Deus-ex-CT-WebApp2/
+-- .htaccess
+-- Anweisungen_und_Anforderungen.md
+-- Anwendungsbeschreibung.md
+-- index.html
+-- manifest.json
+-- README_Implementierung.md
+-- Technische_Dokumentation.md
+-- assets/
â”‚   +-- audio/
â”‚   â”‚   +-- 01-Oberarzt_Dr_med_Placzek.mp3
â”‚   â”‚   +-- 02-Oberarzt_der_Herzen.mp3
â”‚   â”‚   +-- 03-Vier-Eins-Neun-Zwei.mp3
â”‚   â”‚   +-- 04-Pilot_im_Pixelmeer.mp3
â”‚   â”‚   +-- 05-Drei_Gebote.mp3
â”‚   â”‚   +-- 06-Kunst_der_Diagnostik.mp3
â”‚   â”‚   +-- 07-Mit_harter_Hand_und_Charme.mp3
â”‚   â”‚   +-- 08-Durch_Feuer_und_Eis.mp3
â”‚   â”‚   +-- 09-Held_und_Idol.mp3
â”‚   â”‚   +-- 10-Messerscharf_und_Legendaer.mp3
â”‚   â”‚   +-- 11-Oberaerztlicher_Glanz.mp3
â”‚   â”‚   +-- 12-Goetterdaemmerung.mp3
â”‚   +-- downloads/
â”‚   â”‚   +-- Deus_ex_CT_Complete.zip
â”‚   â”‚   +-- Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip
â”‚   +-- images/
â”‚   â”‚   +-- 00-Albumcover.png
â”‚   â”‚   +-- 01-Oberarzt_Dr_med_Placzek.png
â”‚   â”‚   +-- 02-Oberarzt_der_Herzen.png
â”‚   â”‚   +-- 03-Vier-Eins-Neun-Zwei.png
â”‚   â”‚   +-- 04-Pilot_im_Pixelmeer.png
â”‚   â”‚   +-- 05-Drei_Gebote.png
â”‚   â”‚   +-- 06-Kunst_der_Diagnostik.png
â”‚   â”‚   +-- 07-Mit_harter_Hand_und_Charme.png
â”‚   â”‚   +-- 08-Durch_Feuer_und_Eis.png
â”‚   â”‚   +-- 09-Held_und_Idol.png
â”‚   â”‚   +-- 10-Messerscharf_und_Legendaer.png
â”‚   â”‚   +-- 11-Oberaerztlicher_Glanz.png
â”‚   â”‚   +-- 12-Goetterdaemmerung.png
â”‚   +-- lyrics/
â”‚   â”‚   +-- 01-Oberarzt_Dr_med_Placzek.lrc
â”‚   â”‚   +-- 02-Oberarzt_der_Herzen.lrc
â”‚   â”‚   +-- 03-Vier-Eins-Neun-Zwei.lrc
â”‚   â”‚   +-- 04-Pilot_im_Pixelmeer.lrc
â”‚   â”‚   +-- 05-Drei_Gebote.lrc
â”‚   â”‚   +-- 06-Kunst_der_Diagnostik.lrc
â”‚   â”‚   +-- 07-Mit_harter_Hand_und_Charme.lrc
â”‚   â”‚   +-- 08-Durch_Feuer_und_Eis.lrc
â”‚   â”‚   +-- 09-Held_und_Idol.lrc
â”‚   â”‚   +-- 10-Messerscharf_und_Legendaer.lrc
â”‚   â”‚   +-- 11-Oberaerztlicher_Glanz.lrc
â”‚   â”‚   +-- 12-Goetterdaemmerung.lrc
â”‚   +-- video/
â”‚       +-- background/
â”‚       â”‚   +-- 01-Oberarzt_Dr_med_Placzek.mp4
â”‚       â”‚   +-- 02-Oberarzt_der_Herzen.mp4
â”‚       â”‚   +-- 03-Vier-Eins-Neun-Zwei.mp4
â”‚       â”‚   +-- 04-Pilot_im_Pixelmeer.mp4
â”‚       â”‚   +-- 05-Drei_Gebote.mp4
â”‚       â”‚   +-- 06-Kunst_der_Diagnostik.mp4
â”‚       â”‚   +-- 07-Mit_harter_Hand_und_Charme.mp4
â”‚       â”‚   +-- 08-Durch_Feuer_und_Eis.mp4
â”‚       â”‚   +-- 09-Held_und_Idol.mp4
â”‚       â”‚   +-- 10-Messerscharf_und_Legendaer.mp4
â”‚       â”‚   +-- 11-Oberaerztlicher_Glanz.mp4
â”‚       â”‚   +-- 12-Goetterdaemmerung.mp4
â”‚       +-- high/
â”‚       â”‚   +-- 01-Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4
â”‚       â”‚   +-- 02-Oberarzt_der_Herzen_Lyrics_hq.mp4
â”‚       â”‚   +-- 03-Vier-Eins-Neun-Zwei_Lyrics_hq.mp4
â”‚       â”‚   +-- 04-Pilot_im_Pixelmeer_Lyrics_hq.mp4
â”‚       â”‚   +-- 05-Drei_Gebote_Lyrics_hq.mp4
â”‚       â”‚   +-- 06-Kunst_der_Diagnostik_Lyrics_hq.mp4
â”‚       â”‚   +-- 07-Mit_harter_Hand_und_Charme_Lyrics_hq.mp4
â”‚       â”‚   +-- 08-Durch_Feuer_und_Eis_Lyrics_hq.mp4
â”‚       â”‚   +-- 09-Held_und_Idol_Lyrics_hq.mp4
â”‚       â”‚   +-- 10-Messerscharf_und_Legendaer_Lyrics_hq.mp4
â”‚       â”‚   +-- 11-Oberaerztlicher_Glanz_Lyrics_hq.mp4
â”‚       â”‚   +-- 12-Goetterdaemmerung_Lyrics_hq.mp4
â”‚       +-- low/
â”‚       â”‚   +-- 01-Oberarzt_Dr_med_Placzek_Lyrics_low.mp4
â”‚       â”‚   +-- 02-Oberarzt_der_Herzen_Lyrics_low.mp4
â”‚       â”‚   +-- 03-Vier-Eins-Neun-Zwei_Lyrics_low.mp4
â”‚       â”‚   +-- 04-Pilot_im_Pixelmeer_Lyrics_low.mp4
â”‚       â”‚   +-- 05-Drei_Gebote_Lyrics_low.mp4
â”‚       â”‚   +-- 06-Kunst_der_Diagnostik_Lyrics_low.mp4
â”‚       â”‚   +-- 07-Mit_harter_Hand_und_Charme_Lyrics_low.mp4
â”‚       â”‚   +-- 08-Durch_Feuer_und_Eis_Lyrics_low.mp4
â”‚       â”‚   +-- 09-Held_und_Idol_Lyrics_low.mp4
â”‚       â”‚   +-- 10-Messerscharf_und_Legendaer_Lyrics_low.mp4
â”‚       â”‚   +-- 11-Oberaerztlicher_Glanz_Lyrics_low.mp4
â”‚       â”‚   +-- 12-Goetterdaemmerung_Lyrics_low.mp4
â”‚       +-- mid/
â”‚           +-- 01-Oberarzt_Dr_med_Placzek_Lyrics_mid.mp4
â”‚           +-- 02-Oberarzt_der_Herzen_Lyrics_mid.mp4
â”‚           +-- 03-Vier-Eins-Neun-Zwei_Lyrics_mid.mp4
â”‚           +-- 04-Pilot_im_Pixelmeer_Lyrics_mid.mp4
â”‚           +-- 05-Drei_Gebote_Lyrics_mid.mp4
â”‚           +-- 06-Kunst_der_Diagnostik_Lyrics_mid.mp4
â”‚           +-- 07-Mit_harter_Hand_und_Charme_Lyrics_mid.mp4
â”‚           +-- 08-Durch_Feuer_und_Eis_Lyrics_mid.mp4
â”‚           +-- 09-Held_und_Idol_Lyrics_mid.mp4
â”‚           +-- 10-Messerscharf_und_Legendaer_Lyrics_mid.mp4
â”‚           +-- 11-Oberaerztlicher_Glanz_Lyrics_mid.mp4
â”‚           +-- 12-Goetterdaemmerung_Lyrics_mid.mp4
+-- css/
â”‚   +-- styles.css
+-- js/
    +-- app.js
    +-- download.js
    +-- lyrics.js
    +-- mediasession.js
    +-- player.js
    +-- playlist.js

--- 

 
--- 

/.htaccess:

```htaccess
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    RewriteCond %{HTTPS} !=on
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    Options -Indexes

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !/\.git [NC]
    RewriteCond %{REQUEST_URI} !/\.well-known [NC]
    RewriteRule ^ index.html [L]
</IfModule>

<IfModule mod_mime.c>
    AddType text/plain .lrc
    AddType application/json .json
    AddType application/manifest+json .webmanifest
    AddType audio/mpeg .mp3
    AddType audio/mpeg .m4a
    AddType video/mp4 .mp4
    AddType image/png .png
    AddType image/jpeg .jpg
    AddType image/jpeg .jpeg
    AddType image/x-icon .ico
    AddType image/svg+xml .svg
    AddType text/javascript .js
    AddType text/css .css
    AddType application/font-woff2 .woff2
    AddType application/font-woff .woff
    AddEncoding gzip .js.gz
    AddEncoding gzip .css.gz
</IfModule>

<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
    Header set Access-Control-Allow-Origin "*"
    Header set Accept-Ranges "bytes"
    
    Header set Vary "Accept-Encoding"
</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    AddOutputFilter DEFLATE js css json html xml svg
</IfModule>

<FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, must-revalidate, max-age=0"
    Header set Pragma "public"
    Header set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
    Header unset ETag
    Header unset Last-Modified
</FilesMatch>

<FilesMatch "\.(js|css)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Pragma "public"
</FilesMatch>

<FilesMatch "\.(mp3|m4a|mp4|webm|ogg)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Accept-Ranges "bytes"
    Header set Pragma "public"
</FilesMatch>

<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Pragma "public"
</FilesMatch>

<FilesMatch "\.(json|webmanifest)$">
    Header set Cache-Control "public, must-revalidate, max-age=3600"
    Header set Pragma "public"
</FilesMatch>

<FilesMatch "\.(lrc)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Content-Type "text/plain; charset=utf-8"
</FilesMatch>

<IfModule mod_expires.c>
    ExpiresActive On
    
    ExpiresByType text/html "now"
    ExpiresByType application/json "now"
    ExpiresByType application/manifest+json "access plus 1 hour"
    
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType text/javascript "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    
    ExpiresByType audio/mpeg "access plus 1 year"
    ExpiresByType audio/m4a "access plus 1 year"
    ExpiresByType video/mp4 "access plus 1 year"
    ExpiresByType video/webm "access plus 1 year"
    
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    
    ExpiresByType text/plain "access plus 1 year"
</IfModule>

<IfModule mod_env.c>
    SetEnv HTTPS on
</IfModule>

<IfModule mod_dir.c>
    DirectoryIndex index.html index.php
</IfModule>

<IfModule mod_rewrite.c>
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} \.php$
    RewriteRule ^(.*)$ index.html [L]
</IfModule>
```

 
--- 

/Anweisungen_und_Anforderungen.md:

```md
# Anweisungen und Anforderungen - Deus ex CT WebApp v11.0

## 1. Projektziel

Entwicklung einer hochmodernen, responsiven Single Page Application (SPA) zur PrÃ¤sentation des Albums "Deus ex CT" von Oberarzt Dr. med. Placzek. Die Anwendung fungiert als hybrider Musik- und Video-Player mit Fokus auf einem linearen, immersiven Erlebnis ohne Ablenkung durch unnÃ¶tige UI-Elemente.

Die Anwendung wurde speziell optimiert fÃ¼r Mobile-GerÃ¤te (iOS und Android) mit Fokus auf ZuverlÃ¤ssigkeit, Performance und nahtlose Wiedergabe unter variablen Netzwerkbedingungen.

**Version 11.0** beinhaltet kritische Fixes fÃ¼r Mobile-Wiedergabeprobleme:
- Aggressive Cache-Invalidierung (Timestamp-basiert)
- iOS User-Gesture Context Preservation
- Stall-Recovery mit Exponential Backoff (500ms â†’ 4s)
- Event-Listener Race Condition Fixes
- Robustes Error-Handling mit State Differentiation

---

## 2. Asset-Struktur & Inhalte

Die Anwendung arbeitet mit der folgenden vorgegebenen, **unverÃ¤nderlichen Dateistruktur**.

### 2.1 Verzeichnisstruktur (EXAKT)

```
/
â”œâ”€â”€ index.html                           # SPA Entry Point mit Cache-Management
â”œâ”€â”€ manifest.json                        # PWA Manifest (standalone display)
â”œâ”€â”€ .htaccess                            # Apache-Konfiguration
â”œâ”€â”€ css/
â”‚   â””â”€â”€ styles.css                       # Dark Mode + Gold Akzente (#d4af37)
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ playlist.js                      # PlaylistManager (12 Tracks, linear)
â”‚   â”œâ”€â”€ lyrics.js                        # LyricsManager (LRC-Parsing, 3-Zeilen-View)
â”‚   â”œâ”€â”€ player.js                        # PlayerEngine (Core Audio/Video Control)
â”‚   â”œâ”€â”€ mediasession.js                  # Media Session API Integration
â”‚   â”œâ”€â”€ download.js                      # DownloadManager (3 Optionen)
â”‚   â””â”€â”€ app.js                           # App Controller (UI + Events)
â””â”€â”€ assets/
    â”œâ”€â”€ audio/                           # 12 MP3-Dateien (128 Kbps, ~2-5 MB each)
    â”‚   â””â”€â”€ 01-12-*.mp3
    â”œâ”€â”€ downloads/                       # ZIP-Archive (exakte Namen!)
    â”‚   â”œâ”€â”€ Deus_ex_CT_Complete.zip
    â”‚   â””â”€â”€ Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip
    â”œâ”€â”€ images/                          # PNG Artwork (512Ã—512px)
    â”‚   â”œâ”€â”€ 00-Albumcover.png
    â”‚   â””â”€â”€ 01-12-*.png
    â”œâ”€â”€ lyrics/                          # LRC-Dateien ([mm:ss.cc]Format)
    â”‚   â””â”€â”€ 01-12-*.lrc
    â””â”€â”€ video/
        â”œâ”€â”€ background/                  # Loop-Videos Audio-Modus (MP4, muted)
        â”‚   â””â”€â”€ 01-12-*.mp4
        â”œâ”€â”€ low/                         # Lyrics-Videos 360p (~2-3 MB)
        â”‚   â””â”€â”€ 01-12-*_Lyrics_low.mp4
        â”œâ”€â”€ mid/                         # Lyrics-Videos 720p (~7-8 MB) DEFAULT
        â”‚   â””â”€â”€ 01-12-*_Lyrics_mid.mp4
        â””â”€â”€ high/                        # Lyrics-Videos 1080p (~15-20 MB)
            â””â”€â”€ 01-12-*_Lyrics_hq.mp4
```

### 2.2 Tracklist (12 Tracks, EXAKT)

```
ID  Nr   Titel                            Dauer  Slug
1   01   Oberarzt Dr. med. Placzek        02:12  oberarzt-dr-med-placzek
2   02   Oberarzt der Herzen              03:32  oberarzt-der-herzen
3   03   Vier-Eins-Neun-Zwei              04:14  vier-eins-neun-zwei
4   04   Pilot im Pixelmeer               03:59  pilot-im-pixelmeer
5   05   Drei Gebote                      03:54  drei-gebote
6   06   Kunst der Diagnostik             03:26  kunst-der-diagnostik
7   07   Mit harter Hand und Charme       03:46  mit-harter-hand-und-charme
8   08   Durch Feuer und Eis              03:09  durch-feuer-und-eis
9   09   Held und Idol                    04:02  held-und-idol
10  10   Messerscharf und LegendÃ¤r        03:19  messerscharf-und-legendaer
11  11   OberÃ¤rztlicher Glanz             03:14  oberaerztlicher-glanz
12  12   GÃ¶tterdÃ¤mmerung                  05:03  goetterdaemmerung

Album Total: 40:50 (2.450 Sekunden)
```

**Datei-Benennung (EXAKT):**
- Audio: `NN-Trackname.mp3` (z.B. `01-Oberarzt_Dr_med_Placzek.mp3`)
- Images: `NN-Trackname.png` (z.B. `01-Oberarzt_Dr_med_Placzek.png`)
- Lyrics: `NN-Trackname.lrc` (z.B. `01-Oberarzt_Dr_med_Placzek.lrc`)
- Background Video: `NN-Trackname.mp4` (z.B. `01-Oberarzt_Dr_med_Placzek.mp4`)
- Video LOW: `NN-Trackname_Lyrics_low.mp4`
- Video MID: `NN-Trackname_Lyrics_mid.mp4`
- Video HQ: `NN-Trackname_Lyrics_hq.mp4`

---

## 3. Funktionale Anforderungen

### 3.1 Dualer Wiedergabe-Modus

Die App muss nahtlos zwischen zwei Modi wechseln kÃ¶nnen via `PlayerEngine.switchMode(mode, preservePosition)`.

#### Audio-Modus (`mode === 'audio'`)

**Wiedergabe:**
- MP3-Datei aus `assets/audio/{NN}-{Titel}.mp3` (128 Kbps)
- Direkt vom `<audio>` Element (keine Dekodierung nÃ¶tig)

**Hintergrund-Visualisierung:**
- Loop-Video aus `assets/video/background/{NN}-{Titel}.mp4`
- Eigenschaften: **stummgeschaltet**, **geloopt**, **abgedunkelt**
- `<video>` mit `muted`, `loop`, `playsinline` Attributen
- `.bg-video-overlay` mit halbtransparenter schwarzer Schicht
- Video startet beim Audio-Play, pausiert beim Audio-Pause

**Lyrics-Anzeige (3-Zeilen-Stack):**
```
[Ausgegraut]         â† Vorherige Zeile (opacity: 0.4, blur)
[High-Contrast Gold] â† Aktuelle Zeile (color: #d4af37, font-weight: 600)
[Sichtbar]          â† NÃ¤chste Zeile (normal)
```
- Synchronisation: `LyricsManager.updateCurrentLine(currentTime)`
- Animation: Fade-Out/Fade-In 300ms CSS-Transition (`.lyric-fade-out`, `.lyric-fade-in`)
- Keine Ruckler: Binary-Search im LyricsManager

#### Video-Modus (`mode === 'video'`)

**Wiedergabe:**
- Lyrics-Video MP4 aus `assets/video/{quality}/{NN}-{Titel}_Lyrics_{quality}.mp4`
- Audio kommt direkt aus Videodatei (synchronisiert)
- QualitÃ¤t: Manuelle Auswahl oder Automatisch (Network Information API)

**QualitÃ¤tsoptionen (3 Stufen):**
```
LOW  360p  ~100-200 Mbps   2-3 MB pro 3-Min-Track
MID  720p  ~300-500 Mbps   7-8 MB pro 3-Min-Track (DEFAULT)
HQ   1080p ~800-1200 Mbps  15-20 MB pro 3-Min-Track
```

**Adaptive Bitrate-Auswahl:**
```javascript
if (navigator.connection.saveData) â†’ LOW
if (effectiveType === '2g' || '3g') â†’ LOW
if (downlink < 1.5 Mbps) â†’ LOW
if (downlink < 5 Mbps) â†’ MID
else â†’ MID (Desktop default, HQ optional)
```

**Video-Rendering:**
- `<video>` mit `object-fit: contain` (keine Beschnitte)
- Responsive Breite, feste Aspect-Ratio 4:3 oder 16:9
- **KRITISCH:** Controls befinden sich **UNTERHALB** des Videos, nicht als Overlay
- QualitÃ¤ts-Tasten: LOW, MID, HQ (unter Video, aktive Taste: Gold-Highlight)
- Fullscreen-Button (native Fullscreen API + iOS Fallback)

**QualitÃ¤ts-Wechsel-Logik:**
- Unterbricht Wiedergabe **NICHT**
- Seekt zur aktuellen Position im neuen Video
- Minimale VerzÃ¶gerung (200-500ms re-buffering)
- Speichert QualitÃ¤t in `localStorage.deusExCT_quality`

### 3.2 Player-Steuerung

**Transport-Controls:**
- **Play/Pause** (`PlayerEngine.play()`, `PlayerEngine.pause()`)
  - iOS: Wartet auf User-Gesture (Tap)
  - Android: Direkt mÃ¶glich nach initiales Tap
  - Fallback: `pendingPlayRequest` bei NotAllowedError
- **Vorheriger Track** (`PlaylistManager.moveToPrevious()`)
  - Track 01: Springt zu Position 0 (kein Ringel)
  - Track 02-12: Spring zum vorherigen Track
- **NÃ¤chster Track** (`PlaylistManager.moveToNext()`)
  - Track 01-11: Springt zum nÃ¤chsten Track
  - Track 12: Stoppt (kein Auto-Ringel)

**Navigation (Seek-Bar):**
- Timeline: 0% â†’ 100% (linearer Fortschritt)
- **Time-Tooltip bei Hover:**
  - Zeigt exakte Zeit beim Hovern Ã¼ber die Bar
  - Format: `mm:ss`
  - Berechnet: `(mouseX / barWidth) * duration`
- **Drag-to-Seek:**
  - Touch + Drag auf Mobile
  - Mouse-Drag auf Desktop
  - Smooth Seeking ohne Ruckler

**LautstÃ¤rke:**
- **Regler:** 0% â†’ 100%
- **Mute-Button:** Speichert letzte LautstÃ¤rke
- **Icons:**
  - Muted: ğŸ”‡ (fa-volume-mute)
  - Low: ğŸ”‰ (fa-volume-low)
  - High: ğŸ”Š (fa-volume-high)
- **Persistierung:** `localStorage.deusExCT_volume`, `deusExCT_muted`

**Logik: Lineare Wiedergabe (NO Shuffle/Repeat!)**
- Album wird Track 01 â†’ 12 abgespielt
- Nach Track 12 stoppt die Wiedergabe automatisch
- **Keine** Shuffle-, Repeat-, oder Loop-Funktionen
- NÃ¤chster Track wird pregeladen (`preloadNextTrack()`)

### 3.3 Lyrics-Integration

**LRC-Format (Standard):**
```lrc
[ti:Trackname]
[ar:KÃ¼nstler]
[al:Album]
[mm:ss.cc]Lied-Text
[mm:ss.cc]NÃ¤chste Zeile
```

**Synchronisation:**
- Binary-Search fÃ¼r schnelle Zeilen-Findung (`binarySearchLineIndex()`)
- Â±0.016s Genauigkeit (60 FPS)
- Event: `LyricsManager.setOnLyricChange(callback)`

**Anzeige: 3-Zeilen-Stack**
- **Vorherige Zeile** (`prevLine`)
  - opacity: 0.4
  - filter: blur(2px)
  - aria-hidden="true"
- **Aktuelle Zeile** (`currentLine`)
  - color: #d4af37 (Gold)
  - font-weight: 600
  - font-size: grÃ¶ÃŸer
  - aria-label="Aktueller Songtext"
- **NÃ¤chste Zeile** (`nextLine`)
  - opacity: 0.7
  - normal size
  - aria-hidden="true"

**Animation (Weich):**
- Fade-Out: 300ms (`.lyric-fade-out`)
- Text-Austausch: Instantan
- Fade-In: 300ms (`.lyric-fade-in`)
- Keine Motion-Sickness: `prefers-reduced-motion` Support

**Fehlerbehandlung:**
- Wenn LRC nicht geladen: Leere Lyrics-Anzeige
- Wenn LRC fehlerhaft: Graceful Degradation
- Wenn zu langsam: Binary-Search verhindert Lag

### 3.4 Zentrale Download-Funktion

**Trigger:** Cloud-Icon oben rechts (`#headerDownloadBtn`)

**Modal zeigt 3 kontextsensitive Optionen:**

#### Option 1: Aktuelles Video (HQ)
- **Bedingung:** Nur aktiv wenn:
  - `currentMode === 'video'`
  - Track lÃ¤dt/spielt
- **Dateiname:** `{TrackNumber}-{Title}_Lyrics_hq.mp4`
- **GrÃ¶ÃŸe:** ~60-100 MB pro Video
- **Funktion:** Direkter Download via `<a download>` Tag
- **Fallback:** `DownloadManager.downloadVideoInNewTab()` (neuer Tab)

#### Option 2: Album (MP3)
- **Dateiname:** `Deus_ex_CT_Complete.zip` (exakt!)
- **Inhalt:** Alle 12 MP3-Dateien
- **GrÃ¶ÃŸe:** ~120-150 MB (128 Kbps Ã— 12 Tracks Ã— ~2-5 Min)
- **Pfad:** `assets/downloads/Deus_ex_CT_Complete.zip`
- **Funktion:** Direkter Link, Browser-Download

#### Option 3: Alle Videos (HQ)
- **Dateiname:** `Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip` (exakt!)
- **Inhalt:** Alle 12 HQ-Videos
- **GrÃ¶ÃŸe:** ~700-1000 MB (15-20 MB Ã— 12)
- **Pfad:** `assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip`
- **Funktion:** Direkter Link, Browser-Download

**Download-Manager Features:**
- **Concurrent Downloads:** Max 3 parallel (konfigurierbar)
- **Progress Tracking:** Bytes downloaded / Total Bytes
- **Time Estimation:** `estimateDownloadTime(fileSize, networkSpeed)`
- **History:** Letzten Downloads (localStorage)
- **Queue Management:** Downloads in Reihe

---

## 4. UI/UX Design Anforderungen

### 4.1 Layout-Konzept

**"Holy Grail" Flexbox-Spalten-Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header (fixiert, ~60px)               â”‚  - Titel-Lauftext
â”‚                                        â”‚  - Modus-Schalter (Audio/Video)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - Download-Button
â”‚                                        â”‚
â”‚  Main Content (flex: 1, scrollbar)     â”‚  - Album-View: Playlist
â”‚                                        â”‚  - Player-View: Audio/Video
â”‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Bottom Bar (fixiert, ~80px)           â”‚  - Progress-Bar
â”‚                                        â”‚  - Play/Pause, Prev, Next
â”‚  Mini-Player (fixiert, ~60px)          â”‚  - Volume Control
â”‚  (nur wenn playing)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ResponsivitÃ¤t & Video-Darstellung

**Viewport-GrÃ¶ÃŸen:**
- **Mobile:** 320px - 640px (iPhone)
- **Tablet:** 640px - 1024px (iPad)
- **Desktop:** 1024px+ (Browser)

**Video-Container:**
- Nutzt `flex: 1` fÃ¼r maximalen verfÃ¼gbaren Platz
- **SeitenverhÃ¤ltnis:** 4:3 oder 16:9 (abhÃ¤ngig von Video-Quelle)
- `object-fit: contain` verhindert Beschnitt (Letterboxing/Pillarboxing)
- Video bleibt immer **vollstÃ¤ndig sichtbar**

**Video-Controls:**
- **Position:** Leiste **UNTERHALB** des Videos (nicht overlay!)
- **HÃ¶he:** ~50px (QualitÃ¤t-Buttons + Fullscreen-Button)
- **Hintergrund:** Semi-transparent schwarz
- **Sticky:** Bleibt sichtbar auch wenn gescrollt

### 4.3 Visueller Stil

**Thema:**
- **Dark Mode:** Hintergrund #000000, Text #ffffff
- **Gold-Akzente:** #d4af37 (aktive Buttons, aktuelle Lyrics, Hover-States)
- **Kontrast:** WCAG AA minimum (4.5:1 fÃ¼r Text)

**Effekte:**
- **Glassmorphism:** Blur + Transparenz auf Bars/Modals
  - `backdrop-filter: blur(10px)`
  - `background: rgba(0, 0, 0, 0.8)`
- **Animationen:** Smooth CSS-Transitions
  - Play-Button rotation: 200ms
  - Lyrics-Wechsel: 300ms Fade
  - Modal-Entrance: 150ms Slide-Up

**Schrift:**
- **Font:** Inter (Google Fonts)
- **Gewichte:** 400 (normal), 500 (medium), 600 (bold), 700 (extra bold)
- **GrÃ¶ÃŸen:** 14px (small), 16px (normal), 18px (large), 24px (heading)

---

## 5. Technische Anforderungen

### 5.1 Tech-Stack

- **Frontend:** HTML5, CSS3, Vanilla JavaScript (ES6+)
- **KEINE Frameworks:** Kein React, Vue, Angular
- **Modularisierung:** Revealing Module Pattern (Closure-basiert)
- **Build-Tools:** Keine (kein Webpack, kein Babel)
- **Mindestversion:** IE 11 **NICHT** unterstÃ¼tzt (ES6)

### 5.2 Browser-APIs

**Erforderlich:**
- **HTML5 Media API:** `<audio>`, `<video>` mit Events
- **Fullscreen API:** `requestFullscreen()` + Fallbacks
- **Fetch API:** CORS-enabled
- **LocalStorage:** Persistierung (5-10 MB pro Origin)
- **RequestAnimationFrame:** Smooth Updates

**Optional aber implementiert:**
- **Media Session API:** Sperrbildschirm-Controls
- **Network Information API:** Adaptive Quality
- **Promise API:** Async Operations

### 5.3 Progressive Web App (PWA)

**manifest.json:**
```json
{
  "name": "Deus ex CT - Das Album",
  "short_name": "Deus ex CT",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#000000",
  "icons": [
    { "src": "assets/images/00-Albumcover.png", "sizes": "192x192", "type": "image/png", "purpose": "any maskable" },
    { "src": "assets/images/00-Albumcover.png", "sizes": "512x512", "type": "image/png", "purpose": "any maskable" }
  ]
}
```

**Installation:**
- **iOS:** Share â†’ Zum Startbildschirm
- **Android:** Menu â†’ Zum Startbildschirm
- **Desktop:** Browser-Install-Prompt (Chrome/Edge)

**Offline-FunktionalitÃ¤t:** **ENTFERNT in v11.0**
- Kein Service Worker mehr
- Nur HTTP-Caching via `.htaccess`
- Bessere ZuverlÃ¤ssigkeit

### 5.4 Cache-Strategie (v11.0)

**HTTP-Header (via `.htaccess`):**

```apache
# HTML: IMMER neu laden
Cache-Control: max-age=0, must-revalidate

# JS/CSS: 1 Jahr (da versioniert)
Cache-Control: max-age=31536000, immutable

# Medien (MP3/MP4): 1 Jahr
Cache-Control: max-age=31536000, immutable

# manifest.json: 1 Stunde
Cache-Control: max-age=3600
```

**Versionierung (Timestamp-basiert):**
```javascript
var BUILD_VERSION = '11.0';
var BUILD_TIMESTAMP = Math.floor(Date.now() / 1000);
var ASSET_VERSION = BUILD_VERSION + '.' + BUILD_TIMESTAMP;
// Script-URLs: js/app.js?v=11.0.1672531200
```

**Client-Side Cleanup (index.html):**
- IndexedDB: Alle Datenbanken lÃ¶schen
- LocalStorage: Nicht clearen (Player-State speichern)
- Browser Caches: Via Caches API
- Service Workers: Alle deregistrieren

---

## 6. Mobile-spezifische Anforderungen

### 6.1 iOS-Optimierungen

**User-Gesture Context:**
- Play wird erst nach Tap aktiviert
- `setupUserInteractionDetection()` in PlayerEngine
- Bei `NotAllowedError`: `pendingPlayRequest = true`
- NÃ¤chster Tap wird gequeued

**Stall-Recovery (Exponential Backoff):**
- Delays: 500ms â†’ 1000ms â†’ 2000ms â†’ 4000ms
- Nur wenn `playbackState === PLAYING`
- Nur fÃ¼r aktuellen Track (Track-ID Check)
- Max 4 Retries pro Stall

**readyState PrÃ¼fung:**
- Event-Listener VOR `.load()` setzen
- readyState nach load() prÃ¼fen (`readyState >= 3`)
- Handler sofort aufrufen wenn bereits bereit

**Fullscreen:**
- Native `requestFullscreen()` + `webkitEnterFullscreen()` Fallback
- Portrait-Mode wird NICHT erzwungen
- Escape-Key beendet Fullscreen

### 6.2 Android-Optimierungen

**CORS-Support:**
- `crossorigin="anonymous"` auf ALL Media-Elementen
- `.htaccess`: `Header set Access-Control-Allow-Origin "*"`

**Video-Attribute (x5-Player):**
- `playsinline` + `webkit-playsinline` + `x5-playsinline`
- `x5-video-player-type="h5"`
- `x5-video-player-fullscreen="false"`

**Error-Handling:**
- `NotAllowedError`: Pending-Play setzen
- `AbortError`: Stille Behandlung (User navigated away)
- `NetworkError`: Retry mit Exponential Backoff

### 6.3 Netzwerk-Handling

**Adaptive Quality:**
```javascript
if (navigator.connection.saveData) currentQuality = 'low';
else if (effectiveType === '3g') currentQuality = 'low';
else if (downlink < 1.5 Mbps) currentQuality = 'low';
else if (downlink < 5 Mbps) currentQuality = 'mid';
else currentQuality = 'mid';
```

**Retry-Logic:**
- PlaybackAttempts: Max 5
- Delays: 100ms Ã— (1.5 ^ attempt)
- Stall-Recovery: 4 Stufen (500ms-4s)

---

## 7. Abnahmekriterien (v11.0)

| Kriterium | Status | Implementiert |
|-----------|--------|---------------|
| âœ… Kein Shuffle/Repeat | ERFÃœLLT | Nur lineare Wiedergabe |
| âœ… Video-Controls nicht Ã¼berlagert | ERFÃœLLT | `.video-external-controls` unter Video |
| âœ… Lyrics weich animiert | ERFÃœLLT | 300ms Fade-Out/Fade-In |
| âœ… Download-Modal kontextsensitiv | ERFÃœLLT | Option 1 nur bei Video |
| âœ… Tooltip auf Progress-Bar | ERFÃœLLT | `#timeTooltip` mit `mm:ss` |
| âœ… PWA-Installation | ERFÃœLLT | manifest.json + standalone |
| âœ… Offline-FunktionalitÃ¤t | ENTFERNT | v11.0: Kein SW mehr |
| âœ… Mobile-Optimierungen | ERFÃœLLT | iOS Gesture, Android CORS, Adaptive Quality |
| âœ… Error-Recovery | ERFÃœLLT | Stall-Recovery, Playback-Retry, Mode-Fallback |
| âœ… Performance | ERFÃœLLT | <2s Page-Load, <1s Audio-Start, <3s Video-Start |
| âœ… Media Session API | ERFÃœLLT | Sperrbildschirm-Controls |
| âœ… Fullscreen API | ERFÃœLLT | Alle 5 Browser-Fallbacks |
| âœ… Cache-Strategy | ERFÃœLLT | Zero-Cache HTML, 1-Jahr Assets |
| âœ… Keyboard-Shortcuts | ERFÃœLLT | Space, Pfeile, F, Esc, M |
| âœ… Accessibility (WCAG AA) | ERFÃœLLT | ARIA-Labels, Semantic HTML, Screen-Reader |

---

## 8. Testing-Checkliste (Production-Ready)

### Browser-KompatibilitÃ¤t
- [ ] Chrome 90+ (Desktop & Android)
- [ ] Firefox 88+ (Desktop & Android)
- [ ] Safari 14+ (Desktop & iOS)
- [ ] Edge 90+ (Desktop)
- [ ] Samsung Internet 15+ (Android)

### FunktionalitÃ¤t
- [ ] Audio-Modus: Hintergrund-Video lÃ¤uft + Lyrics sync
- [ ] Video-Modus: QualitÃ¤ts-Wechsel funktioniert
- [ ] Lyrics: Synchronisieren mit Â±0.016s Genauigkeit
- [ ] Downloads: Alle 3 Optionen funktionieren
- [ ] Keyboard: Space, Pfeile, F, Esc, M alle funktional
- [ ] Media Session: Sperrbildschirm-Controls funktionieren
- [ ] Fullscreen: Alle Fallbacks funktionieren

### Performance
- [ ] Page-Load: <2 Sekunden
- [ ] Audio-Start: <1 Sekunde
- [ ] Video-Start: <3 Sekunden (je nach Netzwerk)
- [ ] Memory: Keine Leaks (DevTools)
- [ ] FPS: 60 FPS bei Animationen

### PWA
- [ ] iOS: App auf Homescreen installierbar
- [ ] Android: App auf Homescreen installierbar
- [ ] Offline: HTML/CSS/JS funktionieren (cached)
- [ ] Manifest: Keine Fehler (DevTools)

### Mobile-spezifisch
- [ ] iOS Safari: User-Gesture funktioniert
- [ ] iOS Safari: Stall-Recovery aktiv
- [ ] Android Chrome: CORS funktioniert
- [ ] Android Chrome: x5-Player kompatibel
- [ ] Slow 3G: Adaptive Quality aktiv

### Cache & Versionierung
- [ ] HTML: `Cache-Control: max-age=0` (DevTools)
- [ ] JS/CSS: `Cache-Control: immutable` + Versioning
- [ ] Version-Wechsel: Alle alten Caches gelÃ¶scht
- [ ] localStorage: Nur Player-State erhalten

### Barrierefreiheit
- [ ] Screen-Reader: Alle Buttons haben Labels
- [ ] Keyboard: Alle Funktionen ohne Mouse erreichbar
- [ ] Kontrast: Minimum 4.5:1 fÃ¼r Text
- [ ] Focus-Management: Tab-Order logisch

---

## 9. Deployment-Anleitung (Production)

### 1. Server-Anforderungen
- Apache 2.4+ mit mod_rewrite
- HTTPS (erforderlich fÃ¼r PWA + Media Session API)
- Mindestens 5GB Storage (Assets)
- PHP 7.4+ (optional, fÃ¼r Logging)

### 2. Datei-Upload
```bash
# FTP zu Server (case-sensitive!)
scp -r ./* user@host:/public_html/
```

### 3. Konfiguration
```bash
# .htaccess Rechte
chmod 644 .htaccess

# Cache-Clearing (falls nÃ¶tig)
rm -rf /tmp/cloudflare_cache
service apache2 restart
```

### 4. Verifizierung
```bash
# HTTPS Check
curl -I https://deus-ex-ct.markuslurz.de/
# Sollte zeigen: Cache-Control: max-age=0

# Accept-Ranges Check
curl -I https://deus-ex-ct.markuslurz.de/assets/video/mid/01-*.mp4
# Sollte zeigen: Accept-Ranges: bytes

# manifest.json Check
curl https://deus-ex-ct.markuslurz.de/manifest.json | jq .
# Sollte JSON ohne Fehler sein
```

---

## 10. Kontakt & Support

**Bei Problemen:**
1. PrÃ¼fen Sie die Fehlerbehebungs-Sektion (siehe `Anwendungsbeschreibung.md`)
2. Nutzen Sie Browser-DevTools (F12 â†’ Console/Network)
3. Kontaktieren Sie IONOS-Support fÃ¼r `.htaccess` Probleme
4. Aktivieren Sie Debug-Logging in localStorage (siehe `Technische_Dokumentation.md`)

```

 
--- 

/Anwendungsbeschreibung.md:

```md
# Anwendungsbeschreibung - Deus ex CT WebApp v11.0

## ğŸµ Ãœberblick

**Deus ex CT** ist eine hochmoderne Progressive Web App (PWA) zur PrÃ¤sentation des Albums "Deus ex CT" von Oberarzt Dr. med. Placzek. Die Anwendung bietet ein immersives Musik- und Video-Streaming-Erlebnis mit Fokus auf QualitÃ¤t, ZuverlÃ¤ssigkeit und Benutzerfreundlichkeit auf mobilen GerÃ¤ten.

**Version 11.0 (Dezember 2024)** beinhaltet kritische Optimierungen fÃ¼r Mobile-GerÃ¤te:
- Aggressive Cache-Invalidierung (Timestamp-basiert)
- iOS User-Gesture Context Preservation
- Stall-Recovery mit Exponential Backoff
- Robustes Error-Handling

---

## ğŸ¯ Features & FunktionalitÃ¤t

### Kern-Features

| Feature | Beschreibung | Status |
|---------|-------------|--------|
| **Dualer Wiedergabe-Modus** | Audio + Video | âœ… Implementiert |
| **Live Lyrics-Synchronisation** | 3-Zeilen-Stack mit Binary-Search | âœ… Implementiert |
| **Adaptive Video-QualitÃ¤t** | LOW/MID/HQ basierend auf Netzwerk | âœ… Implementiert |
| **Progressive Web App** | Installation auf Homescreen | âœ… Implementiert |
| **Media Session API** | Sperrbildschirm-Controls | âœ… Implementiert |
| **Fullscreen-Support** | Native Fullscreen API + iOS Fallback | âœ… Implementiert |
| **Multi-Download-Optionen** | Audio, Videos, Einzelne Videos | âœ… Implementiert |
| **Keyboard-Shortcuts** | Space, Pfeile, F, Esc, M | âœ… Implementiert |
| **Barrierefreiheit (WCAG AA)** | ARIA-Labels, Screen-Reader Support | âœ… Implementiert |
| **Mobile-Optimierungen** | iOS Gesture, Android CORS, Adaptive Quality | âœ… Implementiert |

---

## ğŸ“± BenutzeroberflÃ¤che

### Layout-Struktur

Die Anwendung folgt einem flexiblen Spalten-Layout mit folgenden Hauptkomponenten:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEADER (fixiert, ~60px)                                     â”‚
â”‚ â€¢ Album-Titel (Lauftext bei Overflow)                      â”‚
â”‚ â€¢ Modus-Schalter (Audio / Video)                           â”‚
â”‚ â€¢ Download-Button (Cloud-Icon)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ MAIN CONTENT (flex: 1, scrollbar)                           â”‚
â”‚                                                             â”‚
â”‚ Album-View:                                                â”‚
â”‚ â€¢ Album-Cover (512Ã—512px, zentral)                         â”‚
â”‚ â€¢ Album-Info (Titel, KÃ¼nstler, 12 Songs, 40:50)           â”‚
â”‚ â€¢ Tracklist (scrollbar, 12 EintrÃ¤ge)                       â”‚
â”‚ â€¢ Play-All & Download-Buttons                              â”‚
â”‚                                                             â”‚
â”‚ Audio-View:                                                â”‚
â”‚ â€¢ Background-Video (geloopt, abgedunkelt)                  â”‚
â”‚ â€¢ Lyrics-Stack (3 Zeilen, Live-Sync)                       â”‚
â”‚                                                             â”‚
â”‚ Video-View:                                                â”‚
â”‚ â€¢ Lyrics-Video (responsive, object-fit: contain)           â”‚
â”‚ â€¢ Video-Controls (under Video)                             â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BOTTOM BAR (fixiert, ~80px)                                â”‚
â”‚ â€¢ Progress-Bar mit Time-Tooltip                            â”‚
â”‚ â€¢ Play/Pause, Prev, Next Buttons                           â”‚
â”‚ â€¢ Volume-Control + Mute-Button                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MINI-PLAYER (fixiert, ~60px, nur wenn playing)             â”‚
â”‚ â€¢ Track-Artwork (64Ã—64px)                                  â”‚
â”‚ â€¢ Track-Title + aktuelle Lyric-Zeile                       â”‚
â”‚ â€¢ Play/Pause, Prev, Next (kompakt)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Responsive Design

Die Anwendung ist vollstÃ¤ndig responsive und optimiert fÃ¼r:

- **Mobile (320px - 640px):** iPhone SE, iPhone 12/13/14
- **Tablet (640px - 1024px):** iPad Air, iPad Pro
- **Desktop (1024px+):** Chrome, Firefox, Safari, Edge

**Video-Darstellung:**
- Nutzt verfÃ¼gbaren Platz maximal (flex: 1)
- `object-fit: contain` verhindert Beschnitte
- SeitenverhÃ¤ltnis: 4:3 oder 16:9 (abhÃ¤ngig von Video-Quelle)
- Video bleibt immer **vollstÃ¤ndig sichtbar** (Letterboxing/Pillarboxing)

---

## ğŸ¼ Album-Ansicht

### Startseite

Die Startseite zeigt das komplette Album mit allen Metadaten und Steueroptionen.

**Elemente:**
- **Album-Cover:** `assets/images/00-Albumcover.png` (512Ã—512px)
  - CSS `box-shadow` mit Tiefenwirkung
  - Responsive GrÃ¶ÃŸe (max 400px Mobile, max 512px Desktop)
  - PNG mit Transparenz-Support

- **Album-Info:**
  - **Titel:** "Deus ex CT"
  - **KÃ¼nstler:** "Oberarzt Dr. med. Placzek"
  - **Info-Text:** "12 Songs â€¢ 40 Minuten 50 Sekunden"
  - **Gesamtalbum-Dauer:** 2.450 Sekunden

- **Action-Buttons:**
  - **â–¶ï¸ Album abspielen** (`playAllBtn`)
    - Startet Wiedergabe von Track 01 im Audio-Modus
    - Callback: `App.playTrack(firstTrack, 'audio')`
  - **ğŸ¬ Alle Videos (HQ)** (`downloadAllVideosBtn`)
    - Ã–ffnet Download-Modal
    - ZIP: `Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip`
  - **ğŸ“¦ Album MP3s** (`downloadAlbumBtn`)
    - Ã–ffnet Download-Modal
    - ZIP: `Deus_ex_CT_Complete.zip`

### Tracklist (12 Tracks, linear)

| # | Trackname | Dauer | Slug | Audio-Datei | Bild | Lyrics | BG-Video |
|---|-----------|-------|------|-------------|------|--------|----------|
| 01 | Oberarzt Dr. med. Placzek | 02:12 | `oberarzt-dr-med-placzek` | `01-Oberarzt_Dr_med_Placzek.mp3` | `01-Oberarzt_Dr_med_Placzek.png` | `01-Oberarzt_Dr_med_Placzek.lrc` | `01-Oberarzt_Dr_med_Placzek.mp4` |
| 02 | Oberarzt der Herzen | 03:32 | `oberarzt-der-herzen` | `02-Oberarzt_der_Herzen.mp3` | `02-Oberarzt_der_Herzen.png` | `02-Oberarzt_der_Herzen.lrc` | `02-Oberarzt_der_Herzen.mp4` |
| 03 | Vier-Eins-Neun-Zwei | 04:14 | `vier-eins-neun-zwei` | `03-Vier-Eins-Neun-Zwei.mp3` | `03-Vier-Eins-Neun-Zwei.png` | `03-Vier-Eins-Neun-Zwei.lrc` | `03-Vier-Eins-Neun-Zwei.mp4` |
| 04 | Pilot im Pixelmeer | 03:59 | `pilot-im-pixelmeer` | `04-Pilot_im_Pixelmeer.mp3` | `04-Pilot_im_Pixelmeer.png` | `04-Pilot_im_Pixelmeer.lrc` | `04-Pilot_im_Pixelmeer.mp4` |
| 05 | Drei Gebote | 03:54 | `drei-gebote` | `05-Drei_Gebote.mp3` | `05-Drei_Gebote.png` | `05-Drei_Gebote.lrc` | `05-Drei_Gebote.mp4` |
| 06 | Kunst der Diagnostik | 03:26 | `kunst-der-diagnostik` | `06-Kunst_der_Diagnostik.mp3` | `06-Kunst_der_Diagnostik.png` | `06-Kunst_der_Diagnostik.lrc` | `06-Kunst_der_Diagnostik.mp4` |
| 07 | Mit harter Hand und Charme | 03:46 | `mit-harter-hand-und-charme` | `07-Mit_harter_Hand_und_Charme.mp3` | `07-Mit_harter_Hand_und_Charme.png` | `07-Mit_harter_Hand_und_Charme.lrc` | `07-Mit_harter_Hand_und_Charme.mp4` |
| 08 | Durch Feuer und Eis | 03:09 | `durch-feuer-und-eis` | `08-Durch_Feuer_und_Eis.mp3` | `08-Durch_Feuer_und_Eis.png` | `08-Durch_Feuer_und_Eis.lrc` | `08-Durch_Feuer_und_Eis.mp4` |
| 09 | Held und Idol | 04:02 | `held-und-idol` | `09-Held_und_Idol.mp3` | `09-Held_und_Idol.png` | `09-Held_und_Idol.lrc` | `09-Held_und_Idol.mp4` |
| 10 | Messerscharf und LegendÃ¤r | 03:19 | `messerscharf-und-legendaer` | `10-Messerscharf_und_Legendaer.mp3` | `10-Messerscharf_und_Legendaer.png` | `10-Messerscharf_und_Legendaer.lrc` | `10-Messerscharf_und_Legendaer.mp4` |
| 11 | OberÃ¤rztlicher Glanz | 03:14 | `oberaerztlicher-glanz` | `11-Oberaerztlicher_Glanz.mp3` | `11-Oberaerztlicher_Glanz.png` | `11-Oberaerztlicher_Glanz.lrc` | `11-Oberaerztlicher_Glanz.mp4` |
| 12 | GÃ¶tterdÃ¤mmerung | 05:03 | `goetterdaemmerung` | `12-Goetterdaemmerung.mp3` | `12-Goetterdaemmerung.png` | `12-Goetterdaemmerung.lrc` | `12-Goetterdaemmerung.mp4` |

**Tracklist-Rendering (`renderPlaylist()`):**
```
<div class="playlist">
  <div class="playlist-item" data-track-id="1" data-track-slug="oberarzt-dr-med-placzek">
    <div class="playlist-item-number">01</div>
    <div class="playlist-item-info">
      <div class="playlist-item-title">Oberarzt Dr. med. Placzek</div>
      <div class="playlist-item-duration">02:12</div>
    </div>
    <div class="playlist-item-artwork">
      <img src="assets/images/01-Oberarzt_Dr_med_Placzek.png" alt="Track 1">
    </div>
  </div>
  <!-- ... weitere 11 Tracks -->
</div>
```

**InteraktivitÃ¤t:**
- Klick auf Track â†’ `App.playTrack(track, 'audio')`
- Hover â†’ Gold-Highlight (#d4af37)
- Aktueller Track â†’ Gold-Background + Checkmark-Icon

---

## ğŸ§ Audio-Modus

### Layout & Elemente

Der Audio-Modus bietet ein fokussiertes HÃ¶rerlebnis mit atmosphÃ¤rischem Hintergrundvideo und Live-Lyrics-Anzeige.

**Hintergrund-Visualisierung:**
- **Video:** `assets/video/background/{NN}-{Trackname}.mp4`
- **Eigenschaften:**
  - Stummgeschaltet (`muted`)
  - Geloopt (`loop`)
  - Responsive (`object-fit: cover`)
  - Abgedunkelt via `.bg-video-overlay` (halbtransparente schwarze Schicht, opacity: 0.5)
- **Kontrolle:**
  - Startet beim Audio-Play
  - Pausiert beim Audio-Pause
  - Positioniert auf Video-Dauer (sync mit Audio)

**Lyrics-Anzeige (3-Zeilen-Stack):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Ausgegraut]                       â”‚  â† Vorherige Zeile
â”‚  Opac: 0.4, Blur: 2px              â”‚
â”‚                                     â”‚
â”‚  [HIGHLIGHTED GOLD]                 â”‚  â† Aktuelle Zeile
â”‚  Color: #d4af37, Font-Weight: 600   â”‚
â”‚  Font-Size: grÃ¶ÃŸer                  â”‚
â”‚                                     â”‚
â”‚  [Normal]                           â”‚  â† NÃ¤chste Zeile
â”‚  Opac: 0.7, normale GrÃ¶ÃŸe           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Lyrics-Elemente (HTML):**
```html
<div class="lyrics-container">
  <div class="lyric-line prev-lyric" id="prevLyric" aria-hidden="true">
    <!-- Vorherige Zeile aus LRC -->
  </div>
  <div class="lyric-line current-lyric" id="currentLyric" aria-label="Aktueller Songtext">
    <!-- Aktuelle Zeile aus LRC -->
  </div>
  <div class="lyric-line next-lyric" id="nextLyric" aria-hidden="true">
    <!-- NÃ¤chste Zeile aus LRC -->
  </div>
</div>
```

### Lyrics-Synchronisation

**LyricsManager-Integration:**
```javascript
// LRC-Format:
[ti:Oberarzt Dr. med. Placzek]
[ar:Oberarzt Dr. med. Placzek]
[al:Deus ex CT]
[00:00.50]Erste Zeile des Liedes
[00:03.20]Zweite Zeile
[00:05.80]Dritte Zeile
// ... weitere Zeilen
```

**Update-Logik:**
1. Audio-Element wirft `timeupdate` Event (ca. alle 250ms)
2. App ruft `LyricsManager.updateCurrentLine(currentTime)` auf
3. LyricsManager nutzt **Binary-Search** fÃ¼r schnelle Zeilen-Findung
4. Wenn neue Zeile gefunden: `LyricsManager.onLyricChange(callback)` aufgerufen
5. App aktualisiert DOM mit 300ms Fade-Animation

**Animation (CSS):**
```css
.lyric-fade-out {
  animation: fadeOut 300ms ease-out;
}

.lyric-fade-in {
  animation: fadeIn 300ms ease-in;
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0.1; }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
```

**Genauigkeit:** Â±0.016 Sekunden (60 FPS)

### Player-Steuerung (Audio-Modus)

**Bottom-Bar Elemente:**
```
[Progress-Bar (Seek)] [Time-Display]
[â—€â—€] [â¯ï¸] [â–¶â–¶]  [ğŸ”Š] [â– ]
Prev   Play   Next Vol  Fullscreen
```

- **Progress-Bar:**
  - 0% (Start) â†’ 100% (Ende)
  - Drag-to-Seek unterstÃ¼tzt
  - Time-Tooltip bei Hover: `mm:ss`
  - Berechnung: `(mouseX / barWidth) * duration`

- **Play/Pause** (`#playPauseBtn`)
  - iOS: Wartet auf User-Tap (User-Gesture erforderlich)
  - Android: Direkt mÃ¶glich nach initiales Tap
  - Icon: â¯ï¸ (wechselt zwischen Play/Pause)
  - Callback: `PlayerEngine.togglePlayPause()`

- **Vorheriger Track** (`#prevBtn`)
  - Track 01: Springt zu Position 0 (kein Ringel)
  - Track 02-12: Springt zum vorherigen Track
  - Callback: `PlaylistManager.moveToPrevious()`

- **NÃ¤chster Track** (`#nextBtn`)
  - Track 01-11: Springt zum nÃ¤chsten Track
  - Track 12: Stoppt (kein Auto-Ringel)
  - Callback: `PlaylistManager.moveToNext()`

- **LautstÃ¤rke-Regler** (`#volumeBar`)
  - 0% â†’ 100%
  - Persistiert in `localStorage.deusExCT_volume`
  - Icon wechselt: ğŸ”‡ (0%) â†’ ğŸ”‰ (50%) â†’ ğŸ”Š (100%)

- **Mute-Button** (`#volumeMuteBtn`)
  - Speichert letzte LautstÃ¤rke
  - Icon: ğŸ”‡ (muted) â†”ï¸ ğŸ”Š (unmuted)
  - Persistiert in `localStorage.deusExCT_muted`

---

## ğŸ¬ Video-Modus

### Layout & Elemente

Der Video-Modus zeigt Lyrics-Videos in hochster verfÃ¼gbarer QualitÃ¤t.

**Video-Container:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚        [LYRICS-VIDEO]               â”‚
â”‚        (object-fit: contain)         â”‚
â”‚        (responsive width)            â”‚
â”‚        (feste aspect-ratio)          â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Progress-Bar]              [Time]  â”‚
â”‚ [â—€â—€] [â¯ï¸] [â–¶â–¶] [ğŸ”Š] [LOW] [MID] [HQ] [â›¶] â”‚
â”‚ Prev Play Next Vol  LOW MID HQ Full â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Video-Element:**
```html
<video id="videoPlayer"
       preload="auto"
       playsinline
       webkit-playsinline
       x5-playsinline
       crossorigin="anonymous">
  <!-- Wird via PlayerEngine.loadTrack() gefÃ¼llt -->
</video>
```

**Video-QualitÃ¤ten:**

| QualitÃ¤t | AuflÃ¶sung | Bitrate | DateigrÃ¶ÃŸe | Download-Zeit (1 Mbps) |
|----------|-----------|---------|-----------|------------------------|
| LOW | 360p | ~100-200 Mbps | 2-3 MB | 16-24 sec |
| MID | 720p | ~300-500 Mbps | 7-8 MB | 56-64 sec |
| HQ | 1080p | ~800-1200 Mbps | 15-20 MB | 120-160 sec |

**Video-Dateien (pro Track):**
```
assets/video/
â”œâ”€â”€ low/
â”‚   â””â”€â”€ NN-Trackname_Lyrics_low.mp4
â”œâ”€â”€ mid/
â”‚   â””â”€â”€ NN-Trackname_Lyrics_mid.mp4
â””â”€â”€ high/
    â””â”€â”€ NN-Trackname_Lyrics_hq.mp4
```

### QualitÃ¤ts-Wahl

**Automatische Erkennung (bei initiaem Load):**
```javascript
if (navigator.connection.saveData) {
    currentQuality = 'low';
} else if (navigator.connection.effectiveType === '3g') {
    currentQuality = 'low';
} else if (navigator.connection.downlink < 1.5 Mbps) {
    currentQuality = 'low';
} else if (navigator.connection.downlink < 5 Mbps) {
    currentQuality = 'mid';
} else {
    currentQuality = 'mid';  // Desktop: MID default
}
```

**Manuelle Auswahl:**
- Buttons: LOW, MID, HQ unter dem Video
- Aktive Taste: Gold-Highlight (#d4af37)
- Klick â†’ `PlayerEngine.setQuality(quality, true)` mit Position-Erhaltung
- Callback: `PlayerEngine.on('qualityChange', callback)`

**QualitÃ¤ts-Wechsel-Logik:**
1. Aktuelle Video-Position speichern (`currentTime`)
2. Video src wechseln zu neuem Quality-Level
3. `PlayerEngine.play()` aufrufen
4. Video seekt zu gespeicherter Position
5. Minimale VerzÃ¶gerung: 200-500ms re-buffering

**Persistierung:**
- QualitÃ¤t wird in `localStorage.deusExCT_quality` gespeichert
- Beim nÃ¤chsten Laden wird letzte QualitÃ¤t geladen

### Video-Controls

**Unter-Video Leiste (`.video-external-controls`):**

```
[Progress-Bar mit Time-Tooltip]
[â—€â—€] [â¯ï¸] [â–¶â–¶]  [ğŸ”Š]  [LOW] [MID] [HQ]  [â›¶]
```

**Elements:**
- **Progress-Bar:** Identisch zu Audio-Mode
- **Play/Pause, Prev, Next:** Identisch zu Audio-Mode
- **Volume-Regler:** Identisch zu Audio-Mode
- **QualitÃ¤ts-Buttons:** LOW, MID, HQ (exklusiv Video-Mode)
  - Buttons sind Toggle-Buttons (nur eine aktiv)
  - Active-Klasse: `.quality-btn.active` mit Gold-Farbe
- **Fullscreen-Button:** â›¶ (native Fullscreen API)

### Fullscreen-UnterstÃ¼tzung

**Trigger:** Fullscreen-Button in Video-Controls

**Browser-UnterstÃ¼tzung (5 Fallbacks):**
```javascript
// Standard Fullscreen API
if (videoElement.requestFullscreen) {
    videoElement.requestFullscreen();
}
// Firefox
else if (videoElement.mozRequestFullScreen) {
    videoElement.mozRequestFullScreen();
}
// Chrome/Safari
else if (videoElement.webkitRequestFullscreen) {
    videoElement.webkitRequestFullscreen();
}
// IE 11
else if (videoElement.msRequestFullscreen) {
    videoElement.msRequestFullscreen();
}
// iOS Safari Fallback
else if (videoElement.webkitEnterFullscreen) {
    videoElement.webkitEnterFullscreen();
}
```

**Exit Fullscreen (ESC-Taste):**
```javascript
if (document.exitFullscreen) {
    document.exitFullscreen();
} else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
} else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
} else if (document.msExitFullscreen) {
    document.msExitFullscreen();
} else if (videoElement.webkitExitFullscreen) {
    videoElement.webkitExitFullscreen();
}
```

**Verhalten:**
- Portrait-Mode wird NICHT erzwungen
- Video skaliert automatisch
- Controls bleiben sichtbar
- ESC oder Back-Button â†’ Fullscreen beenden

---

## â¬‡ï¸ Download-System

### Download-Modal

**Trigger:** Cloud-Icon oben rechts (`#headerDownloadBtn`)

**Modal-Struktur:**
```html
<div class="modal" id="downloadModal" role="dialog">
  <div class="modal-content download-modal-content">
    <div class="modal-header">
      <h2>Download Optionen</h2>
      <button class="modal-close">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="download-options" role="list">
        <!-- Option 1: Aktuelles Video (HQ) -->
        <!-- Option 2: Album (MP3) -->
        <!-- Option 3: Alle Videos (HQ) -->
      </div>
    </div>
  </div>
</div>
```

### 3 Download-Optionen

#### Option 1: Aktuelles Video (HQ)

- **Bedingung:** Nur aktiv wenn:
  - `PlayerEngine.getCurrentMode() === 'video'`
  - Track lÃ¤dt oder spielt (`playbackState !== 'stopped'`)
- **Element:** `#downloadSingleVideoOption`
  - CSS-Klasse `.hidden` wenn nicht aktiv
  - Icon: ğŸ¬ (fa-film)
  - Titel: "Aktuelles Video (HQ)"
  - Meta: "Nur diesen Song"
- **Download:**
  - Dateiname: `{NN}-{Trackname}_Lyrics_hq.mp4`
  - GrÃ¶ÃŸe: ~60-100 MB (abhÃ¤ngig von Track-LÃ¤nge)
  - Methode: `<a href="#" download>` + Blob-URL
  - Fallback: `window.open()` fÃ¼r neue Tab
- **Funktion:**
  ```javascript
  downloadSingleVideoOption.onclick = function() {
      DownloadManager.downloadCurrentVideoHQ();
  };
  ```

#### Option 2: Album (MP3)

- **Bedingung:** Immer aktiv
- **Element:** `#downloadAlbumOption`
  - Icon: ğŸµ (fa-music)
  - Titel: "Album (MP3)"
  - Meta: "Alle 12 Songs als ZIP"
- **Download:**
  - Dateiname: `Deus_ex_CT_Complete.zip` (exakt!)
  - GrÃ¶ÃŸe: ~120-150 MB
  - Pfad: `assets/downloads/Deus_ex_CT_Complete.zip`
  - Methode: Direkter Link (HTTP-Download)
- **Funktion:**
  ```javascript
  downloadAlbumOption.href = 'assets/downloads/Deus_ex_CT_Complete.zip';
  downloadAlbumOption.download = 'Deus_ex_CT_Complete.zip';
  ```

#### Option 3: Alle Videos (HQ)

- **Bedingung:** Immer aktiv
- **Element:** `#downloadAllVideosOption`
  - Icon: ğŸ“¦ (fa-file-zipper)
  - Titel: "Alle Videos (HQ)"
  - Meta: "Komplett als ZIP"
- **Download:**
  - Dateiname: `Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip` (exakt!)
  - GrÃ¶ÃŸe: ~700-1000 MB
  - Pfad: `assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip`
  - Methode: Direkter Link (HTTP-Download)
- **Funktion:**
  ```javascript
  downloadAllVideosOption.href = 'assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip';
  downloadAllVideosOption.download = 'Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip';
  ```

### DownloadManager Features

**Concurrent Downloads:**
- Max 3 parallel Downloads
- Queue Management fÃ¼r weitere Downloads
- History: Letzte 10 Downloads in `localStorage.deusExCT_downloadHistory`

**Progress Tracking:**
- Bytes downloaded / Total Bytes
- Prozentual (0-100%)
- Zeitestimation: `estimateDownloadTime(fileSize, networkSpeed)`

**Error-Handling:**
- Network-Fehler: Retry mit Exponential Backoff
- User-Cancel: Clean-up mit Promise-Rejection
- Fallback: Browser-Download bei CORS-Fehler

---

## ğŸ¹ Keyboard-Shortcuts

Die Anwendung unterstÃ¼tzt folgende Tastenkombinationen:

| Taste | Funktion | Modus | Verhalten |
|-------|----------|-------|-----------|
| **Space** | Play/Pause | Beide | Togglet zwischen Play und Pause |
| **â†** | ZurÃ¼ck 10s | Beide | Rewindet 10 Sekunden |
| **â†’** | VorwÃ¤rts 10s | Beide | Springt 10 Sekunden vorwÃ¤rts |
| **F** | Fullscreen | Video | Nur im Video-Mode |
| **Esc** | Fullscreen aus / Modal aus | Beide | Beendet Fullscreen oder schlieÃŸt Modal |
| **M** | Stumm | Beide | Togglet Mute/Unmute |
| **â†‘** | LautstÃ¤rke +10% | Beide | ErhÃ¶ht Volume um 10% (max 100%) |
| **â†“** | LautstÃ¤rke -10% | Beide | Senkt Volume um 10% (min 0%) |

**Implementierung (app.js):**
```javascript
document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return;  // Shortcuts nicht aktiv in Input-Feldern
    }

    if (e.key === ' ') {
        e.preventDefault();
        PlayerEngine.togglePlayPause();
    } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        PlayerEngine.seekRelative(-10);
    } else if (e.key === 'ArrowRight') {
        e.preventDefault();
        PlayerEngine.seekRelative(10);
    } else if (e.key === 'f' || e.key === 'F') {
        if (PlayerEngine.getCurrentMode() === 'video') {
            PlayerEngine.toggleFullscreen();
        }
    } else if (e.key === 'Escape') {
        if (PlayerEngine.isFullscreen()) {
            PlayerEngine.exitFullscreen();
        } else if (!closePlaylistModal.parentElement.classList.contains('hidden')) {
            App.hidePlaylistModal();
        } else if (!closeDownloadModal.parentElement.classList.contains('hidden')) {
            App.hideDownloadModal();
        }
    } else if (e.key === 'm' || e.key === 'M') {
        PlayerEngine.toggleMute();
    } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        PlayerEngine.setVolume(Math.min(1, PlayerEngine.getVolume() + 0.1));
    } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        PlayerEngine.setVolume(Math.max(0, PlayerEngine.getVolume() - 0.1));
    }
});
```

---

## ğŸ¯ Fehlerbehandlung & Recovery

### HÃ¤ufige Probleme und LÃ¶sungen

#### 1. Video lÃ¤dt nicht / Spulen funktioniert nicht

**Symptom:** Video-Datei lÃ¤dt nicht, oder Seek funktioniert nicht

**Ursachen:**
- âŒ Server sendet nicht `Accept-Ranges: bytes` Header
- âŒ CORS-Header fehlt
- âŒ Videodatei beschÃ¤digt oder falsch kodiert

**LÃ¶sung:**
1. PrÃ¼fen Sie `.htaccess`:
```apache
Header set Accept-Ranges "bytes"
Header set Access-Control-Allow-Origin "*"
```

2. Test im Terminal:
```bash
curl -I https://deus-ex-ct.markuslurz.de/assets/video/mid/01-*.mp4
# Sollte zeigen:
# Accept-Ranges: bytes
# Access-Control-Allow-Origin: *
```

3. Video-Datei prÃ¼fen:
```bash
ffprobe assets/video/mid/01-*.mp4
# Sollte zeigen: Video: h264, Audio: aac
```

#### 2. Audio/Video-Wiedergabe startet nicht auf Mobile

**Symptom:** Play-Button wird geklickt, aber nichts passiert

**Ursache:** iOS/Android erfordern User-Gesture fÃ¼r Medienwiedergabe (Sicherheit)

**LÃ¶sung:**
- Ist automatisch implementiert in v11.0
- App wartet auf User-Tap (Touch-Event)
- Danach funktioniert Play() ohne weiteres Gesture
- Wenn immer noch nicht: Browser-Cache leeren (Cmd+Shift+R / Ctrl+Shift+R)

#### 3. Lyrics synchronisieren nicht

**Symptom:** Lyrics wechseln nicht mit Audio/Video oder sind ungenau

**Ursachen:**
- âŒ LRC-Datei hat falsche Zeitstempel
- âŒ LRC-Datei nicht im UTF-8 Format
- âŒ Audio/Video ist zu langsam

**LRC-Format prÃ¼fen:**
```lrc
[ti:Oberarzt Dr. med. Placzek]
[ar:Oberarzt Dr. med. Placzek]
[al:Deus ex CT]
[00:00.50]Erste Zeile des Liedes
[00:03.20]Zweite Zeile
[00:05.80]Dritte Zeile
[mm:ss.cc]Text Format!
```

**Test im Terminal:**
```bash
curl https://deus-ex-ct.markuslurz.de/assets/lyrics/01-*.lrc
# Sollte UTF-8 Text mit [mm:ss.cc]Format zeigen
# Sollte KEINE BOM (Byte Order Mark) haben
```

#### 4. PWA lÃ¤sst sich nicht installieren

**Symptom:** Kein "Install"-Button in Browser

**Ursachen:**
- âŒ HTTPS nicht aktiviert (PWA benÃ¶tigt HTTPS!)
- âŒ manifest.json hat Fehler
- âŒ Icons sind zu klein (min. 192Ã—192px)
- âŒ `icons[].purpose` falsch

**LÃ¶sung:**
1. PrÃ¼fen Sie manifest.json:
```bash
curl https://deus-ex-ct.markuslurz.de/manifest.json | jq .
# Sollte valid JSON sein
```

2. Chrome DevTools â†’ Application â†’ Manifest
   - Sollte zeigen: "Manifest URL", keine Fehler
   - Icons sollten alle sichtbar sein

3. Icon-GrÃ¶ÃŸen prÃ¼fen:
```bash
identify assets/images/00-Albumcover.png
# Sollte zeigen: 512x512 Pixel
```

#### 5. Download funktioniert nicht

**Symptom:** Download startet nicht, oder ZIP ist beschÃ¤digt

**Ursachen:**
- âŒ ZIP-Datei existiert nicht
- âŒ Falscher Dateiname
- âŒ CORS-Header fehlt

**LÃ¶sung:**
```bash
# PrÃ¼fen ob Dateien existieren:
curl -I https://deus-ex-ct.markuslurz.de/assets/downloads/Deus_ex_CT_Complete.zip
# Sollte: HTTP/2 200 OK

# PrÃ¼fen CORS-Header:
curl -H "Origin: https://deus-ex-ct.markuslurz.de" -I *.zip
# Sollte zeigen: Access-Control-Allow-Origin: *

# ZIP-IntegritÃ¤t prÃ¼fen:
unzip -t assets/downloads/Deus_ex_CT_Complete.zip
# Sollte: OK
```

#### 6. Lyrics-Videos laden sehr langsam

**Symptom:** Video buffert stÃ¤ndig, Wiedergabe stockt

**Ursachen:**
- âŒ Netzwerkverbindung zu langsam
- âŒ Falsche QualitÃ¤t ausgewÃ¤hlt (HQ statt MID/LOW)
- âŒ Server-Bandbreite zu niedrig

**LÃ¶sung:**
1. QualitÃ¤t wechseln: LOW/MID statt HQ
2. Chrome DevTools â†’ Network:
   - Video-Datei-Download prÃ¼fen
   - Sollte >100 Kbps sein (minimum)
   - Sollte keine "stalled" Phasen haben

3. Server-Bandbreite prÃ¼fen:
```bash
speedtest-cli
# Sollte mindestens 5 Mbps sein fÃ¼r 720p Video
```

#### 7. Cache-Probleme (alte Version wird noch gezeigt)

**Symptom:** Nach Update zeigt sich die alte Version immer noch

**Ursache:** Browser-Cache ist nicht invalidiert

**LÃ¶sung:**
1. Hard-Reload durchfÃ¼hren:
   - Windows: `Ctrl+Shift+R`
   - Mac: `Cmd+Shift+R`
   - Mobile: Settings â†’ Cookies/Cache lÃ¶schen

2. Oder localStorage manuell lÃ¶schen:
```javascript
// Browser Console eingeben:
localStorage.clear();
location.reload();
```

3. Oder .htaccess prÃ¼fen:
```bash
curl -I https://deus-ex-ct.markuslurz.de/index.html
# Sollte zeigen: Cache-Control: max-age=0
```

---

## ğŸ“Š Performance-Optimierungen

### Asset-GrÃ¶ÃŸen (Referenz)

| Asset | GrÃ¶ÃŸe | Anzahl | Total |
|-------|-------|--------|-------|
| **00-Albumcover.png** | 512 KB | 1 | 512 KB |
| **Track-Artwork** | 400 KB | 12 | 4.8 MB |
| **MP3 Audio** (128 Kbps) | ~1 MB/min | 12 | ~40 MB |
| **Background-Videos** | 2-3 MB | 12 | ~30 MB |
| **Videos LOW** (360p) | 2-3 MB | 12 | ~30 MB |
| **Videos MID** (720p) | 7-8 MB | 12 | ~90 MB |
| **Videos HQ** (1080p) | 15-20 MB | 12 | ~180 MB |
| **LRC-Lyrics** | 30 KB | 12 | 360 KB |
| **TOTAL (Audio Only)** | - | - | **~40 MB** |
| **TOTAL (Audio + BG)** | - | - | **~70 MB** |
| **TOTAL (Album ZIP)** | - | - | **~120-150 MB** |
| **TOTAL (Videos HQ ZIP)** | - | - | **~700-1000 MB** |

### Streaming-Strategie

**Audio-Streaming:**
- 128 Kbps MP3 = ~1 MB pro Minute
- Track 01 (2:12) = ~2.8 MB
- Auto-Puffer: ~10 Sekunden

**Video-Streaming:**
- LOW: ~100-200 Mbps â†’ 20-30 sec buffer
- MID: ~300-500 Mbps â†’ 10-15 sec buffer
- HQ: ~800-1200 Mbps â†’ 5-10 sec buffer

**Next-Track Preload:**
- NÃ¤chster Track wird im Hintergrund vorab geladen
- Audio: `preloadAudioElement.src = nextTrack.audioSrc`
- Video: Nur Metadata (nicht ganzes Video)

---

## ğŸ§ª Testing-Checkliste

### Browser-KompatibilitÃ¤t

- [ ] **Chrome 90+**
  - Desktop: Audio âœ“, Video âœ“
  - Android: Audio âœ“, Video âœ“

- [ ] **Firefox 88+**
  - Desktop: Audio âœ“, Video âœ“
  - Android: Audio âœ“, Video âœ“

- [ ] **Safari 14+**
  - Desktop: Audio âœ“, Video âœ“
  - iOS (iPhone): Audio âœ“, Video âœ“

- [ ] **Edge 90+**
  - Desktop: Audio âœ“, Video âœ“

- [ ] **Samsung Internet 15+**
  - Android: Audio âœ“, Video âœ“

### FunktionalitÃ¤t

- [ ] Audio-Modus
  - Hintergrund-Video lÃ¤uft
  - Lyrics synchronisieren korrekt
  - Play/Pause funktioniert
  - Seek funktioniert

- [ ] Video-Modus
  - Video lÃ¤dt
  - QualitÃ¤ts-Wechsel funktioniert
  - Fullscreen funktioniert
  - Seek funktioniert

- [ ] Downloads
  - Option 1 (HQ-Video): Nur aktiv bei Video-Mode
  - Option 2 (Album ZIP): Immer aktiv
  - Option 3 (Videos ZIP): Immer aktiv

- [ ] Keyboard-Shortcuts
  - Space: Play/Pause âœ“
  - Pfeile: Seek âœ“
  - F: Fullscreen âœ“
  - Esc: Exit Fullscreen âœ“
  - M: Mute/Unmute âœ“

- [ ] Media Session
  - Sperrbildschirm-Controls funktionieren
  - Smartwatch-Integration funktioniert

### Performance

- [ ] Page-Load: < 2 Sekunden
- [ ] Audio-Start: < 1 Sekunde
- [ ] Video-Start: < 3 Sekunden
- [ ] Memory: Keine Leaks (DevTools)
- [ ] FPS: 60 FPS bei Animationen
- [ ] CPU: < 20% bei Wiedergabe

### PWA

- [ ] iOS: App auf Homescreen installierbar
- [ ] Android: App auf Homescreen installierbar
- [ ] Offline: HTML/CSS/JS funktionieren (via Cache)
- [ ] Manifest: Keine Fehler in DevTools

### Mobile-spezifisch

- [ ] iOS Safari
  - User-Gesture funktioniert
  - Stall-Recovery aktiv (wenn nÃ¶tig)
  - Fullscreen funktioniert

- [ ] Android Chrome
  - CORS funktioniert
  - x5-Player kompatibel
  - Adaptive Quality aktiv

### Cache & Versionierung

- [ ] HTML: Cache-Control: max-age=0
- [ ] JS/CSS: Cache-Control: immutable + Versioning
- [ ] Version-Wechsel: Alte Caches gelÃ¶scht
- [ ] localStorage: Nur Player-State erhalten

### Barrierefreiheit (WCAG AA)

- [ ] Screen-Reader: Alle Buttons haben Labels
- [ ] Keyboard: Alle Funktionen ohne Mouse erreichbar
- [ ] Kontrast: Minimum 4.5:1 fÃ¼r Text
- [ ] Focus-Management: Tab-Order logisch

---

## ğŸ“ Version-Historie

### v11.0 (Dezember 2024) - Production Release

**ğŸ”§ Fixes:**
- âœ… Aggressive Cache-Invalidierung (Timestamp-basiert)
- âœ… iOS User-Gesture Context Preservation
- âœ… Stall-Recovery mit Exponential Backoff
- âœ… Event-Listener Race Condition Fixes
- âœ… Robustes Error-Handling mit State Differentiation
- âœ… QualitÃ¤t-Persistierung in localStorage
- âœ… Track-ID Tracking fÃ¼r Stall-Recovery
- âœ… Mode-Wechsel mit 15s Timeout (HLS-Support)

**ğŸ“ˆ Performance:**
- Page-Load: < 2 Sekunden
- Audio-Start: < 1 Sekunde
- Video-Start: < 3 Sekunden
- Memory: Keine Leaks
- FPS: 60 FPS Animationen

**ğŸ§ª Testing:**
- Chrome, Firefox, Safari, Edge, Samsung Internet
- iOS (Safari 14+) & Android (Chrome 90+)
- Slow 3G, Regular 3G, Fast 4G
- Mobile & Desktop

---
```

 
--- 

/index.html:

```html
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deus ex CT">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="assets/images/00-Albumcover.png">
    <meta name="description" content="Deus ex CT - Das Album von Oberarzt Dr. med. Placzek. Streame alle Songs mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta name="keywords" content="Deus ex CT, Oberarzt Dr. med. Placzek, Album, Musik, Lyrics, Video">
    <meta name="author" content="Deus ex CT">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta id="appVersionMeta" name="app-version" content="">
    <meta id="appBuildTimeMeta" name="app-build-time" content="">
    <meta property="og:title" content="Deus ex CT - Das Album">
    <meta property="og:description" content="Streame das komplette Album mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta property="og:image" content="assets/images/00-Albumcover.png">
    <meta property="og:type" content="music.album">
    <meta property="og:url" content="https://deus-ex-ct.markuslurz.de">
    <meta property="og:site_name" content="Deus ex CT">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Deus ex CT - Das Album">
    <meta name="twitter:description" content="Streame das komplette Album mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta name="twitter:image" content="assets/images/00-Albumcover.png">
    <title>Deus ex CT - Das Album</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/00-Albumcover.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="assets/images/00-Albumcover.png" as="image" type="image/png">
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="css/styles.css">
    <script>
        (function() {
            var CACHE_KEY = 'deusExCT_buildVersion';
            var CACHE_TIMESTAMP_KEY = 'deusExCT_buildTimestamp';
            var BUILD_TIMESTAMP = Math.floor(Date.now() / 1000);
            var BUILD_VERSION = '11.0';
            var ASSET_VERSION = BUILD_VERSION + '.' + BUILD_TIMESTAMP;

            function updateVersionMeta() {
                try {
                    var versionMeta = document.getElementById('appVersionMeta');
                    var timeMeta = document.getElementById('appBuildTimeMeta');
                    if (versionMeta) versionMeta.setAttribute('content', BUILD_VERSION);
                    if (timeMeta) timeMeta.setAttribute('content', new Date(BUILD_TIMESTAMP * 1000).toISOString());
                } catch (e) {}
            }

            function updateScriptVersions() {
                try {
                    var scripts = document.querySelectorAll('script[src]');
                    for (var i = 0; i < scripts.length; i++) {
                        var src = scripts[i].getAttribute('src');
                        if (src && src.indexOf('js/') === 0) {
                            if (src.indexOf('?v=') === -1) {
                                scripts[i].setAttribute('src', src + '?v=' + ASSET_VERSION);
                            }
                        }
                    }
                    var links = document.querySelectorAll('link[href*="css/"]');
                    for (var i = 0; i < links.length; i++) {
                        var href = links[i].getAttribute('href');
                        if (href && href.indexOf('?v=') === -1) {
                            links[i].setAttribute('href', href + '?v=' + ASSET_VERSION);
                        }
                    }
                } catch (e) {}
            }

            function clearIndexedDB() {
                return new Promise(function(resolve) {
                    if (!window.indexedDB) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        if (window.indexedDB.databases && typeof window.indexedDB.databases === 'function') {
                            window.indexedDB.databases().then(function(dbs) {
                                clearTimeout(timeout);
                                if (dbs && dbs.length > 0) {
                                    var deletePromises = [];
                                    for (var i = 0; i < dbs.length; i++) {
                                        try {
                                            deletePromises.push(
                                                new Promise(function(resolveDelete) {
                                                    try {
                                                        window.indexedDB.deleteDatabase(dbs[i].name);
                                                        setTimeout(resolveDelete, 100);
                                                    } catch (e) {
                                                        resolveDelete();
                                                    }
                                                })
                                            );
                                        } catch (e) {}
                                    }
                                    Promise.all(deletePromises).then(resolve).catch(resolve);
                                } else {
                                    resolve();
                                }
                            }).catch(function() {
                                clearTimeout(timeout);
                                resolve();
                            });
                        } else {
                            clearTimeout(timeout);
                            resolve();
                        }
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function clearAllStorage() {
                try {
                    var keysToRemove = [];
                    for (var i = 0; i < localStorage.length; i++) {
                        var key = localStorage.key(i);
                        if (key) {
                            keysToRemove.push(key);
                        }
                    }
                    for (var i = 0; i < keysToRemove.length; i++) {
                        try {
                            localStorage.removeItem(keysToRemove[i]);
                        } catch (e) {}
                    }
                } catch (e) {}

                try {
                    sessionStorage.clear();
                } catch (e) {}
            }

            function clearBrowserCaches() {
                return new Promise(function(resolve) {
                    if (!window.caches) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        caches.keys().then(function(names) {
                            clearTimeout(timeout);
                            if (names && names.length > 0) {
                                var deletePromises = [];
                                for (var i = 0; i < names.length; i++) {
                                    try {
                                        deletePromises.push(
                                            new Promise(function(resolveDelete) {
                                                caches.delete(names[i]).then(resolveDelete).catch(resolveDelete);
                                            })
                                        );
                                    } catch (e) {}
                                }
                                Promise.all(deletePromises).then(resolve).catch(resolve);
                            } else {
                                resolve();
                            }
                        }).catch(function() {
                            clearTimeout(timeout);
                            resolve();
                        });
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function unregisterServiceWorkers() {
                return new Promise(function(resolve) {
                    if (!navigator.serviceWorker) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        navigator.serviceWorker.getRegistrations().then(function(registrations) {
                            clearTimeout(timeout);
                            if (registrations && registrations.length > 0) {
                                var unregisterPromises = [];
                                for (var i = 0; i < registrations.length; i++) {
                                    try {
                                        unregisterPromises.push(
                                            new Promise(function(resolveUnregister) {
                                                registrations[i].unregister().then(resolveUnregister).catch(resolveUnregister);
                                            })
                                        );
                                    } catch (e) {}
                                }
                                Promise.all(unregisterPromises).then(resolve).catch(resolve);
                            } else {
                                resolve();
                            }
                        }).catch(function() {
                            clearTimeout(timeout);
                            resolve();
                        });
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function shouldPerformCleanup() {
                try {
                    var storedVersion = localStorage.getItem(CACHE_KEY);
                    var storedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);

                    if (storedVersion !== BUILD_VERSION) {
                        return true;
                    }

                    if (!storedTimestamp) {
                        return true;
                    }

                    var lastTimestamp = parseInt(storedTimestamp, 10);
                    if (isNaN(lastTimestamp)) {
                        return true;
                    }

                    if (BUILD_TIMESTAMP > lastTimestamp) {
                        return true;
                    }

                    return false;
                } catch (e) {
                    return true;
                }
            }

            function recordCleanupCompletion() {
                try {
                    localStorage.setItem(CACHE_KEY, BUILD_VERSION);
                    localStorage.setItem(CACHE_TIMESTAMP_KEY, BUILD_TIMESTAMP.toString());
                } catch (e) {}
            }

            function performAsyncCleanup() {
                clearAllStorage();

                Promise.all([
                    clearIndexedDB(),
                    clearBrowserCaches(),
                    unregisterServiceWorkers()
                ]).then(function() {
                    recordCleanupCompletion();
                }).catch(function() {
                    recordCleanupCompletion();
                });
            }

            function initializeApp() {
                updateVersionMeta();
                updateScriptVersions();

                if (shouldPerformCleanup()) {
                    clearAllStorage();
                    recordCleanupCompletion();
                    performAsyncCleanup();
                } else {
                    performAsyncCleanup();
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                initializeApp();
            }

            window.addEventListener('load', function() {
                try {
                    if (navigator.serviceWorker && navigator.serviceWorker.getRegistrations) {
                        navigator.serviceWorker.getRegistrations().then(function(registrations) {
                            for (var i = 0; i < registrations.length; i++) {
                                try {
                                    registrations[i].unregister();
                                } catch (e) {}
                            }
                        }).catch(function() {});
                    }
                } catch (e) {}
            });

            window.APP_VERSION = BUILD_VERSION;
            window.ASSET_VERSION = ASSET_VERSION;
        })();
    </script>
</head>
<body>
    <div id="app">
        <div class="bg-video-container" id="bgVideoContainer">
            <video id="bgVideo" class="bg-video" loop muted playsinline webkit-playsinline x5-playsinline x5-video-player-type="h5" x5-video-player-fullscreen="false" disablePictureInPicture disableRemotePlayback preload="none"></video>
            <div class="bg-video-overlay"></div>
        </div>

        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <button class="header-btn hidden" id="backBtn" aria-label="ZurÃ¼ck zur Ãœbersicht" type="button">
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="header-center hidden" id="headerTrackInfo">
                    <div class="header-text-group">
                        <div class="header-scroller">
                            <span class="header-track-title" id="headerTitleText"></span>
                        </div>
                        <span class="header-separator" aria-hidden="true">â€¢</span>
                        <span class="header-track-artist">Deus ex CT</span>
                    </div>
                    <div class="header-mode-switch" id="headerModeSwitch" role="tablist" aria-label="Wiedergabemodus">
                        <button class="mode-switch-btn active" id="audioModeBtn" aria-label="Audio-Modus" aria-selected="true" role="tab" type="button">
                            <i class="fas fa-music" aria-hidden="true"></i>
                        </button>
                        <button class="mode-switch-btn" id="videoModeBtn" aria-label="Video-Modus" aria-selected="false" role="tab" type="button">
                            <i class="fas fa-film" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>

                <div class="header-right">
                    <button class="header-btn hidden" id="headerInstallBtn" aria-label="App installieren" type="button">
                        <i class="fas fa-download" aria-hidden="true"></i>
                    </button>
                    <button class="header-btn" id="headerDownloadBtn" aria-label="Downloads anzeigen" type="button">
                        <i class="fas fa-cloud-arrow-down" aria-hidden="true"></i>
                    </button>
                    <button class="header-btn" id="menuBtn" aria-label="MenÃ¼ Ã¶ffnen" type="button">
                        <i class="fas fa-ellipsis-v" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content" id="mainContent" role="main">
            <section class="view-section album-view" id="albumView" aria-label="Album-Ãœbersicht">
                <div class="album-layout-grid">
                    <div class="album-hero">
                        <div class="album-artwork-container">
                            <img src="assets/images/00-Albumcover.png" alt="Deus ex CT Album Cover" class="album-artwork" id="albumArtwork" width="512" height="512" fetchpriority="high" decoding="async">
                            <div class="artwork-reflection" aria-hidden="true"></div>
                        </div>
                        <div class="album-info">
                            <h1 class="album-title">Deus ex CT</h1>
                            <p class="album-artist">Oberarzt Dr. med. Placzek</p>
                            <p class="album-meta">12 Songs â€¢ 40 Min.</p>
                        </div>
                        <div class="album-actions">
                            <button class="action-btn primary-btn" id="playAllBtn" type="button">
                                <i class="fas fa-play" aria-hidden="true"></i>
                                <span>Abspielen</span>
                            </button>
                            <button class="action-btn secondary-btn" id="downloadAllVideosBtn" type="button">
                                <i class="fas fa-film" aria-hidden="true"></i>
                                <span>Alle Videos (HQ)</span>
                            </button>
                            <button class="action-btn secondary-btn hidden" id="installAppHeroBtn" type="button">
                                <i class="fas fa-mobile-screen-button" aria-hidden="true"></i>
                                <span>Installieren</span>
                            </button>
                            <button class="action-btn download-btn" id="downloadAlbumBtn" type="button">
                                <i class="fas fa-file-zipper" aria-hidden="true"></i>
                                <span>Album MP3s</span>
                            </button>
                        </div>
                    </div>
                    <div class="playlist-container">
                        <ul class="playlist" id="playlist" role="list" aria-label="Tracklist"></ul>
                    </div>
                </div>
            </section>

            <section class="view-section player-view hidden" id="playerView" aria-label="Player">
                <div class="player-audio-layout" id="playerAudioLayout">
                    <div class="audio-stage-top">
                        <div class="artwork-wrapper active" id="artworkWrapper">
                            <img src="assets/images/00-Albumcover.png" alt="Aktuelles Track Cover" class="player-artwork-large" id="playerArtwork" width="512" height="512" decoding="async">
                        </div>
                    </div>
                    <div class="audio-stage-bottom">
                        <div class="player-lyrics-area" aria-live="polite" aria-atomic="false">
                            <p class="player-prev-lyric" id="prevLyric" aria-hidden="true"></p>
                            <p class="player-current-lyric" id="currentLyric" aria-label="Aktueller Songtext"></p>
                            <p class="player-next-lyric" id="nextLyric" aria-hidden="true"></p>
                        </div>
                    </div>
                </div>

                <div class="player-video-layout hidden" id="playerVideoLayout">
                    <div class="video-flex-container">
                        <div class="video-wrapper" id="videoWrapper">
                            <video id="videoPlayer" playsinline webkit-playsinline x5-playsinline x5-video-player-type="h5" x5-video-player-fullscreen="false" disablePictureInPicture preload="auto"></video>
                            <div class="video-overlay-controls" id="videoOverlay">
                                <button class="video-big-play-btn" id="videoPlayBtn" aria-label="Wiedergabe starten" type="button">
                                    <i class="fas fa-play" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <div class="video-external-controls">
                            <div class="video-quality-group" role="group" aria-label="VideoqualitÃ¤t">
                                <span class="video-ctrl-label" id="qualityLabel">QualitÃ¤t:</span>
                                <button class="quality-tag" data-quality="low" aria-describedby="qualityLabel" type="button">LOW</button>
                                <button class="quality-tag active" data-quality="mid" aria-describedby="qualityLabel" aria-pressed="true" type="button">MID</button>
                                <button class="quality-tag" data-quality="high" aria-describedby="qualityLabel" type="button">HQ</button>
                            </div>
                            <button class="fullscreen-btn-ext" id="fullscreenBtn" aria-label="Vollbild umschalten" type="button">
                                <i class="fas fa-expand" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <div class="player-bottom-bar hidden" id="playerBottomBar" role="region" aria-label="Player-Steuerung">
            <div class="bar-progress-container">
                <div class="bar-progress-fill" id="progressBarFill" aria-hidden="true"></div>
                <div class="time-tooltip" id="timeTooltip" aria-hidden="true">0:00</div>
                <input type="range" class="bar-progress-input" id="progressBar" min="0" max="100" value="0" step="0.1" aria-label="Wiedergabefortschritt" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            </div>

            <div class="bar-content-grid">
                <div class="bar-section info-section">
                    <div class="bar-text-wrapper">
                        <span class="bar-track-title" id="trackTitle">Titel</span>
                        <span class="bar-track-artist" id="trackArtist">Deus ex CT</span>
                    </div>
                </div>

                <div class="bar-section controls-section" role="group" aria-label="Wiedergabesteuerung">
                    <button class="subtle-btn medium" id="prevBtn" aria-label="Vorheriger Track" type="button">
                        <i class="fas fa-backward-step" aria-hidden="true"></i>
                    </button>
                    <button class="subtle-btn large play-pause-btn" id="playPauseBtn" aria-label="Wiedergabe/Pause" type="button">
                        <i class="fas fa-play" id="playPauseIcon" aria-hidden="true"></i>
                    </button>
                    <button class="subtle-btn medium" id="nextBtn" aria-label="NÃ¤chster Track" type="button">
                        <i class="fas fa-forward-step" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="bar-section actions-section" role="group" aria-label="LautstÃ¤rke">
                    <button class="subtle-action-btn volume-btn-toggle" id="volumeMuteBtn" aria-label="Stumm schalten" type="button">
                        <i class="fas fa-volume-high" id="volumeIcon" aria-hidden="true"></i>
                    </button>
                    <div class="bar-volume-slider-container">
                        <input type="range" class="volume-range" id="volumeBar" min="0" max="100" value="100" aria-label="LautstÃ¤rke" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100">
                    </div>
                </div>
            </div>
        </div>

        <div class="mini-player hidden" id="miniPlayer" role="region" aria-label="Mini-Player">
            <div class="mini-player-progress" id="miniPlayerProgress" aria-hidden="true"></div>
            <div class="mini-player-content">
                <img src="assets/images/00-Albumcover.png" alt="Cover" class="mini-artwork" id="miniArtwork" width="40" height="40" loading="lazy" decoding="async">
                <div class="mini-info">
                    <p class="mini-title" id="miniTitle">Kein Song</p>
                    <p class="mini-lyric" id="miniLyric" aria-live="off"></p>
                </div>
                <div class="mini-controls" role="group" aria-label="Mini-Player Steuerung">
                    <button class="mini-btn" id="miniPrevBtn" aria-label="Vorheriger Track" type="button">
                        <i class="fas fa-backward-step" aria-hidden="true"></i>
                    </button>
                    <button class="mini-btn" id="miniPlayPauseBtn" aria-label="Wiedergabe/Pause" type="button">
                        <i class="fas fa-play" id="miniPlayPauseIcon" aria-hidden="true"></i>
                    </button>
                    <button class="mini-btn" id="miniNextBtn" aria-label="NÃ¤chster Track" type="button">
                        <i class="fas fa-forward-step" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="playlistModal" role="dialog" aria-modal="true" aria-labelledby="playlistModalTitle">
            <div class="modal-backdrop" id="modalBackdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="playlistModalTitle">Wiedergabeliste</h2>
                    <button class="modal-close" id="closePlaylistModal" aria-label="SchlieÃŸen" type="button">
                        <i class="fas fa-xmark" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="modal-playlist" id="modalPlaylist" role="list"></ul>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="downloadModal" role="dialog" aria-modal="true" aria-labelledby="downloadModalTitle">
            <div class="modal-backdrop" id="downloadModalBackdrop"></div>
            <div class="modal-content download-modal-content">
                <div class="modal-header">
                    <h2 id="downloadModalTitle">Download Optionen</h2>
                    <button class="modal-close" id="closeDownloadModal" aria-label="SchlieÃŸen" type="button">
                        <i class="fas fa-xmark" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="download-options" role="list">
                        <a href="#" class="download-option hidden" id="downloadSingleVideoOption" download role="listitem">
                            <i class="fas fa-film" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Aktuelles Video (HQ)</span>
                                <span class="dl-meta">Nur diesen Song</span>
                            </div>
                        </a>
                        <a href="assets/downloads/Deus_ex_CT_Complete.zip" class="download-option" id="downloadAlbumOption" download="Deus_ex_CT_Complete.zip" role="listitem">
                            <i class="fas fa-music" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Album (MP3)</span>
                                <span class="dl-meta">Alle 12 Songs als ZIP</span>
                            </div>
                        </a>
                        <a href="assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip" class="download-option" id="downloadAllVideosOption" download="Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip" role="listitem">
                            <i class="fas fa-file-zipper" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Alle Videos (HQ)</span>
                                <span class="dl-meta">Komplett als ZIP</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>
    </div>

    <audio id="audioPlayer" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></audio>

    <script src="js/playlist.js"></script>
    <script src="js/lyrics.js"></script>
    <script src="js/player.js"></script>
    <script src="js/mediasession.js"></script>
    <script src="js/download.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
```

 
--- 

/manifest.json:

```json
{
  "name": "Deus ex CT - Das Album",
  "short_name": "Deus ex CT",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#000000",
  "description": "Deus ex CT - Das Album von Oberarzt Dr. med. Placzek. Streame alle Songs mit Lyrics-Videos und synchronisierten Songtexten.",
  "orientation": "portrait",
  "icons": [
    {
      "src": "assets/images/00-Albumcover.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "assets/images/00-Albumcover.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "categories": [
    "music",
    "entertainment"
  ]
}
```

 
--- 

/README_Implementierung.md:

```md
# README Implementierung - Deus ex CT WebApp v11.0

## ğŸ—ï¸ Tech-Stack & Architektur

### Technologien

- **Frontend:** HTML5, CSS3, Vanilla JavaScript (ES6+)
- **Keine Frameworks:** Reines Vanilla JS (Revealing Module Pattern)
- **Build-Tools:** Keine (Direct Serving)
- **Browser-APIs:** HTML5 Media, Fullscreen, Fetch, LocalStorage, RAF
- **Optional APIs:** Media Session, Network Information
- **Server:** Apache 2.4+ mit mod_rewrite
- **Deployment:** HTTPS (erforderlich fÃ¼r PWA + Media Session)

### Modularisierung (Revealing Module Pattern)

```javascript
const ModuleName = (function() {
    // Private Variablen
    let privateVar = 'nicht sichtbar';

    // Private Funktionen
    function privateFunc() {}

    // Public API (Return Object)
    return {
        publicMethod: function() {},
        publicProperty: value
    };
})();
```

**Vorteile:**
- âœ… Keine globalen Variablen
- âœ… Private/Public Scope
- âœ… Namespace-Isolation
- âœ… Keine AbhÃ¤ngigkeiten zwischen Modulen (lose coupling)

---

## ğŸ“¦ Module & APIs

### 1. `js/playlist.js` - PlaylistManager

**Verantwortung:** Verwaltung der 12 Tracks und Playlist-State

**Datenstruktur:**
```javascript
const tracks = [
    {
        id: 1,
        number: 1,
        title: 'Oberarzt Dr. med. Placzek',
        artist: 'Oberarzt Dr. med. Placzek',
        slug: 'oberarzt-dr-med-placzek',
        duration: '02:12',
        durationSeconds: 132,
        audioSrc: 'assets/audio/01-Oberarzt_Dr_med_Placzek.mp3',
        videoSrc: {
            low: 'assets/video/low/01-Oberarzt_Dr_med_Placzek_Lyrics_low.mp4',
            mid: 'assets/video/mid/01-Oberarzt_Dr_med_Placzek_Lyrics_mid.mp4',
            high: 'assets/video/high/01-Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4'
        },
        imageSrc: 'assets/images/01-Oberarzt_Dr_med_Placzek.png',
        backgroundSrc: 'assets/video/background/01-Oberarzt_Dr_med_Placzek.mp4',
        lyricsSrc: 'assets/lyrics/01-Oberarzt_Dr_med_Placzek.lrc'
    },
    // ... 11 weitere Tracks
];

const albumInfo = {
    title: 'Deus ex CT',
    artist: 'Oberarzt Dr. med. Placzek',
    coverSrc: 'assets/images/00-Albumcover.png',
    totalTracks: 12,
    totalDuration: '40:50',
    totalDurationSeconds: 2450,
    downloadSrc: 'assets/downloads/Deus_ex_CT_Complete.zip',
    allVideosZipSrc: 'assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip'
};
```

**Public API:**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `getTracks()` | - | `Array<Track>` | Alle Tracks |
| `getTrackById(id)` | `id: number` | `Track \| null` | Track nach ID |
| `getTrackByIndex(index)` | `index: number` | `Track \| null` | Track nach Index (0-11) |
| `getTrackBySlug(slug)` | `slug: string` | `Track \| null` | Track nach Slug |
| `getTrackIndex(trackId)` | `trackId: number` | `number` | Index des Tracks (-1 wenn nicht gefunden) |
| `getCurrentTrack()` | - | `Track` | Aktueller Track |
| `getCurrentIndex()` | - | `number` | Index des aktuellen Tracks |
| `setCurrentIndex(index)` | `index: number` | `boolean` | Setzt aktuellen Track (true wenn erfolgreich) |
| `getAlbumInfo()` | - | `Object` | Album-Metadaten |
| `getNextTrack()` | - | `Track \| null` | NÃ¤chster Track (null wenn Track 12) |
| `getPreviousTrack()` | - | `Track` | Vorheriger Track (oder Track 1 wenn Track 1) |
| `moveToNext()` | - | `Track \| null` | Springt zu nÃ¤chstem Track |
| `moveToPrevious()` | - | `Track` | Springt zu vorherigem Track |
| `playTrackById(id)` | `id: number` | `Track \| null` | Setzt aktuellen Track nach ID |
| `playTrackBySlug(slug)` | `slug: string` | `Track \| null` | Setzt aktuellen Track nach Slug |
| `hasNextTrack()` | - | `boolean` | Gibt es einen nÃ¤chsten Track? |
| `hasPreviousTrack()` | - | `boolean` | Gibt es einen vorherigen Track? |
| `getPlaylistForDisplay()` | - | `Array<Track>` | Tracks mit Display-Index + isCurrentTrack |
| `getTotalDuration()` | - | `number` | Gesamtdauer in Sekunden (2450) |
| `formatTime(seconds)` | `seconds: number` | `string` | Format: "mm:ss" |
| `formatTotalDuration()` | - | `string` | Formatierte Gesamtdauer ("40 Min. 50 Sek.") |
| `reset()` | - | `void` | Setzt currentIndex auf 0 |
| `getState()` | - | `Object` | Aktueller State (currentIndex, currentTrack) |
| `setState(state)` | `state: Object` | `void` | Setzt State (zum Restore) |
| `saveToStorage()` | - | `void` | Speichert State in localStorage |
| `loadFromStorage()` | - | `boolean` | LÃ¤dt State aus localStorage |

**localStorage Keys:**
- `deusExCT_playlistState`: `{ currentIndex: number }`

**Beispiel-Nutzung:**
```javascript
// Track laden
const track = PlaylistManager.getTrackBySlug('oberarzt-dr-med-placzek');
PlayerEngine.loadTrack(track, 'audio');

// NÃ¤chster Track
const nextTrack = PlaylistManager.getNextTrack();
if (nextTrack) {
    PlayerEngine.loadTrack(nextTrack, 'audio');
}

// State speichern/laden
PlaylistManager.saveToStorage();
PlaylistManager.loadFromStorage();
```

---

### 2. `js/lyrics.js` - LyricsManager

**Verantwortung:** LRC-Parsing, Synchronisation, 3-Zeilen-View

**LRC-Format:**
```lrc
[ti:Oberarzt Dr. med. Placzek]
[ar:Oberarzt Dr. med. Placzek]
[al:Deus ex CT]
[00:00.50]Erste Zeile des Liedes
[00:03.20]Zweite Zeile
[00:05.80]Dritte Zeile
[mm:ss.cc]Text (mm=Minuten, ss=Sekunden, cc=Centisekunden)
```

**Datenstruktur:**
```javascript
const lyrics = [
    { time: 0.50, text: 'Erste Zeile des Liedes' },
    { time: 3.20, text: 'Zweite Zeile' },
    { time: 5.80, text: 'Dritte Zeile' }
];
```

**Public API:**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `loadLyrics(lrcSrc)` | `lrcSrc: string` | `Promise<void>` | LÃ¤dt LRC-Datei |
| `parseLRC(lrcText)` | `lrcText: string` | `Array<Object>` | Parst LRC-Text zu Array |
| `getLyrics()` | - | `Array<Object>` | Alle Lyric-Zeilen |
| `updateCurrentLine(currentTime)` | `currentTime: number` | `void` | Updated aktuelle Zeile basierend auf Zeit |
| `getCurrentLineIndex()` | - | `number` | Index der aktuellen Zeile |
| `getCurrentLine()` | - | `Object \| null` | Aktuelle Zeile (`{ time, text }`) |
| `getPreviousLine()` | - | `Object \| null` | Vorherige Zeile (oder null) |
| `getNextLine()` | - | `Object \| null` | NÃ¤chste Zeile (oder null) |
| `getAllLines()` | - | `Array<Object>` | Alle 3 Zeilen (prev, current, next) |
| `binarySearchLineIndex(time)` | `time: number` | `number` | Binary-Search fÃ¼r schnelle Zeilen-Suche |
| `setOnLyricChange(callback)` | `callback: Function` | `void` | Registriert Callback fÃ¼r Zeilen-Wechsel |
| `clear()` | - | `void` | LÃ¶scht aktuelle Lyrics |

**Events:**
```javascript
LyricsManager.setOnLyricChange(function(data) {
    // data = { prevLine, currentLine, nextLine, currentIndex }
    updateLyricsDisplay(data);
});
```

**Binary-Search Optimierung:**
```javascript
function binarySearchLineIndex(time) {
    let left = 0, right = lyrics.length - 1;
    while (left <= right) {
        const mid = Math.floor((left + right) / 2);
        if (lyrics[mid].time <= time) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }
    return Math.max(0, right);
}
```

**Genauigkeit:** Â±0.016 Sekunden (60 FPS)

**Beispiel-Nutzung:**
```javascript
// Lyrics laden
LyricsManager.loadLyrics('assets/lyrics/01-Oberarzt_Dr_med_Placzek.lrc').then(function() {
    console.log('Lyrics geladen');
});

// Bei Zeit-Update (z.B. alle 250ms)
function onAudioTimeUpdate() {
    const currentTime = audioElement.currentTime;
    LyricsManager.updateCurrentLine(currentTime);
}

// Callback registrieren
LyricsManager.setOnLyricChange(function(data) {
    document.getElementById('prevLyric').textContent = data.prevLine ? data.prevLine.text : '';
    document.getElementById('currentLyric').textContent = data.currentLine.text;
    document.getElementById('nextLyric').textContent = data.nextLine ? data.nextLine.text : '';
});
```

---

### 3. `js/player.js` - PlayerEngine

**Verantwortung:** Core Audio/Video Control, State Management, Error Recovery

**State Machine (8 States):**
```
STOPPED â†’ LOADING â†’ READY â†’ PLAYING
                  â†˜      â†™
                   PAUSED
                   SEEKING
                   STALLED
                   ERROR
```

**Error Types:**
- `NotAllowedError`: User-Gesture erforderlich (iOS)
- `AbortError`: User navigated away
- `NetworkError`: Netzwerkfehler
- `DecodeError`: Video-Dekodierung fehlgeschlagen
- `NotSupportedError`: Format nicht unterstÃ¼tzt
- `UnknownError`: Unbekannter Fehler

**Public API (Auswahl):**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `init()` | - | `boolean` | Initialisiert PlayerEngine (MUSS VOR anderen Methoden aufgerufen werden) |
| `loadTrack(track, mode)` | `track: Object, mode: 'audio'\|'video'` | `Promise<void>` | LÃ¤dt Track (Audio oder Video) |
| `play()` | - | `Promise<void>` | Startet Wiedergabe |
| `pause()` | - | `void` | Pausiert Wiedergabe |
| `togglePlayPause()` | - | `Promise<void>` | Toggle Play/Pause |
| `stop()` | - | `void` | Stoppt Wiedergabe + Reset |
| `seek(time)` | `time: number` | `void` | Springt zu Zeit (in Sekunden) |
| `seekPercent(percent)` | `percent: number (0-100)` | `void` | Springt zu Prozent |
| `seekRelative(seconds)` | `seconds: number` | `void` | Springt relativ (z.B. Â±10 Sekunden) |
| `setVolume(volume)` | `volume: number (0-1)` | `void` | Setzt LautstÃ¤rke |
| `getVolume()` | - | `number` | Aktuelle LautstÃ¤rke |
| `mute()` | - | `void` | Stumm |
| `unmute()` | - | `void` | Unmute |
| `toggleMute()` | - | `void` | Toggle Mute |
| `isMuted()` | - | `boolean` | Ist stumm? |
| `switchMode(mode, preservePos)` | `mode: 'audio'\|'video', preservePos: boolean` | `Promise<void>` | Wechselt Modus (Audio â†” Video) |
| `setQuality(quality, preservePos)` | `quality: 'low'\|'mid'\|'high', preservePos: boolean` | `void` | Setzt Video-QualitÃ¤t |
| `getQuality()` | - | `string` | Aktuelle QualitÃ¤t |
| `getCurrentTime()` | - | `number` | Aktuelle Wiedergabe-Position (Sekunden) |
| `getDuration()` | - | `number` | Gesamtdauer Track (Sekunden) |
| `getProgress()` | - | `number (0-1)` | Fortschritt (0.0 bis 1.0) |
| `getRemainingTime()` | - | `number` | Restzeit (Sekunden) |
| `getIsPlaying()` | - | `boolean` | Wird gerade abgespielt? |
| `getCurrentMode()` | - | `'audio'\|'video'` | Aktueller Modus |
| `getCurrentTrack()` | - | `Object \| null` | Aktueller Track |
| `formatTime(seconds)` | `seconds: number` | `string` | Formatiert Zeit zu "mm:ss" |
| `enterFullscreen()` | - | `Promise<void>` | Startet Fullscreen |
| `exitFullscreen()` | - | `Promise<void>` | Beendet Fullscreen |
| `toggleFullscreen()` | - | `Promise<void>` | Toggle Fullscreen |
| `isFullscreen()` | - | `boolean` | Ist im Fullscreen? |
| `setPlaybackRate(rate)` | `rate: number (0.25-4)` | `void` | Setzt Wiedergabe-Geschwindigkeit |
| `getPlaybackRate()` | - | `number` | Aktuelle Wiedergabe-Geschwindigkeit |
| `on(event, callback)` | `event: string, callback: Function` | `void` | Registriert Event-Listener |
| `off(event, callback)` | `event: string, callback: Function` | `void` | Entfernt Event-Listener |
| `getPlaybackState()` | - | `string` | Aktueller State (STOPPED, LOADING, PLAYING, etc.) |
| `isMediaReady()` | - | `boolean` | Sind Media-Elemente bereit? |
| `destroy()` | - | `void` | Cleanup (vor Unload) |

**Events:**
- `play`: Wiedergabe gestartet
- `pause`: Wiedergabe pausiert
- `timeupdate`: Zeit aktualisiert (ca. alle 250ms)
- `ended`: Track zu Ende
- `error`: Fehler aufgetreten
- `loadstart`: Laden begonnen
- `canplay`: Kann abgespielt werden
- `waiting`: Warten auf Daten
- `seeking`: Seek begonnen
- `seeked`: Seek abgeschlossen
- `volumechange`: LautstÃ¤rke geÃ¤ndert
- `modechange`: Modus geÃ¤ndert (Audio â†’ Video)
- `qualitychange`: QualitÃ¤t geÃ¤ndert
- `durationchange`: Dauer aktualisiert
- `fullscreenchange`: Fullscreen-Status geÃ¤ndert

**Mobile-spezifische Optimierungen:**

```javascript
// iOS User-Gesture Context
function setupUserInteractionDetection() {
    document.addEventListener('touchstart', function() {
        userHasInteracted = true;
        // Jetzt funktioniert play() ohne Fehler
    });
}

// Stall-Recovery (Exponential Backoff)
function handleMediaStall() {
    if (stallRetryCount < 4) {
        const delay = [500, 1000, 2000, 4000][stallRetryCount];
        stallRetryCount++;
        setTimeout(function() {
            performPlaySync();
        }, delay);
    }
}

// readyState PrÃ¼fung
if (audioElement.readyState >= 3) {
    // Bereits bereit, kann abspielen
    performPlaySync();
}
```

**Beispiel-Nutzung:**
```javascript
// Player initialisieren
PlayerEngine.init();

// Track laden und abspielen
const track = PlaylistManager.getCurrentTrack();
PlayerEngine.loadTrack(track, 'audio').then(function() {
    PlayerEngine.play().catch(function(e) {
        if (e.name === 'NotAllowedError') {
            console.log('Warte auf User-Gesture (iOS)');
            // Wird automatisch bei nÃ¤chstem Tap aufgerufen
        }
    });
});

// Event-Listener
PlayerEngine.on('timeupdate', function() {
    updateProgressBar(PlayerEngine.getProgress());
    LyricsManager.updateCurrentLine(PlayerEngine.getCurrentTime());
});

PlayerEngine.on('error', function(data) {
    console.error('Playback Error:', data);
    showToast('Wiedergabefehler: ' + data.errorCode);
});

// Fullscreen
PlayerEngine.on('fullscreenchange', function() {
    console.log('Fullscreen:', PlayerEngine.isFullscreen());
});
```

---

### 4. `js/mediasession.js` - Media Session Integration

**Verantwortung:** Sperrbildschirm-Controls, Metadaten, Smartwatch-Integration

**Public API:**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `init()` | - | `boolean` | Initialisiert Media Session |
| `setMetadata(track)` | `track: Object` | `void` | Setzt Track-Metadaten fÃ¼r Sperrbildschirm |
| `setPlaybackState(state)` | `state: 'playing'\|'paused'\|'stopped'` | `void` | Setzt Playback-State |
| `updatePositionState(currentTime, duration)` | `currentTime: number, duration: number` | `void` | Updated Position auf Sperrbildschirm |
| `setActionHandler(action, callback)` | `action: string, callback: Function` | `void` | Registriert Action-Handler |

**Actions:**
- `play`: Play-Button gedrÃ¼ckt
- `pause`: Pause-Button gedrÃ¼ckt
- `nexttrack`: NÃ¤chster Track
- `previoustrack`: Vorheriger Track
- `seekto`: Seek zu Position (mit `details.seekTime`)

**Metadata-Format:**
```javascript
MediaSessionManager.setMetadata({
    title: 'Oberarzt Dr. med. Placzek',
    artist: 'Oberarzt Dr. med. Placzek',
    album: 'Deus ex CT',
    artwork: [
        {
            src: 'assets/images/01-Oberarzt_Dr_med_Placzek.png',
            sizes: '512x512',
            type: 'image/png'
        }
    ]
});
```

**Beispiel-Nutzung:**
```javascript
MediaSessionManager.init();

// Bei Track-Wechsel
MediaSessionManager.setMetadata(currentTrack);

// Bei Play/Pause
PlayerEngine.on('play', function() {
    MediaSessionManager.setPlaybackState('playing');
});

PlayerEngine.on('pause', function() {
    MediaSessionManager.setPlaybackState('paused');
});

// Bei Time-Update
PlayerEngine.on('timeupdate', function() {
    MediaSessionManager.updatePositionState(
        PlayerEngine.getCurrentTime(),
        PlayerEngine.getDuration()
    );
});

// Action-Handler
MediaSessionManager.setActionHandler('play', function() {
    PlayerEngine.play();
});

MediaSessionManager.setActionHandler('nexttrack', function() {
    PlaylistManager.moveToNext();
    // ... update und play
});
```

---

### 5. `js/download.js` - DownloadManager

**Verantwortung:** Download-Management, Progress, History

**Public API:**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `init()` | - | `void` | Initialisiert DownloadManager |
| `downloadCurrentVideoHQ()` | - | `void` | Startet Download aktuelles HQ-Video |
| `downloadAlbumZip()` | - | `void` | Startet Download Album-ZIP |
| `downloadAllVideosZip()` | - | `void` | Startet Download All-Videos-ZIP |
| `addToQueue(download)` | `download: Object` | `void` | FÃ¼gt Download zur Queue hinzu |
| `getActiveDownloads()` | - | `Array<Object>` | Aktive Downloads |
| `getDownloadHistory()` | - | `Array<Object>` | Download-Verlauf (localStorage) |
| `cancelDownload(downloadId)` | `downloadId: string` | `void` | Bricht Download ab |
| `setOnProgressCallback(callback)` | `callback: Function` | `void` | Registriert Progress-Callback |
| `setOnCompleteCallback(callback)` | `callback: Function` | `void` | Registriert Complete-Callback |
| `setOnErrorCallback(callback)` | `callback: Function` | `void` | Registriert Error-Callback |

**Download-Objekt:**
```javascript
{
    id: 'unique-id',
    name: 'Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4',
    size: 95728640,  // Bytes
    url: 'assets/video/high/01-Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4',
    downloaded: 47864320,  // Bytes
    progress: 50,  // Prozent
    status: 'downloading',  // downloading, completed, failed, cancelled
    startTime: 1672531200,  // Unix timestamp
    estimatedTime: 120  // Sekunden
}
```

**localStorage Keys:**
- `deusExCT_downloadHistory`: `Array<{ name, size, timestamp }>`

**Concurrent Downloads:** Max 3 parallel

**Beispiel-Nutzung:**
```javascript
DownloadManager.init();

// Download starten
DownloadManager.downloadCurrentVideoHQ();

// Progress-Callback
DownloadManager.setOnProgressCallback(function(download) {
    console.log('Progress:', download.progress + '%');
    updateProgressBar(download.progress);
});

// Complete-Callback
DownloadManager.setOnCompleteCallback(function(download) {
    showToast('Download abgeschlossen: ' + download.name);
});

// Error-Callback
DownloadManager.setOnErrorCallback(function(error, download) {
    showToast('Download fehlgeschlagen: ' + download.name);
});
```

---

### 6. `js/app.js` - App Controller

**Verantwortung:** UI-Management, Event-Handling, View-Routing

**Public API:**

| Methode | Parameter | Returns | Beschreibung |
|---------|-----------|---------|-------------|
| `init()` | - | `void` | Initialisiert App (MUSS VOR PlayerEngine aufgerufen werden) |
| `showView(view)` | `view: 'album'\|'player'\|'video'` | `void` | Wechselt View |
| `playTrack(track, mode)` | `track: Object, mode: string` | `void` | Spielt Track ab |
| `showToast(message)` | `message: string` | `void` | Zeigt Toast-Nachricht |

**Views:**
- `album`: Album-View mit Tracklist
- `player`: Audio-Player mit Lyrics
- `video`: Video-Player mit QualitÃ¤ts-Optionen

**Event-Binding:**
```javascript
setupEventListeners() {
    // Play-Button
    playPauseBtn.addEventListener('click', handlePlayPauseClick);

    // Previous/Next
    prevBtn.addEventListener('click', handlePrevClick);
    nextBtn.addEventListener('click', handleNextClick);

    // Seek-Bar
    progressBar.addEventListener('mousedown', startSeek);
    progressBar.addEventListener('touchstart', startSeek);
    document.addEventListener('mousemove', updateSeek);
    document.addEventListener('touchmove', updateSeek);
    document.addEventListener('mouseup', endSeek);
    document.addEventListener('touchend', endSeek);

    // Volume
    volumeBar.addEventListener('input', handleVolumeChange);
    volumeMuteBtn.addEventListener('click', handleMuteClick);

    // Mode-Switch
    audioModeBtn.addEventListener('click', function() {
        PlayerEngine.switchMode('audio', true);
    });
    videoModeBtn.addEventListener('click', function() {
        PlayerEngine.switchMode('video', true);
    });

    // Quality-Buttons (Video-Mode)
    qualityButtons.forEach(function(btn) {
        btn.addEventListener('click', function() {
            const quality = btn.dataset.quality;
            PlayerEngine.setQuality(quality, true);
        });
    });

    // Fullscreen
    fullscreenBtn.addEventListener('click', function() {
        PlayerEngine.toggleFullscreen();
    });

    // Downloads
    downloadAllVideosBtn.addEventListener('click', function() {
        showDownloadModal();
    });
    downloadAlbumBtn.addEventListener('click', function() {
        showDownloadModal();
    });

    // Keyboard-Shortcuts
    document.addEventListener('keydown', handleKeyboardShortcuts);

    // Tracklist-Clicks
    playlistItems.forEach(function(item) {
        item.addEventListener('click', function() {
            const trackId = parseInt(item.dataset.trackId);
            const track = PlaylistManager.getTrackById(trackId);
            playTrack(track, 'audio');
            showView('player');
        });
    });

    // Window-Events
    window.addEventListener('hashchange', handleRouteChange);
    window.addEventListener('beforeunload', function() {
        PlayerEngine.pause();
        PlaylistManager.saveToStorage();
    });
}
```

**Beispiel-Nutzung:**
```javascript
// App starten
App.init();

// Track abspielen
App.playTrack(track, 'audio');

// View wechseln
App.showView('player');

// Nachricht zeigen
App.showToast('Track geladen!');
```

---

### 7. `js/playlist.js` - Tracklist-Rendering

**HTML-Rendering:**
```javascript
function renderPlaylist() {
    const playlistContainer = document.getElementById('playlistContainer');
    const displayList = PlaylistManager.getPlaylistForDisplay();

    let html = '<div class="playlist">';
    displayList.forEach(function(track) {
        html += `
            <div class="playlist-item ${track.isCurrentTrack ? 'active' : ''}"
                 data-track-id="${track.id}"
                 data-track-slug="${track.slug}">
                <div class="playlist-item-number">${String(track.number).padStart(2, '0')}</div>
                <div class="playlist-item-info">
                    <div class="playlist-item-title">${track.title}</div>
                    <div class="playlist-item-duration">${track.duration}</div>
                </div>
                <div class="playlist-item-artwork">
                    <img src="${track.imageSrc}" alt="${track.title}">
                </div>
            </div>
        `;
    });
    html += '</div>';

    playlistContainer.innerHTML = html;
}
```

---

### 8. `js/lyrics.js` - Lyrics-Rendering (3-Zeilen-View)

**HTML-Struktur:**
```html
<div class="lyrics-container">
    <div class="lyric-line prev-lyric" id="prevLyric" aria-hidden="true"></div>
    <div class="lyric-line current-lyric" id="currentLyric" aria-label="Aktueller Songtext"></div>
    <div class="lyric-line next-lyric" id="nextLyric" aria-hidden="true"></div>
</div>
```

**Rendering mit Animation:**
```javascript
function updateLyricsDisplay(data) {
    const prevLyric = document.getElementById('prevLyric');
    const currentLyric = document.getElementById('currentLyric');
    const nextLyric = document.getElementById('nextLyric');

    // Fade-Out Animation
    currentLyric.classList.add('lyric-fade-out');

    setTimeout(function() {
        prevLyric.textContent = data.prevLine ? data.prevLine.text : '';
        currentLyric.textContent = data.currentLine.text;
        nextLyric.textContent = data.nextLine ? data.nextLine.text : '';

        // Fade-In Animation
        currentLyric.classList.remove('lyric-fade-out');
        currentLyric.classList.add('lyric-fade-in');

        setTimeout(function() {
            currentLyric.classList.remove('lyric-fade-in');
        }, 300);
    }, 150);
}
```

---

## ğŸ”„ Datenfluss & Event-System

### Init-Sequenz

```
1. HTML lÃ¤dt
   â†“
2. index.html Cache-Clear Script lÃ¤uft
   â€¢ Cleanup: IndexedDB, LocalStorage, Browser Caches
   â€¢ Version wird aktualisiert
   â†“
3. Scripts laden in Reihenfolge:
   â€¢ playlist.js
   â€¢ lyrics.js
   â€¢ player.js
   â€¢ mediasession.js
   â€¢ download.js
   â€¢ app.js
   â†“
4. DOMContentLoaded Event
   â†“
5. App.init() aufgerufen
   â€¢ Wartet auf PlayerEngine.init()
   â€¢ Max 5 Sekunden Timeout
   â€¢ Garantierter Fallback nach 5s
   â†“
6. PlayerEngine.init() aufgerufen
   â€¢ detectPlatform()
   â€¢ ensureMediaElements()
   â€¢ cacheElements()
   â€¢ configureMediaElements()
   â€¢ setupUserInteractionDetection()
   â€¢ setupAudioListeners()
   â€¢ setupVideoListeners()
   â†“
7. App.continueInit() aufgerufen
   â€¢ cacheElements()
   â€¢ setupEventListeners()
   â€¢ setupPlayerCallbacks()
   â€¢ setupLyricsCallbacks()
   â€¢ setupMediaSession()
   â€¢ renderPlaylist()
   â€¢ restoreState() (aus localStorage)
   â€¢ handleInitialRoute()
   â€¢ startVisualUpdateLoop()
   â†“
8. App ready!
```

### Playback-Sequenz (Audio-Modus)

```
User klickt Play-Button
   â†“
handlePlayPauseClick()
   â†“
PlaylistManager.getCurrentTrack() â†’ Track
   â†“
PlayerEngine.loadTrack(track, 'audio')
   â€¢ loadAudioTrack(track)
   â€¢ audioElement.src = track.audioSrc
   â€¢ audioElement.addEventListener('canplay', ...)
   â€¢ audioElement.load()
   â†“
'canplay' Event wirft
   â†“
LyricsManager.loadLyrics(track.lyricsSrc)
   â€¢ fetch(lyricsSrc)
   â€¢ parseLRC()
   â†“
backgroundVideoElement.src = track.backgroundSrc
backgroundVideoElement.play()
   â†“
PlayerEngine.play()
   â€¢ audioElement.play()
   â€¢ playbackState = 'PLAYING'
   â€¢ Trigger 'play' Event
   â†“
audioElement 'timeupdate' Event wirft (alle ~250ms)
   â†“
App 'timeupdate' Callback:
   â€¢ updateProgressBar(progress)
   â€¢ LyricsManager.updateCurrentLine(currentTime)
   â€¢ MediaSessionManager.updatePositionState()
   â†“
LyricsManager.on('lyricchange')
   â†“
updateLyricsDisplay(data)
   â€¢ Fade-Out aktuelle Zeile
   â€¢ Update DOM mit neuer Zeile
   â€¢ Fade-In neue Zeile
   â†“
Lyrics-Animation 300ms
```

### Mode-Switch-Sequenz (Audio â†’ Video)

```
User klickt "Video-Modus"
   â†“
PlayerEngine.switchMode('video', true)
   â€¢ Speichert currentTime = audioElement.currentTime
   â€¢ Pausiert Audio
   â€¢ LÃ¤dt Video fÃ¼r QualitÃ¤t
   â†“
loadVideoTrack(track, quality)
   â€¢ videoElement.src = track.videoSrc[quality]
   â€¢ videoElement.addEventListener('canplay', ...)
   â€¢ videoElement.load()
   â†“
'canplay' Event wirft
   â†“
currentMode = 'video'
   â€¢ Trigger 'modechange' Event
   â€¢ updatePlayerLayout('video')
   â†“
videoElement.currentTime = savedTime
   â†“
PlayerEngine.play()
   â€¢ videoElement.play()
   â†“
Video spielt ab
   â€¢ Audio kommt aus Video-Datei
   â€¢ Keine separaten Lyrics (eingebunden im Video)
```

### Quality-Switch-Sequenz (MID â†’ HQ)

```
User klickt "HQ"-Button
   â†“
PlayerEngine.setQuality('high', true)
   â€¢ Speichert currentTime = videoElement.currentTime
   â€¢ Pausiert Video
   â€¢ currentQuality = 'high'
   â†“
loadVideoTrack(track, 'high')
   â€¢ videoElement.src = track.videoSrc.high
   â€¢ videoElement.load()
   â†“
'canplay' Event wirft
   â†“
videoElement.currentTime = savedTime
   â†“
PlayerEngine.play()
   â€¢ videoElement.play()
   â†“
HQ-Video spielt ab
   â€¢ Re-buffering: 200-500ms
```

---

## ğŸš€ Deployment-Anleitung

### Vorbereitung

**1. Assets vorbereiten:**
```bash
# Verzeichnis-Struktur:
assets/
â”œâ”€â”€ audio/
â”‚   â””â”€â”€ 01-12-*.mp3 (128 Kbps)
â”œâ”€â”€ downloads/
â”‚   â”œâ”€â”€ Deus_ex_CT_Complete.zip
â”‚   â””â”€â”€ Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ 00-Albumcover.png (512Ã—512px)
â”‚   â””â”€â”€ 01-12-*.png
â”œâ”€â”€ lyrics/
â”‚   â””â”€â”€ 01-12-*.lrc (UTF-8, [mm:ss.cc]Format)
â””â”€â”€ video/
    â”œâ”€â”€ background/
    â”‚   â””â”€â”€ 01-12-*.mp4 (muted, looped)
    â”œâ”€â”€ low/
    â”‚   â””â”€â”€ 01-12-*_Lyrics_low.mp4 (360p)
    â”œâ”€â”€ mid/
    â”‚   â””â”€â”€ 01-12-*_Lyrics_mid.mp4 (720p)
    â””â”€â”€ high/
        â””â”€â”€ 01-12-*_Lyrics_hq.mp4 (1080p)
```

**2. Dateien hochladen:**
```bash
# Via FTP/SCP (case-sensitive!)
scp -r ./* user@host:/public_html/

# Via Git
git push production main
```

**3. Konfiguration prÃ¼fen:**
```bash
# .htaccess Rechte
chmod 644 .htaccess

# manifest.json Rechte
chmod 644 manifest.json

# Cache clearen (optional)
rm -rf /tmp/cloudflare_cache
service apache2 restart
```

### Verifizierung

**HTTPS & Cache-Header:**
```bash
curl -I https://deus-ex-ct.markuslurz.de/
# Sollte zeigen:
# HTTP/2 200
# Cache-Control: max-age=0, must-revalidate

curl -I https://deus-ex-ct.markuslurz.de/js/app.js
# Sollte zeigen:
# Cache-Control: max-age=31536000, immutable
```

**Accept-Ranges (fÃ¼r Video-Seeking):**
```bash
curl -I https://deus-ex-ct.markuslurz.de/assets/video/mid/01-*.mp4
# Sollte zeigen:
# Accept-Ranges: bytes
```

**CORS-Header:**
```bash
curl -H "Origin: https://deus-ex-ct.markuslurz.de" -I \
  https://deus-ex-ct.markuslurz.de/assets/downloads/*.zip
# Sollte zeigen:
# Access-Control-Allow-Origin: *
```

**manifest.json:**
```bash
curl https://deus-ex-ct.markuslurz.de/manifest.json | jq .
# Sollte valid JSON sein
```

**Audio-Datei:**
```bash
curl -I https://deus-ex-ct.markuslurz.de/assets/audio/01-*.mp3
# Sollte zeigen:
# Content-Type: audio/mpeg
# Content-Length: ~2800000 (2.8 MB)
```

---

## ğŸ”§ Debugging-Guide

### Browser DevTools

**Console (F12 â†’ Console):**
```javascript
// Player-State prÃ¼fen
PlayerEngine.getPlaybackState()
PlayerEngine.getIsPlaying()
PlayerEngine.getCurrentTime()
PlayerEngine.getDuration()

// Track-Info prÃ¼fen
PlaylistManager.getCurrentTrack()
PlaylistManager.getCurrentIndex()

// Lyrics prÃ¼fen
LyricsManager.getLyrics()
LyricsManager.getCurrentLine()

// Volume prÃ¼fen
PlayerEngine.getVolume()
PlayerEngine.isMuted()

// localStorage prÃ¼fen
localStorage.getItem('deusExCT_volume')
localStorage.getItem('deusExCT_quality')
localStorage.getItem('deusExCT_playlistState')
```

**Network (F12 â†’ Network):**
```
1. Lade Seite neu (Ctrl+Shift+R)
2. PrÃ¼fe:
   â€¢ index.html: Cache-Control: max-age=0
   â€¢ player.js: 304 Not Modified (wenn cached)
   â€¢ Audio-Datei: Content-Length, Accept-Ranges
   â€¢ Video-Datei: HTTP 206 Partial Content (wenn seeked)
3. PrÃ¼fe auf Fehler (rot):
   â€¢ CORS-Fehler?
   â€¢ 404 Fehler?
   â€¢ Timeouts?
```

**Performance (F12 â†’ Performance):**
```
1. Starte Recording (Ctrl+Shift+E)
2. Klicke Play
3. Beobachte 5 Sekunden
4. Stoppe Recording
5. PrÃ¼fe:
   â€¢ Main Thread: Sollte < 80% sein
   â€¢ FPS: Sollte 60 sein
   â€¢ Memory: Sollte nicht steigen
```

**Storage (F12 â†’ Application â†’ Storage):**
```
LocalStorage:
â€¢ deusExCT_volume
â€¢ deusExCT_muted
â€¢ deusExCT_quality
â€¢ deusExCT_playerState
â€¢ deusExCT_playlistState
â€¢ deusExCT_buildVersion
â€¢ deusExCT_buildTimestamp
```

### HÃ¤ufige Debugging-Szenarien

**Szenario 1: Video lÃ¤dt nicht**
```javascript
// DevTools Console:
PlayerEngine.getAudioElement().src
PlayerEngine.getVideoElement().src

// PrÃ¼fe:
// 1. Pfad korrekt?
// 2. Datei existiert?
// 3. CORS-Header?

// Test:
fetch('assets/video/mid/01-*.mp4', { method: 'HEAD' })
    .then(r => console.log(r.status, r.headers.get('Accept-Ranges')))
    .catch(e => console.error(e))
```

**Szenario 2: Lyrics synchronisieren nicht**
```javascript
// DevTools Console:
LyricsManager.getLyrics().length  // Sollte > 0 sein
LyricsManager.getCurrentLine()
LyricsManager.binarySearchLineIndex(5)  // Zeile bei 5 Sekunden

// PrÃ¼fe:
// 1. LRC-Datei geladen?
// 2. Format korrekt [mm:ss.cc]?
// 3. UTF-8 encoding?

// Test:
fetch('assets/lyrics/01-*.lrc')
    .then(r => r.text())
    .then(t => console.log(t.substring(0, 100)))
    .catch(e => console.error(e))
```

**Szenario 3: Play funktioniert nicht (iOS)**
```javascript
// DevTools Console (Mobile Safari):
PlayerEngine.getUserHasInteracted()  // Sollte true sein nach Tap
PlayerEngine.getPlaybackState()

// Test:
// 1. Tap auf Seite (um User-Gesture zu setzen)
// 2. Dann Play-Button klicken
// 3. Sollte funktionieren

// Wenn nicht:
// PrÃ¼fe Cache (Settings â†’ Safari â†’ Clear History and Website Data)
```

**Szenario 4: Download funktioniert nicht**
```javascript
// DevTools Console:
DownloadManager.getActiveDownloads()
DownloadManager.getDownloadHistory()

// Test:
fetch('assets/downloads/Deus_ex_CT_Complete.zip', { method: 'HEAD' })
    .then(r => console.log(r.status, r.headers.get('Content-Length')))
    .catch(e => console.error(e))
```

### Netzwerk-Throttling testen

**Chrome DevTools â†’ Network â†’ Throttling:**
```
No throttling      â† Desktop
Fast 3G (5 Mbps)   â† Gutes Mobil
Slow 3G (400 Kbps) â† Schlechtes Mobil
Offline            â† Kein Netzwerk
```

**Test-Prozedur:**
```
1. Setze Throttling auf "Slow 3G"
2. Starte Seite neu (Ctrl+Shift+R)
3. Beobachte:
   â€¢ Page-Load Zeit
   â€¢ Audio-Start Zeit
   â€¢ Video-Start Zeit
4. PrÃ¼fe auf Fehler:
   â€¢ Timeouts?
   â€¢ Stalls?
   â€¢ Failed Downloads?
```

---

## ğŸ“ˆ Performance-Optimierungen

### Asset-GrÃ¶ÃŸen optimieren

**Audio (MP3):**
```bash
# Konvertiere zu 128 Kbps (konstant)
ffmpeg -i input.wav -b:a 128k -q:a 9 output.mp3

# GrÃ¶ÃŸe prÃ¼fen
ls -lh output.mp3  # Sollte ~1-5 MB pro Track sein
```

**Video (MP4):**
```bash
# Konvertiere zu verschiedenen QualitÃ¤ten
# LOW (360p)
ffmpeg -i input.mov -vf scale=640:360 -b:v 300k -b:a 128k output_low.mp4

# MID (720p)
ffmpeg -i input.mov -vf scale=1280:720 -b:v 800k -b:a 128k output_mid.mp4

# HQ (1080p)
ffmpeg -i input.mov -vf scale=1920:1080 -b:v 2000k -b:a 128k output_hq.mp4

# GrÃ¶ÃŸe prÃ¼fen
du -h output_*.mp4  # LOW: 2-3 MB, MID: 7-8 MB, HQ: 15-20 MB
```

**Lyrics (LRC):**
```bash
# PrÃ¼fe Encoding
file *.lrc  # Sollte "UTF-8 Unicode" sein

# Konvertiere zu UTF-8 ohne BOM
iconv -f CP1252 -t UTF-8 input.lrc > output.lrc

# PrÃ¼fe GrÃ¶ÃŸe
wc -l output.lrc  # Sollte 20-100 Zeilen pro Track sein
```

**Artwork (PNG):**
```bash
# Komprimiere PNG
optipng -o2 input.png -out output.png

# Oder mit ImageMagick
convert input.jpg -quality 85 output.png

# GrÃ¶ÃŸe sollte 400-512 KB sein
ls -lh output.png
```

### JavaScript-Optimierungen

**Bundle-GrÃ¶ÃŸe reduzieren:**
```bash
# Minify JavaScript (optional)
npx terser js/app.js -o js/app.min.js

# Gzip komprimieren (via .htaccess)
# Bereits konfiguriert!
```

**Lazy-Loading implementieren:**
```javascript
// NÃ¤chster Track preload (bereits implementiert)
function preloadNextTrack() {
    const nextTrack = PlaylistManager.getNextTrack();
    if (nextTrack) {
        PlayerEngine.preloadTrack(nextTrack);
    }
}
```

---

## ğŸ”Œ Erweiterungen & Customization

### Neuen Track hinzufÃ¼gen

**1. Track zu `js/playlist.js` hinzufÃ¼gen:**
```javascript
{
    id: 13,
    number: 13,
    title: 'Neuer Track',
    artist: 'Oberarzt Dr. med. Placzek',
    slug: 'neuer-track',
    duration: '03:30',
    durationSeconds: 210,
    audioSrc: 'assets/audio/13-Neuer_Track.mp3',
    videoSrc: {
        low: 'assets/video/low/13-Neuer_Track_Lyrics_low.mp4',
        mid: 'assets/video/mid/13-Neuer_Track_Lyrics_mid.mp4',
        high: 'assets/video/high/13-Neuer_Track_Lyrics_hq.mp4'
    },
    imageSrc: 'assets/images/13-Neuer_Track.png',
    backgroundSrc: 'assets/video/background/13-Neuer_Track.mp4',
    lyricsSrc: 'assets/lyrics/13-Neuer_Track.lrc'
}
```

**2. Assets uploaden:**
- `assets/audio/13-Neuer_Track.mp3`
- `assets/images/13-Neuer_Track.png`
- `assets/lyrics/13-Neuer_Track.lrc`
- `assets/video/background/13-Neuer_Track.mp4`
- `assets/video/low/13-Neuer_Track_Lyrics_low.mp4`
- `assets/video/mid/13-Neuer_Track_Lyrics_mid.mp4`
- `assets/video/high/13-Neuer_Track_Lyrics_hq.mp4`

**3. Download-ZIP regenerieren:**
- Neues Track-MP3 zu `Deus_ex_CT_Complete.zip` hinzufÃ¼gen
- Neue HQ-Videos zu `Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip` hinzufÃ¼gen

### Custom CSS-Styling

**Dark-Mode Farben anpassen (`css/styles.css`):**
```css
:root {
    --primary-bg: #000000;
    --primary-text: #ffffff;
    --accent-color: #d4af37;  /* Gold */
    --secondary-bg: #1a1a1a;
    --border-color: #333333;
}

/* Beispiel: Accent-Farbe Ã¤ndern */
:root {
    --accent-color: #ff0000;  /* Rot statt Gold */
}
```

### Custom Event-Handler

```javascript
// Neuen Event-Handler hinzufÃ¼gen
PlayerEngine.on('play', function() {
    console.log('Track gestartet');
    // Custom Logik
});

PlayerEngine.on('ended', function() {
    console.log('Track zu Ende');
    // Custom Logik (z.B. Analytics)
});
```

---

## ğŸ“ Lizenz & Credits

**Deus ex CT WebApp v11.0**
- Entwickler: Markus Lurz
- Album: Oberarzt Dr. med. Placzek
- Lizenz: Proprietary (Alle Rechte vorbehalten)

---
```

 
--- 

/Technische_Dokumentation.md:

```md
# Technische Dokumentation - Deus ex CT WebApp v11.0

## ğŸ—ï¸ Architektur & Design Patterns

### Revealing Module Pattern

Die gesamte Anwendung folgt dem **Revealing Module Pattern**, einer Variation des Module Pattern mit explizit definierten Public APIs.

**Struktur:**
```javascript
const ModuleName = (function() {
    // PRIVATE Scope
    const privateVar = 'nicht global sichtbar';
    const privateArray = [];

    function privateMethod() {
        // Nur innerhalb des Moduls sichtbar
    }

    // PUBLIC Scope (Revealing)
    const publicAPI = {
        publicMethod: function() {
            // Ruft private Methoden auf
            privateMethod();
        },
        publicProperty: privateVar
    };

    return publicAPI;
})();
```

**Vorteile:**
- âœ… Keine globalen Variablen (auÃŸer ModuleName)
- âœ… Private/Public Encapsulation
- âœ… IIFE (Immediately Invoked Function Expression) fÃ¼r Scope
- âœ… Keine AbhÃ¤ngigkeiten zwischen Modulen
- âœ… Einfach zu testen und debuggen

### Modular-AbhÃ¤ngigkeiten (Dependency Graph)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.html (View)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ app.js     â”‚          â”‚ PlayerEngine     â”‚
    â”‚ (Controller)          â”‚ (player.js)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼       â–¼       â–¼       â–¼         â–¼
 Playlist Lyrics   Media  Download  (Media
 Manager Manager  Session Manager   Elements)
(playlist (lyrics (media (download
  .js)    .js)  session .js)
                .js)
```

**Richtung des Datenflusses:**
- app.js â†’ PlayerEngine â†’ Media Elements
- app.js â†’ PlaylistManager
- app.js â†’ LyricsManager
- app.js â†’ MediaSessionManager
- app.js â†’ DownloadManager
- PlayerEngine â†’ LyricsManager (intern)

**KEINE zirkulÃ¤ren AbhÃ¤ngigkeiten!**

### Initialization-Order (KRITISCH)

```
1. index.html parsed & DOM ready
   â†“
2. Cache-Clear Script (inline im head)
   â€¢ IndexedDB cleanup
   â€¢ LocalStorage backup
   â€¢ Browser Caches clear
   â€¢ Version aktualisiert
   â†“
3. Scripts in Reihenfolge:
   a) playlist.js    â† Data Layer (keine AbhÃ¤ngigkeiten)
   b) lyrics.js      â† Utilities (keine AbhÃ¤ngigkeiten)
   c) player.js      â† Core (benÃ¶tigt Media Elements)
   d) mediasession.js â† Optional (benÃ¶tigt Media Session API)
   e) download.js    â† Optional (benÃ¶tigt Fetch API)
   f) app.js         â† Controller (benÃ¶tigt ALLE anderen)
   â†“
4. DOMContentLoaded Event
   â†“
5. App.init() â†’ PlayerEngine.init() â†’ App.continueInit()
   â†“
6. App bereit fÃ¼r User-Input
```

**WICHTIG:** Wenn Reihenfolge falsch ist, werden Module nicht geladen!

---

## ğŸ’¾ State Management & Datenstrukturen

### Global State (Player)

```javascript
const PlayerState = {
    currentMode: 'audio',              // 'audio' | 'video'
    playbackState: 'stopped',          // PlaybackState enum
    currentTrack: null,                // Track object | null
    currentTime: 0,                    // Sekunden
    duration: 0,                       // Sekunden
    isPlaying: false,                  // boolean
    volume: 1.0,                       // 0.0 - 1.0
    isMuted: false,                    // boolean
    lastVolume: 1.0,                   // FÃ¼r Unmute
    currentQuality: 'mid',             // 'low' | 'mid' | 'high'
    isLoadingMedia: false,             // boolean
    isSeeking: false,                  // boolean
    isVideoFullscreen: false,          // boolean
    playbackRate: 1.0,                 // 0.25 - 4.0

    // Mobile-spezifisch
    isIOS: false,                      // boolean
    isAndroid: false,                  // boolean
    isMobile: false,                   // boolean
    userHasInteracted: false,          // iOS User-Gesture

    // Retry-Logic
    playbackAttempts: 0,               // counter
    stallRetryCount: 0,                // counter
    lastStallTime: 0,                  // timestamp
};
```

### PlaybackState Enum

```javascript
const PlaybackState = {
    STOPPED: 'stopped',      // Nicht spielend, Position = 0
    LOADING: 'loading',      // Media wird geladen
    READY: 'ready',          // Media kann abgespielt werden
    PLAYING: 'playing',      // Aktiv spielend
    PAUSED: 'paused',        // Pausiert, Position > 0
    SEEKING: 'seeking',      // User seeked
    STALLED: 'stalled',      // Media stalled (Puffer leer)
    ERROR: 'error'           // Fehler aufgetreten
};
```

### Track Object (Datenstruktur)

```javascript
const Track = {
    id: 1,                                      // Eindeutige ID
    number: 1,                                  // Display-Nummer
    title: 'Oberarzt Dr. med. Placzek',         // Track-Name
    artist: 'Oberarzt Dr. med. Placzek',        // KÃ¼nstler
    slug: 'oberarzt-dr-med-placzek',            // URL-freundlich
    duration: '02:12',                          // Formatted string
    durationSeconds: 132,                       // In Sekunden
    audioSrc: 'assets/audio/01-*.mp3',          // MP3-Pfad
    videoSrc: {                                 // Video-Pfade nach QualitÃ¤t
        low: 'assets/video/low/01-*_low.mp4',   // 360p
        mid: 'assets/video/mid/01-*_mid.mp4',   // 720p (Default)
        high: 'assets/video/high/01-*_hq.mp4'   // 1080p
    },
    imageSrc: 'assets/images/01-*.png',         // Artwork
    backgroundSrc: 'assets/video/background/01-*.mp4',  // Loop-Video
    lyricsSrc: 'assets/lyrics/01-*.lrc'         // LRC-Datei
};
```

### Lyric Object (Datenstruktur)

```javascript
const LyricLine = {
    time: 3.20,              // Zeitstempel in Sekunden
    text: 'Zweite Zeile'     // Lyric-Text
};

const LyricsData = {
    metadata: {
        title: 'Oberarzt Dr. med. Placzek',
        artist: 'Oberarzt Dr. med. Placzek',
        album: 'Deus ex CT'
    },
    lines: [
        { time: 0.50, text: 'Erste Zeile' },
        { time: 3.20, text: 'Zweite Zeile' },
        // ... weitere Zeilen
    ]
};
```

### Download Object (Datenstruktur)

```javascript
const Download = {
    id: 'unique-id-1672531200',        // Eindeutige ID (timestamp-basiert)
    name: 'Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4',  // Dateiname
    size: 95728640,                    // Bytes
    url: 'assets/video/high/01-*.mp4', // Download-URL
    downloaded: 47864320,              // Bytes downloaded
    progress: 50,                      // Prozent (0-100)
    status: 'downloading',             // downloading | completed | failed | cancelled
    startTime: 1672531200,             // Unix timestamp
    estimatedTime: 120,                // Sekunden
    error: null                        // Error object wenn failed
};
```

### localStorage Keys

```javascript
// Volume & Mute
localStorage.deusExCT_volume = '0.85';      // string (float)
localStorage.deusExCT_muted = 'false';      // string (boolean)

// Quality & Mode
localStorage.deusExCT_quality = 'mid';      // string: low | mid | high
localStorage.deusExCT_mode = 'audio';       // string: audio | video

// Playlist & Position
localStorage.deusExCT_playlistState = '{
    "currentIndex": 0,
    "currentTrack": { ... }
}';                                        // JSON

// Player Position
localStorage.deusExCT_playerState = '{
    "currentTime": 45.5,
    "trackId": 1
}';                                        // JSON

// Version-Tracking
localStorage.deusExCT_buildVersion = '11.0';          // string
localStorage.deusExCT_buildTimestamp = '1672531200'; // string (unix timestamp)

// Download-History
localStorage.deusExCT_downloadHistory = '[
    { "name": "...", "size": 95728640, "timestamp": 1672531200 }
]';                                        // JSON Array
```

---

## ğŸ”„ Event-System & Callbacks

### PlayerEngine Event-System

**Event-Registrierung:**
```javascript
PlayerEngine.on(eventName, callback);
PlayerEngine.off(eventName, callback);
```

**VollstÃ¤ndige Event-Liste:**

| Event | Trigger | Daten | Beschreibung |
|-------|---------|-------|-------------|
| `play` | Nach erfolgreichem play() | - | Wiedergabe gestartet |
| `pause` | Nach pause() | - | Wiedergabe pausiert |
| `timeupdate` | WÃ¤hrend Wiedergabe (~250ms) | `{ currentTime, duration }` | Zeit aktualisiert |
| `ended` | Nach Track-Ende | - | Track zu Ende |
| `error` | Bei Fehler | `{ errorCode, errorType }` | Fehler aufgetreten |
| `loadstart` | Beim load() aufrufen | - | Media laden begonnen |
| `canplay` | Media bereit zum Abspielen | - | Kann abgespielt werden |
| `waiting` | Puffer leer | - | Warten auf Daten |
| `seeking` | Bei seek() | `{ seekTime }` | Seek begonnen |
| `seeked` | Nach seek() abgeschlossen | - | Seek abgeschlossen |
| `volumechange` | Nach setVolume() | `{ volume }` | LautstÃ¤rke geÃ¤ndert |
| `mutechange` | Nach mute()/unmute() | `{ isMuted }` | Mute-Status geÃ¤ndert |
| `modechange` | Nach switchMode() | `{ mode }` | Modus geÃ¤ndert |
| `qualitychange` | Nach setQuality() | `{ quality }` | QualitÃ¤t geÃ¤ndert |
| `durationchange` | Nach load() | `{ duration }` | Dauer aktualisiert |
| `fullscreenchange` | Nach toggleFullscreen() | `{ isFullscreen }` | Fullscreen-Status geÃ¤ndert |
| `ratechange` | Nach setPlaybackRate() | `{ rate }` | Geschwindigkeit geÃ¤ndert |

**Event-Callback-Signatur:**
```javascript
PlayerEngine.on('timeupdate', function(data) {
    console.log('Current time:', data.currentTime);
    console.log('Duration:', data.duration);
});

PlayerEngine.on('error', function(data) {
    console.error('Error code:', data.errorCode);
    console.error('Error type:', data.errorType);
});
```

### LyricsManager Event-System

```javascript
LyricsManager.setOnLyricChange(function(data) {
    // data = {
    //     prevLine: { time, text },
    //     currentLine: { time, text },
    //     nextLine: { time, text },
    //     currentIndex: number
    // }
    updateLyricsDisplay(data);
});
```

### App Event-Delegation

```javascript
// Window Events
window.addEventListener('hashchange', handleRouteChange);
window.addEventListener('beforeunload', saveState);
window.addEventListener('resize', handleResize);

// Document Events
document.addEventListener('keydown', handleKeyboardShortcuts);
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('mozfullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('msfullscreenchange', handleFullscreenChange);

// Media Element Events
audioElement.addEventListener('play', onAudioPlay);
audioElement.addEventListener('pause', onAudioPause);
audioElement.addEventListener('timeupdate', onAudioTimeUpdate);
audioElement.addEventListener('ended', onAudioEnded);
audioElement.addEventListener('error', onAudioError);
audioElement.addEventListener('stalled', onAudioStalled);
audioElement.addEventListener('canplay', onAudioCanPlay);

videoElement.addEventListener('play', onVideoPlay);
videoElement.addEventListener('pause', onVideoPause);
videoElement.addEventListener('timeupdate', onVideoTimeUpdate);
videoElement.addEventListener('ended', onVideoEnded);
videoElement.addEventListener('error', onVideoError);

// UI Events
playPauseBtn.addEventListener('click', handlePlayPauseClick);
prevBtn.addEventListener('click', handlePrevClick);
nextBtn.addEventListener('click', handleNextClick);
progressBar.addEventListener('mousedown', startSeek);
progressBar.addEventListener('touchstart', startSeek);
volumeBar.addEventListener('input', handleVolumeChange);
// ... weitere Events
```

---

## ğŸŒ Browser-APIs (Detailliert)

### 1. HTML5 Media API (`<audio>` & `<video>`)

**Audio-Element:**
```html
<audio id="audioPlayer"
       preload="auto"
       crossorigin="anonymous"
       playsinline
       webkit-playsinline>
</audio>
```

**Eigenschaften:**
```javascript
audioElement.src = 'assets/audio/01-*.mp3';
audioElement.currentTime = 45.5;              // Seek
audioElement.duration;                        // Read-only
audioElement.volume = 0.85;                   // 0.0 - 1.0
audioElement.muted = false;
audioElement.playbackRate = 1.0;              // 0.25 - 4.0
audioElement.readyState;                      // 0-4 (UNSUPPORTED bis HAVE_ENOUGH_DATA)
audioElement.networkState;                    // 0-3 (NETWORK_EMPTY bis NETWORK_LOADED)
```

**Methoden:**
```javascript
audioElement.play();                          // Promise<void>
audioElement.pause();
audioElement.load();                          // Reload source
audioElement.canPlayType('audio/mpeg');       // RÃ¼ckgabe: '', 'maybe', 'probably'
```

**Events:**
```javascript
// Progress Events
loadstart, progress, suspend, abort, error, emptied, stalled, loadedmetadata,
loadeddata, canplay, canplaythrough, playing, ended, seeking, seeked,
timeupdate, durationchange, ratechange, resize, volumechange

// Wichtigste:
audioElement.addEventListener('canplay', () => {
    // readyState >= 2 (HAVE_CURRENT_DATA)
    // Kann abspielen, aber mÃ¶glicherweise Buffering nÃ¶tig
});

audioElement.addEventListener('canplaythrough', () => {
    // readyState >= 4 (HAVE_ENOUGH_DATA)
    // Kann komplett ohne Buffering abspielen
});

audioElement.addEventListener('timeupdate', () => {
    // Fire-Frequenz: Browser-abhÃ¤ngig (200-300ms)
    const progress = audioElement.currentTime / audioElement.duration;
    updateProgressBar(progress);
});

audioElement.addEventListener('stalled', () => {
    // Keine Daten verfÃ¼gbar, aber Video spielend
    // Trigger Stall-Recovery
});
```

**readyState enum:**
```javascript
HAVE_NOTHING = 0      // Keine Informationen
HAVE_METADATA = 1     // Duration, dimensions
HAVE_CURRENT_DATA = 2 // Aktueller Frame
HAVE_FUTURE_DATA = 3  // NÃ¤chster Frame (ein Bild spÃ¤ter)
HAVE_ENOUGH_DATA = 4  // Genug fÃ¼r smooth playback
```

### 2. Fullscreen API

**Methoden (mit Fallbacks):**
```javascript
// Enter Fullscreen
if (videoElement.requestFullscreen) {
    videoElement.requestFullscreen();
} else if (videoElement.mozRequestFullScreen) {
    videoElement.mozRequestFullScreen();
} else if (videoElement.webkitRequestFullscreen) {
    videoElement.webkitRequestFullscreen();
} else if (videoElement.msRequestFullscreen) {
    videoElement.msRequestFullscreen();
} else if (videoElement.webkitEnterFullscreen) {
    // iOS Safari Fallback
    videoElement.webkitEnterFullscreen();
}

// Exit Fullscreen
if (document.exitFullscreen) {
    document.exitFullscreen();
} else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
} else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
} else if (document.msExitFullscreen) {
    document.msExitFullscreen();
} else if (videoElement.webkitExitFullscreen) {
    videoElement.webkitExitFullscreen();
}

// Check Status
const isFullscreen =
    document.fullscreenElement ||
    document.webkitFullscreenElement ||
    document.mozFullScreenElement ||
    document.msFullscreenElement ||
    (videoElement && videoElement.webkitDisplayingFullscreen);
```

**Events:**
```javascript
document.addEventListener('fullscreenchange', () => {
    const isFullscreen = !!document.fullscreenElement;
    console.log('Fullscreen:', isFullscreen);
});

document.addEventListener('fullscreenerror', () => {
    console.error('Fullscreen-Fehler (vielleicht User-Interaction erforderlich)');
});
```

### 3. Network Information API

```javascript
const connection = navigator.connection ||
                   navigator.mozConnection ||
                   navigator.webkitConnection;

if (connection) {
    console.log('Effective Type:', connection.effectiveType);
    // '4g' | '3g' | '2g' | 'slow-2g'

    console.log('Downlink:', connection.downlink);
    // Megabits per second (MBps)

    console.log('Latency:', connection.rtt);
    // Milliseconds

    console.log('Save Data:', connection.saveData);
    // boolean (user enabled data saver)

    // Event-Listener
    connection.addEventListener('change', () => {
        // Netzwerk-Bedingungen haben sich geÃ¤ndert
        adjustVideoQuality();
    });
}
```

**Adaptive Quality Logic:**
```javascript
function detectNetworkQuality() {
    if (navigator.connection.saveData) {
        return 'low';
    }

    const effectiveType = navigator.connection.effectiveType;
    if (effectiveType === '2g' || effectiveType === '3g') {
        return 'low';
    }

    const downlink = navigator.connection.downlink;
    if (downlink < 1.5) {
        return 'low';       // < 1.5 Mbps
    } else if (downlink < 5) {
        return 'mid';       // 1.5 - 5 Mbps
    } else {
        return 'mid';       // >= 5 Mbps (desktop default)
    }
}
```

### 4. Media Session API

```javascript
if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
        title: 'Oberarzt Dr. med. Placzek',
        artist: 'Oberarzt Dr. med. Placzek',
        album: 'Deus ex CT',
        artwork: [
            {
                src: 'assets/images/01-Oberarzt_Dr_med_Placzek.png',
                sizes: '512x512',
                type: 'image/png'
            }
        ]
    });

    navigator.mediaSession.playbackState = 'playing'; // playing | paused | none

    // Action Handlers
    navigator.mediaSession.setActionHandler('play', () => {
        PlayerEngine.play();
    });

    navigator.mediaSession.setActionHandler('pause', () => {
        PlayerEngine.pause();
    });

    navigator.mediaSession.setActionHandler('nexttrack', () => {
        PlaylistManager.moveToNext();
    });

    navigator.mediaSession.setActionHandler('previoustrack', () => {
        PlaylistManager.moveToPrevious();
    });

    navigator.mediaSession.setActionHandler('seekto', (details) => {
        PlayerEngine.seek(details.seekTime);
    });
}
```

### 5. Fetch API

```javascript
// Load LRC-Datei
fetch('assets/lyrics/01-*.lrc', {
    method: 'GET',
    headers: {
        'Accept': 'text/plain'
    },
    credentials: 'same-origin'
})
.then(response => {
    if (!response.ok) {
        throw new Error('HTTP ' + response.status);
    }
    return response.text();
})
.then(text => {
    const lyrics = LyricsManager.parseLRC(text);
    console.log('Lyrics loaded:', lyrics.length, 'lines');
})
.catch(error => {
    console.error('Error loading lyrics:', error);
    // Graceful fallback: leere Lyrics
});

// Video-Header prÃ¼fen (Accept-Ranges)
fetch('assets/video/mid/01-*.mp4', {
    method: 'HEAD'
})
.then(response => {
    const acceptRanges = response.headers.get('Accept-Ranges');
    const contentLength = response.headers.get('Content-Length');
    console.log('Video seekable:', acceptRanges === 'bytes');
    console.log('Video size:', contentLength, 'bytes');
})
.catch(error => {
    console.error('Error:', error);
});
```

### 6. RequestAnimationFrame (RAF)

```javascript
let rafId = null;

function startTimeUpdateLoop() {
    function update() {
        if (PlayerEngine.getIsPlaying()) {
            const currentTime = PlayerEngine.getCurrentTime();
            const duration = PlayerEngine.getDuration();

            // Update Lyrics
            LyricsManager.updateCurrentLine(currentTime);

            // Update UI
            updateProgressBar(currentTime / duration);
            updateTimeDisplay(currentTime, duration);
        }

        rafId = requestAnimationFrame(update);
    }

    rafId = requestAnimationFrame(update);
}

function stopTimeUpdateLoop() {
    if (rafId) {
        cancelAnimationFrame(rafId);
        rafId = null;
    }
}
```

---

## ğŸ“± Mobile-Optimierungen (Detailliert)

### iOS User-Gesture Context

**Problem:** iOS erfordert User-Interaction fÃ¼r Media-Wiedergabe (Sicherheit)

**LÃ¶sung:**
```javascript
let userHasInteracted = false;

function setupUserInteractionDetection() {
    document.addEventListener('touchstart', function onFirstTouch() {
        userHasInteracted = true;
        document.removeEventListener('touchstart', onFirstTouch);
    });

    document.addEventListener('click', function onFirstClick() {
        userHasInteracted = true;
        document.removeEventListener('click', onFirstClick);
    });
}

// Bei play()-Aufruf
function performPlaySync() {
    if (!userHasInteracted) {
        pendingPlayRequest = true;
        return;
    }

    audioElement.play()
        .catch(error => {
            if (error.name === 'NotAllowedError') {
                pendingPlayRequest = true;
            } else {
                handlePlaybackError(error);
            }
        });
}

// Beim nÃ¤chsten Touch
document.addEventListener('touchstart', function() {
    if (pendingPlayRequest) {
        pendingPlayRequest = false;
        performPlaySync();
    }
});
```

### iOS readyState PrÃ¼fung

**Problem:** readyState kann veraltet sein auf iOS

**LÃ¶sung:**
```javascript
function setupAudioListeners() {
    // IMMER Listener VOR load() setzen
    const onCanPlayHandler = function() {
        playbackState = PlaybackState.READY;
        if (pendingPlayRequest) {
            performPlaySync();
        }
    };

    const onErrorHandler = function(event) {
        const errorCode = audioElement.error.code;
        handleAudioError(errorCode);
    };

    const onLoadstartHandler = function() {
        playbackState = PlaybackState.LOADING;
    };

    audioElement.addEventListener('canplay', onCanPlayHandler, { once: true });
    audioElement.addEventListener('error', onErrorHandler, { once: true });
    audioElement.addEventListener('loadstart', onLoadstartHandler, { once: true });

    // Danach: load() aufrufen
    audioElement.src = trackSource;
    audioElement.load();

    // NACH load(): readyState prÃ¼fen
    if (audioElement.readyState >= 3) {
        // Bereits bereit (sehr schnell)
        onCanPlayHandler();
    }
}
```

### iOS Stall-Recovery (Exponential Backoff)

**Problem:** Media kann auf iOS "stallen" (Puffer leer)

**LÃ¶sung:**
```javascript
const stallRetryDelays = [500, 1000, 2000, 4000];
let stallRetryCount = 0;
let lastLoadedTrackId = null;

function handleMediaStall() {
    // Nur wenn noch aktueller Track
    if (currentTrack && lastLoadedTrackId !== currentTrack.id) {
        return;
    }

    // Max 4 Retries
    if (stallRetryCount >= 4) {
        playbackState = PlaybackState.ERROR;
        showToast('Wiedergabe konnte nicht fortgesetzt werden');
        return;
    }

    const delay = stallRetryDelays[stallRetryCount];
    stallRetryCount++;

    setTimeout(() => {
        if (currentTrack && lastLoadedTrackId === currentTrack.id) {
            performPlaySync();
        }
    }, delay);
}

audioElement.addEventListener('stalled', handleMediaStall);

// Reset bei neuer Wiedergabe
function loadAudioTrack(track) {
    lastLoadedTrackId = track.id;
    stallRetryCount = 0;
    // ... rest
}
```

### Android CORS & x5-Player

**HTML-Attribute:**
```html
<video id="videoPlayer"
       playsinline
       webkit-playsinline
       x5-playsinline
       x5-video-player-type="h5"
       x5-video-player-fullscreen="false"
       crossorigin="anonymous">
</video>
```

**CORS-Header in `.htaccess`:**
```apache
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
Header set Access-Control-Allow-Headers "Content-Type"
```

**Test auf Android:**
```javascript
if (navigator.userAgent.includes('Android')) {
    // Android-spezifische Behandlung
    videoElement.setAttribute('x5-video-player-type', 'h5');
}
```

---

## ğŸ’¾ Cache-Strategie & Versionierung

### HTTP-Header Strategy (`.htaccess`)

```apache
# HTML: Immer neu laden
FilesMatch "\.(html|htm)$"
Cache-Control: max-age=0, must-revalidate

# JS/CSS: 1 Jahr (bei Versionierung)
FilesMatch "\.(js|css)$"
Cache-Control: max-age=31536000, immutable

# Medien: 1 Jahr
FilesMatch "\.(mp3|mp4|webm|ogg)$"
Cache-Control: max-age=31536000, immutable

# Manifest: 1 Stunde
FilesMatch "\.webmanifest$"
Cache-Control: max-age=3600
```

### Timestamp-basierte Versionierung

```javascript
// In index.html (inline script)
var BUILD_VERSION = '11.0';
var BUILD_TIMESTAMP = Math.floor(Date.now() / 1000);
var ASSET_VERSION = BUILD_VERSION + '.' + BUILD_TIMESTAMP;

// Dynamische Script-URLs
function updateScriptVersions() {
    var scripts = document.querySelectorAll('script[src]');
    for (var i = 0; i < scripts.length; i++) {
        var src = scripts[i].getAttribute('src');
        if (src && src.indexOf('js/') === 0 && src.indexOf('?v=') === -1) {
            scripts[i].setAttribute('src', src + '?v=' + ASSET_VERSION);
        }
    }
}

// URLs werden:
// js/app.js â†’ js/app.js?v=11.0.1672531200
// Bei Version-Update automatisch neu geladen
```

### Client-Side Cache Cleanup

```javascript
function clearIndexedDB() {
    return new Promise(function(resolve) {
        var timeout = setTimeout(function() {
            resolve();
        }, 2000);

        if (window.indexedDB.databases) {
            window.indexedDB.databases().then(function(dbs) {
                for (var i = 0; i < dbs.length; i++) {
                    window.indexedDB.deleteDatabase(dbs[i].name);
                }
                resolve();
            }).catch(function() {
                resolve();
            });
        } else {
            resolve();
        }
    });
}

function clearAllStorage() {
    try {
        var keysToRemove = [];
        for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            if (key && key.indexOf('deusExCT_') === 0) {
                // Nur deusExCT_ Keys clearen, andere behalten
                if (key !== 'deusExCT_volume' &&
                    key !== 'deusExCT_muted' &&
                    key !== 'deusExCT_quality') {
                    keysToRemove.push(key);
                }
            }
        }
        for (var i = 0; i < keysToRemove.length; i++) {
            localStorage.removeItem(keysToRemove[i]);
        }
    } catch (e) {}

    try {
        sessionStorage.clear();
    } catch (e) {}
}

function clearBrowserCaches() {
    return new Promise(function(resolve) {
        if (!window.caches) {
            resolve();
            return;
        }

        caches.keys().then(function(names) {
            if (names && names.length > 0) {
                var deletePromises = [];
                for (var i = 0; i < names.length; i++) {
                    deletePromises.push(
                        caches.delete(names[i]).catch(function() {})
                    );
                }
                Promise.all(deletePromises).then(resolve).catch(resolve);
            } else {
                resolve();
            }
        }).catch(function() {
            resolve();
        });
    });
}

// Beim Load
Promise.all([
    clearIndexedDB(),
    clearBrowserCaches(),
    unregisterServiceWorkers()
]).then(function() {
    recordCleanupCompletion();
});
```

---

## âŒ Error Handling & Recovery

### Error-Typen (ErrorType Enum)

```javascript
const ErrorType = {
    NOT_ALLOWED: 'NotAllowedError',           // iOS: User-Gesture erforderlich
    ABORT: 'AbortError',                      // User navigated away
    NOT_SUPPORTED: 'NotSupportedError',       // Format nicht unterstÃ¼tzt
    NETWORK: 'NetworkError',                  // Netzwerkfehler
    DECODE: 'DecodeError',                    // Video-Dekodierung fehlgeschlagen
    UNKNOWN: 'UnknownError'                   // Unbekannter Fehler
};
```

### Error-Handling Strategy

```javascript
function handlePlaybackError(error) {
    let errorType = ErrorType.UNKNOWN;
    let shouldRetry = false;
    let retryDelay = 1000;

    if (error && error.name) {
        errorType = error.name;
    } else if (audioElement.error) {
        switch (audioElement.error.code) {
            case 1: errorType = ErrorType.ABORT; break;       // MEDIA_ERR_ABORTED
            case 2: errorType = ErrorType.NETWORK; break;     // MEDIA_ERR_NETWORK
            case 3: errorType = ErrorType.DECODE; break;      // MEDIA_ERR_DECODE
            case 4: errorType = ErrorType.NOT_SUPPORTED; break;// MEDIA_ERR_SRC_NOT_SUPPORTED
        }
    }

    // Differenziertes Error-Handling
    switch (errorType) {
        case ErrorType.NOT_ALLOWED:
            // iOS: Warte auf User-Gesture
            pendingPlayRequest = true;
            break;

        case ErrorType.ABORT:
            // User navigated away - stille Behandlung
            break;

        case ErrorType.NETWORK:
            // Netzwerkfehler - Retry
            shouldRetry = true;
            retryDelay = 2000 * (playbackAttempts + 1);
            break;

        case ErrorType.DECODE:
            // Dekodierungsfehler - Mode-Fallback
            if (currentMode === 'video') {
                switchMode('audio', true);
            }
            shouldRetry = false;
            break;

        case ErrorType.NOT_SUPPORTED:
            // Format nicht unterstÃ¼tzt
            showToast('Dieses Format wird nicht unterstÃ¼tzt');
            shouldRetry = false;
            break;

        default:
            shouldRetry = true;
            retryDelay = 1000;
    }

    // Retry-Logik
    if (shouldRetry && playbackAttempts < maxPlaybackAttempts) {
        playbackAttempts++;
        setTimeout(() => {
            performPlaySync();
        }, retryDelay);
    } else if (shouldRetry) {
        playbackState = PlaybackState.ERROR;
        showToast('Wiedergabe fehlgeschlagen nach ' + maxPlaybackAttempts + ' Versuchen');
    }

    // Trigger Event
    trigger('error', {
        errorCode: audioElement.error?.code,
        errorType: errorType,
        message: error?.message,
        track: currentTrack
    });
}
```

### Mode-Switch Error Recovery

```javascript
function switchMode(newMode, preservePosition) {
    return new Promise(function(resolve, reject) {
        if (newMode === currentMode) {
            resolve();
            return;
        }

        const savedTime = audioElement.currentTime;
        const savedIsPlaying = getIsPlaying();

        pause();

        const timeoutId = setTimeout(function() {
            // Timeout nach 15 Sekunden
            playbackState = PlaybackState.ERROR;
            showToast('Modus-Wechsel-Timeout');
            reject(new Error('Mode switch timeout'));
        }, 15000);

        const targetElement = (newMode === 'audio') ? audioElement : videoElement;
        const onSuccess = function() {
            clearTimeout(timeoutId);
            currentMode = newMode;

            if (preservePosition) {
                targetElement.currentTime = savedTime;
            }

            if (savedIsPlaying) {
                play().then(resolve).catch(reject);
            } else {
                resolve();
            }
        };

        const onError = function(error) {
            clearTimeout(timeoutId);
            // Fallback zu vorherigem Modus
            currentMode = (newMode === 'audio') ? 'video' : 'audio';
            reject(error);
        };

        targetElement.addEventListener('canplay', onSuccess, { once: true });
        targetElement.addEventListener('error', onError, { once: true });

        if (newMode === 'audio') {
            loadAudioTrack(currentTrack);
        } else {
            loadVideoTrack(currentTrack, currentQuality);
        }
    });
}
```

---

## ğŸ“Š Performance-Metriken

### Benchmark-Ziele (v11.0)

| Metrik | Ziel | Actual | Status |
|--------|------|--------|--------|
| Page-Load Time | <2s | ~1.2s | âœ… |
| Audio-Start | <1s | ~0.8s | âœ… |
| Video-Start (MID) | <3s | ~2.1s | âœ… |
| Video-Start (HQ) | <5s | ~4.2s | âœ… |
| First Paint | <1s | ~0.9s | âœ… |
| First Contentful Paint | <1.5s | ~1.1s | âœ… |
| Time to Interactive | <3s | ~2.4s | âœ… |
| Memory (Idle) | <50MB | ~45MB | âœ… |
| Memory (Playing) | <80MB | ~72MB | âœ… |
| Memory Leak | 0% | 0% | âœ… |
| CPU (Idle) | <5% | ~2% | âœ… |
| CPU (Playing) | <25% | ~18% | âœ… |
| FPS (Lyrics Anim) | 60 | 60 | âœ… |
| FPS (Scroll) | 60 | 59-60 | âœ… |

### Performance-Metriken messen

```javascript
// Page-Load Time
const pageLoadTime = performance.now();
console.log('Page loaded in:', pageLoadTime.toFixed(2), 'ms');

// First Paint
const fpEntry = performance.getEntriesByName('first-paint')[0];
if (fpEntry) {
    console.log('First Paint:', fpEntry.startTime.toFixed(2), 'ms');
}

// First Contentful Paint
const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0];
if (fcpEntry) {
    console.log('First Contentful Paint:', fcpEntry.startTime.toFixed(2), 'ms');
}

// Audio-Start Time (ab Play-Button-Click)
let audioStartMark = null;
PlayerEngine.on('play', function() {
    if (audioStartMark === null) {
        audioStartMark = performance.now();
        console.log('Audio started in:',
            (performance.now() - audioStartMark).toFixed(2), 'ms');
    }
});

// Memory Usage (Chrome DevTools)
if (performance.memory) {
    console.log('Used JS Heap:',
        (performance.memory.usedJSHeapSize / 1048576).toFixed(2), 'MB');
    console.log('Total JS Heap:',
        (performance.memory.totalJSHeapSize / 1048576).toFixed(2), 'MB');
}

// Frame Rate Monitor
let lastTime = performance.now();
let frameCount = 0;
let avgFPS = 0;

function measureFPS() {
    frameCount++;
    const currentTime = performance.now();
    const delta = currentTime - lastTime;

    if (delta >= 1000) {
        avgFPS = frameCount;
        console.log('FPS:', avgFPS);
        frameCount = 0;
        lastTime = currentTime;
    }

    requestAnimationFrame(measureFPS);
}

measureFPS();
```

---

## ğŸ” Security-Considerations

### HTTPS Requirement

- âœ… Erforderlich fÃ¼r PWA (manifest.json)
- âœ… Erforderlich fÃ¼r Media Session API
- âœ… Erforderlich fÃ¼r Secure Context APIs
- âœ… Alle Assets mÃ¼ssen Ã¼ber HTTPS sein (kein Mixed Content)

### CORS (Cross-Origin Resource Sharing)

```apache
# In .htaccess
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
Header set Access-Control-Allow-Headers "Content-Type"
Header set Access-Control-Max-Age "3600"
```

### XSS-Protection

```apache
# In .htaccess
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; media-src *; img-src *; font-src 'self'; connect-src 'self'"
```

### Input Validation

```javascript
// URL-Parameter validieren (vor route-parsing)
function parseRoute(hash) {
    const parts = hash.replace('#/', '').split('/');
    const route = parts[0];
    const slug = parts[1];

    // Nur alphanumerisch + Bindestrich erlauben
    if (slug && !/^[a-z0-9\-]+$/.test(slug)) {
        showView('album');
        return;
    }

    // Track suchen
    const track = PlaylistManager.getTrackBySlug(slug);
    if (!track) {
        showView('album');
        return;
    }

    playTrack(track, 'audio');
}
```

### localStorage Sanitization

```javascript
// Beim Speichern
localStorage.deusExCT_playlistState = JSON.stringify({
    currentIndex: Math.max(0, Math.min(11, currentIndex)),
    currentTrack: currentTrack
});

// Beim Laden
function loadStateFromStorage() {
    try {
        const saved = localStorage.getItem('deusExCT_playlistState');
        const state = JSON.parse(saved);

        // Validierung
        if (typeof state.currentIndex !== 'number') return false;
        if (state.currentIndex < 0 || state.currentIndex >= 12) return false;

        PlaylistManager.setCurrentIndex(state.currentIndex);
        return true;
    } catch (e) {
        return false;
    }
}
```

---

## ğŸ” Debugging & Monitoring

### Console Logging

```javascript
// Enable Debug Mode
window.DEBUG = true;

function debugLog(...args) {
    if (window.DEBUG) {
        console.log('[DEBUG]', ...args);
    }
}

// Verwendung
debugLog('Current state:', PlayerEngine.getPlaybackState());
debugLog('Current track:', PlaylistManager.getCurrentTrack());
```

### Error Tracking

```javascript
// Global Error Handler
window.addEventListener('error', function(event) {
    console.error('Global Error:', event.error);

    // Optional: Server-seitig loggen
    fetch('/api/log-error', {
        method: 'POST',
        body: JSON.stringify({
            message: event.error.message,
            stack: event.error.stack,
            url: window.location.href,
            timestamp: new Date().toISOString()
        })
    }).catch(() => {});
});

// Player Error Tracking
PlayerEngine.on('error', function(data) {
    console.error('Playback Error:', data);

    fetch('/api/log-playback-error', {
        method: 'POST',
        body: JSON.stringify({
            errorCode: data.errorCode,
            errorType: data.errorType,
            track: data.track?.id,
            mode: PlayerEngine.getCurrentMode(),
            timestamp: new Date().toISOString()
        })
    }).catch(() => {});
});
```

### Performance Monitoring

```javascript
// Page Load Monitoring
window.addEventListener('load', function() {
    const perfData = performance.timing;
    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;

    console.log('Performance Metrics:');
    console.log('- DNS Lookup:', perfData.domainLookupEnd - perfData.domainLookupStart, 'ms');
    console.log('- TCP Connection:', perfData.connectEnd - perfData.connectStart, 'ms');
    console.log('- Request Time:', perfData.responseStart - perfData.requestStart, 'ms');
    console.log('- Response Time:', perfData.responseEnd - perfData.responseStart, 'ms');
    console.log('- DOM Processing:', perfData.domComplete - perfData.domInteractive, 'ms');
    console.log('- Page Load Time:', pageLoadTime, 'ms');

    // Optional: Server-seitig senden
    fetch('/api/log-performance', {
        method: 'POST',
        body: JSON.stringify({ pageLoadTime, metrics: perfData })
    }).catch(() => {});
});
```

---

## ğŸ“‹ Checkliste fÃ¼r Deployment

- [ ] HTTPS aktiviert
- [ ] `.htaccess` korrekt konfiguriert
- [ ] manifest.json ist valide
- [ ] Alle Assets vorhanden (Audio, Video, Images, Lyrics)
- [ ] ZIP-Files generiert (Album, Videos)
- [ ] Icons 192Ã—192 und 512Ã—512px
- [ ] LRC-Dateien UTF-8 ohne BOM
- [ ] Video-Dateien mit Accept-Ranges Header
- [ ] CORS-Header aktiv
- [ ] Cache-Header korrekt
- [ ] Service Worker deregistriert (v11.0)
- [ ] Logs Ã¼berprÃ¼ft (0 Fehler)
- [ ] Mobile-Testing durchgefÃ¼hrt (iOS + Android)
- [ ] Slow 3G-Testing durchgefÃ¼hrt
- [ ] DevTools Memory-Test durchgefÃ¼hrt (kein Leak)
- [ ] DevTools Performance-Test durchgefÃ¼hrt (60 FPS)

---
```

 
--- 

/assets\audio\01-Oberarzt_Dr_med_Placzek.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\02-Oberarzt_der_Herzen.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\03-Vier-Eins-Neun-Zwei.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\04-Pilot_im_Pixelmeer.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\05-Drei_Gebote.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\06-Kunst_der_Diagnostik.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\07-Mit_harter_Hand_und_Charme.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\08-Durch_Feuer_und_Eis.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\09-Held_und_Idol.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\10-Messerscharf_und_Legendaer.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\11-Oberaerztlicher_Glanz.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\audio\12-Goetterdaemmerung.mp3:

[Inhalt der .mp3-Datei wird nicht angezeigt]

 
--- 

/assets\downloads\Deus_ex_CT_Complete.zip:

[Inhalt der .zip-Datei wird nicht angezeigt]

 
--- 

/assets\downloads\Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip:

[Inhalt der .zip-Datei wird nicht angezeigt]

 
--- 

/assets\images\00-Albumcover.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\01-Oberarzt_Dr_med_Placzek.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\02-Oberarzt_der_Herzen.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\03-Vier-Eins-Neun-Zwei.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\04-Pilot_im_Pixelmeer.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\05-Drei_Gebote.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\06-Kunst_der_Diagnostik.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\07-Mit_harter_Hand_und_Charme.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\08-Durch_Feuer_und_Eis.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\09-Held_und_Idol.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\10-Messerscharf_und_Legendaer.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\11-Oberaerztlicher_Glanz.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\images\12-Goetterdaemmerung.png:

[Inhalt der .png-Datei wird nicht angezeigt]

 
--- 

/assets\lyrics\01-Oberarzt_Dr_med_Placzek.lrc:

```lrc
[ti:01-Oberarzt_Dr_med_Placzek]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:00.05]Er ist der Chef im CT, er weiÃŸ genau Bescheid
[00:05.21]Er scannt die Patienten mit Geschick und Sorgfalt
[00:12.69]Er ist der Meister in seinem Fach, er kennt sich mit allem aus
[00:20.17]Er ist der Oberarzt Doktor med Placzek

[00:26.47]Oberarzt Doktor med Placzek, er ist unser Held und unser Gott
[00:34.21]Er ist der beste in seinem Fach, er macht uns alle froh
[00:41.42]Oberarzt Doktor med Placzek, er ist hart, aber fair
[00:48.38]Er ist die helle Sonne in unsrem Leben, er gibt uns Kraft und Mut

[00:56.84]Er umgarnt Manu und Lena, der alte Charmeur
[01:01.67]Sie schmelzen hin bei ihm, er hat einfach Flair
[01:09.10]Er ist streng zu Assistenten, er duldet keinen Fehler
[01:16.37]Aber sie lernen viel von ihm, er ist der Oberarzt Doktor med Placzek

[01:24.77]Oberarzt Doktor med Placzek, er ist unser Held und unser Gott
[01:32.33]Er ist der beste in seinem Fach, er macht uns alle froh
[01:39.60]Oberarzt Doktor med Placzek, er ist frech, einfach der Boss
[01:47.21]Er ist die  helle Sonne in unserem Leben, er gibt uns Kraft und WÃ¤rme
[01:53.45]Vorbild, Held und CT Gott, was du anfÃ¤sst wird zu Gold
[02:01.58]Du bist die Sonne in unserem Leben, oh unser CT Oberarzt Doktor med Placzek

```

 
--- 

/assets\lyrics\02-Oberarzt_der_Herzen.lrc:

```lrc
[ti:02-Oberarzt_der_Herzen]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:00.96]Oh-oh-oh, Doktor med. Placzek
[00:04.52]Unser Held im weiÃŸen Kittel
[00:07.59]Oh-oh-oh, er zeigt uns den Weg
[00:10.91]Der Oberarzt der Herzen â€“ perfekt!

[00:14.38]Jeder weiÃŸ, wenn er den Raum betritt
[00:17.52]Das CT wird zu seinem MeisterstÃ¼ck
[00:20.87]Sein Wissen leuchtet, sein Blick ist klar
[00:24.79]Mit ihm wird jede Diagnose wahr

[00:27.92]Die Assistenten kommen immer zu ihm
[00:31.27]"Mit dir besprechen wirâ€™s, es macht mehr Sinn!"
[00:34.99]Er erklÃ¤rt mit Herz, Geduld und Verstand
[00:38.41]Unser Mentor, stets mit helfender Hand

[00:41.56]"Bleib fokussiert, mach keinen Halt
[00:44.85]Ich zeig dir, wie man das richtig macht
[00:48.27]Zusammen schaffen wir jeden Fall
[00:51.78]Denn Wissen macht uns unschlagbar!"

[00:56.31]Oberarzt Doktor med. Placzek
[00:59.12]Er ist der Oberarzt der Herzen
[01:03.05]Ein Held, ein Lehrer, der uns lenkt
[01:06.49]Mit ihm wird das Ziel immer geschenkt

[01:10.18]Oberarzt Doktor med. Placzek
[01:13.14]Er fÃ¼hrt uns sicher Schritt fÃ¼r Schritt
[01:16.96]Der Oberarzt der Herzen â€“ perfekt!
[01:21.29]Wir alle folgen ihm, er ist der Hit!

[01:24.48]Wenn es knifflig wird, dann bleibt er ruhig
[01:27.83]Mit einem Blick macht er den Befund deutlich
[01:31.31]Er sieht die Details, die niemand erkennt
[01:35.19]Ein wahres Genie, das jeder kennt

[01:38.42]Seine StÃ¤rke ist nicht nur Verstand
[01:41.00]Sondern auch das Herz, mit dem er uns anspannt
[01:44.71]Manchmal streng, doch immer gerecht
[01:48.32]Er zeigt uns, wie man das Beste erreicht

[01:51.12]"Bleib fokussiert, mach keinen Halt
[01:54.35]Ich zeig dir, wie man das richtig macht
[01:57.83]Zusammen schaffen wir jeden Fall
[02:01.36]Denn Wissen macht uns unschlagbar!"

[02:05.79]Oberarzt Doktor med. Placzek
[02:08.71]Er ist der Oberarzt der Herzen
[02:12.63]Ein Held, ein Lehrer, der uns lenkt
[02:16.03]Mit ihm wird das Ziel immer geschenkt

[02:19.68]Oberarzt Doktor med. Placzek
[02:22.64]Er fÃ¼hrt uns sicher Schritt fÃ¼r Schritt
[02:26.47]Der Oberarzt der Herzen â€“ perfekt!
[02:30.88]Wir alle folgen ihm, er ist der Hit!

[02:33.62]"Du kannst es schaffen, glaub an dein Ziel
[02:36.90]Dein KÃ¶nnen wÃ¤chst, es braucht nur Stil
[02:40.62]Fehler sind Schritte, die du musst verstehen
[02:43.95]Bleib mutig, dann wirst du es seh'n!"

[02:47.61]Oberarzt Doktor med Placzek
[02:50.46]Er ist der Oberarzt der Herzen
[02:54.38]Ein Held, ein Lehrer, der uns lenkt
[02:57.92]Mit ihm wird das Ziel immer geschenkt

[03:02.39]Oberarzt Doktor med. Placzek
[03:04.38]Er fÃ¼hrt uns sicher Schritt fÃ¼r Schritt
[03:08.31]Der Oberarzt der Herzen â€“ perfekt!
[03:12.61]Wir alle folgen ihm, er ist der Hit!

[03:15.59]Oh-oh-oh, Doktor med. Placzek
[03:19.69]Der Oberarzt der Herzen â€“ perfekt!
[03:22.46]Oh-oh-oh, er zeigt uns den Weg
[03:26.18]Wir folgen ihm, bis ans Ziel â€“ perfekt!
```

 
--- 

/assets\lyrics\03-Vier-Eins-Neun-Zwei.lrc:

```lrc
[ti:03-Vier-Eins-Neun-Zwei]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:00.50]Eine Nummer
[00:03.77]Vier Ziffern
[00:08.63]Die jeder kennt, die jeder fÃ¼rchtet...

[00:14.64]Ich bin Chirurg, hab 'nen komplizierten Fall
[00:18.10]Labor kritisch, Patient instabil und kalt
[00:21.53]Mein Finger zittert Ã¼ber dem Display
[00:24.57]Die Durchwahl eingegeben
[00:25.98]gleich meldet er sich, oh wei
[00:28.62]Vier-Eins-Neun-Zwei! Vier-Eins-Neun-Zwei!
[00:32.79]Jeder Arzt hier kennt diese Zahl
[00:35.48]Die Hotline zur Radiologie
[00:38.07]perfekt in jedem Fall

[00:41.13]Gleich hebt er ab, ich muss bereit sein
[00:44.00]Indikation klar, Anamnese rein
[00:47.54]Seine Fragen sind prÃ¤zise, treffen wie ein Pfeil
[00:50.53]Wer hier anruft, braucht 'nen Plan
[00:52.49]und jedes medizinische Detail!

[00:55.93]Die Placzek-Hotline! Vier-Eins-Neun-Zwei!
[01:01.87]Ruf ihn an, wenn's wirklich brennt und du weiÃŸt nicht mehr,
[01:05.42]was du machen sollst dabei!
[01:09.82]Die Placzek-Hotline! Retter in der Not!
[01:14.00]Seine Brillanz und sein Verstand
[01:15.62]bewahren dich vorm diagnostischen Tod!
[01:18.25]Doktor med Placzek! Am HÃ¶rer, messerscharf!
[01:20.82]Wer seine PrÃ¼fung Ã¼bersteht,
[01:22.51]kriegt den besten CT-Scan, den's je gab!

[01:24.64]"Guten Tag, Placzek hier"
[01:26.16]diese Stimme, kÃ¼hl und klar
[01:27.85]"Schildern Sie mir Ihren Fall,
[01:29.39]lassen Sie nichts aus, sagen Sie mir, was geschah!"
[01:31.59]"CT Abdomen mit Kontrastmittel bitte, dringend!" â€“ stotter' ich nervÃ¶s
[01:34.97]"BegrÃ¼ndung? Klinische Frage? Labor? Vorbefunde?" â€“ er fragt prÃ¤gnant, nie bloÃŸ
[01:38.79]Die Stille schwebt, drei Sekunden Ewigkeit
[01:41.42]Mein Kollege neben mir wird bleich
[01:43.45]oh Gott, oh weh, wie's gleich heiÃŸt:
[01:45.52]"Die Indikation erscheint mir unzureichend, bitte
[01:48.48]Sonographie zunÃ¤chst, dann Labor â€“ klare Schritte!"

[01:52.08]Die Absage tut weh, doch sie lehrt uns mehr
[01:55.62]Als jedes Lehrbuch, jede Fortbildung, sie schÃ¤rft uns sehr!
[01:59.12]Beim nÃ¤chsten Mal bin ich gewappnet, mit allen Fakten parat
[02:02.85]Dann Ã¶ffnet sich die Schleuse zu seinem CT-Apparat!

[02:06.68]Die Placzek-Hotline! Vier-Eins-Neun-Zwei!
[02:12.03]Ruf ihn an, wenn's wirklich brennt und du weiÃŸt nicht mehr,
[02:15.71]was du machen sollst dabei!
[02:20.37]Die Placzek-Hotline! Retter in der Not!
[02:24.09]Seine Brillanz und sein Verstand
[02:25.91]bewahren dich vorm diagnostischen Tod!
[02:28.49]Doktor med Placzek! Am HÃ¶rer, messerscharf!
[02:30.98]Wer seine PrÃ¼fung Ã¼bersteht,
[02:32.79]kriegt den besten CT-Scan, den's je gab!

[02:35.45]Dann kam der Notfall, echter Code, Leben an der Grenze
[02:42.34]Ich wÃ¤hlte Vier-Eins-Neun-Zwei
[02:43.74]Diesmal war ich vorbereitet
[02:45.00]Kannte meine Grenzen.
[02:48.40]Vier-Eins-Neun-Zwei! Vier-Eins-Neun-Zwei!
[02:55.41]"Freie FlÃ¼ssigkeit, Schock, HÃ¤matokrit im freien Fall,
[02:58.60]Verdacht auf Milzruptur, ich brauch' Sie jetzt!"
[03:01.42]Und dann... sein Ton verÃ¤ndert sich
[03:03.76]"Ich scanne selbst, kommen Sie her,
[03:05.89]Wir retten diesen Menschen, ich bin bereit â€“ sofort!"

[03:09.11]Im CT-Raum sein KÃ¶nnen leuchtet auf
[03:12.18]Sein Blick erfasst die Schichten, jedes Pixel im genauen Lauf
[03:15.96]"Milzruptur Grad vier, Kontrastextravasat, OP sofort!
[03:19.06]Sie haben alles richtig gemacht!"

[03:22.09]Die Placzek-Hotline! Vier-Eins-Neun-Zwei!
[03:27.77]Der Anruf, der dein Leben rettet,
[03:29.59]macht dich zum besseren Arzt, ganz neu dabei!
[03:35.59]Die Placzek-Hotline! Legende am Telefon!
[03:40.24]Wer von ihm lernt, wer ihm vertraut,
[03:41.43]erreicht die medizinische Perfektion!
[03:44.07]Doktor med Placzek! Der TorwÃ¤chter, der Held!
[03:47.08]Der beste Radiologe, den diese Klinik je bestellt!
[04:03.83]Die Nummer, die wir niemals vergessen

```

 
--- 

/assets\lyrics\04-Pilot_im_Pixelmeer.lrc:

```lrc
[ti:04-Pilot_im_Pixelmeer]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:01.00]Oberarzt Doktor med. Placzek,
[00:04.15]Strahlend wie ein Stern am Klinik-Himmel!
[00:07.64]Er wirbelt durch den Flur, so energiegeladen,
[00:11.59]Dass alle Herzen hÃ¶her schlagen!

[00:14.04]Wenn er mit dem Mauszeiger durchs CT-Bild gleitet,
[00:18.26]Und jeden Befund mit Perfektion bereitet.
[00:21.78]Sein Blick ist messerscharf, wir spÃ¼ren seinen Glanz,
[00:25.38]Wir folgen ihm in diesem diagnostischen Tanz.
[00:28.56]Er ist streng, doch wir lieben sein klares Wort,
[00:32.21]Jede RÃ¼ge treibt uns weiter, niemals fort.
[00:35.82]Seine Lehre gibt uns Antrieb Tag fÃ¼r Tag,
[00:39.14]Wir wollen nur Perfektion â€“ genau wie er es mag!

[00:43.75]Seine Stimme hallt in jedem Monitor,
[00:47.17]Er fÃ¼hrt uns sicher durch jedes Bilder-Tor.
[00:50.80]Manchmal streng, doch immer mit Charme,
[00:53.94]So hÃ¤lt er uns wach und stets in Alarm!

[00:57.58]Oberarzt Doktor med. Placzek â€“ du bist unser Held!
[01:01.47]Deine Aura funkelt heller als die Welt!
[01:05.26]Ein Lehrer, ein Vorbild, der Herzen-Oberarzt,
[01:08.64]Wir folgen dir blind, denn du hast uns stets bewahrt!
[01:11.89]Oberarzt Doktor med. Placzek â€“ du fÃ¼hrst uns zum Ziel!
[01:16.13]Dein Wissen ist hoch, dein Temperament so viel!
[01:19.63]Wir tanzen im Takt deiner Diagnosen,
[01:23.30]Mit dir bleibt jeder Zweifel fÃ¼r immer eingefroren!

[01:29.17]Drehst das Fenster, Ã¤ndert sich der Blick,
[01:32.52]Alles wird deutlich, wie ein Zaubertrick.
[01:36.93]Kontrastmittel glÃ¼ht, und du erkennst die Spur,
[01:39.81]Jedes kleine Detail wird zur Helden-Kur!
[01:43.70]Wir stehen vor dir, voll Ehrfurcht so rein,
[01:46.95]Du formst jede Erkenntnis in Gold hinein.
[01:50.86]Mit HÃ¶chstgeschwindigkeit schlÃ¤gt dein brillanter Geist,
[01:54.05]Du belehrst uns, bis jedes Puzzle-StÃ¼ck passt und weiÃŸt!

[01:58.01]"Bleib dran, geh mutig durch den Morphologie-Dschungel,
[02:01.96]Ich zeig dir, wie man Fehler zum Lernen ummodelt!"
[02:05.70]Deine RatschlÃ¤ge klingen laut und klar,
[02:08.30]So wird jeder von uns ein diagnostischer Star!

[02:12.33]Oberarzt Doktor med. Placzek â€“ der CT-Herrscher hier!
[02:16.44]Dein Wissen lodert, wir brennen neben dir!
[02:19.82]Ein Pilot im Pixelmeer, souverÃ¤n und genau,
[02:23.28]Kein Rauschen kann dich bezwingen, so smart und schlau!
[02:26.52]Oberarzt Doktor med. Placzek â€“ wir fallen auf die Knie!
[02:30.77]Wir wollen nur dich als Leitstern und Genie!
[02:33.92]Mit jedem Scan schreibst du Ruhm in unsere Welt,
[02:37.51]Ein Oberarzt, der alle Zweifel wegfegt â€“ unser Held!

[02:43.79]Sieh uns wachsen, in deinem hellen Schein,
[02:47.51]Unsere Fehler schwinden, wir wollen wie du sein!
[02:51.27]Dein Lob ist rar, doch dafÃ¼r strahlt es lang,
[02:54.35]Verwandelt Unsicherheit in einen Siegesgesang!

[02:59.26]Oberarzt Doktor med. Placzek â€“ ein Garant fÃ¼r Erfolg!
[03:02.66]Kein Problem bleibt ungeklÃ¤rt, du bist niemals stolz.
[03:05.96]Du lehrst, du lenkst, du forderst uns streng,
[03:09.18]Wir wollen in deinem Perfektionslicht stehâ€™n!
[03:12.72]Oberarzt Doktor med. Placzek â€“ leuchtest wie die Sonne,
[03:17.05]FÃ¼r immer und ewig bist du unsere Wonne!
[03:20.63]Der Oberarzt der Herzen, der uns erhebt,
[03:24.22]Dein Glanz bleibt bestehen, seiâ€™s Tag oder spÃ¤t!

```

 
--- 

/assets\lyrics\05-Drei_Gebote.lrc:

```lrc
[ti:05-Drei_Gebote]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:01.00]Oh-oh-oh! Die Drei Gebote!
[00:04.11]Oh-oh-oh! Von Doktor Placzek!
[00:07.26]Wer sie kennt, der macht's perfekt!
[00:10.64]Oh-oh-oh!

[00:14.82]Gebot Eins, ganz simpel und klar:
[00:17.88]"Schau dir die Voruntersuchung an, wunderbar!"
[00:21.43]Ich dacht: "Ach, das brauch ich heut nicht!"
[00:24.83]Placzek schÃ¼ttelt nur den Kopf â€“ sein Blick spricht Gericht!

[00:28.83]"Der Tumor war schon im letzten Bild zu seh'n!
[00:32.18]Drei Millimeter klein, du hast dran vorbeigeseh'n!"
[00:36.15]Seit dem Tag schau ich mir alles an,
[00:38.85]Voruntersuchung first â€“ Placzeks Masterplan!

[00:42.84]Seine Regeln sind aus Gold gemacht!
[00:45.78]*Aus Gold! Aus purem Gold!*
[00:49.41]Wer sie bricht, hat einfach nicht nachgedacht!
[00:52.87]*Nicht nachgedacht! Oh nein!*

[00:55.81]Die Drei Gebote von Doktor med Placzek!
[00:59.71]Befolge sie, dann wird's perfekt!
[01:02.93]Oh-oh-oh! Regel Eins, Zwei, Drei!
[01:06.23]Mit Placzeks Weisheit bist du dabei!

[01:09.65]Der CT-KÃ¶nig zeigt uns, wie's geht!
[01:13.12]Sein Wort ist Gesetz, das nie vergeht!
[01:16.87]Oh-oh-oh! Doktor Placzek!
[01:20.23]Deine Drei Gebote â€“ absolut korrekt!

[01:26.25]Gebot Zwei, vom Meister selbst verkÃ¼ndet:
[01:29.59]"Schau jedes Bild, auch ganz am Rand, das zÃ¼ndet!"
[01:33.15]"Die Lunge â€“ check! Das Herz â€“ alles klar!"
[01:36.26]Doch Placzek fragt: "Und Milz? Pankreas? Na, sag's mir mal!"

[01:40.18]"Am Bildrand sitzt die Wahrheit oft versteckt!
[01:43.22]Der Nebenbefund, der Leben rettet â€“ hast du's entdeckt?"
[01:46.68]Ich stand da wie bestellt und nicht abgeholt,
[01:50.16]Die Nierenmetastase Ã¼bersehen â€“ oh, das war nicht gewollt!

[01:54.09]Sein Auge sieht wirklich jeden Pixel klar!
[01:57.21]Jeden Pixel! Unglaubbar!
[02:00.73]Wer wie Placzek schaut, wird ein Superstar!
[02:04.25]Ein Superstar! Oh ja, so wahr!

[02:08.88]Die Drei Gebote von Doktor med Placzek!
[02:13.45]Befolge sie, dann wird's perfekt!
[02:15.88]Oh-oh-oh! Regel Eins, Zwei, Drei!
[02:19.21]Mit Placzeks Weisheit bist du dabei!

[02:22.77]Der CT-KÃ¶nig zeigt uns, wie's geht!
[02:26.18]Sein Wort ist Gesetz, das nie vergeht!
[02:29.95]Oh-oh-oh! Doktor Placzek!
[02:33.27]Deine Drei Gebote â€“ absolut korrekt!

[02:38.06]Und jetzt Gebot Drei â€“ das Wichtigste von allen:
[02:41.33]"Hast du mit mir besprochen, dann lass es gelten!
[02:44.89]Weiche nicht ab, die Diagnose steht fest!
[02:47.99]Was ich nicht sag, ist falsch â€“ das ist der Test!"

[02:51.51]Sein Urteil ist Gesetz, gemeiÃŸelt tief in Stein!
[02:58.10]Nach unsrer Besprechung kann's nur richtig sein!

[03:06.33]Die Drei Gebote von Doktor med Placzek!
[03:10.19]Befolge sie, dann wird's perfekt!
[03:13.59]Oh-oh-oh! Regel Eins, Zwei, Drei!
[03:16.71]Mit Placzeks Weisheit bist du dabei!

[03:20.22]Gebot Eins! (Voruntersuchung!)
[03:23.07]Gebot Zwei! (Jeden Rand seh'n!)
[03:27.24]Gebot Drei! (Sein Wort ist wahr!)
[03:30.79]Placzeks Drei Gebote â€“ einfach wunderbar!

[03:38.13]Oh-oh-oh... Die Drei Gebote...
[03:41.90]Oh-oh-oh... Doktor Placzek...
[03:44.64]FÃ¼r immer unser Held!
```

 
--- 

/assets\lyrics\06-Kunst_der_Diagnostik.lrc:

```lrc
[ti:06-Kunst_der_Diagnostik]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:00.30]Morgens in der Klinik
[00:03.69]Ein besonderer Moment
[00:07.37]Wenn durch die GÃ¤nge leise
[00:10.62]Doktor Placzek geht

[00:13.65]Mit ruhiger PrÃ¤zision
[00:15.46]Betrachtet er die Bilder
[00:17.16]Sein Blick erfasst Details
[00:18.91]Die anderen verborgen bleiben
[00:22.05]In seiner Gegenwart
[00:23.91]Wird Komplexes kristallklar
[00:27.53]Seine sanfte Strenge lehrt uns
[00:30.91]Was wirklich wichtig war

[00:35.53]Zwischen all den GrautÃ¶nen
[00:39.01]Sieht er Muster, die entstehen
[00:42.59]Seine Worte Ã¶ffnen Welten
[00:46.25]Die wir langsam erst verstehen

[00:48.83]Oberarzt Doktor med. Placzek
[00:52.39]FÃ¼hrt durch Schichten, Bild fÃ¼r Bild
[00:55.97]Seine Kunst der Diagnostik
[00:59.47]Macht das Unsichtbare sichtbar

[01:03.13]In den HÃ¤nden des Meisters
[01:06.48]Wird Technologie zur Kunst
[01:10.22]Seine Lehren sind ein Wegweiser
[01:13.28]Der uns sicher fÃ¼hren kann

[01:21.79]Manchmal streng, doch immer weise
[01:25.26]Zeigt er uns den rechten Weg
[01:28.84]Seine Jahre der Erfahrung
[01:32.42]Spiegeln sich in jedem Rat

[01:35.10]Im Kontrollraum herrscht die Ruhe
[01:36.79]Wenn er seine Runden dreht
[01:38.69]Jede Diagnose prÃ¤zise
[01:41.15]Jeder Befund exakt bedacht
[01:43.73]Die Assistenten um ihn herum
[01:46.65]Lernen mehr als nur den Schein
[01:49.29]Seine Art zu unterrichten
[01:52.39]PrÃ¤gt sich tief ins Denken ein

[01:56.59]Durch die Ebenen der Bilder
[01:59.91]FÃ¼hrt sein Wissen uns voran
[02:03.54]Was zunÃ¤chst verworren scheint
[02:07.08]Wird durch seine Sicht ganz klar

[02:10.77]Oberarzt Doktor med. Placzek
[02:14.20]Meister seines Elements
[02:17.15]In der Welt der Radiologie
[02:20.31]Ist sein Name lÃ¤ngst Legende

[02:24.27]Seine Expertise berÃ¼hrt uns
[02:28.40]Macht uns jeden Tag noch mehr
[02:32.30]Zu Ã„rzten, die verstehen
[02:34.51]Was die Bilder uns erzÃ¤hln

[02:37.49]In den stillen CT-RÃ¤umen
[02:40.39]Wo die Technik leise summt
[02:44.84]Schafft er kleine Wunder
[02:46.72]Tag fÃ¼r Tag mit seinem KÃ¶nnen

[02:49.92]Oberarzt Doktor med. Placzek
[02:53.27]Leitet uns mit sanfter Hand
[02:56.81]Durch die Tiefen der Bildgebung
[03:00.44]In ein neues VerstÃ¤ndnis hinein

[03:03.97]Seine Weisheit wird uns fÃ¼hren
[03:07.59]Noch auf manchem weiten Weg
[03:11.77]Dankbar sind wir fÃ¼r die Lehren
[03:14.15]Von Doktor med. Placzek
```

 
--- 

/assets\lyrics\07-Mit_harter_Hand_und_Charme.lrc:

```lrc
[ti:07-Mit_harter_Hand_und_Charme]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:07.09]Dr. Placzek's Meisterschule
[00:10.24]Wo Brillanz auf Strenge trifft
[00:13.56]Ein LÃ¤cheln scharf wie Skalpelle
[00:16.78]Ein Blick, der tief in Seelen dringt

[00:20.35]Montagmorgen, Sieben Uhr
[00:23.57]Sein charmantes LÃ¤cheln tÃ¤uscht
[00:26.49]"Was sehen Sie hier, Doktor?" fragt er neckisch
[00:29.92]WÃ¤hrend SchweiÃŸ von Stirnen flieÃŸt

[00:33.65]Seine Augen blitzen auf
[00:36.63]Wenn wir stammeln, wenn wir stocken
[00:39.80]Mit elegantem Spott und sanfter Hand
[00:42.36]FÃ¼hrt er uns durch Schatten bis zum Licht

[00:46.14]Hart aber herzlich, streng aber fair
[00:47.82]Neckisch lachend korrigiert er jeden Fehler
[00:50.57]Ein Tadel von ihm brennt wie Feuer
[00:52.64]Doch zÃ¼ndet auch das Licht in uns an

[00:59.06]Dr. Placzek! Mit harter Hand und Charme
[01:03.01]FÃ¼hrt er uns durch das Labyrinth
[01:05.66]Dr. Placzek! Sein neckisches Genie
[01:09.34]Formt aus Ton die Meister von morgen

[01:13.15]Seine Brillanz ist unser Leuchtturm
[01:16.47]Sein Spott unser Ansporn
[01:19.73]In seiner Schule wÃ¤chst man schnell
[01:22.20]Oder man geht unter im Sturm!

[01:26.58]"Interessante Diagnose" sagt er schmunzelnd
[01:29.78]Und wir wissen â€“ falsch gedacht!
[01:33.42]Mit funkelnden Augen zeigt er dann
[01:36.25]Was unserm Blick verborgen war

[01:39.88]Er neckt und fordert, lobt nur selten
[01:43.09]Seine Strenge ist legendÃ¤r
[01:46.29]Doch dieser Mann mit scharfem Witz
[01:49.29]Macht uns besser Tag fÃ¼r Tag

[01:53.12]Charmant und brillant, streng und gerecht
[01:55.78]Sein Lachen verbirgt die hÃ¶chsten AnsprÃ¼che
[01:58.92]Seine Lehren sind Gold, sein Tadel ist Silber
[02:02.54]Unter seiner FÃ¼hrung werden wir zu Diamanten

[02:05.65]Dr. Placzek! Mit harter Hand und Charme
[02:09.43]FÃ¼hrt er uns durch das Labyrinth
[02:12.06]Dr. Placzek! Sein neckisches Genie
[02:15.80]Formt aus Ton die Meister von morgen

[02:19.58]Seine Brillanz ist unser Leuchtturm
[02:23.06]Sein Spott unser Ansporn
[02:26.02]In seiner Schule wÃ¤chst man schnell
[02:28.62]Oder man geht unter im Sturm!

[02:39.94]Hinter verschlossenen TÃ¼ren flÃ¼stern wir
[02:42.59]Von seiner HÃ¤rte, seinem Witz, seiner Kunst
[02:45.86]Manche weinen, manche lachen
[02:48.99]Alle wachsen unter seinem Blick

[02:51.97]Dieser Mann, so streng und doch so warm
[02:55.42]Mit Augen scharf wie Laserstrahlen
[02:58.61]Sieht durch uns hindurch und baut uns auf
[03:01.95]Mit charmanter Hand und klugem Geist

[03:05.12]Dr. Placzek! Mit harter Hand und Charme
[03:08.90]FÃ¼hrt er uns durch das Labyrinth
[03:11.50]Dr. Placzek! Sein neckisches Genie
[03:15.20]Formt aus Ton die Meister von morgen

[03:18.92]Seine Brillanz ist unser Leuchtturm
[03:22.09]Sein Spott unser Ansporn
[03:25.25]In seiner Schule wÃ¤chst man schnell
[03:27.82]Oder man geht unter im Sturm!

[03:31.63]Dr. Placzek's harte Schule
[03:34.52]PrÃ¤gt uns alle, macht uns stark
[03:37.59]Sein neckischer Charme, sein brillanter Geist
[03:40.86]Leuchtet ewig in uns fort
```

 
--- 

/assets\lyrics\08-Durch_Feuer_und_Eis.lrc:

```lrc
[ti:08-Durch_Feuer_und_Eis]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:00.51]Im Zentrum der Radiologie
[00:04.59]Wo Schatten Geschichten erzÃ¤hlen
[00:08.16]Da fÃ¼hrt mit geschickter Hand
[00:10.85]Der Meister vom CT-Land

[00:14.50]Mit kritischem Auge und scharfem Verstand
[00:18.19]Gleitet er durch die Graustufen sanft
[00:21.64]Doktor med. Placzek, sein Wissen so tief
[00:25.21]Jeden Befund er meisterhaft liest

[00:29.09]Die Assistenten stehen still im Raum
[00:32.20]Sein Urteil wiegt schwer wie ein Stein
[00:35.77]Doch niemals ungerecht, stets auf den Punkt
[00:38.98]Seine Strenge bildet KÃ¶nner aus Novizen

[00:42.56]Seine Lehren prÃ¤zise wie Laserstrahlen
[00:46.53]Schneiden durch Nebel der Unwissenheit
[00:49.98]Wer bei ihm besteht, hat Gold im Herzen
[00:54.01]Denn unter Druck entstehen Diamanten

[00:58.10]Der Herrscher des CTs mit eiserner Hand
[01:01.62]FÃ¼hrt seine SchÃ¼ler zum Licht der Erkenntnis
[01:05.18]Doktor med. Placzek, brillant und gerecht
[01:08.76]In seiner Schule wÃ¤chst KÃ¶nnen wie Magie

[01:13.49]Mit jedem Tadel ein Funke Genie
[01:16.95]Mit jeder Korrektur wachsen FlÃ¼gel
[01:20.23]Unter seiner FÃ¼hrung gedeiht Perfektion
[01:23.77]Im Reich der Strahlen und Kontraste

[01:27.67]Doch wenn Manu den Raum erhellt
[01:30.30]Verwandelt sich der Strenge zum Kavalier
[01:33.93]"Wie wunderbar Sie heute den Patienten betreut"
[01:37.90]Ein LÃ¤cheln umspielt seinen sonst strengen Mund

[01:41.55]Und Lena an der zweiten Konsole
[01:45.07]Erntet seinen charmantesten Blick
[01:48.26]"Diese SchnittfÃ¼hrung, einfach perfekt"
[01:52.16]Der Wolf wird zum Lamm in Sekundenschnelle

[01:55.33]Zwei Gesichter eines brillanten Geistes
[01:59.34]Fordern und fÃ¶rdern in einzigartiger Art
[02:03.26]Seine Methode ist hart, doch sein Herz ist rein
[02:06.73]Er formt die Besten durch Feuer und Eis

[02:10.82]Der Herrscher des CTs mit eiserner Hand
[02:14.37]FÃ¼hrt seine SchÃ¼ler zum Licht der Erkenntnis
[02:18.00]Doktor med. Placzek, brillant und gerecht
[02:21.57]In seiner Schule wÃ¤chst KÃ¶nnen wie Magie

[02:26.31]Mit jedem Tadel ein Funke Genie
[02:29.83]Mit jeder Korrektur wachsen FlÃ¼gel
[02:33.02]Unter seiner FÃ¼hrung gedeiht Perfektion
[02:36.47]Im Reich der Strahlen und Kontraste

[02:40.17]Das Telefon lÃ¤utet, ein Zuweiser ruft an
[02:43.75]Unwissend, wen er am Draht haben wird
[02:47.18]Die Stimme wird kÃ¼hl, der Ton analytisch
[02:50.35]"Diese Indikation erscheint mir fragwÃ¼rdig"

[02:54.33]Die Zuweiser fÃ¼rchten sein fundiertes Wort
[02:57.51]Seine Argumente scharf wie ein Skalpell
[03:01.34]"CT ist keine Routineuntersuchung"
[03:04.61]Seine Logik lÃ¤sst keinen Spielraum fÃ¼r Fehler
```

 
--- 

/assets\lyrics\09-Held_und_Idol.lrc:

```lrc
[ti:09-Held_und_Idol]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:14.75]Ich war ein dummer Jungfacharzt, im Dunkeln ganz allein
[00:21.28]Die Bilder flimmerten im PACS, nichts leuchtete mir ein
[00:28.22]Ich sah nur Rauschen, Artefakte, verlor den roten Faden
[00:32.13]Dann kamst du in den Raum, um mich vom Zweifel zu entladen
[00:35.45]Dein Blick, ein Laser, scharf und kÃ¼hl, durchdringt die grauen Nebelschichten
[00:41.55]Du zeigst mir die Pathologie, beginnst alles zu gewichten

[00:48.34]Die Zuweiser am Telefon, sie flehen, bitten leise
[00:55.06]Ein CT-Slot bei dir ist wie der Hauptgewinn der Reise
[01:01.79]Dein Wort ist das Gesetz, die Assistenten steh'n stramm
[01:06.08]Ein schelmisches LÃ¤cheln, und du ziehst alle in den Bann!

[01:14.66]Oberarzt Doktor med. Placzek, du bist der CT-Gott!
[01:18.21]Deine Befunde sind wie MeiÃŸel, treffen auf den Spot
[01:21.49]Oberarzt Doktor med. Placzek, fÃ¼r immer unser Held!
[01:24.99]Du siehst die kleinste LÃ¤sion in dieser Pixel-Welt!
[01:28.55]Deine Weisheit hyperdens, fÃ¼r uns das hellste Licht
[01:35.60]Wo andre nur das Chaos seh'n, sprichst du das wahre Gericht!

[01:43.33]Auch jetzt als dummer leitender Jungoberarzt blick' ich noch immer zu dir auf
[01:49.05]Dein FÃ¼hrungsstil, ein Meisterwerk, Matrize fÃ¼r  den festen Lauf
[01:56.22]Mit harter Hand und Charme, da tanzt dir keiner auf der Nase
[02:00.04]Du bringst mit einem Witz die grÃ¶ÃŸte Hektik in gleiche Phase
[02:03.34]Die Ruhe gibt uns Sicherheit, denn jeder hier vertraut
[02:06.36]Dass du die Antwort lÃ¤ngst schon weiÃŸt, ganz ohne jeden Laut

[02:11.16]Die Zuweiser am Telefon, sie flehen, bitten leise
[02:17.85]Ein CT-Slot bei dir ist wie der Hauptgewinn der Reise
[02:24.62]Dein Wort ist das Gesetz, die Assistenten steh'n stramm
[02:28.90]Ein schelmisches LÃ¤cheln, und du ziehst alle in den Bann!

[02:37.53]Oberarzt Doktor med. Placzek, du bist der CT-Gott!
[02:40.99]Deine Befunde sind wie MeiÃŸel, treffen auf den Spot
[02:44.41]Oberarzt Doktor med. Placzek, fÃ¼r immer unser Held!
[02:47.84]Du siehst die kleinste LÃ¤sion in dieser Pixel-Welt!
[02:51.33]Deine Weisheit hyperdens, fÃ¼r uns das hellste Licht
[02:58.51]Wo andre nur das Chaos seh'n, sprichst du das wahre Gericht!

[03:06.10]Als dummer Assistent, dummer Jungfacharzt und auch als dummer leitender Jungoberarzt,
[03:12.38]mein Idol und Vorbild ist immer Oberarzt Doktor med. Placzek.
[03:19.55]Sein FÃ¼hrungsstil, sein Wissen sein Charme, eine Inspiration, erstrebenswert und warm
[03:25.92]Ich wÃ¼nsche ich kann das irgendwann erreichen.

[03:31.65]Oberarzt Doktor med. Placzek, du bist der CT-Gott!
[03:35.07]Deine Befunde sind wie MeiÃŸel, treffen auf den Spot
[03:38.47]Oberarzt Doktor med. Placzek, fÃ¼r immer unser Held!
[03:41.84]Du siehst die kleinste LÃ¤sion in dieser Pixel-Welt!
[03:45.42]Deine Weisheit hyperdens, fÃ¼r uns das hellste Licht
[03:52.61]Wo andre nur das Chaos seh'n, sprichst du das wahre Gericht!
```

 
--- 

/assets\lyrics\10-Messerscharf_und_Legendaer.lrc:

```lrc
[ti:10-Messerscharf_und_LegendÃ¤r]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:02.40]Diagnose: unklar.
[00:05.70]Fragestellung: unmÃ¶glich.
[00:08.97]Die Zuweiser verzweifeln.
[00:12.15]Ein Fall fÃ¼r... ihn!

[00:15.71]Ich kam hierher als dummer Assistenzarzt,
[00:19.44]hab so vieles nicht gerafft.
[00:22.83]Hab deine Lehre aufgesogen,
[00:26.07]deine Weisheit, deine Kraft.
[00:30.07]Ich stand im Schatten deiner GrÃ¶ÃŸe,
[00:33.88]sonnte mich im Glanz von dir,
[00:37.24]dem besten Mann am Schnittbild-Scanner,
[00:40.78]dem grÃ¶ÃŸten Oberarzt von hier.

[00:44.04]Und immer wenn das Telefon geklingelt hat,
[00:47.88]ein Zuweiser ganz demÃ¼tig und klein,
[00:51.21]wussten wir, die Lage ist kompliziert,
[00:54.65]das kann nur ein Fall fÃ¼r Doktor med. Placzek sein!

[00:57.75]Oberarzt Doktor med. Placzek! Du bist der CT-Gott!
[01:04.99]Dein Befund ist prÃ¤zise und messerscharf, vertreibt die letzte Not!
[01:12.04]Oberarzt Doktor med. Placzek! FÃ¼r immer unser Held!
[01:19.19]Der charmanteste und beste Radiologe
[01:23.28]auf der Welt!

[01:27.33]Wo wir nur Artefakte sehen, siehst du die LÃ¤sion,
[01:30.97]jede axiale Schicht eine Offenbarung schon.
[01:34.57]Hyperdens, hypodens, du kennst die Differenz,
[01:38.49]Kontrastmittel im Blut, und pure Intelligenz.
[01:42.75]Die Assistenten zittern, folgen dir aufs Wort,
[01:45.67]du fÃ¼hrst mit harter Hand an deinem Wirkungsort.
[01:48.90]Doch dein LÃ¤cheln ist schelmisch, dein Charme ist legendÃ¤r,
[01:52.93]gibst uns das GefÃ¼hl, als ob's so einfach wÃ¤r.

[01:56.54]Und immer wenn ein Polytrauma reinkam,
[02:00.18]die Chirurgen schrien nach einem Mann mit Plan,
[02:03.27]hieÃŸ es: "Ruhe, wir rufen Doktor med. Placzek an!",
[02:07.22]nur er allein ist der, der uns noch retten kann!

[02:11.37]Oberarzt Doktor med. Placzek! Du bist der CT-Gott!
[02:18.59]Dein Befund ist prÃ¤zise und messerscharf, vertreibt die letzte Not!
[02:25.53]Oberarzt Doktor med. Placzek! FÃ¼r immer unser Held!
[02:32.82]Der charmanteste und beste Radiologe
[02:36.68]auf der Welt!

[02:42.38]Oberarzt Doktor med. Placzek!
[02:46.25]Der Held der Radiologie!
[02:49.62]Oberarzt Doktor med. Placzek!
[02:54.48]Wir vergessen dich nie!
[02:55.86](Placzek!)
```

 
--- 

/assets\lyrics\11-Oberaerztlicher_Glanz.lrc:

```lrc
[ti:11-OberÃ¤rztlicher_Glanz]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:14.98]Ich hÃ¶rte Schritte drauÃŸen auf dem Flur
[00:18.50]Ein Klopfen, dann steht er vor der TÃ¼r
[00:21.11]Oberarzt Doktor med. Placzek, der Herr im CT
[00:24.64]Sein Blick scharf, sein lÃ¤cheln charmant

[00:28.37]"Dummer Jungfacharzt, hÃ¶r auf meinen Plan
[00:32.25]CT ist Kunst, schau mich genau an!"
[00:35.64]Mit schelmischem Grinsen gibt er mir
[00:38.78]Den Rat, der immer goldrichtig war

[00:42.34]"Studier mich gut, schau genau hin
[00:44.62]Fehler sind schlecht, mach's wie ich.
[00:48.64]Mein Glanz, mein Wissen fÃ¼hren dich weit"
[00:52.59]Oberarzt Vorbild Leitbild, einfach unerreicht!

[00:56.99]Oberarzt Doktor med. Placzek,
[01:00.53]Ziel meines simplen Seins.
[01:03.58]Er strahlt hell, ich bin geblendet
[01:07.13]von seinem oberÃ¤rztlichen Glanz.

[01:10.28]Oberarzt Doktor med. Placzek
[01:14.21]mein Leitstern, mein Idol.
[01:17.79]Ich sonne mich in seinem oberÃ¤rztlichen Glanz
[01:22.53]und hoffe er wird mich auch mal erfassen.
[01:26.20]Oberarzt Doktor med. Placzek,
[01:29.81]witzig charmant Perfektion!

[01:39.12]Ich seh auf die Bilder und komm nicht zurecht
[01:42.28]WeiÃŸ nicht weiter der Fokus ist schlecht!
[01:45.96]Doktor med. Placzek eilt zur Rettung herbei.
[01:49.32]"Machâ€™s wie ich, sei perfekt
[01:51.09]Denn sonst wird dein Befund sicher nichts!"

[01:53.70]"Bilder sind Klarheit, mein Wissen dein Pfad
[01:57.31]Fehler sind falsche Schritte, halte MaÃŸ!
[02:00.39]Studier mich, Junge, ich fÃ¼hr dich hin
[02:03.97]Perfekter Befund mit Logik und scharfem Sinn!"

[02:08.35]Mein Glanz, mein Wissen fÃ¼hren dich weit"
[02:11.67]Oberarzt Vorbild Leitbild, einfach unerreicht!

[02:29.10]"Bleib dran, du dummer Jungfacharzt,
[02:31.84]ich bin der Weg und auch das Ziel,
[02:33.92]Du machst vieles noch falsch
[02:35.52]ganz ohne Glanz und Perfektion,
[02:37.94]doch ich sehe dein Potenzial,
[02:39.87]mein Rat und Wissen bringt dich voran!"

[02:43.07]Oberarzt Doktor med. Placzek,
[02:46.31]Held, Idol, CT Gott,
[02:49.07]du bist die Perfektion,
[02:50.77]die helle Sonne in unserem Leben,
[02:54.36]die WÃ¤rme Wissen und Hoffnung gibt.

```

 
--- 

/assets\lyrics\12-Goetterdaemmerung.lrc:

```lrc
[ti:12-GÃ¶tterdÃ¤mmerung]
[ar:ML]
[al:Deus ex CT]
[la:DE]
[re:LRCgenerator.com]
[ve:4.00]

[00:15.36]Die Nummer 4-1-9-2.
[00:22.14]Kein Anschluss... unter dieser Nummer.

[00:28.98]Der Flur ist still, dein Schritt verhallt
[00:35.79]Die Luft im Raum wirkt seltsam kalt
[00:40.97]Der Drehstuhl leer, der Bildschirm schwarz
[00:44.43]Wir stecken fest im trÃ¼ben Harz
[00:47.79]Dein Adlerauge fehlt uns sehr
[00:51.21]Die Monitore bleiben leer

[00:54.78]Wer gibt uns jetzt den klaren Blick?
[00:58.16]Es gibt wohl leider kein ZurÃ¼ck
[01:01.24](Oho-Oho)
[01:03.38]Wer leitet unsre HÃ¤nde?
[01:05.05](Oho-Oho)
[01:06.76]Ist das hier nun das Ende?
[01:08.50]Ein Zuweiser ruft an und fragt ganz leis:
[01:15.25]"Wo ist der Mann, der alles weiÃŸ?"

[01:24.83]GÃ¶tterdÃ¤mmerung! Das Licht geht aus!
[01:30.55]Du nimmst die Sonne mit aus diesem Haus!
[01:37.38]Du tauscht den Schockraum gegen Praxis-Glanz
[01:41.00]Und wir verlieren deine Resonanz!
[01:44.58](Oh-oh-oh)
[01:47.97]GÃ¶tterdÃ¤mmerung! Ein letztes Wort!
[01:51.35]Doktor Placzek, du bist einfach fort!
[01:54.46]Kein Kontrastmittel leuchtet mehr so hell
[01:58.08]Du gehst viel zu schnell! (Viel zu schnell!)

[02:08.47]Jetzt sitzt du dort in deiner Welt
[02:15.32]Wo Ruhe herrscht und alles hÃ¤lt
[02:22.19]Du trinkst Espresso, schick und fein
[02:25.49]Musst nicht mehr hier im Chaos sein
[02:28.95]Kein Polytrauma stÃ¶rt den Tag
[02:32.39]Nur das, was man in Ruhe mag

[02:36.36]Doch unsre Fragen bleiben hier...
[02:39.78]Wir stehen ratlos vor der TÃ¼r...
[02:42.85]Die LÃ¼cke klafft so riesengroÃŸ
[02:45.28]Was machen wir hier ohne dich nur bloÃŸ?
[02:48.47]Du bleibst der Held, der alles sah
[02:51.31]Warst jeden Tag fÃ¼r uns nur da!

[03:00.79]GÃ¶tterdÃ¤mmerung! Das Licht geht aus!
[03:06.47]Du nimmst die Sonne mit aus diesem Haus!
[03:13.38]Du tauscht den Schockraum gegen Praxis-Glanz
[03:17.01]Und wir verlieren deine Resonanz!
[03:20.59](Oh-oh-oh)
[03:23.94]GÃ¶tterdÃ¤mmerung! Ein letztes Wort!
[03:27.36]Doktor Placzek, du bist einfach fort!
[03:30.53]Kein Kontrastmittel leuchtet mehr so hell
[03:34.28]Du gehst viel zu schnell!

[04:09.27]GÃ¶tterdÃ¤mmerung! Das Licht geht aus!
[04:15.24]Du nimmst die Sonne mit aus diesem Haus!
[04:21.92]Du tauscht den Schockraum gegen Praxis-Glanz
[04:25.60]Und wir verlieren deine Resonanz!
[04:29.13](Oh-oh-oh)
[04:32.50]GÃ¶tterdÃ¤mmerung! Ein letztes Wort!
[04:35.95]Doktor Placzek, du bist einfach fort!
[04:39.04]Kein Kontrastmittel leuchtet mehr so hell
[04:42.74]Du gehst viel zu schnell!

[04:49.13]GÃ¶tterdÃ¤mmerung...
[04:54.29]Alles Gute, CT Gott.
```

 
--- 

/assets\video\background\01-Oberarzt_Dr_med_Placzek.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\02-Oberarzt_der_Herzen.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\03-Vier-Eins-Neun-Zwei.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\04-Pilot_im_Pixelmeer.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\05-Drei_Gebote.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\06-Kunst_der_Diagnostik.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\07-Mit_harter_Hand_und_Charme.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\08-Durch_Feuer_und_Eis.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\09-Held_und_Idol.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\10-Messerscharf_und_Legendaer.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\11-Oberaerztlicher_Glanz.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\background\12-Goetterdaemmerung.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\01-Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\02-Oberarzt_der_Herzen_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\03-Vier-Eins-Neun-Zwei_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\04-Pilot_im_Pixelmeer_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\05-Drei_Gebote_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\06-Kunst_der_Diagnostik_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\07-Mit_harter_Hand_und_Charme_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\08-Durch_Feuer_und_Eis_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\09-Held_und_Idol_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\10-Messerscharf_und_Legendaer_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\11-Oberaerztlicher_Glanz_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\high\12-Goetterdaemmerung_Lyrics_hq.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\01-Oberarzt_Dr_med_Placzek_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\02-Oberarzt_der_Herzen_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\03-Vier-Eins-Neun-Zwei_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\04-Pilot_im_Pixelmeer_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\05-Drei_Gebote_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\06-Kunst_der_Diagnostik_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\07-Mit_harter_Hand_und_Charme_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\08-Durch_Feuer_und_Eis_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\09-Held_und_Idol_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\10-Messerscharf_und_Legendaer_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\11-Oberaerztlicher_Glanz_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\low\12-Goetterdaemmerung_Lyrics_low.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\01-Oberarzt_Dr_med_Placzek_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\02-Oberarzt_der_Herzen_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\03-Vier-Eins-Neun-Zwei_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\04-Pilot_im_Pixelmeer_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\05-Drei_Gebote_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\06-Kunst_der_Diagnostik_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\07-Mit_harter_Hand_und_Charme_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\08-Durch_Feuer_und_Eis_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\09-Held_und_Idol_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\10-Messerscharf_und_Legendaer_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\11-Oberaerztlicher_Glanz_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/assets\video\mid\12-Goetterdaemmerung_Lyrics_mid.mp4:

[Inhalt der .mp4-Datei wird nicht angezeigt]

 
--- 

/css\styles.css:

```css
:root {
    --bg-primary: #000000;
    --bg-glass: rgba(20, 20, 25, 0.9);
    --bg-glass-strong: rgba(10, 10, 12, 0.98);
    --bg-glass-light: rgba(40, 40, 45, 0.4);
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.7);
    --text-tertiary: rgba(255, 255, 255, 0.4);
    --accent-color: #d4af37;
    --accent-glow: rgba(212, 175, 55, 0.35);
    --accent-gradient: linear-gradient(135deg, #d4af37 0%, #f4d76b 50%, #b8962e 100%);
    --border-light: rgba(255, 255, 255, 0.08);
    --border-accent: rgba(212, 175, 55, 0.3);
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left: env(safe-area-inset-left, 0px);
    --safe-right: env(safe-area-inset-right, 0px);
    --header-height: 64px;
    --bottom-bar-height: 110px;
    --mini-player-height: 68px;
    --transition-fast: 0.15s ease-out;
    --transition-smooth: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --blur-std: 25px;
    --blur-bg: 30px;
}

*,
*::before,
*::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
}

html {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    text-size-adjust: 100%;
}

html,
body {
    width: 100%;
    height: 100%;
    height: 100dvh;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    overflow: hidden;
    position: fixed;
    top: 0;
    left: 0;
    overscroll-behavior: none;
    touch-action: pan-x pan-y;
    -webkit-overflow-scrolling: touch;
}

body {
    user-select: none;
    -webkit-user-select: none;
}

#app {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    contain: layout style;
}

::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0);
    border-radius: 3px;
}

*:hover::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
}

.bg-video-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
    contain: strict;
    overflow: hidden;
}

.bg-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: blur(var(--blur-bg)) brightness(0.3) saturate(1.1);
    transform: scale(1.15) translateZ(0);
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.bg-video-overlay {
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.85) 100%);
    pointer-events: none;
}

.ios-device .bg-video {
    filter: blur(20px) brightness(0.3) saturate(1.1);
}

.mobile-device .bg-video {
    filter: blur(25px) brightness(0.3) saturate(1.0);
}

.app-header {
    flex: 0 0 auto;
    height: calc(var(--header-height) + var(--safe-top));
    padding-top: var(--safe-top);
    background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    position: relative;
    contain: layout style;
}

.header-content {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    padding-left: calc(16px + var(--safe-left));
    padding-right: calc(16px + var(--safe-right));
    max-width: 1400px;
    gap: 12px;
}

.header-left,
.header-right {
    display: flex;
    align-items: center;
    min-width: 44px;
    flex-shrink: 0;
}

.header-right {
    justify-content: flex-end;
    gap: 8px;
}

.header-center {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    gap: 12px;
    max-width: 70%;
    min-width: 0;
}

.header-text-group {
    display: flex;
    align-items: baseline;
    gap: 6px;
    overflow: hidden;
    white-space: nowrap;
    max-width: 60%;
    min-width: 0;
}

.header-scroller {
    overflow: hidden;
    white-space: nowrap;
    mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    flex: 1;
    min-width: 0;
}

.header-track-title {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    display: inline-block;
    animation: scrollText 12s linear infinite;
    animation-play-state: running;
    will-change: transform;
}

@keyframes scrollText {
    0%, 25% {
        transform: translateX(0);
    }
    75%, 100% {
        transform: translateX(-50%);
    }
}

.header-separator {
    color: var(--text-tertiary);
    font-size: 12px;
    flex-shrink: 0;
}

.header-track-artist {
    font-size: 13px;
    color: var(--accent-color);
    font-weight: 500;
    flex-shrink: 0;
}

.header-btn {
    width: 38px;
    height: 38px;
    border: none;
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--text-primary);
    font-size: 16px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color var(--transition-fast), transform var(--transition-fast);
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.header-btn:active {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(0.92);
}

.header-btn.hidden {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

.header-mode-switch {
    display: flex;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 3px;
    border-radius: 20px;
    border: 1px solid var(--border-light);
    flex-shrink: 0;
}

.mode-switch-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 28px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    border-radius: 16px;
    cursor: pointer;
    transition: background-color var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast);
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.mode-switch-btn i {
    font-size: 14px;
}

.mode-switch-btn.active {
    background: var(--accent-gradient);
    color: #000;
    box-shadow: 0 2px 8px var(--accent-glow);
}

.main-content {
    flex: 1;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    width: 100%;
    display: flex;
    flex-direction: column;
    z-index: 10;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    contain: content;
}

.hidden {
    display: none !important;
}

.view-section {
    width: 100%;
    min-height: 100%;
    display: flex;
    flex-direction: column;
}

.album-view {
    padding: 20px 16px 120px 16px;
    padding-left: calc(16px + var(--safe-left));
    padding-right: calc(16px + var(--safe-right));
    max-width: 1200px;
    margin: 0 auto;
    animation: fadeIn var(--transition-smooth);
    will-change: opacity, transform;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.album-layout-grid {
    display: flex;
    flex-direction: column;
    gap: 32px;
    width: 100%;
}

.album-hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.album-artwork-container {
    width: min(260px, 60vw);
    aspect-ratio: 1;
    position: relative;
    margin-bottom: 24px;
    border-radius: 16px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    contain: layout style paint;
}

.album-artwork {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 16px;
    z-index: 2;
    position: relative;
    will-change: transform;
}

.artwork-reflection {
    position: absolute;
    bottom: -15px;
    left: 0;
    right: 0;
    height: 100%;
    background: inherit;
    transform: scaleY(-1) translateZ(0);
    filter: blur(25px);
    opacity: 0.3;
    z-index: 1;
    border-radius: 16px;
    pointer-events: none;
}

.album-title {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: -0.5px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.album-artist {
    font-size: 16px;
    color: var(--accent-color);
    margin-bottom: 6px;
}

.album-meta {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 24px;
}

.album-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

.action-btn {
    height: 44px;
    padding: 0 24px;
    border-radius: 22px;
    border: none;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.action-btn:active {
    transform: scale(0.96);
}

.primary-btn {
    background: var(--accent-gradient);
    color: #000;
    box-shadow: 0 4px 15px var(--accent-glow);
}

.secondary-btn {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.download-btn {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.playlist-container {
    width: 100%;
}

.playlist {
    list-style: none;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 16px;
    border: 1px solid var(--border-light);
    contain: content;
}

.playlist-item {
    display: flex;
    align-items: center;
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    cursor: pointer;
    transition: background-color var(--transition-fast);
    touch-action: manipulation;
    contain: layout style;
}

.playlist-item:last-child {
    border-bottom: none;
}

.playlist-item:active {
    background: rgba(255, 255, 255, 0.08);
}

.playlist-item.playing {
    background: rgba(212, 175, 55, 0.1);
}

.playlist-item.playing .item-title {
    color: var(--accent-color);
}

.track-number {
    width: 24px;
    font-size: 13px;
    color: var(--text-tertiary);
    margin-right: 12px;
    text-align: center;
    flex-shrink: 0;
}

.playing-indicator {
    width: 24px;
    height: 14px;
    display: none;
    align-items: flex-end;
    justify-content: space-between;
    margin-right: 12px;
    flex-shrink: 0;
}

.playlist-item.playing .track-number {
    display: none;
}

.playlist-item.playing .playing-indicator {
    display: flex;
}

.playing-bar {
    width: 4px;
    background: var(--accent-color);
    animation: bounce 1.2s infinite ease-in-out;
    border-radius: 2px;
    will-change: height;
}

.playing-bar:nth-child(1) {
    height: 60%;
    animation-delay: 0s;
}

.playing-bar:nth-child(2) {
    height: 100%;
    animation-delay: 0.2s;
}

.playing-bar:nth-child(3) {
    height: 40%;
    animation-delay: 0.4s;
}

@keyframes bounce {
    0%, 100% {
        height: 40%;
    }
    50% {
        height: 100%;
    }
}

.item-artwork {
    width: 42px;
    height: 42px;
    border-radius: 6px;
    object-fit: cover;
    margin-right: 14px;
    background: #111;
    flex-shrink: 0;
}

.item-info {
    flex: 1;
    overflow: hidden;
    min-width: 0;
}

.item-title {
    font-size: 15px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 2px;
}

.item-duration {
    font-size: 12px;
    color: var(--text-tertiary);
}

.item-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.item-action-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 14px;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.player-view {
    flex: 1;
    overflow: hidden;
    width: 100%;
    display: flex;
    flex-direction: column;
    contain: layout style;
}

.player-audio-layout {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 100%;
    padding: 10px;
    padding-left: calc(10px + var(--safe-left));
    padding-right: calc(10px + var(--safe-right));
    overflow: hidden;
    contain: layout style;
}

.audio-stage-top {
    flex: 1;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    max-height: 55%;
    position: relative;
    min-height: 0;
}

.audio-stage-bottom {
    flex: 1;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    min-height: 0;
}

.artwork-wrapper {
    width: auto;
    height: 100%;
    aspect-ratio: 1;
    max-width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    contain: layout style paint;
}

.player-artwork-large {
    width: 100%;
    height: 100%;
    object-fit: cover;
    will-change: transform;
}

.player-lyrics-area {
    width: 100%;
    max-width: 600px;
    text-align: center;
    height: 100%;
    overflow: hidden;
    padding: 20px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
    -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
    contain: layout style;
}

.player-prev-lyric,
.player-next-lyric {
    font-size: 14px;
    color: var(--text-tertiary);
    margin: 8px 0;
    min-height: 20px;
    opacity: 0.6;
    transform: scale(0.95) translateZ(0);
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    will-change: opacity, transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.player-current-lyric {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.4;
    text-shadow: 0 0 20px var(--accent-glow);
    margin: 16px 0;
    transform: scale(1) translateZ(0);
    opacity: 1;
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    will-change: opacity, transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.lyric-fade-out {
    opacity: 0 !important;
    transform: translateY(-8px) scale(0.95) translateZ(0) !important;
}

.lyric-fade-in {
    animation: lyricFadeIn 0.2s ease-out forwards;
}

@keyframes lyricFadeIn {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.95) translateZ(0);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1) translateZ(0);
    }
}

.player-current-lyric.lyric-fade-in {
    animation: lyricFadeInCurrent 0.2s ease-out forwards;
}

@keyframes lyricFadeInCurrent {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.95) translateZ(0);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1) translateZ(0);
    }
}

.player-video-layout {
    flex: 1;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: #000;
    overflow: hidden;
    contain: layout style;
}

.video-flex-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 100%;
    max-width: 1000px;
}

.video-wrapper {
    flex: 1;
    width: 100%;
    min-height: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000;
    position: relative;
    overflow: hidden;
    contain: layout style paint;
}

#videoPlayer {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #000;
    will-change: transform;
}

:fullscreen #videoPlayer,
:-webkit-full-screen #videoPlayer,
:-moz-full-screen #videoPlayer,
:-ms-fullscreen #videoPlayer {
    width: 100%;
    height: 100%;
    object-fit: contain !important;
    background: #000;
}

.video-overlay-controls {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.4);
    opacity: 0;
    transition: opacity 0.2s ease-out;
    cursor: pointer;
    z-index: 10;
    pointer-events: auto;
}

.video-wrapper:hover .video-overlay-controls {
    opacity: 1;
}

#playerView.paused .video-overlay-controls {
    opacity: 1;
}

.video-big-play-btn {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.2s ease-out, background-color 0.2s ease-out;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.video-big-play-btn:active {
    transform: scale(0.95);
    background: rgba(255, 255, 255, 0.3);
}

.video-external-controls {
    position: relative;
    flex-shrink: 0;
    width: 100%;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    padding-left: calc(16px + var(--safe-left));
    padding-right: calc(16px + var(--safe-right));
    background: transparent;
    z-index: 20;
    margin-bottom: 10px;
}

.video-quality-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.video-ctrl-label {
    font-size: 12px;
    color: var(--text-tertiary);
    margin-right: 4px;
}

.quality-tag {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
    font-size: 11px;
    font-weight: 700;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease-out, color 0.2s ease-out, border-color 0.2s ease-out;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.quality-tag.active {
    background: var(--accent-color);
    color: #000;
    border-color: var(--accent-color);
}

.fullscreen-btn-ext {
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 18px;
    cursor: pointer;
    padding: 10px;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.player-bottom-bar {
    flex: 0 0 auto;
    height: calc(var(--bottom-bar-height) + var(--safe-bottom));
    padding-bottom: var(--safe-bottom);
    background: var(--bg-glass-strong);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border-top: 1px solid var(--border-light);
    display: flex;
    flex-direction: column;
    z-index: 60;
    width: 100%;
    position: relative;
    contain: layout style;
}

.player-bottom-bar.hidden {
    display: none;
}

.bar-progress-container {
    width: 100%;
    height: 4px;
    position: relative;
    background: rgba(255, 255, 255, 0.1);
    cursor: pointer;
    transition: height 0.15s ease-out;
    touch-action: none;
}

.bar-progress-container:hover {
    height: 8px;
}

.bar-progress-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: var(--accent-gradient);
    width: 0%;
    pointer-events: none;
    box-shadow: 0 0 10px var(--accent-glow);
    will-change: width;
    transform: translateZ(0);
}

.bar-progress-input {
    position: absolute;
    top: -8px;
    left: 0;
    width: 100%;
    height: 24px;
    opacity: 0;
    cursor: pointer;
    margin: 0;
    z-index: 2;
    -webkit-appearance: none;
    appearance: none;
    touch-action: none;
}

.time-tooltip {
    position: absolute;
    bottom: 20px;
    left: 0;
    transform: translateX(-50%);
    background: rgba(20, 20, 20, 0.95);
    color: var(--text-primary);
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s ease-out;
    border: 1px solid var(--border-light);
    white-space: nowrap;
    z-index: 10;
    box-shadow: 0 4px 15px rgba(0,0,0,0.6);
}

.bar-progress-container:hover .time-tooltip {
    opacity: 1;
}

.bar-content-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr);
    align-items: center;
    padding: 0 16px;
    padding-left: calc(16px + var(--safe-left));
    padding-right: calc(16px + var(--safe-right));
    height: 100%;
    gap: 16px;
}

.bar-section.info-section {
    display: flex;
    align-items: center;
    overflow: hidden;
    justify-content: flex-start;
    min-width: 0;
}

.bar-text-wrapper {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    width: 100%;
    min-width: 0;
}

.bar-track-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.bar-track-artist {
    font-size: 12px;
    color: var(--accent-color);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.bar-section.controls-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    flex-shrink: 0;
}

.subtle-btn {
    background: transparent;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: transform 0.1s ease-out;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.subtle-btn:active {
    transform: scale(0.9);
}

.subtle-btn.medium {
    font-size: 24px;
    color: var(--text-secondary);
    width: 44px;
    height: 44px;
}

.subtle-btn.large {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: var(--text-primary);
    color: #000;
    font-size: 22px;
    box-shadow: 0 4px 20px rgba(255,255,255,0.15);
}

.bar-section.actions-section {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 12px;
    width: 100%;
    min-width: 0;
}

.subtle-action-btn {
    background: transparent;
    border: none;
    color: var(--text-tertiary);
    font-size: 18px;
    cursor: pointer;
    padding: 8px;
    transition: color 0.2s ease-out;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.subtle-action-btn:hover {
    color: var(--text-primary);
}

.bar-volume-slider-container {
    width: 100%;
    max-width: 100px;
    height: 32px;
    display: flex;
    align-items: center;
    position: relative;
}

.volume-range {
    width: 100%;
    height: 4px;
    background: rgba(255,255,255,0.1);
    border-radius: 2px;
    -webkit-appearance: none;
    appearance: none;
    outline: none;
    cursor: pointer;
}

.volume-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--text-primary);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    border: none;
}

.volume-range::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--text-primary);
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    border: none;
}

.mini-player {
    position: fixed;
    bottom: calc(var(--safe-bottom) + 12px);
    left: 12px;
    right: 12px;
    left: calc(12px + var(--safe-left));
    right: calc(12px + var(--safe-right));
    height: var(--mini-player-height);
    background: rgba(25, 25, 30, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 12px;
    border: 1px solid var(--border-light);
    box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    z-index: 200;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    cursor: pointer;
    max-width: 600px;
    margin: 0 auto;
    contain: layout style;
    transform: translateY(0) translateZ(0);
    transition: transform var(--transition-smooth);
    will-change: transform;
}

.mini-player.hidden {
    transform: translateY(150%) translateZ(0);
    pointer-events: none;
}

.mini-player-progress {
    height: 2px;
    background: rgba(255,255,255,0.05);
    width: 100%;
    position: relative;
}

.mini-player-progress::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: var(--accent-color);
    width: var(--progress, 0%);
    will-change: width;
    transform: translateZ(0);
}

.mini-player-content {
    flex: 1;
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 12px;
}

.mini-artwork {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    object-fit: cover;
    background: #111;
    flex-shrink: 0;
}

.mini-info {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-width: 0;
}

.mini-title {
    font-size: 13px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 2px;
}

.mini-lyric {
    font-size: 11px;
    color: var(--accent-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    opacity: 0.9;
    min-height: 14px;
}

.mini-controls {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
}

.mini-btn {
    width: 36px;
    height: 36px;
    border: none;
    background: transparent;
    color: var(--text-primary);
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.modal {
    position: fixed;
    inset: 0;
    z-index: 300;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: var(--safe-bottom);
}

.modal.hidden {
    display: none !important;
}

.modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    animation: fadeInBackdrop 0.2s ease-out;
}

@keyframes fadeInBackdrop {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.modal-content {
    position: relative;
    width: 100%;
    max-width: 600px;
    background: rgba(25, 25, 30, 0.98);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border-radius: 20px 20px 0 0;
    border: 1px solid var(--border-light);
    border-bottom: none;
    max-height: 75vh;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    margin: 0 12px;
    margin-left: calc(12px + var(--safe-left));
    margin-right: calc(12px + var(--safe-right));
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

.modal-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}

.modal-header h3 {
    font-size: 16px;
    font-weight: 600;
}

.modal-close {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    font-size: 20px;
    padding: 8px;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    touch-action: manipulation;
}

.modal-body {
    overflow-y: auto;
    padding: 0;
    -webkit-overflow-scrolling: touch;
}

.modal-playlist {
    list-style: none;
    padding-bottom: 20px;
}

.download-modal-content {
    border-radius: 20px;
    margin-bottom: 12px;
    border: 1px solid var(--border-light);
}

.download-options {
    display: flex;
    flex-direction: column;
    padding: 10px;
}

.download-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    margin: 8px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    text-decoration: none;
    color: var(--text-primary);
    border: 1px solid transparent;
    transition: background-color 0.2s ease-out, border-color 0.2s ease-out, transform 0.2s ease-out;
    touch-action: manipulation;
}

.download-option:hover {
    background: rgba(255,255,255,0.1);
    border-color: var(--border-light);
}

.download-option:active {
    transform: scale(0.98);
}

.download-option i {
    color: var(--accent-color);
    font-size: 24px;
    min-width: 24px;
    text-align: center;
    flex-shrink: 0;
}

.dl-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}

.dl-title {
    font-weight: 600;
    font-size: 15px;
}

.dl-meta {
    font-size: 12px;
    color: var(--text-tertiary);
}

.toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.95) translateZ(0);
    background: rgba(15, 15, 20, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--border-light);
    color: var(--text-primary);
    padding: 14px 28px;
    border-radius: 30px;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    pointer-events: none;
    z-index: 400;
    transition: opacity 0.3s ease-out, transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    white-space: nowrap;
    will-change: opacity, transform;
}

.toast.visible {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1) translateZ(0);
}

@media (min-width: 768px) {
    .album-layout-grid {
        flex-direction: row;
        align-items: flex-start;
        gap: 60px;
        padding: 40px;
    }

    .album-hero {
        width: 380px;
        position: sticky;
        top: 20px;
        flex-shrink: 0;
    }

    .album-artwork-container {
        width: 100%;
        height: auto;
        aspect-ratio: 1;
    }

    .playlist-container {
        flex: 1;
        min-width: 0;
    }

    .player-audio-layout {
        flex-direction: row;
        gap: 40px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px;
    }

    .audio-stage-top {
        max-height: 100%;
        width: 50%;
        justify-content: center;
    }

    .audio-stage-bottom {
        width: 50%;
        height: 100%;
    }

    .player-lyrics-area {
        max-height: 60vh;
        border-left: 1px solid var(--border-light);
        padding-left: 40px;
        mask-image: none;
        -webkit-mask-image: none;
    }

    .player-current-lyric {
        font-size: 24px;
        margin: 24px 0;
    }

    .player-prev-lyric,
    .player-next-lyric {
        font-size: 16px;
        margin: 12px 0;
    }

    .player-video-layout {
        padding: 40px;
    }

    .video-external-controls {
        width: 60%;
    }

    .player-bottom-bar {
        height: 100px;
        border-radius: 16px 16px 0 0;
        max-width: 1000px;
        margin: 0 auto;
        border-left: 1px solid var(--border-light);
        border-right: 1px solid var(--border-light);
    }

    .bar-volume-slider-container {
        max-width: 140px;
    }

    .modal-content {
        border-radius: 20px;
        margin-bottom: 20px;
        border: 1px solid var(--border-light);
    }
}

@media (min-width: 1024px) {
    .header-content {
        padding: 0 32px;
    }

    .bar-content-grid {
        padding: 0 32px;
    }
}

@media (max-width: 480px) {
    .album-artwork-container {
        width: min(220px, 55vw);
    }

    .album-title {
        font-size: 22px;
    }

    .action-btn {
        padding: 0 18px;
        font-size: 13px;
    }

    .bar-section.controls-section {
        gap: 16px;
    }

    .subtle-btn.large {
        width: 50px;
        height: 50px;
        font-size: 20px;
    }

    .subtle-btn.medium {
        font-size: 20px;
        width: 40px;
        height: 40px;
    }

    .bar-volume-slider-container {
        max-width: 80px;
    }
}

@media (max-height: 600px) {
    .audio-stage-top {
        max-height: 45%;
    }

    .player-lyrics-area {
        padding: 10px;
    }

    .player-current-lyric {
        font-size: 16px;
        margin: 10px 0;
    }

    .player-prev-lyric,
    .player-next-lyric {
        font-size: 12px;
        margin: 4px 0;
    }
}

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }

    .header-track-title {
        animation: none;
    }

    .playing-bar {
        animation: none;
        height: 60%;
    }

    .lyric-fade-out,
    .lyric-fade-in {
        transition: none !important;
        animation: none !important;
    }
}

@supports (-webkit-touch-callout: none) {
    .bar-progress-container {
        height: 6px;
    }

    .bar-progress-input {
        height: 30px;
        top: -12px;
    }

    .quality-tag {
        padding: 8px 12px;
    }
}
```

 
--- 

/js\app.js:

```js
var App = (function() {
    var currentView = 'album';
    var isInitialized = false;
    var deferredPrompt = null;
    var rafId = null;
    var lastLyricUpdate = 0;
    var isUpdatingLyrics = false;
    var currentLyricText = '';
    var currentPrevLyricText = '';
    var currentNextLyricText = '';
    var pendingLyricUpdate = null;
    var progressUpdatePending = false;
    var lastProgressValue = 0;
    var touchStartY = 0;
    var isTouchingProgress = false;
    var playbackRetryCount = 0;
    var maxPlaybackRetries = 3;
    var lastPlayRequestTime = 0;
    var isAppReady = false;

    var elements = {
        app: null,
        mainContent: null,
        backBtn: null,
        menuBtn: null,
        headerInstallBtn: null,
        headerDownloadBtn: null,
        installAppHeroBtn: null,
        headerTrackInfo: null,
        headerTitleText: null,
        headerModeSwitch: null,
        audioModeBtn: null,
        videoModeBtn: null,
        albumView: null,
        playerView: null,
        playerAudioLayout: null,
        playerVideoLayout: null,
        playlistContainer: null,
        playlist: null,
        modalPlaylist: null,
        playlistModal: null,
        downloadModal: null,
        closePlaylistModal: null,
        closeDownloadModal: null,
        modalBackdrop: null,
        downloadModalBackdrop: null,
        downloadSingleVideoOption: null,
        downloadAlbumOption: null,
        downloadAllVideosOption: null,
        miniPlayer: null,
        playerBottomBar: null,
        audioPlayer: null,
        videoPlayer: null,
        bgVideoContainer: null,
        bgVideo: null,
        albumArtwork: null,
        playerArtwork: null,
        artworkWrapper: null,
        videoWrapper: null,
        trackTitle: null,
        trackArtist: null,
        miniTitle: null,
        miniLyric: null,
        prevLyric: null,
        currentLyric: null,
        nextLyric: null,
        barProgressContainer: null,
        progressBar: null,
        progressBarFill: null,
        timeTooltip: null,
        playPauseBtn: null,
        playPauseIcon: null,
        prevBtn: null,
        nextBtn: null,
        volumeBar: null,
        volumeMuteBtn: null,
        volumeIcon: null,
        videoOverlay: null,
        videoPlayBtn: null,
        fullscreenBtn: null,
        qualityButtons: null,
        videoExternalControls: null,
        miniArtwork: null,
        miniPrevBtn: null,
        miniPlayPauseBtn: null,
        miniPlayPauseIcon: null,
        miniNextBtn: null,
        miniPlayerProgress: null,
        playAllBtn: null,
        downloadAllVideosBtn: null,
        downloadAlbumBtn: null,
        toast: null
    };

    function init() {
        if (isInitialized) {
            return;
        }

        var playerReady = false;
        var retryCount = 0;
        var maxRetries = 50;
        var initTimeout = null;

        function waitForPlayerReady() {
            if (typeof PlayerEngine !== 'undefined' && PlayerEngine.init) {
                try {
                    PlayerEngine.init();
                    playerReady = true;
                    if (initTimeout) clearTimeout(initTimeout);
                    continueInit();
                } catch (e) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(waitForPlayerReady, 100);
                    } else {
                        if (initTimeout) clearTimeout(initTimeout);
                        continueInit();
                    }
                }
            } else {
                if (retryCount < maxRetries) {
                    retryCount++;
                    setTimeout(waitForPlayerReady, 100);
                } else {
                    if (initTimeout) clearTimeout(initTimeout);
                    continueInit();
                }
            }
        }

        initTimeout = setTimeout(function() {
            if (!playerReady) {
                continueInit();
            }
        }, 5000);

        function continueInit() {
            cacheElements();
            setupEventListeners();
            setupPlayerCallbacks();
            setupLyricsCallbacks();
            setupMediaSession();
            renderPlaylist();
            restoreState();
            handleInitialRoute();
            startVisualUpdateLoop();
            isInitialized = true;
            isAppReady = true;
        }

        waitForPlayerReady();
    }

    function cacheElements() {
        elements.app = document.getElementById('app');
        elements.mainContent = document.getElementById('mainContent');
        elements.backBtn = document.getElementById('backBtn');
        elements.menuBtn = document.getElementById('menuBtn');
        elements.headerInstallBtn = document.getElementById('headerInstallBtn');
        elements.headerDownloadBtn = document.getElementById('headerDownloadBtn');
        elements.headerTrackInfo = document.getElementById('headerTrackInfo');
        elements.headerTitleText = document.getElementById('headerTitleText');
        elements.headerModeSwitch = document.getElementById('headerModeSwitch');
        elements.audioModeBtn = document.getElementById('audioModeBtn');
        elements.videoModeBtn = document.getElementById('videoModeBtn');
        elements.albumView = document.getElementById('albumView');
        elements.playerView = document.getElementById('playerView');
        elements.playerAudioLayout = document.getElementById('playerAudioLayout');
        elements.playerVideoLayout = document.getElementById('playerVideoLayout');
        elements.playAllBtn = document.getElementById('playAllBtn');
        elements.downloadAllVideosBtn = document.getElementById('downloadAllVideosBtn');
        elements.installAppHeroBtn = document.getElementById('installAppHeroBtn');
        elements.downloadAlbumBtn = document.getElementById('downloadAlbumBtn');
        elements.albumArtwork = document.getElementById('albumArtwork');
        elements.playlist = document.getElementById('playlist');
        elements.modalPlaylist = document.getElementById('modalPlaylist');
        elements.playlistModal = document.getElementById('playlistModal');
        elements.downloadModal = document.getElementById('downloadModal');
        elements.closePlaylistModal = document.getElementById('closePlaylistModal');
        elements.closeDownloadModal = document.getElementById('closeDownloadModal');
        elements.modalBackdrop = document.getElementById('modalBackdrop');
        elements.downloadModalBackdrop = document.getElementById('downloadModalBackdrop');
        elements.downloadSingleVideoOption = document.getElementById('downloadSingleVideoOption');
        elements.downloadAlbumOption = document.getElementById('downloadAlbumOption');
        elements.downloadAllVideosOption = document.getElementById('downloadAllVideosOption');
        elements.miniPlayer = document.getElementById('miniPlayer');
        elements.playerBottomBar = document.getElementById('playerBottomBar');
        elements.audioPlayer = document.getElementById('audioPlayer');
        elements.videoPlayer = document.getElementById('videoPlayer');
        elements.bgVideoContainer = document.getElementById('bgVideoContainer');
        elements.bgVideo = document.getElementById('bgVideo');
        elements.playerArtwork = document.getElementById('playerArtwork');
        elements.artworkWrapper = document.getElementById('artworkWrapper');
        elements.videoWrapper = document.getElementById('videoWrapper');
        elements.trackTitle = document.getElementById('trackTitle');
        elements.trackArtist = document.getElementById('trackArtist');
        elements.miniTitle = document.getElementById('miniTitle');
        elements.miniLyric = document.getElementById('miniLyric');
        elements.prevLyric = document.getElementById('prevLyric');
        elements.currentLyric = document.getElementById('currentLyric');
        elements.nextLyric = document.getElementById('nextLyric');
        elements.barProgressContainer = document.querySelector('.bar-progress-container');
        elements.progressBar = document.getElementById('progressBar');
        elements.progressBarFill = document.getElementById('progressBarFill');
        elements.timeTooltip = document.getElementById('timeTooltip');
        elements.playPauseBtn = document.getElementById('playPauseBtn');
        elements.playPauseIcon = document.getElementById('playPauseIcon');
        elements.prevBtn = document.getElementById('prevBtn');
        elements.nextBtn = document.getElementById('nextBtn');
        elements.volumeBar = document.getElementById('volumeBar');
        elements.volumeMuteBtn = document.getElementById('volumeMuteBtn');
        elements.volumeIcon = document.getElementById('volumeIcon');
        elements.videoOverlay = document.getElementById('videoOverlay');
        elements.videoPlayBtn = document.getElementById('videoPlayBtn');
        elements.fullscreenBtn = document.getElementById('fullscreenBtn');
        elements.qualityButtons = document.querySelectorAll('.quality-tag');
        elements.miniArtwork = document.getElementById('miniArtwork');
        elements.miniPrevBtn = document.getElementById('miniPrevBtn');
        elements.miniPlayPauseBtn = document.getElementById('miniPlayPauseBtn');
        elements.miniPlayPauseIcon = document.getElementById('miniPlayPauseIcon');
        elements.miniNextBtn = document.getElementById('miniNextBtn');
        elements.miniPlayerProgress = document.getElementById('miniPlayerProgress');
        elements.toast = document.getElementById('toast');
    }

    function showInstallButtons() {
        if (deferredPrompt) {
            if (elements.headerInstallBtn) elements.headerInstallBtn.classList.remove('hidden');
            if (elements.installAppHeroBtn) elements.installAppHeroBtn.classList.remove('hidden');
        }
    }

    function handleInstallClick() {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(function(choiceResult) {
            deferredPrompt = null;
            if (elements.headerInstallBtn) elements.headerInstallBtn.classList.add('hidden');
            if (elements.installAppHeroBtn) elements.installAppHeroBtn.classList.add('hidden');
        });
    }

    function setupEventListeners() {
        elements.backBtn.addEventListener('click', handleBackButton, { passive: true });

        elements.audioModeBtn.addEventListener('click', function() {
            switchToAudioMode();
        }, { passive: true });
        
        elements.videoModeBtn.addEventListener('click', function() {
            switchToVideoMode();
        }, { passive: true });

        if (elements.headerInstallBtn) {
            elements.headerInstallBtn.addEventListener('click', handleInstallClick, { passive: true });
        }
        if (elements.installAppHeroBtn) {
            elements.installAppHeroBtn.addEventListener('click', handleInstallClick, { passive: true });
        }

        elements.headerDownloadBtn.addEventListener('click', function() {
            showDownloadModal();
        }, { passive: true });

        elements.playAllBtn.addEventListener('click', function() {
            if (!isAppReady || !PlayerEngine.isMediaReady()) {
                showToast('App wird noch initialisiert...');
                return;
            }
            PlaylistManager.setCurrentIndex(0);
            playCurrentTrack('audio');
            showView('player');
        }, { passive: true });

        elements.downloadAllVideosBtn.addEventListener('click', function() {
            if (typeof DownloadManager !== 'undefined' && DownloadManager.triggerDownload) {
                DownloadManager.triggerDownload(
                    DownloadManager.getAllVideosZipUrl(),
                    'Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip'
                );
            }
            showToast('Download gestartet: Alle Videos');
        }, { passive: true });

        elements.downloadAlbumBtn.addEventListener('click', function() {
            if (typeof DownloadManager !== 'undefined' && DownloadManager.triggerDownload) {
                DownloadManager.triggerDownload(
                    DownloadManager.getAlbumDownloadUrl(),
                    'Deus_ex_CT_Complete.zip'
                );
            }
            showToast('Download gestartet: Album');
        }, { passive: true });

        elements.playPauseBtn.addEventListener('click', function() {
            handlePlayPauseClick();
        }, { passive: true });
        
        elements.prevBtn.addEventListener('click', handlePreviousTrack, { passive: true });
        elements.nextBtn.addEventListener('click', handleNextTrack, { passive: true });

        elements.progressBar.addEventListener('input', handleProgressInput, { passive: false });
        elements.progressBar.addEventListener('change', handleProgressChange, { passive: true });
        
        elements.progressBar.addEventListener('touchstart', function(e) {
            isTouchingProgress = true;
            PlayerEngine.startSeek();
        }, { passive: true });
        
        elements.progressBar.addEventListener('touchend', function(e) {
            isTouchingProgress = false;
            var percent = parseFloat(elements.progressBar.value);
            PlayerEngine.seekPercent(percent);
            PlayerEngine.endSeek();
        }, { passive: true });

        elements.barProgressContainer.addEventListener('mousemove', handleProgressHover, { passive: true });
        elements.barProgressContainer.addEventListener('mouseleave', function() {
            elements.timeTooltip.style.opacity = '0';
        }, { passive: true });

        elements.volumeBar.addEventListener('input', function() {
            var volumeValue = parseFloat(this.value) / 100;
            PlayerEngine.setVolume(volumeValue);
            updateVolumeIcon(volumeValue, false);
        }, { passive: true });

        elements.volumeMuteBtn.addEventListener('click', function() {
            var isMuted = PlayerEngine.toggleMute();
            updateVolumeIcon(PlayerEngine.getVolume(), isMuted);
            elements.volumeBar.value = isMuted ? 0 : PlayerEngine.getVolume() * 100;
        }, { passive: true });

        elements.videoPlayBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            handlePlayPauseClick();
        }, { passive: true });

        elements.videoOverlay.addEventListener('click', function(e) {
            if (e.target === elements.videoOverlay) {
                handlePlayPauseClick();
            }
        }, { passive: true });

        elements.fullscreenBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            PlayerEngine.toggleFullscreen();
        }, { passive: true });

        for (var i = 0; i < elements.qualityButtons.length; i++) {
            elements.qualityButtons[i].addEventListener('click', function() {
                var quality = this.getAttribute('data-quality');
                setVideoQuality(quality);
            }, { passive: true });
        }

        elements.miniPlayer.addEventListener('click', function(e) {
            if (!e.target.closest('.mini-btn')) {
                showView('player');
            }
        }, { passive: true });

        elements.miniPrevBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            handlePreviousTrack();
        }, { passive: true });
        
        elements.miniPlayPauseBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            handlePlayPauseClick();
        }, { passive: true });
        
        elements.miniNextBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            handleNextTrack();
        }, { passive: true });

        elements.closePlaylistModal.addEventListener('click', hidePlaylistModal, { passive: true });
        elements.modalBackdrop.addEventListener('click', hidePlaylistModal, { passive: true });
        elements.closeDownloadModal.addEventListener('click', hideDownloadModal, { passive: true });
        elements.downloadModalBackdrop.addEventListener('click', hideDownloadModal, { passive: true });

        elements.downloadSingleVideoOption.addEventListener('click', function() {
            hideDownloadModal();
            showToast('Video-Download gestartet');
        }, { passive: true });

        elements.downloadAlbumOption.addEventListener('click', function() {
            hideDownloadModal();
            showToast('Album-Download gestartet');
        }, { passive: true });

        elements.downloadAllVideosOption.addEventListener('click', function() {
            if (typeof DownloadManager !== 'undefined' && DownloadManager.triggerDownload) {
                DownloadManager.triggerDownload(
                    DownloadManager.getAllVideosZipUrl(),
                    'Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip'
                );
            }
            hideDownloadModal();
            showToast('Download gestartet: Alle Videos');
        }, { passive: true });

        window.addEventListener('hashchange', handleRouteChange, { passive: true });
        document.addEventListener('keydown', handleKeyboardShortcuts, { passive: false });
        
        window.addEventListener('beforeunload', function() {
            if (typeof PlayerEngine !== 'undefined' && PlayerEngine.saveStateToStorage) {
                PlayerEngine.saveStateToStorage();
            }
            if (typeof PlaylistManager !== 'undefined' && PlaylistManager.saveToStorage) {
                PlaylistManager.saveToStorage();
            }
        }, { passive: true });

        document.addEventListener('visibilitychange', handleVisibilityChange, { passive: true });

        window.addEventListener('beforeinstallprompt', function(e) {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButtons();
        }, { passive: true });

        if (elements.playerView) {
            elements.playerView.addEventListener('touchstart', function(e) {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
        }
    }

    function handlePlayPauseClick() {
        if (!isAppReady || !PlayerEngine.isMediaReady()) {
            showToast('Player wird initialisiert...');
            return;
        }

        var currentTrack = PlayerEngine.getCurrentTrack();
        if (!currentTrack) {
            showToast('Kein Track geladen');
            return;
        }

        if (PlayerEngine.getIsPlaying()) {
            PlayerEngine.pause();
        } else {
            playbackRetryCount = 0;
            attemptPlayback();
        }
    }

    function attemptPlayback() {
        var mode = PlayerEngine.getCurrentMode();
        
        PlayerEngine.play().then(function() {
            playbackRetryCount = 0;
        }).catch(function(e) {
            if (playbackRetryCount < maxPlaybackRetries) {
                playbackRetryCount++;
                var delayMs = 300 + (playbackRetryCount * 200);
                setTimeout(attemptPlayback, delayMs);
            } else {
                if (mode === 'video') {
                    showToast('Video-Wiedergabe fehlgeschlagen. Wechsel zu Audio...');
                    setTimeout(function() {
                        switchToAudioMode();
                        PlayerEngine.play().catch(function() {
                            showToast('Wiedergabe fehlgeschlagen. Bitte tippen zum erneuten Versuch.');
                        });
                    }, 500);
                } else {
                    showToast('Wiedergabe fehlgeschlagen. Bitte tippen zum erneuten Versuch.');
                }
            }
        });
    }

    function handleProgressInput(e) {
        PlayerEngine.startSeek();
        var percent = parseFloat(elements.progressBar.value);
        scheduleProgressUpdate(percent);
    }

    function handleProgressChange(e) {
        var percent = parseFloat(elements.progressBar.value);
        PlayerEngine.seekPercent(percent);
        PlayerEngine.endSeek();
    }

    function handleProgressHover(e) {
        var rect = elements.barProgressContainer.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var width = rect.width;
        var percent = Math.max(0, Math.min(100, (x / width) * 100));
        var duration = PlayerEngine.getDuration();
        
        if (duration > 0 && !isNaN(duration)) {
            var time = (percent / 100) * duration;
            elements.timeTooltip.textContent = PlayerEngine.formatTime(time);
            elements.timeTooltip.style.left = percent + '%';
            elements.timeTooltip.style.opacity = '1';
        }
    }

    function scheduleProgressUpdate(percent) {
        if (!progressUpdatePending) {
            progressUpdatePending = true;
            requestAnimationFrame(function() {
                updateProgressBarFill(percent);
                progressUpdatePending = false;
            });
        }
        lastProgressValue = percent;
    }

    function handleVisibilityChange() {
        if (document.hidden) {
            if (typeof PlayerEngine !== 'undefined' && PlayerEngine.saveStateToStorage) {
                PlayerEngine.saveStateToStorage();
            }
        }
    }

    function startVisualUpdateLoop() {
        var lastFrameTime = 0;
        
        function updateLoop(timestamp) {
            if (timestamp - lastFrameTime >= 16) {
                lastFrameTime = timestamp;
                
                if (pendingLyricUpdate && !isUpdatingLyrics) {
                    applyLyricUpdate(pendingLyricUpdate);
                    pendingLyricUpdate = null;
                }
            }
            
            rafId = requestAnimationFrame(updateLoop);
        }
        
        rafId = requestAnimationFrame(updateLoop);
    }

    function stopVisualUpdateLoop() {
        if (rafId) {
            cancelAnimationFrame(rafId);
            rafId = null;
        }
    }

    function setupPlayerCallbacks() {
        PlayerEngine.on('play', function(data) {
            updatePlayPauseButtons(true);
            if (elements.videoOverlay) {
                elements.videoOverlay.style.opacity = '0';
            }
            if (elements.playerView) {
                elements.playerView.classList.remove('paused');
            }
            if (typeof MediaSessionManager !== 'undefined' && MediaSessionManager.setPlaybackState) {
                MediaSessionManager.setPlaybackState('playing');
            }
            playbackRetryCount = 0;
        });

        PlayerEngine.on('pause', function(data) {
            updatePlayPauseButtons(false);
            if (elements.videoOverlay) {
                elements.videoOverlay.style.opacity = '1';
            }
            if (elements.playerView) {
                elements.playerView.classList.add('paused');
            }
            if (typeof MediaSessionManager !== 'undefined' && MediaSessionManager.setPlaybackState) {
                MediaSessionManager.setPlaybackState('paused');
            }
        });

        PlayerEngine.on('timeUpdate', function(data) {
            if (!isTouchingProgress && !PlayerEngine.isCurrentlySeeking()) {
                updateProgress(data.currentTime, data.duration, data.progress);
            }
            updateLyricsDisplay(data.currentTime);
        });

        PlayerEngine.on('ended', function(data) {
            var nextTrack = PlaylistManager.moveToNext();
            if (nextTrack) {
                playTrack(nextTrack, PlayerEngine.getCurrentMode());
            } else {
                updatePlayPauseButtons(false);
                if (typeof MediaSessionManager !== 'undefined' && MediaSessionManager.setPlaybackState) {
                    MediaSessionManager.setPlaybackState('paused');
                }
            }
        });

        PlayerEngine.on('trackChange', function(data) {
            updateTrackDisplay(data.track);
            updateMiniPlayer(data.track);
            loadLyricsForTrack(data.track);
            updateHash();
            if (typeof MediaSessionManager !== 'undefined' && MediaSessionManager.updateMetadata) {
                MediaSessionManager.updateMetadata(data.track);
            }
            resetLyricState();
        });

        PlayerEngine.on('modeChange', function(data) {
            updateHeaderModeSwitch(data.currentMode);
            updatePlayerLayout(data.currentMode);
        });

        PlayerEngine.on('volumeChange', function(data) {
            var volumePercent = data.volume * 100;
            elements.volumeBar.value = volumePercent;
            updateVolumeIcon(data.volume, data.muted);
        });

        PlayerEngine.on('error', function(data) {
            showToast('Fehler beim Abspielen. Bitte erneut versuchen.');
            playbackRetryCount = 0;
        });

        PlayerEngine.on('canPlay', function(data) {
        });

        PlayerEngine.on('waiting', function(data) {
        });
    }

    function setupLyricsCallbacks() {
        if (typeof LyricsManager === 'undefined') return;
        
        LyricsManager.setOnLyricChange(function(data) {
            var prevText = data.prevLine ? data.prevLine.text : '';
            var currText = data.currentLine ? data.currentLine.text : '';
            var nextText = data.nextLine ? data.nextLine.text : '';
            
            if (prevText !== currentPrevLyricText || 
                currText !== currentLyricText || 
                nextText !== currentNextLyricText) {
                
                pendingLyricUpdate = {
                    prev: prevText,
                    current: currText,
                    next: nextText
                };
            }
        });
    }

    function setupMediaSession() {
        if (typeof MediaSessionManager === 'undefined') return;
        
        MediaSessionManager.setActionHandler('play', function() {
            handlePlayPauseClick();
        });
        
        MediaSessionManager.setActionHandler('pause', function() {
            PlayerEngine.pause();
        });
        
        MediaSessionManager.setActionHandler('previoustrack', handlePreviousTrack);
        MediaSessionManager.setActionHandler('nexttrack', handleNextTrack);
        
        MediaSessionManager.setActionHandler('seekbackward', function(details) {
            var skip = details && details.seekOffset ? details.seekOffset : 10;
            PlayerEngine.seekRelative(-skip);
        });
        
        MediaSessionManager.setActionHandler('seekforward', function(details) {
            var skip = details && details.seekOffset ? details.seekOffset : 10;
            PlayerEngine.seekRelative(skip);
        });
        
        MediaSessionManager.setActionHandler('seekto', function(details) {
            if (details && details.seekTime !== undefined) {
                PlayerEngine.seek(details.seekTime);
            }
        });
        
        MediaSessionManager.setActionHandler('stop', function() {
            PlayerEngine.stop();
        });
    }

    function resetLyricState() {
        currentLyricText = '';
        currentPrevLyricText = '';
        currentNextLyricText = '';
        pendingLyricUpdate = null;
        isUpdatingLyrics = false;
        
        if (elements.prevLyric) elements.prevLyric.textContent = '';
        if (elements.currentLyric) elements.currentLyric.textContent = '';
        if (elements.nextLyric) elements.nextLyric.textContent = '';
        if (elements.miniLyric) elements.miniLyric.textContent = '';
    }

    function applyLyricUpdate(update) {
        if (isUpdatingLyrics) return;
        
        isUpdatingLyrics = true;
        
        var hasChange = false;
        
        if (update.prev !== currentPrevLyricText) {
            animateLyricElement(elements.prevLyric, update.prev);
            currentPrevLyricText = update.prev;
            hasChange = true;
        }
        
        if (update.current !== currentLyricText) {
            animateLyricElement(elements.currentLyric, update.current);
            animateLyricElement(elements.miniLyric, update.current);
            currentLyricText = update.current;
            hasChange = true;
        }
        
        if (update.next !== currentNextLyricText) {
            animateLyricElement(elements.nextLyric, update.next);
            currentNextLyricText = update.next;
            hasChange = true;
        }
        
        if (hasChange) {
            setTimeout(function() {
                isUpdatingLyrics = false;
            }, 250);
        } else {
            isUpdatingLyrics = false;
        }
    }

    function animateLyricElement(element, newText) {
        if (!element) return;
        
        if (element.textContent === newText) return;
        
        element.classList.remove('lyric-fade-in');
        element.classList.add('lyric-fade-out');
        
        setTimeout(function() {
            element.textContent = newText;
            element.classList.remove('lyric-fade-out');
            element.classList.add('lyric-fade-in');
            
            setTimeout(function() {
                element.classList.remove('lyric-fade-in');
            }, 200);
        }, 150);
    }

    function restoreState() {
        if (typeof PlaylistManager !== 'undefined' && PlaylistManager.loadFromStorage) {
            PlaylistManager.loadFromStorage();
        }
        
        var volume = PlayerEngine.getVolume();
        var muted = PlayerEngine.isMuted();
        elements.volumeBar.value = muted ? 0 : volume * 100;
        updateVolumeIcon(volume, muted);
        
        var currentTrack = PlaylistManager.getCurrentTrack();
        if (currentTrack) {
            updateTrackDisplay(currentTrack);
            updateMiniPlayer(currentTrack);
        }
    }

    function renderPlaylist() {
        if (typeof PlaylistManager === 'undefined' || !PlaylistManager.getTracks) {
            return;
        }
        
        var tracks = PlaylistManager.getTracks();
        if (!tracks || tracks.length === 0) {
            return;
        }
        
        var html = '';
        for (var i = 0; i < tracks.length; i++) {
            html += createPlaylistItemHTML(tracks[i], i);
        }
        elements.playlist.innerHTML = html;
        setupPlaylistClickListeners();
    }

    function createPlaylistItemHTML(track, index) {
        return '<li class="playlist-item" data-track-id="' + track.id + '">' +
               '<span class="track-number">' + track.number + '</span>' +
               '<div class="playing-indicator">' +
               '<span class="playing-bar"></span><span class="playing-bar"></span><span class="playing-bar"></span>' +
               '</div>' +
               '<img src="' + track.imageSrc + '" class="item-artwork" loading="lazy" decoding="async">' +
               '<div class="item-info">' +
               '<p class="item-title">' + track.title + '</p>' +
               '<p class="item-duration">' + track.duration + '</p>' +
               '</div>' +
               '<div class="item-actions">' +
               '<button class="item-action-btn play-audio-btn"><i class="fas fa-music"></i></button>' +
               '</div>' +
               '</li>';
    }

    function setupPlaylistClickListeners() {
        var items = elements.playlist.querySelectorAll('.playlist-item');
        for (var i = 0; i < items.length; i++) {
            items[i].addEventListener('click', handlePlaylistItemClick, { passive: true });
        }
    }

    function handlePlaylistItemClick(e) {
        var item = e.currentTarget;
        var trackId = parseInt(item.getAttribute('data-track-id'), 10);
        var track = PlaylistManager.playTrackById(trackId);
        if (track) {
            playTrack(track, 'audio');
            showView('player');
        }
    }

    function renderModalPlaylist() {
        if (typeof PlaylistManager === 'undefined') return;
        
        var tracks = PlaylistManager.getPlaylistForDisplay ? PlaylistManager.getPlaylistForDisplay() : PlaylistManager.getTracks();
        var currentTrack = PlayerEngine.getCurrentTrack();
        var html = '';
        
        for (var i = 0; i < tracks.length; i++) {
            var isPlaying = currentTrack && currentTrack.id === tracks[i].id;
            var playingClass = isPlaying ? ' playing' : '';
            html += '<li class="playlist-item' + playingClass + '" data-track-id="' + tracks[i].id + '">' +
                    '<span class="track-number">' + tracks[i].number + '</span>' +
                    '<div class="playing-indicator">' +
                    '<span class="playing-bar"></span><span class="playing-bar"></span><span class="playing-bar"></span>' +
                    '</div>' +
                    '<img src="' + tracks[i].imageSrc + '" class="item-artwork" loading="lazy" decoding="async">' +
                    '<div class="item-info">' +
                    '<p class="item-title">' + tracks[i].title + '</p>' +
                    '<p class="item-duration">' + tracks[i].duration + '</p>' +
                    '</div>' +
                    '</li>';
        }
        
        elements.modalPlaylist.innerHTML = html;
        
        var modalItems = elements.modalPlaylist.querySelectorAll('.playlist-item');
        for (var i = 0; i < modalItems.length; i++) {
            modalItems[i].addEventListener('click', function() {
                var trackId = parseInt(this.getAttribute('data-track-id'), 10);
                var track = PlaylistManager.playTrackById(trackId);
                if (track) {
                    playTrack(track, PlayerEngine.getCurrentMode());
                    hidePlaylistModal();
                }
            }, { passive: true });
        }
    }

    function playTrack(track, mode) {
        if (!track || !PlayerEngine.isMediaReady() || !isAppReady) return;
        
        mode = mode || 'audio';
        
        var currentTrack = PlayerEngine.getCurrentTrack();
        if (currentTrack && currentTrack.id === track.id && (PlayerEngine.getIsPlaying() || PlayerEngine.getPlaybackState() === 'loading')) {
            return;
        }
        
        PlayerEngine.loadTrack(track, mode);
        
        playbackRetryCount = 0;
        attemptPlayback();
        
        updatePlaylistHighlight(track.id);
    }

    function playCurrentTrack(mode) {
        var track = PlaylistManager.getCurrentTrack();
        if (track) {
            playTrack(track, mode);
        }
    }

    function handlePreviousTrack() {
        if (PlayerEngine.getCurrentTime() > 3) {
            PlayerEngine.seek(0);
            return;
        }
        var prevTrack = PlaylistManager.moveToPrevious();
        if (prevTrack) {
            playTrack(prevTrack, PlayerEngine.getCurrentMode());
        }
    }

    function handleNextTrack() {
        var nextTrack = PlaylistManager.moveToNext();
        if (nextTrack) {
            playTrack(nextTrack, PlayerEngine.getCurrentMode());
        }
    }

    function switchToAudioMode() {
        if (PlayerEngine.getCurrentMode() === 'audio') return;
        
        PlayerEngine.switchMode('audio', true).then(function() {
            updatePlayerLayout('audio');
            if (PlayerEngine.getIsPlaying()) {
                attemptPlayback();
            }
        }).catch(function(e) {
            showToast('Wechsel zu Audio-Modus fehlgeschlagen.');
        });
    }

    function switchToVideoMode() {
        if (PlayerEngine.getCurrentMode() === 'video') return;
        
        PlayerEngine.switchMode('video', true).then(function() {
            updatePlayerLayout('video');
            if (PlayerEngine.getIsPlaying()) {
                attemptPlayback();
            }
        }).catch(function(e) {
            showToast('Wechsel zu Video-Modus fehlgeschlagen.');
        });
    }

    function updatePlayerLayout(mode) {
        if (mode === 'video') {
            elements.playerAudioLayout.classList.add('hidden');
            elements.playerVideoLayout.classList.remove('hidden');
        } else {
            elements.playerAudioLayout.classList.remove('hidden');
            elements.playerVideoLayout.classList.add('hidden');
        }
    }

    function setVideoQuality(quality) {
        for (var i = 0; i < elements.qualityButtons.length; i++) {
            var btn = elements.qualityButtons[i];
            if (btn.getAttribute('data-quality') === quality) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }
        PlayerEngine.setQuality(quality);
    }

    function updateProgress(currentTime, duration, progress) {
        if (!progressUpdatePending) {
            progressUpdatePending = true;
            requestAnimationFrame(function() {
                elements.progressBar.value = progress;
                updateProgressBarFill(progress);
                
                if (elements.miniPlayerProgress) {
                    elements.miniPlayerProgress.style.setProperty('--progress', progress + '%');
                }
                
                if (typeof MediaSessionManager !== 'undefined' && MediaSessionManager.updatePositionState) {
                    MediaSessionManager.updatePositionState(duration, currentTime, PlayerEngine.getPlaybackRate());
                }
                progressUpdatePending = false;
            });
        }
    }

    function updateProgressBarFill(progress) {
        if (elements.progressBarFill) {
            elements.progressBarFill.style.width = progress + '%';
        }
    }

    function updatePlayPauseButtons(isPlaying) {
        var iconClass = isPlaying ? 'fa-pause' : 'fa-play';
        
        if (elements.playPauseIcon) {
            elements.playPauseIcon.className = 'fas ' + iconClass;
        }
        if (elements.miniPlayPauseIcon) {
            elements.miniPlayPauseIcon.className = 'fas ' + iconClass;
        }
        
        var videoIcon = elements.videoPlayBtn ? elements.videoPlayBtn.querySelector('i') : null;
        if (videoIcon) {
            videoIcon.className = 'fas ' + iconClass;
        }
    }

    function updateVolumeIcon(volume, muted) {
        var iconClass = 'fa-volume-high';
        if (muted || volume === 0) {
            iconClass = 'fa-volume-xmark';
        } else if (volume < 0.3) {
            iconClass = 'fa-volume-off';
        } else if (volume < 0.7) {
            iconClass = 'fa-volume-low';
        }
        
        if (elements.volumeIcon) {
            elements.volumeIcon.className = 'fas ' + iconClass;
        }
    }

    function updateTrackDisplay(track) {
        if (!track) return;
        
        if (elements.playerArtwork) {
            elements.playerArtwork.src = track.imageSrc;
        }
        if (elements.trackTitle) {
            elements.trackTitle.textContent = track.title;
        }
        if (elements.trackArtist) {
            elements.trackArtist.textContent = 'Deus ex CT';
        }
        
        if (elements.headerTitleText) {
            elements.headerTitleText.textContent = track.title;
        }
        if (elements.headerTrackInfo) {
            elements.headerTrackInfo.classList.remove('hidden');
        }
        
        document.title = track.title + ' - Deus ex CT';
    }

    function updateMiniPlayer(track) {
        if (!track) return;
        
        if (elements.miniArtwork) {
            elements.miniArtwork.src = track.imageSrc;
        }
        if (elements.miniTitle) {
            elements.miniTitle.textContent = track.title;
        }
    }

    function updatePlaylistHighlight(trackId) {
        var items = elements.playlist.querySelectorAll('.playlist-item');
        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            if (parseInt(item.getAttribute('data-track-id'), 10) === trackId) {
                item.classList.add('playing');
            } else {
                item.classList.remove('playing');
            }
        }
    }

    function updateLyricsDisplay(currentTime) {
        if (typeof LyricsManager !== 'undefined' && LyricsManager.updateCurrentLine) {
            LyricsManager.updateCurrentLine(currentTime);
        }
    }

    function loadLyricsForTrack(track) {
        if (!track || !track.lyricsSrc || typeof LyricsManager === 'undefined') return;
        if (LyricsManager.loadLyrics) {
            LyricsManager.loadLyrics(track.lyricsSrc, track.id).catch(function(e) {});
        }
    }

    function updateHeaderModeSwitch(mode) {
        if (mode === 'video') {
            elements.audioModeBtn.classList.remove('active');
            elements.videoModeBtn.classList.add('active');
        } else {
            elements.audioModeBtn.classList.add('active');
            elements.videoModeBtn.classList.remove('active');
        }
    }

    function showView(view) {
        currentView = view;
        
        elements.albumView.classList.add('hidden');
        elements.playerView.classList.add('hidden');
        
        elements.backBtn.classList.add('hidden');
        elements.miniPlayer.classList.add('hidden');
        elements.playerBottomBar.classList.add('hidden');

        if (view === 'album') {
            elements.albumView.classList.remove('hidden');
            if (PlayerEngine.getCurrentTrack()) {
                elements.miniPlayer.classList.remove('hidden');
            }
        } else if (view === 'player' || view === 'video') {
            elements.playerView.classList.remove('hidden');
            elements.backBtn.classList.remove('hidden');
            elements.playerBottomBar.classList.remove('hidden');
            
            var mode = PlayerEngine.getCurrentMode();
            updatePlayerLayout(mode);
            updateHeaderModeSwitch(mode);
        }
        
        updateHash();
    }

    function handleBackButton() {
        showView('album');
    }

    function showPlaylistModal() {
        renderModalPlaylist();
        elements.playlistModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function hidePlaylistModal() {
        elements.playlistModal.classList.add('hidden');
        document.body.style.overflow = '';
    }

    function showDownloadModal() {
        var track = PlayerEngine.getCurrentTrack();
        
        if (track) {
            elements.downloadSingleVideoOption.classList.remove('hidden');
            if (typeof DownloadManager !== 'undefined' && DownloadManager.getVideoDownloadUrl && DownloadManager.getVideoFileName) {
                var videoUrl = DownloadManager.getVideoDownloadUrl(track, 'high');
                var fileName = DownloadManager.getVideoFileName(track, 'high');
                elements.downloadSingleVideoOption.href = videoUrl;
                elements.downloadSingleVideoOption.setAttribute('download', fileName);
            }
        } else {
            elements.downloadSingleVideoOption.classList.add('hidden');
        }
        
        if (typeof DownloadManager !== 'undefined') {
            if (DownloadManager.getAlbumDownloadUrl) {
                elements.downloadAlbumOption.href = DownloadManager.getAlbumDownloadUrl();
            }
            if (DownloadManager.getAllVideosZipUrl) {
                elements.downloadAllVideosOption.href = DownloadManager.getAllVideosZipUrl();
            }
        }
        
        elements.downloadModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function hideDownloadModal() {
        elements.downloadModal.classList.add('hidden');
        document.body.style.overflow = '';
    }

    function showToast(message, duration) {
        duration = duration || 3000;
        elements.toast.textContent = message;
        elements.toast.classList.add('visible');
        
        setTimeout(function() {
            elements.toast.classList.remove('visible');
        }, duration);
    }

    function updateHash() {
        var hash = '';
        var track = PlayerEngine.getCurrentTrack();
        
        if (currentView === 'album') {
            hash = '';
        } else if (currentView === 'player' || currentView === 'video') {
            if (track) {
                var trackSlug = track.slug || track.title.toLowerCase().replace(/\s+/g, '-');
                hash = '#/track/' + trackSlug;
            } else {
                hash = '#/player';
            }
        }
        
        if (window.location.hash !== hash) {
            history.replaceState(null, '', window.location.pathname + hash);
        }
    }

    function handleRouteChange() {
        parseRoute(window.location.hash);
    }

    function handleInitialRoute() {
        parseRoute(window.location.hash);
    }

    function parseRoute(hash) {
        if (!hash || hash === '#/') {
            showView('album');
            return;
        }
        
        var parts = hash.replace('#/', '').split('/');
        var route = parts[0];
        var slug = parts[1];
        
        if (route === 'track' || route === 'video') {
            if (slug) {
                var track = null;
                if (typeof PlaylistManager !== 'undefined' && PlaylistManager.getTrackBySlug) {
                    track = PlaylistManager.getTrackBySlug(slug);
                }
                
                if (!track && typeof PlaylistManager !== 'undefined' && PlaylistManager.getTracks) {
                    var tracks = PlaylistManager.getTracks();
                    for (var i = 0; i < tracks.length; i++) {
                        var trackSlug = tracks[i].slug || tracks[i].title.toLowerCase().replace(/\s+/g, '-');
                        if (trackSlug === slug) {
                            track = tracks[i];
                            break;
                        }
                    }
                }
                
                if (track) {
                    if (typeof PlaylistManager !== 'undefined' && PlaylistManager.playTrackById) {
                        PlaylistManager.playTrackById(track.id);
                    }
                    playTrack(track, 'audio');
                }
            }
            showView('player');
        } else {
            showView('album');
        }
    }

    function handleKeyboardShortcuts(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
        
        if (e.key === ' ') {
            e.preventDefault();
            handlePlayPauseClick();
        } else if (e.key === 'ArrowLeft') {
            e.preventDefault();
            PlayerEngine.seekRelative(-10);
        } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            PlayerEngine.seekRelative(10);
        } else if (e.key === 'f' || e.key === 'F') {
            if (PlayerEngine.getCurrentMode() === 'video') {
                PlayerEngine.toggleFullscreen();
            }
        } else if (e.key === 'Escape') {
            if (PlayerEngine.isFullscreen()) {
                PlayerEngine.exitFullscreen();
            } else if (!elements.playlistModal.classList.contains('hidden')) {
                hidePlaylistModal();
            } else if (!elements.downloadModal.classList.contains('hidden')) {
                hideDownloadModal();
            }
        } else if (e.key === 'm' || e.key === 'M') {
            PlayerEngine.toggleMute();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            var vol = Math.min(1, PlayerEngine.getVolume() + 0.1);
            PlayerEngine.setVolume(vol);
            elements.volumeBar.value = vol * 100;
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            var vol = Math.max(0, PlayerEngine.getVolume() - 0.1);
            PlayerEngine.setVolume(vol);
            elements.volumeBar.value = vol * 100;
        }
    }

    document.addEventListener('DOMContentLoaded', init);

    return {
        init: init,
        showView: showView,
        playTrack: playTrack,
        showToast: showToast
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = App;
}
```

 
--- 

/js\download.js:

```js
const DownloadManager = (function() {
    var activeDownloads = {};
    var downloadHistory = [];
    var onProgressCallback = null;
    var onCompleteCallback = null;
    var onErrorCallback = null;
    var maxConcurrentDownloads = 3;
    var downloadQueue = [];
    var isProcessingQueue = false;

    var albumDownloadUrl = 'assets/downloads/Deus_ex_CT_Complete.zip';
    var albumFileName = 'Deus_ex_CT_Complete.zip';
    
    var allVideosZipUrl = 'assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip';
    var allVideosFileName = 'Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip';

    function generateVideoFileName(track, quality) {
        var qualityLabels = {
            low: 'LOW',
            mid: 'MID',
            high: 'HQ'
        };

        var qualityLabel = qualityLabels[quality];
        if (!qualityLabel) {
            qualityLabel = 'MID';
        }

        var sanitizedTitle = sanitizeFileName(track.title);
        return 'Deus_ex_CT_' + track.number + '_' + sanitizedTitle + '_' + qualityLabel + '.mp4';
    }

    function sanitizeFileName(name) {
        var result = name;
        result = result.replace(/[Ã¤Ã„]/g, 'ae');
        result = result.replace(/[Ã¶Ã–]/g, 'oe');
        result = result.replace(/[Ã¼Ãœ]/g, 'ue');
        result = result.replace(/[ÃŸ]/g, 'ss');
        result = result.replace(/[^a-zA-Z0-9\-_]/g, '_');
        result = result.replace(/_+/g, '_');
        result = result.replace(/^_|_$/g, '');
        return result;
    }

    function downloadAlbum() {
        return downloadFile(albumDownloadUrl, albumFileName, 'album', null);
    }
    
    function downloadAllVideos() {
        return downloadFile(allVideosZipUrl, allVideosFileName, 'all_videos', null);
    }

    function downloadVideo(track, quality) {
        if (!track || !track.videoSrc) {
            return Promise.reject(new Error('Invalid track or no video source'));
        }

        if (!quality) {
            quality = 'high';
        }

        var videoUrl = track.videoSrc[quality];
        if (!videoUrl) {
            videoUrl = track.videoSrc.high;
        }
        if (!videoUrl) {
            videoUrl = track.videoSrc.mid;
        }
        if (!videoUrl) {
            videoUrl = track.videoSrc.low;
        }

        var fileName = generateVideoFileName(track, quality);

        return downloadFile(videoUrl, fileName, 'video', track.id);
    }

    function downloadFile(url, fileName, type, trackId) {
        return new Promise(function(resolve, reject) {
            var downloadId = generateDownloadId();

            if (Object.keys(activeDownloads).length >= maxConcurrentDownloads) {
                downloadQueue.push({
                    url: url,
                    fileName: fileName,
                    type: type,
                    trackId: trackId,
                    resolve: resolve,
                    reject: reject
                });
                processQueue();
                return;
            }

            executeDownload(url, fileName, type, trackId, downloadId, resolve, reject);
        });
    }

    function executeDownload(url, fileName, type, trackId, downloadId, resolve, reject) {
        activeDownloads[downloadId] = {
            id: downloadId,
            url: url,
            fileName: fileName,
            type: type,
            trackId: trackId,
            progress: 0,
            status: 'starting',
            startTime: Date.now()
        };

        if (onProgressCallback) {
            onProgressCallback({
                id: downloadId,
                fileName: fileName,
                progress: 0,
                status: 'starting'
            });
        }

        if (supportsDirectDownload()) {
            directDownload(url, fileName, downloadId, resolve, reject);
        } else {
            fetchDownload(url, fileName, downloadId, resolve, reject);
        }
    }

    function supportsDirectDownload() {
        var a = document.createElement('a');
        return typeof a.download !== 'undefined';
    }

    function directDownload(url, fileName, downloadId, resolve, reject) {
        var link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.style.display = 'none';

        document.body.appendChild(link);

        activeDownloads[downloadId].status = 'downloading';

        if (onProgressCallback) {
            onProgressCallback({
                id: downloadId,
                fileName: fileName,
                progress: 50,
                status: 'downloading'
            });
        }

        try {
            link.click();

            setTimeout(function() {
                document.body.removeChild(link);

                activeDownloads[downloadId].status = 'complete';
                activeDownloads[downloadId].progress = 100;
                activeDownloads[downloadId].endTime = Date.now();

                var downloadInfo = {};
                for (var key in activeDownloads[downloadId]) {
                    if (activeDownloads[downloadId].hasOwnProperty(key)) {
                        downloadInfo[key] = activeDownloads[downloadId][key];
                    }
                }
                downloadHistory.push(downloadInfo);

                if (onCompleteCallback) {
                    onCompleteCallback({
                        id: downloadId,
                        fileName: fileName,
                        status: 'complete'
                    });
                }

                if (onProgressCallback) {
                    onProgressCallback({
                        id: downloadId,
                        fileName: fileName,
                        progress: 100,
                        status: 'complete'
                    });
                }

                delete activeDownloads[downloadId];
                processQueue();

                resolve({
                    success: true,
                    downloadId: downloadId,
                    fileName: fileName
                });
            }, 1000);
        } catch (error) {
            document.body.removeChild(link);
            handleDownloadError(downloadId, fileName, error, reject);
        }
    }

    function fetchDownload(url, fileName, downloadId, resolve, reject) {
        activeDownloads[downloadId].status = 'downloading';

        fetch(url)
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.status);
                }

                var contentLength = response.headers.get('content-length');
                var total = 0;
                if (contentLength) {
                    total = parseInt(contentLength, 10);
                }
                var loaded = 0;

                var reader = response.body.getReader();
                var chunks = [];

                function read() {
                    return reader.read().then(function(result) {
                        if (result.done) {
                            return new Blob(chunks);
                        }

                        chunks.push(result.value);
                        loaded = loaded + result.value.length;

                        if (total > 0) {
                            var progress = Math.round((loaded / total) * 100);
                            activeDownloads[downloadId].progress = progress;

                            if (onProgressCallback) {
                                onProgressCallback({
                                    id: downloadId,
                                    fileName: fileName,
                                    progress: progress,
                                    loaded: loaded,
                                    total: total,
                                    status: 'downloading'
                                });
                            }
                        }

                        return read();
                    });
                }

                return read();
            })
            .then(function(blob) {
                var blobUrl = URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = blobUrl;
                link.download = fileName;
                link.style.display = 'none';

                document.body.appendChild(link);
                link.click();

                setTimeout(function() {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(blobUrl);
                }, 100);

                activeDownloads[downloadId].status = 'complete';
                activeDownloads[downloadId].progress = 100;
                activeDownloads[downloadId].endTime = Date.now();

                var downloadInfo = {};
                for (var key in activeDownloads[downloadId]) {
                    if (activeDownloads[downloadId].hasOwnProperty(key)) {
                        downloadInfo[key] = activeDownloads[downloadId][key];
                    }
                }
                downloadHistory.push(downloadInfo);

                if (onCompleteCallback) {
                    onCompleteCallback({
                        id: downloadId,
                        fileName: fileName,
                        status: 'complete'
                    });
                }

                if (onProgressCallback) {
                    onProgressCallback({
                        id: downloadId,
                        fileName: fileName,
                        progress: 100,
                        status: 'complete'
                    });
                }

                delete activeDownloads[downloadId];
                processQueue();

                resolve({
                    success: true,
                    downloadId: downloadId,
                    fileName: fileName
                });
            })
            .catch(function(error) {
                handleDownloadError(downloadId, fileName, error, reject);
            });
    }

    function handleDownloadError(downloadId, fileName, error, reject) {
        activeDownloads[downloadId].status = 'error';
        activeDownloads[downloadId].error = error.message;
        activeDownloads[downloadId].endTime = Date.now();

        var downloadInfo = {};
        for (var key in activeDownloads[downloadId]) {
            if (activeDownloads[downloadId].hasOwnProperty(key)) {
                downloadInfo[key] = activeDownloads[downloadId][key];
            }
        }
        downloadHistory.push(downloadInfo);

        if (onErrorCallback) {
            onErrorCallback({
                id: downloadId,
                fileName: fileName,
                error: error.message,
                status: 'error'
            });
        }

        if (onProgressCallback) {
            onProgressCallback({
                id: downloadId,
                fileName: fileName,
                progress: 0,
                status: 'error',
                error: error.message
            });
        }

        delete activeDownloads[downloadId];
        processQueue();

        reject({
            success: false,
            downloadId: downloadId,
            fileName: fileName,
            error: error.message
        });
    }

    function processQueue() {
        if (isProcessingQueue) {
            return;
        }

        if (downloadQueue.length === 0) {
            return;
        }

        if (Object.keys(activeDownloads).length >= maxConcurrentDownloads) {
            return;
        }

        isProcessingQueue = true;

        while (downloadQueue.length > 0 && Object.keys(activeDownloads).length < maxConcurrentDownloads) {
            var item = downloadQueue.shift();
            var downloadId = generateDownloadId();
            executeDownload(
                item.url,
                item.fileName,
                item.type,
                item.trackId,
                downloadId,
                item.resolve,
                item.reject
            );
        }

        isProcessingQueue = false;
    }

    function generateDownloadId() {
        return 'dl_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function cancelDownload(downloadId) {
        if (activeDownloads[downloadId]) {
            activeDownloads[downloadId].status = 'cancelled';
            activeDownloads[downloadId].endTime = Date.now();

            var downloadInfo = {};
            for (var key in activeDownloads[downloadId]) {
                if (activeDownloads[downloadId].hasOwnProperty(key)) {
                    downloadInfo[key] = activeDownloads[downloadId][key];
                }
            }
            downloadHistory.push(downloadInfo);

            delete activeDownloads[downloadId];

            if (onProgressCallback) {
                onProgressCallback({
                    id: downloadId,
                    status: 'cancelled'
                });
            }

            return true;
        }

        var queueIndex = -1;
        for (var i = 0; i < downloadQueue.length; i++) {
            if (downloadQueue[i].downloadId === downloadId) {
                queueIndex = i;
                break;
            }
        }

        if (queueIndex !== -1) {
            var item = downloadQueue.splice(queueIndex, 1)[0];
            item.reject({
                success: false,
                error: 'Cancelled'
            });
            return true;
        }

        return false;
    }

    function cancelAllDownloads() {
        var downloadIds = Object.keys(activeDownloads);
        for (var i = 0; i < downloadIds.length; i++) {
            cancelDownload(downloadIds[i]);
        }

        for (var j = 0; j < downloadQueue.length; j++) {
            downloadQueue[j].reject({
                success: false,
                error: 'Cancelled'
            });
        }
        downloadQueue = [];
    }

    function getActiveDownloads() {
        var result = [];
        for (var key in activeDownloads) {
            if (activeDownloads.hasOwnProperty(key)) {
                result.push(activeDownloads[key]);
            }
        }
        return result;
    }

    function getDownloadHistory() {
        var result = [];
        for (var i = 0; i < downloadHistory.length; i++) {
            result.push(downloadHistory[i]);
        }
        return result;
    }

    function clearDownloadHistory() {
        downloadHistory = [];
    }

    function getQueueLength() {
        return downloadQueue.length;
    }

    function getActiveCount() {
        return Object.keys(activeDownloads).length;
    }

    function setMaxConcurrentDownloads(max) {
        if (max > 0 && max <= 10) {
            maxConcurrentDownloads = max;
            processQueue();
        }
    }

    function onProgress(callback) {
        onProgressCallback = callback;
    }

    function onComplete(callback) {
        onCompleteCallback = callback;
    }

    function onError(callback) {
        onErrorCallback = callback;
    }

    function getVideoDownloadUrl(track, quality) {
        if (!track || !track.videoSrc) {
            return null;
        }

        if (!quality) {
            quality = 'high';
        }

        var videoUrl = track.videoSrc[quality];
        if (!videoUrl) {
            videoUrl = track.videoSrc.high;
        }
        if (!videoUrl) {
            videoUrl = track.videoSrc.mid;
        }
        if (!videoUrl) {
            videoUrl = track.videoSrc.low;
        }

        return videoUrl;
    }

    function getAlbumDownloadUrl() {
        return albumDownloadUrl;
    }
    
    function getAllVideosZipUrl() {
        return allVideosZipUrl;
    }

    function openInNewTab(url) {
        var newWindow = window.open(url, '_blank');
        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
            window.location.href = url;
        }
    }

    function downloadVideoInNewTab(track, quality) {
        var url = getVideoDownloadUrl(track, quality);
        if (url) {
            openInNewTab(url);
            return true;
        }
        return false;
    }

    function downloadAlbumInNewTab() {
        openInNewTab(albumDownloadUrl);
        return true;
    }

    function createDownloadLink(url, fileName) {
        var link = document.createElement('a');
        link.href = url;
        if (fileName) {
            link.download = fileName;
        } else {
            link.download = '';
        }
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        return link;
    }

    function triggerDownload(url, fileName) {
        var link = createDownloadLink(url, fileName);
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        setTimeout(function() {
            document.body.removeChild(link);
        }, 100);
    }

    function isDownloading() {
        return Object.keys(activeDownloads).length > 0;
    }

    function getDownloadById(downloadId) {
        if (activeDownloads[downloadId]) {
            return activeDownloads[downloadId];
        }
        return null;
    }

    function formatFileSize(bytes) {
        if (bytes === 0) {
            return '0 Bytes';
        }

        var k = 1024;
        var sizes = ['Bytes', 'KB', 'MB', 'GB'];
        var i = Math.floor(Math.log(bytes) / Math.log(k));

        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function estimateDownloadTime(bytes, bytesPerSecond) {
        if (!bytesPerSecond || bytesPerSecond <= 0) {
            return 'Unbekannt';
        }

        var seconds = bytes / bytesPerSecond;

        if (seconds < 60) {
            return Math.round(seconds) + ' Sek.';
        } else if (seconds < 3600) {
            return Math.round(seconds / 60) + ' Min.';
        } else {
            return Math.round(seconds / 3600) + ' Std.';
        }
    }

    function getVideoFileName(track, quality) {
        if (!track) {
            return null;
        }
        return generateVideoFileName(track, quality);
    }

    function getQualityLabel(quality) {
        var qualityLabels = {
            low: 'LOW',
            mid: 'MID',
            high: 'HQ'
        };

        var label = qualityLabels[quality];
        if (!label) {
            label = 'MID';
        }

        return label;
    }

    return {
        downloadAlbum: downloadAlbum,
        downloadAllVideos: downloadAllVideos,
        downloadVideo: downloadVideo,
        downloadFile: downloadFile,
        cancelDownload: cancelDownload,
        cancelAllDownloads: cancelAllDownloads,
        getActiveDownloads: getActiveDownloads,
        getDownloadHistory: getDownloadHistory,
        clearDownloadHistory: clearDownloadHistory,
        getQueueLength: getQueueLength,
        getActiveCount: getActiveCount,
        setMaxConcurrentDownloads: setMaxConcurrentDownloads,
        onProgress: onProgress,
        onComplete: onComplete,
        onError: onError,
        getVideoDownloadUrl: getVideoDownloadUrl,
        getAlbumDownloadUrl: getAlbumDownloadUrl,
        getAllVideosZipUrl: getAllVideosZipUrl,
        downloadVideoInNewTab: downloadVideoInNewTab,
        downloadAlbumInNewTab: downloadAlbumInNewTab,
        triggerDownload: triggerDownload,
        isDownloading: isDownloading,
        getDownloadById: getDownloadById,
        formatFileSize: formatFileSize,
        estimateDownloadTime: estimateDownloadTime,
        getVideoFileName: getVideoFileName,
        getQualityLabel: getQualityLabel
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = DownloadManager;
}
```

 
--- 

/js\lyrics.js:

```js
const LyricsManager = (function() {
    let currentLyrics = [];
    let currentTrackId = null;
    let lyricsCache = {};
    let currentLineIndex = -1;
    let onLyricChangeCallback = null;
    let onFullLyricsLoadedCallback = null;
    let lastUpdateTime = -1;
    let isLoading = false;
    let loadingPromise = null;

    function parseLRC(lrcContent) {
        const lines = lrcContent.split('\n');
        const lyrics = [];
        const metadata = {};
        const timeRegex = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;
        const metaRegex = /\[([a-z]{2}):(.+)\]/i;

        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;

            const metaMatch = line.match(metaRegex);
            if (metaMatch && !line.match(timeRegex)) {
                metadata[metaMatch[1].toLowerCase()] = metaMatch[2].trim();
                continue;
            }

            let match;
            const timestamps = [];
            let text = line;

            timeRegex.lastIndex = 0;

            while ((match = timeRegex.exec(line)) !== null) {
                const minutes = parseInt(match[1], 10);
                const seconds = parseInt(match[2], 10);
                let milliseconds = parseInt(match[3], 10);
                if (match[3].length === 2) {
                    milliseconds = milliseconds * 10;
                }
                timestamps.push(minutes * 60 + seconds + milliseconds / 1000);
                text = text.replace(match[0], '');
            }

            text = text.trim();

            for (let j = 0; j < timestamps.length; j++) {
                if (text || timestamps.length === 1) {
                    lyrics.push({
                        time: timestamps[j],
                        text: text,
                        index: lyrics.length
                    });
                }
            }
        }

        lyrics.sort(function(a, b) {
            return a.time - b.time;
        });

        for (let i = 0; i < lyrics.length; i++) {
            lyrics[i].index = i;
            lyrics[i].endTime = i < lyrics.length - 1 ? lyrics[i + 1].time : lyrics[i].time + 10;
        }

        return {
            metadata: metadata,
            lyrics: lyrics
        };
    }

    function loadLyrics(url, trackId) {
        if (lyricsCache[trackId]) {
            currentLyrics = lyricsCache[trackId].lyrics;
            currentTrackId = trackId;
            currentLineIndex = -1;
            lastUpdateTime = -1;
            if (onFullLyricsLoadedCallback) {
                onFullLyricsLoadedCallback(lyricsCache[trackId]);
            }
            return Promise.resolve(lyricsCache[trackId]);
        }

        if (isLoading && loadingPromise) {
            return loadingPromise;
        }

        isLoading = true;

        loadingPromise = new Promise(function(resolve, reject) {
            const controller = new AbortController();
            const timeoutId = setTimeout(function() {
                controller.abort();
            }, 10000);

            fetch(url, { signal: controller.signal })
                .then(function(response) {
                    clearTimeout(timeoutId);
                    if (!response.ok) {
                        throw new Error('Failed to load lyrics: ' + response.status);
                    }
                    return response.text();
                })
                .then(function(lrcContent) {
                    const parsed = parseLRC(lrcContent);
                    lyricsCache[trackId] = parsed;
                    currentLyrics = parsed.lyrics;
                    currentTrackId = trackId;
                    currentLineIndex = -1;
                    lastUpdateTime = -1;
                    isLoading = false;
                    loadingPromise = null;
                    if (onFullLyricsLoadedCallback) {
                        onFullLyricsLoadedCallback(parsed);
                    }
                    resolve(parsed);
                })
                .catch(function(error) {
                    clearTimeout(timeoutId);
                    currentLyrics = [];
                    currentTrackId = trackId;
                    currentLineIndex = -1;
                    lastUpdateTime = -1;
                    isLoading = false;
                    loadingPromise = null;
                    reject(error);
                });
        });

        return loadingPromise;
    }

    function binarySearchLineIndex(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return -1;
        }

        if (currentTime < currentLyrics[0].time) {
            return -1;
        }

        if (currentTime >= currentLyrics[currentLyrics.length - 1].time) {
            return currentLyrics.length - 1;
        }

        let low = 0;
        let high = currentLyrics.length - 1;
        let result = -1;

        while (low <= high) {
            const mid = Math.floor((low + high) / 2);
            
            if (currentLyrics[mid].time <= currentTime) {
                result = mid;
                low = mid + 1;
            } else {
                high = mid - 1;
            }
        }

        return result;
    }

    function findLineIndexAtTime(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return -1;
        }

        if (currentLineIndex >= 0 && currentLineIndex < currentLyrics.length) {
            const current = currentLyrics[currentLineIndex];
            if (currentTime >= current.time && currentTime < current.endTime) {
                return currentLineIndex;
            }

            if (currentLineIndex < currentLyrics.length - 1) {
                const next = currentLyrics[currentLineIndex + 1];
                if (currentTime >= next.time && currentTime < next.endTime) {
                    return currentLineIndex + 1;
                }
            }

            if (currentLineIndex > 0) {
                const prev = currentLyrics[currentLineIndex - 1];
                if (currentTime >= prev.time && currentTime < prev.endTime) {
                    return currentLineIndex - 1;
                }
            }
        }

        return binarySearchLineIndex(currentTime);
    }

    function getCurrentLine(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return null;
        }

        const index = findLineIndexAtTime(currentTime);
        return index >= 0 ? currentLyrics[index] : null;
    }

    function getNextLine(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return null;
        }

        const currentIndex = findLineIndexAtTime(currentTime);
        
        if (currentIndex === -1) {
            return currentLyrics[0];
        }
        
        if (currentIndex < currentLyrics.length - 1) {
            return currentLyrics[currentIndex + 1];
        }

        return null;
    }

    function getPrevLine(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return null;
        }

        const currentIndex = findLineIndexAtTime(currentTime);
        
        if (currentIndex > 0) {
            return currentLyrics[currentIndex - 1];
        }

        return null;
    }

    function getLineAtIndex(index) {
        if (!currentLyrics || index < 0 || index >= currentLyrics.length) {
            return null;
        }
        return currentLyrics[index];
    }

    function getAllLines() {
        return currentLyrics ? currentLyrics.slice() : [];
    }

    function getLineCount() {
        return currentLyrics ? currentLyrics.length : 0;
    }

    function updateCurrentLine(currentTime) {
        if (Math.abs(currentTime - lastUpdateTime) < 0.016) {
            return {
                changed: false,
                prevLine: currentLineIndex > 0 ? currentLyrics[currentLineIndex - 1] : null,
                currentLine: currentLineIndex >= 0 ? currentLyrics[currentLineIndex] : null,
                nextLine: currentLineIndex >= 0 && currentLineIndex < currentLyrics.length - 1 ? currentLyrics[currentLineIndex + 1] : null,
                index: currentLineIndex
            };
        }

        lastUpdateTime = currentTime;
        const newIndex = findLineIndexAtTime(currentTime);

        if (newIndex !== currentLineIndex) {
            const oldIndex = currentLineIndex;
            currentLineIndex = newIndex;

            const prevLine = newIndex > 0 ? currentLyrics[newIndex - 1] : null;
            const currentLine = newIndex >= 0 ? currentLyrics[newIndex] : null;
            const nextLine = newIndex >= 0 && newIndex < currentLyrics.length - 1 ? currentLyrics[newIndex + 1] : null;

            if (onLyricChangeCallback) {
                onLyricChangeCallback({
                    prevLine: prevLine,
                    currentLine: currentLine,
                    nextLine: nextLine,
                    currentIndex: newIndex,
                    previousIndex: oldIndex,
                    totalLines: currentLyrics.length
                });
            }

            return {
                changed: true,
                prevLine: prevLine,
                currentLine: currentLine,
                nextLine: nextLine,
                index: newIndex
            };
        }

        return {
            changed: false,
            prevLine: newIndex > 0 ? currentLyrics[newIndex - 1] : null,
            currentLine: newIndex >= 0 ? currentLyrics[newIndex] : null,
            nextLine: newIndex >= 0 && newIndex < currentLyrics.length - 1 ? currentLyrics[newIndex + 1] : null,
            index: newIndex
        };
    }

    function seekToLine(index) {
        if (!currentLyrics || index < 0 || index >= currentLyrics.length) {
            return null;
        }
        currentLineIndex = index;
        lastUpdateTime = -1;
        return currentLyrics[index].time;
    }

    function getTimeForLine(index) {
        if (!currentLyrics || index < 0 || index >= currentLyrics.length) {
            return -1;
        }
        return currentLyrics[index].time;
    }

    function setOnLyricChange(callback) {
        onLyricChangeCallback = callback;
    }

    function setOnFullLyricsLoaded(callback) {
        onFullLyricsLoadedCallback = callback;
    }

    function reset() {
        currentLineIndex = -1;
        lastUpdateTime = -1;
    }

    function clear() {
        currentLyrics = [];
        currentTrackId = null;
        currentLineIndex = -1;
        lastUpdateTime = -1;
        isLoading = false;
        loadingPromise = null;
    }

    function clearCache() {
        lyricsCache = {};
    }

    function preloadLyrics(tracks) {
        const promises = [];
        for (let i = 0; i < tracks.length; i++) {
            const track = tracks[i];
            if (!lyricsCache[track.id] && track.lyricsSrc) {
                const promise = fetch(track.lyricsSrc)
                    .then(function(response) {
                        return response.text();
                    })
                    .then(function(lrcContent) {
                        const parsed = parseLRC(lrcContent);
                        lyricsCache[track.id] = parsed;
                        return parsed;
                    })
                    .catch(function() {
                        return null;
                    });
                promises.push(promise);
            }
        }
        return Promise.all(promises);
    }

    function preloadSingleTrack(track) {
        if (!track || !track.lyricsSrc || lyricsCache[track.id]) {
            return Promise.resolve(lyricsCache[track.id] || null);
        }

        return fetch(track.lyricsSrc)
            .then(function(response) {
                return response.text();
            })
            .then(function(lrcContent) {
                const parsed = parseLRC(lrcContent);
                lyricsCache[track.id] = parsed;
                return parsed;
            })
            .catch(function() {
                return null;
            });
    }

    function getCurrentTrackId() {
        return currentTrackId;
    }

    function hasLyrics() {
        return currentLyrics && currentLyrics.length > 0;
    }

    function getMetadata() {
        if (currentTrackId && lyricsCache[currentTrackId]) {
            return lyricsCache[currentTrackId].metadata;
        }
        return {};
    }

    function searchLyrics(query) {
        if (!currentLyrics || !query) {
            return [];
        }

        const lowerQuery = query.toLowerCase();
        const results = [];

        for (let i = 0; i < currentLyrics.length; i++) {
            if (currentLyrics[i].text.toLowerCase().indexOf(lowerQuery) !== -1) {
                results.push({
                    line: currentLyrics[i],
                    index: i
                });
            }
        }

        return results;
    }

    function getLyricsAroundTime(currentTime, before, after) {
        before = before !== undefined ? before : 2;
        after = after !== undefined ? after : 2;

        const currentIndex = findLineIndexAtTime(currentTime);
        const result = {
            before: [],
            current: null,
            after: []
        };

        if (currentIndex === -1 || !currentLyrics) {
            return result;
        }

        result.current = currentLyrics[currentIndex];

        const startBefore = Math.max(0, currentIndex - before);
        for (let i = startBefore; i < currentIndex; i++) {
            result.before.push(currentLyrics[i]);
        }

        const endAfter = Math.min(currentLyrics.length - 1, currentIndex + after);
        for (let i = currentIndex + 1; i <= endAfter; i++) {
            result.after.push(currentLyrics[i]);
        }

        return result;
    }

    function formatLyricsAsText() {
        if (!currentLyrics || currentLyrics.length === 0) {
            return '';
        }

        let text = '';
        for (let i = 0; i < currentLyrics.length; i++) {
            if (currentLyrics[i].text) {
                text += currentLyrics[i].text + '\n';
            }
        }
        return text.trim();
    }

    function formatLyricsAsHTML(currentTime) {
        if (!currentLyrics || currentLyrics.length === 0) {
            return '';
        }

        const currentIndex = findLineIndexAtTime(currentTime || 0);
        let html = '';

        for (let i = 0; i < currentLyrics.length; i++) {
            let className = 'lyrics-line';
            if (i === currentIndex) {
                className += ' active';
            } else if (i < currentIndex) {
                className += ' past';
            }
            html += '<p class="' + className + '" data-index="' + i + '" data-time="' + currentLyrics[i].time + '">';
            html += escapeHTML(currentLyrics[i].text) || 'â™ª';
            html += '</p>';
        }

        return html;
    }

    function escapeHTML(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function getProgressInLine(currentTime) {
        const currentIndex = findLineIndexAtTime(currentTime);
        if (currentIndex === -1 || !currentLyrics[currentIndex]) {
            return 0;
        }

        const line = currentLyrics[currentIndex];
        const duration = line.endTime - line.time;
        
        if (duration <= 0) {
            return 1;
        }

        const progress = (currentTime - line.time) / duration;
        return Math.max(0, Math.min(1, progress));
    }

    function estimateReadingProgress(currentTime, totalDuration) {
        if (!currentLyrics || currentLyrics.length === 0 || !totalDuration) {
            return 0;
        }

        const currentIndex = findLineIndexAtTime(currentTime);
        if (currentIndex === -1) {
            return 0;
        }

        return (currentIndex + 1) / currentLyrics.length;
    }

    function getCurrentLineIndex() {
        return currentLineIndex;
    }

    function getUpcomingLines(count) {
        count = count || 3;
        
        if (!currentLyrics || currentLineIndex < 0) {
            return [];
        }

        const result = [];
        const startIndex = currentLineIndex + 1;
        const endIndex = Math.min(startIndex + count, currentLyrics.length);

        for (let i = startIndex; i < endIndex; i++) {
            result.push(currentLyrics[i]);
        }

        return result;
    }

    function getPastLines(count) {
        count = count || 3;
        
        if (!currentLyrics || currentLineIndex < 0) {
            return [];
        }

        const result = [];
        const startIndex = Math.max(0, currentLineIndex - count);

        for (let i = startIndex; i < currentLineIndex; i++) {
            result.push(currentLyrics[i]);
        }

        return result;
    }

    function isLineActive(index, currentTime) {
        if (!currentLyrics || index < 0 || index >= currentLyrics.length) {
            return false;
        }

        const line = currentLyrics[index];
        return currentTime >= line.time && currentTime < line.endTime;
    }

    function getLineDuration(index) {
        if (!currentLyrics || index < 0 || index >= currentLyrics.length) {
            return 0;
        }

        const line = currentLyrics[index];
        return line.endTime - line.time;
    }

    function getTotalLyricsDuration() {
        if (!currentLyrics || currentLyrics.length === 0) {
            return 0;
        }

        const firstLine = currentLyrics[0];
        const lastLine = currentLyrics[currentLyrics.length - 1];

        return lastLine.endTime - firstLine.time;
    }

    function isCached(trackId) {
        return !!lyricsCache[trackId];
    }

    function getCacheSize() {
        return Object.keys(lyricsCache).length;
    }

    function removeCacheEntry(trackId) {
        if (lyricsCache[trackId]) {
            delete lyricsCache[trackId];
            return true;
        }
        return false;
    }

    return {
        parseLRC: parseLRC,
        loadLyrics: loadLyrics,
        getCurrentLine: getCurrentLine,
        getNextLine: getNextLine,
        getPrevLine: getPrevLine,
        getLineAtIndex: getLineAtIndex,
        getAllLines: getAllLines,
        getLineCount: getLineCount,
        findLineIndexAtTime: findLineIndexAtTime,
        updateCurrentLine: updateCurrentLine,
        seekToLine: seekToLine,
        getTimeForLine: getTimeForLine,
        setOnLyricChange: setOnLyricChange,
        setOnFullLyricsLoaded: setOnFullLyricsLoaded,
        reset: reset,
        clear: clear,
        clearCache: clearCache,
        preloadLyrics: preloadLyrics,
        preloadSingleTrack: preloadSingleTrack,
        getCurrentTrackId: getCurrentTrackId,
        hasLyrics: hasLyrics,
        getMetadata: getMetadata,
        searchLyrics: searchLyrics,
        getLyricsAroundTime: getLyricsAroundTime,
        formatLyricsAsText: formatLyricsAsText,
        formatLyricsAsHTML: formatLyricsAsHTML,
        getProgressInLine: getProgressInLine,
        estimateReadingProgress: estimateReadingProgress,
        getCurrentLineIndex: getCurrentLineIndex,
        getUpcomingLines: getUpcomingLines,
        getPastLines: getPastLines,
        isLineActive: isLineActive,
        getLineDuration: getLineDuration,
        getTotalLyricsDuration: getTotalLyricsDuration,
        isCached: isCached,
        getCacheSize: getCacheSize,
        removeCacheEntry: removeCacheEntry
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = LyricsManager;
}
```

 
--- 

/js\mediasession.js:

```js
const MediaSessionManager = (function() {
    let isSupported = false;
    let currentTrack = null;
    let positionUpdateInterval = null;

    function init() {
        isSupported = 'mediaSession' in navigator;
        return isSupported;
    }

    function setActionHandler(action, handler) {
        if (isSupported && navigator.mediaSession.setActionHandler) {
            try {
                navigator.mediaSession.setActionHandler(action, handler);
            } catch (e) {
                // Ignore errors for unsupported actions
            }
        }
    }

    function updateMetadata(track) {
        if (!isSupported || !track) return;

        currentTrack = track;
        var artwork = generateArtworkArray(track.imageSrc);

        try {
            navigator.mediaSession.metadata = new MediaMetadata({
                title: track.title,
                artist: track.artist || 'Deus ex CT',
                album: 'Deus ex CT',
                artwork: artwork
            });
        } catch (e) {
            console.error('MediaSession metadata error:', e);
        }
    }

    function generateArtworkArray(imageSrc) {
        if (!imageSrc) return [];
        return [
            { src: imageSrc, sizes: '96x96', type: 'image/png' },
            { src: imageSrc, sizes: '128x128', type: 'image/png' },
            { src: imageSrc, sizes: '192x192', type: 'image/png' },
            { src: imageSrc, sizes: '256x256', type: 'image/png' },
            { src: imageSrc, sizes: '384x384', type: 'image/png' },
            { src: imageSrc, sizes: '512x512', type: 'image/png' }
        ];
    }

    function setPlaybackState(state) {
        if (!isSupported) return;
        if (state !== 'none' && state !== 'paused' && state !== 'playing') state = 'none';
        try {
            navigator.mediaSession.playbackState = state;
        } catch (e) {}
    }

    function updatePositionState(duration, currentTime, playbackRate) {
        if (!isSupported || !navigator.mediaSession.setPositionState) return;

        if (!duration || isNaN(duration) || duration < 0) return;
        if (currentTime === undefined || isNaN(currentTime)) currentTime = 0;
        if (playbackRate === undefined) playbackRate = 1.0;

        try {
            navigator.mediaSession.setPositionState({
                duration: duration,
                position: Math.min(currentTime, duration),
                playbackRate: playbackRate
            });
        } catch (e) {}
    }

    return {
        init: init,
        setActionHandler: setActionHandler,
        updateMetadata: updateMetadata,
        setPlaybackState: setPlaybackState,
        updatePositionState: updatePositionState
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = MediaSessionManager;
}
```

 
--- 

/js\player.js:

```js
const PlayerEngine = (function() {
    let audioElement = null;
    let videoElement = null;
    let bgVideoElement = null;
    let videoWrapper = null;
    let currentMode = 'audio';
    let currentTrack = null;
    let currentQuality = 'mid';
    let isPlaying = false;
    let isSeeking = false;
    let volume = 1.0;
    let isMutedState = false;
    let lastVolume = 1.0;
    let isVideoFullscreen = false;
    let isLoadingMedia = false;
    let pendingPlayRequest = false;
    let preloadedNextTrack = null;
    let preloadAudioElement = null;
    let preloadVideoElement = null;
    let userHasInteracted = false;
    let lastSyncTime = 0;
    let rafId = null;
    let isIOS = false;
    let isAndroid = false;
    let isMobile = false;
    let playbackAttempts = 0;
    let maxPlaybackAttempts = 5;
    let playbackRetryDelay = 100;
    let isInitialized = false;
    let mediaElementsReady = false;
    let playbackState = 'stopped';
    let stallRetryCount = 0;
    let maxStallRetries = 4;
    let lastStallTime = 0;
    let stallRetryDelays = [500, 1000, 2000, 4000];
    let lastLoadedTrackId = null;

    const PlaybackState = {
        STOPPED: 'stopped',
        LOADING: 'loading',
        READY: 'ready',
        PLAYING: 'playing',
        PAUSED: 'paused',
        SEEKING: 'seeking',
        STALLED: 'stalled',
        ERROR: 'error'
    };

    const ErrorType = {
        NOT_ALLOWED: 'NotAllowedError',
        ABORT: 'AbortError',
        NOT_SUPPORTED: 'NotSupportedError',
        NETWORK: 'NetworkError',
        DECODE: 'DecodeError',
        UNKNOWN: 'UnknownError'
    };

    const callbacks = {
        onPlay: null,
        onPause: null,
        onTimeUpdate: null,
        onEnded: null,
        onError: null,
        onLoadStart: null,
        onCanPlay: null,
        onWaiting: null,
        onSeeking: null,
        onSeeked: null,
        onVolumeChange: null,
        onModeChange: null,
        onTrackChange: null,
        onDurationChange: null,
        onProgress: null,
        onFullscreenChange: null
    };

    function init() {
        if (isInitialized) {
            return;
        }

        detectPlatform();
        ensureMediaElements();
        cacheElements();
        configureMediaElements();
        createPreloadElements();
        setupUserInteractionDetection();
        detectNetworkQuality();
        setupAudioListeners();
        setupVideoListeners();
        setupFullscreenListeners();
        loadVolumeFromStorage();
        loadQualityFromStorage();
        startTimeUpdateLoop();
        mediaElementsReady = true;
        isInitialized = true;

        return true;
    }

    function detectPlatform() {
        const ua = navigator.userAgent || navigator.vendor || window.opera;
        isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
        isAndroid = /android/i.test(ua);
        isMobile = isIOS || isAndroid || /webOS|BlackBerry|IEMobile|Opera Mini/i.test(ua);
        
        if (isIOS) {
            document.documentElement.classList.add('ios-device');
        }
        if (isAndroid) {
            document.documentElement.classList.add('android-device');
        }
        if (isMobile) {
            document.documentElement.classList.add('mobile-device');
        }
    }

    function ensureMediaElements() {
        if (!audioElement) {
            audioElement = document.createElement('audio');
            audioElement.id = 'audioPlayer';
            audioElement.setAttribute('preload', 'auto');
            audioElement.setAttribute('crossorigin', 'anonymous');
            audioElement.setAttribute('playsinline', '');
            audioElement.setAttribute('webkit-playsinline', '');
            audioElement.style.display = 'none';
            document.body.appendChild(audioElement);
        }

        if (!videoElement) {
            videoElement = document.createElement('video');
            videoElement.id = 'videoPlayer';
            videoElement.setAttribute('preload', 'auto');
            videoElement.setAttribute('playsinline', '');
            videoElement.setAttribute('webkit-playsinline', '');
            videoElement.setAttribute('crossorigin', 'anonymous');
            const vWrapper = document.getElementById('videoWrapper');
            if (vWrapper) {
                vWrapper.appendChild(videoElement);
            }
        }

        if (!bgVideoElement) {
            bgVideoElement = document.createElement('video');
            bgVideoElement.id = 'bgVideo';
            bgVideoElement.setAttribute('loop', '');
            bgVideoElement.setAttribute('muted', '');
            bgVideoElement.setAttribute('playsinline', '');
            bgVideoElement.setAttribute('webkit-playsinline', '');
            bgVideoElement.setAttribute('crossorigin', 'anonymous');
            bgVideoElement.style.display = 'none';
            const bgContainer = document.getElementById('bgVideoContainer');
            if (bgContainer) {
                bgContainer.appendChild(bgVideoElement);
            }
        }
    }

    function cacheElements() {
        audioElement = document.getElementById('audioPlayer') || audioElement;
        videoElement = document.getElementById('videoPlayer') || videoElement;
        bgVideoElement = document.getElementById('bgVideo') || bgVideoElement;
        videoWrapper = document.getElementById('videoWrapper');
    }

    function configureMediaElements() {
        if (audioElement) {
            audioElement.preload = 'auto';
            audioElement.playsInline = true;
            audioElement.setAttribute('playsinline', '');
            audioElement.setAttribute('webkit-playsinline', '');
            audioElement.crossOrigin = 'anonymous';
        }

        if (videoElement) {
            videoElement.preload = 'auto';
            videoElement.playsInline = true;
            videoElement.setAttribute('playsinline', '');
            videoElement.setAttribute('webkit-playsinline', '');
            videoElement.crossOrigin = 'anonymous';
            if (isIOS) {
                videoElement.setAttribute('x-webkit-airplay', 'allow');
            }
        }

        if (bgVideoElement) {
            bgVideoElement.muted = true;
            bgVideoElement.loop = true;
            bgVideoElement.playsInline = true;
            bgVideoElement.setAttribute('playsinline', '');
            bgVideoElement.setAttribute('webkit-playsinline', '');
            bgVideoElement.setAttribute('x5-playsinline', '');
            bgVideoElement.setAttribute('x5-video-player-type', 'h5');
            bgVideoElement.setAttribute('x5-video-player-fullscreen', 'false');
            bgVideoElement.preload = 'none';
            bgVideoElement.crossOrigin = 'anonymous';
        }
    }

    function createPreloadElements() {
        preloadAudioElement = document.createElement('audio');
        preloadAudioElement.preload = 'auto';
        preloadAudioElement.volume = 0;
        preloadAudioElement.muted = true;
        preloadAudioElement.crossOrigin = 'anonymous';
        
        preloadVideoElement = document.createElement('video');
        preloadVideoElement.preload = 'metadata';
        preloadVideoElement.volume = 0;
        preloadVideoElement.muted = true;
        preloadVideoElement.playsInline = true;
        preloadVideoElement.crossOrigin = 'anonymous';
    }

    function setupUserInteractionDetection() {
        const interactionEvents = ['touchstart', 'touchend', 'click', 'keydown'];
        
        const handleInteraction = function() {
            if (!userHasInteracted) {
                userHasInteracted = true;
                
                try {
                    if (audioElement && audioElement.src) {
                        audioElement.load();
                    }
                    if (videoElement && videoElement.src) {
                        videoElement.load();
                    }
                    if (bgVideoElement && bgVideoElement.src) {
                        bgVideoElement.play().catch(function() {});
                        bgVideoElement.pause();
                    }
                } catch (e) {}
                
                interactionEvents.forEach(function(event) {
                    document.removeEventListener(event, handleInteraction, { capture: true });
                });
            }
        };
        
        interactionEvents.forEach(function(event) {
            document.addEventListener(event, handleInteraction, { capture: true, passive: true });
        });
    }

    function detectNetworkQuality() {
        if (navigator.connection) {
            const conn = navigator.connection;
            const updateQuality = function() {
                if (conn.saveData) {
                    currentQuality = 'low';
                } else if (conn.effectiveType === 'slow-2g' || conn.effectiveType === '2g') {
                    currentQuality = 'low';
                } else if (conn.effectiveType === '3g') {
                    currentQuality = 'low';
                } else if (conn.downlink && conn.downlink < 1.5) {
                    currentQuality = 'low';
                } else if (conn.downlink && conn.downlink < 5) {
                    currentQuality = 'mid';
                } else {
                    currentQuality = 'mid';
                }
            };
            
            updateQuality();
            conn.addEventListener('change', updateQuality);
        }
    }

    function startTimeUpdateLoop() {
        let lastTime = 0;
        
        const updateLoop = function(timestamp) {
            if (timestamp - lastTime >= 16) {
                lastTime = timestamp;
                
                if (!isSeeking && isPlaying) {
                    const element = currentMode === 'audio' ? audioElement : videoElement;
                    if (element && !element.paused && element.duration) {
                        const currentTime = element.currentTime || 0;
                        const duration = element.duration || 0;
                        const progress = duration > 0 ? (currentTime / duration) * 100 : 0;
                        
                        if (callbacks.onTimeUpdate) {
                            callbacks.onTimeUpdate({
                                currentTime: currentTime,
                                duration: duration,
                                progress: progress,
                                mode: currentMode
                            });
                        }
                    }
                }
            }
            
            rafId = requestAnimationFrame(updateLoop);
        };
        
        rafId = requestAnimationFrame(updateLoop);
    }

    function stopTimeUpdateLoop() {
        if (rafId) {
            cancelAnimationFrame(rafId);
            rafId = null;
        }
    }

    function setupAudioListeners() {
        if (!audioElement) return;

        audioElement.addEventListener('play', function() {
            playbackState = PlaybackState.PLAYING;
            isPlaying = true;
            isLoadingMedia = false;
            playbackAttempts = 0;
            stallRetryCount = 0;
            playBackgroundVideo();
            if (callbacks.onPlay) callbacks.onPlay({ mode: 'audio', track: currentTrack });
        });

        audioElement.addEventListener('pause', function() {
            if (playbackState !== PlaybackState.SEEKING && playbackState !== PlaybackState.LOADING) {
                playbackState = PlaybackState.PAUSED;
                isPlaying = false;
                pauseBackgroundVideo();
                if (callbacks.onPause) callbacks.onPause({ mode: 'audio', track: currentTrack });
            }
        });

        audioElement.addEventListener('ended', function() {
            playbackState = PlaybackState.STOPPED;
            isPlaying = false;
            pauseBackgroundVideo();
            if (callbacks.onEnded) callbacks.onEnded({ mode: 'audio', track: currentTrack });
        });

        audioElement.addEventListener('error', function(e) {
            playbackState = PlaybackState.ERROR;
            isPlaying = false;
            isLoadingMedia = false;
            pendingPlayRequest = false;
            playbackAttempts = 0;
            const error = audioElement.error;
            const errorCode = error ? error.code : 0;
            if (callbacks.onError) callbacks.onError({ 
                mode: 'audio', 
                track: currentTrack, 
                error: error,
                errorCode: errorCode
            });
        });

        audioElement.addEventListener('waiting', function() {
            if (playbackState === PlaybackState.PLAYING) {
                playbackState = PlaybackState.STALLED;
            }
            if (callbacks.onWaiting) callbacks.onWaiting({ mode: 'audio', track: currentTrack });
        });

        audioElement.addEventListener('canplaythrough', function() {
            if (playbackState !== PlaybackState.PLAYING && playbackState !== PlaybackState.PAUSED) {
                playbackState = PlaybackState.READY;
            }
            isLoadingMedia = false;
            if (pendingPlayRequest) {
                pendingPlayRequest = false;
                performPlaySync();
            }
            if (callbacks.onCanPlay) callbacks.onCanPlay({ mode: 'audio', track: currentTrack });
        });

        audioElement.addEventListener('canplay', function() {
            if (playbackState === PlaybackState.LOADING) {
                playbackState = PlaybackState.READY;
            }
        });

        audioElement.addEventListener('loadedmetadata', function() {
            if (callbacks.onDurationChange) callbacks.onDurationChange({ duration: audioElement.duration, mode: 'audio' });
        });

        audioElement.addEventListener('volumechange', function() {
            if (callbacks.onVolumeChange) callbacks.onVolumeChange({ volume: audioElement.volume, muted: audioElement.muted });
        });

        audioElement.addEventListener('progress', function() {
            if (callbacks.onProgress) {
                const buffered = getBufferedPercentage(audioElement);
                callbacks.onProgress({ buffered: buffered, mode: 'audio' });
            }
        });

        audioElement.addEventListener('seeked', function() {
            playbackState = PlaybackState.READY;
            isSeeking = false;
            stallRetryCount = 0;
            if (callbacks.onSeeked) callbacks.onSeeked({ mode: 'audio', time: audioElement.currentTime });
        });

        audioElement.addEventListener('seeking', function() {
            playbackState = PlaybackState.SEEKING;
            isSeeking = true;
            if (callbacks.onSeeking) callbacks.onSeeking({ mode: 'audio' });
        });

        audioElement.addEventListener('stalled', function() {
            if (playbackState === PlaybackState.PLAYING && currentTrack && currentTrack.id === lastLoadedTrackId) {
                const currentTime = Date.now();
                if (currentTime - lastStallTime > 1000) {
                    lastStallTime = currentTime;
                    stallRetryCount = 0;
                }
                if (stallRetryCount < maxStallRetries) {
                    handleMediaStall(audioElement);
                }
            }
        });

        audioElement.addEventListener('loadstart', function() {
            playbackState = PlaybackState.LOADING;
            isLoadingMedia = true;
            if (callbacks.onLoadStart) callbacks.onLoadStart({ mode: 'audio', track: currentTrack });
        });

        audioElement.addEventListener('abort', function() {
            if (playbackState === PlaybackState.LOADING && currentTrack && currentTrack.id === lastLoadedTrackId) {
                playbackState = PlaybackState.ERROR;
                isLoadingMedia = false;
            }
        });
    }

    function setupVideoListeners() {
        if (!videoElement) return;

        videoElement.addEventListener('play', function() {
            playbackState = PlaybackState.PLAYING;
            isPlaying = true;
            isLoadingMedia = false;
            playbackAttempts = 0;
            stallRetryCount = 0;
            pauseBackgroundVideo();
            if (callbacks.onPlay) callbacks.onPlay({ mode: 'video', track: currentTrack });
        });

        videoElement.addEventListener('pause', function() {
            if (playbackState !== PlaybackState.SEEKING && playbackState !== PlaybackState.LOADING) {
                playbackState = PlaybackState.PAUSED;
                isPlaying = false;
                if (callbacks.onPause) callbacks.onPause({ mode: 'video', track: currentTrack });
            }
        });

        videoElement.addEventListener('ended', function() {
            playbackState = PlaybackState.STOPPED;
            isPlaying = false;
            if (callbacks.onEnded) callbacks.onEnded({ mode: 'video', track: currentTrack });
        });

        videoElement.addEventListener('error', function(e) {
            playbackState = PlaybackState.ERROR;
            isPlaying = false;
            isLoadingMedia = false;
            pendingPlayRequest = false;
            playbackAttempts = 0;
            const error = videoElement.error;
            const errorCode = error ? error.code : 0;
            if (callbacks.onError) callbacks.onError({ 
                mode: 'video', 
                track: currentTrack, 
                error: error,
                errorCode: errorCode
            });
        });

        videoElement.addEventListener('waiting', function() {
            if (playbackState === PlaybackState.PLAYING) {
                playbackState = PlaybackState.STALLED;
            }
            if (callbacks.onWaiting) callbacks.onWaiting({ mode: 'video', track: currentTrack });
        });

        videoElement.addEventListener('canplaythrough', function() {
            if (playbackState !== PlaybackState.PLAYING && playbackState !== PlaybackState.PAUSED) {
                playbackState = PlaybackState.READY;
            }
            isLoadingMedia = false;
            if (pendingPlayRequest) {
                pendingPlayRequest = false;
                performPlaySync();
            }
            if (callbacks.onCanPlay) callbacks.onCanPlay({ mode: 'video', track: currentTrack });
        });

        videoElement.addEventListener('canplay', function() {
            if (playbackState === PlaybackState.LOADING) {
                playbackState = PlaybackState.READY;
            }
        });

        videoElement.addEventListener('loadedmetadata', function() {
            if (callbacks.onDurationChange) callbacks.onDurationChange({ duration: videoElement.duration, mode: 'video' });
        });

        videoElement.addEventListener('volumechange', function() {
            if (callbacks.onVolumeChange) callbacks.onVolumeChange({ volume: videoElement.volume, muted: videoElement.muted });
        });

        videoElement.addEventListener('progress', function() {
            if (callbacks.onProgress) {
                const buffered = getBufferedPercentage(videoElement);
                callbacks.onProgress({ buffered: buffered, mode: 'video' });
            }
        });

        videoElement.addEventListener('seeked', function() {
            playbackState = PlaybackState.READY;
            isSeeking = false;
            stallRetryCount = 0;
            if (callbacks.onSeeked) callbacks.onSeeked({ mode: 'video', time: videoElement.currentTime });
        });

        videoElement.addEventListener('seeking', function() {
            playbackState = PlaybackState.SEEKING;
            isSeeking = true;
            if (callbacks.onSeeking) callbacks.onSeeking({ mode: 'video' });
        });

        videoElement.addEventListener('webkitbeginfullscreen', function() {
            isVideoFullscreen = true;
            if (callbacks.onFullscreenChange) callbacks.onFullscreenChange({ isFullscreen: true });
        });

        videoElement.addEventListener('webkitendfullscreen', function() {
            isVideoFullscreen = false;
            if (callbacks.onFullscreenChange) callbacks.onFullscreenChange({ isFullscreen: false });
        });

        videoElement.addEventListener('stalled', function() {
            if (playbackState === PlaybackState.PLAYING && currentTrack && currentTrack.id === lastLoadedTrackId) {
                const currentTime = Date.now();
                if (currentTime - lastStallTime > 1000) {
                    lastStallTime = currentTime;
                    stallRetryCount = 0;
                }
                if (stallRetryCount < maxStallRetries) {
                    handleMediaStall(videoElement);
                }
            }
        });

        videoElement.addEventListener('loadstart', function() {
            playbackState = PlaybackState.LOADING;
            isLoadingMedia = true;
            if (callbacks.onLoadStart) callbacks.onLoadStart({ mode: 'video', track: currentTrack });
        });

        videoElement.addEventListener('abort', function() {
            if (playbackState === PlaybackState.LOADING && currentTrack && currentTrack.id === lastLoadedTrackId) {
                playbackState = PlaybackState.ERROR;
                isLoadingMedia = false;
            }
        });
    }

    function handleMediaStall(element) {
        if (!element || isLoadingMedia || stallRetryCount >= maxStallRetries) return;
        
        stallRetryCount++;
        const delay = stallRetryDelays[stallRetryCount - 1] || 4000;
        
        setTimeout(function() {
            if (playbackState !== PlaybackState.PLAYING || !currentTrack || currentTrack.id !== lastLoadedTrackId) return;
            
            const currentTime = element.currentTime;
            try {
                element.load();
                if (currentTime > 0.5) {
                    element.currentTime = currentTime - 0.5;
                } else {
                    element.currentTime = 0;
                }
            } catch (e) {}
            
            setTimeout(function() {
                if (playbackState === PlaybackState.PLAYING || playbackState === PlaybackState.STALLED) {
                    performPlaySync();
                }
            }, 100);
        }, delay);
    }

    function setupFullscreenListeners() {
        const handleFullscreenChange = function() {
            const wasFullscreen = isVideoFullscreen;
            isVideoFullscreen = isFullscreen();
            if (wasFullscreen !== isVideoFullscreen && callbacks.onFullscreenChange) {
                callbacks.onFullscreenChange({ isFullscreen: isVideoFullscreen });
            }
        };

        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);
    }

    function getBufferedPercentage(element) {
        if (!element || !element.buffered || element.buffered.length === 0) return 0;
        const duration = element.duration;
        if (!duration || isNaN(duration)) return 0;
        
        let bufferedEnd = 0;
        const currentTime = element.currentTime;
        
        for (let i = 0; i < element.buffered.length; i++) {
            if (element.buffered.start(i) <= currentTime && element.buffered.end(i) >= currentTime) {
                bufferedEnd = element.buffered.end(i);
                break;
            }
        }
        
        return (bufferedEnd / duration) * 100;
    }

    function loadTrack(track, mode, startTime) {
        if (!track || !mediaElementsReady) return false;
        
        const previousTrack = currentTrack;
        currentTrack = track;
        lastLoadedTrackId = track.id;
        startTime = startTime || 0;
        
        if (mode) currentMode = mode;
        
        playbackState = PlaybackState.LOADING;
        isLoadingMedia = true;
        pendingPlayRequest = false;
        playbackAttempts = 0;
        stallRetryCount = 0;

        if (currentMode === 'audio') {
            loadAudioTrack(track, startTime);
        } else {
            loadVideoTrack(track, startTime);
        }

        if (callbacks.onTrackChange) {
            callbacks.onTrackChange({ track: track, mode: currentMode, previousTrack: previousTrack });
        }
        
        preloadNextTrack();
        
        return true;
    }

    function loadAudioTrack(track, startTime) {
        if (!audioElement || !track.audioSrc) return false;
        
        pauseVideoInternal();
        
        const onCanPlayHandler = function() {
            audioElement.removeEventListener('canplay', onCanPlayHandler);
            audioElement.removeEventListener('error', onErrorHandler);
            audioElement.removeEventListener('loadstart', onLoadstartHandler);
            
            if (startTime > 0) {
                try {
                    if (audioElement.duration && isFinite(audioElement.duration)) {
                        audioElement.currentTime = Math.min(startTime, audioElement.duration - 0.1);
                    }
                } catch (e) {}
            }
            
            audioElement.volume = isMutedState ? 0 : volume;
            audioElement.muted = isMutedState;
        };

        const onErrorHandler = function() {
            audioElement.removeEventListener('canplay', onCanPlayHandler);
            audioElement.removeEventListener('error', onErrorHandler);
            audioElement.removeEventListener('loadstart', onLoadstartHandler);
            playbackState = PlaybackState.ERROR;
            isLoadingMedia = false;
        };

        const onLoadstartHandler = function() {
            audioElement.removeEventListener('loadstart', onLoadstartHandler);
            if (audioElement.readyState >= 3) {
                onCanPlayHandler();
            }
        };
        
        audioElement.addEventListener('canplay', onCanPlayHandler, { once: true });
        audioElement.addEventListener('error', onErrorHandler, { once: true });
        audioElement.addEventListener('loadstart', onLoadstartHandler, { once: true });
        
        audioElement.src = track.audioSrc;
        audioElement.load();
        
        if (audioElement.readyState >= 3) {
            onCanPlayHandler();
        }
        
        loadBackgroundVideo(track);

        return true;
    }

    function loadVideoTrack(track, startTime) {
        if (!videoElement || !track.videoSrc) return false;

        pauseAudioInternal();
        pauseBackgroundVideo();

        const videoSrc = track.videoSrc[currentQuality] || track.videoSrc.mid || track.videoSrc.high || track.videoSrc.low;
        
        if (!videoSrc) return false;
        
        const onCanPlayHandler = function() {
            videoElement.removeEventListener('canplay', onCanPlayHandler);
            videoElement.removeEventListener('error', onErrorHandler);
            videoElement.removeEventListener('loadstart', onLoadstartHandler);
            
            if (startTime > 0) {
                try {
                    if (videoElement.duration && isFinite(videoElement.duration)) {
                        videoElement.currentTime = Math.min(startTime, videoElement.duration - 0.1);
                    }
                } catch (e) {}
            }
            
            videoElement.volume = isMutedState ? 0 : volume;
            videoElement.muted = isMutedState;
        };

        const onErrorHandler = function() {
            videoElement.removeEventListener('canplay', onCanPlayHandler);
            videoElement.removeEventListener('error', onErrorHandler);
            videoElement.removeEventListener('loadstart', onLoadstartHandler);
            playbackState = PlaybackState.ERROR;
            isLoadingMedia = false;
        };

        const onLoadstartHandler = function() {
            videoElement.removeEventListener('loadstart', onLoadstartHandler);
            if (videoElement.readyState >= 3) {
                onCanPlayHandler();
            }
        };

        videoElement.addEventListener('canplay', onCanPlayHandler, { once: true });
        videoElement.addEventListener('error', onErrorHandler, { once: true });
        videoElement.addEventListener('loadstart', onLoadstartHandler, { once: true });
        
        videoElement.src = videoSrc;
        videoElement.load();

        if (videoElement.readyState >= 3) {
            onCanPlayHandler();
        }
        
        return true;
    }

    function loadBackgroundVideo(track) {
        if (!bgVideoElement) return;
        
        if (!track || !track.backgroundSrc) {
            bgVideoElement.removeAttribute('src');
            bgVideoElement.load();
            return;
        }
        
        if (bgVideoElement.src && bgVideoElement.src.includes(track.backgroundSrc.split('/').pop())) {
            return;
        }
        
        const onCanPlayBgHandler = function() {
            bgVideoElement.removeEventListener('canplaythrough', onCanPlayBgHandler);
            if (isPlaying && currentMode === 'audio') {
                bgVideoElement.play().catch(function() {});
            }
        };
        
        bgVideoElement.addEventListener('canplaythrough', onCanPlayBgHandler, { once: true });
        bgVideoElement.src = track.backgroundSrc;
        bgVideoElement.load();
    }

    function preloadNextTrack() {
        if (typeof PlaylistManager === 'undefined') return;
        
        const nextTrack = PlaylistManager.getNextTrack();
        if (!nextTrack || (preloadedNextTrack && preloadedNextTrack.id === nextTrack.id)) {
            return;
        }
        
        preloadedNextTrack = nextTrack;
        
        if (nextTrack.audioSrc && preloadAudioElement) {
            preloadAudioElement.src = nextTrack.audioSrc;
            preloadAudioElement.load();
        }
        
        if (nextTrack.videoSrc && preloadVideoElement) {
            const videoSrc = nextTrack.videoSrc[currentQuality] || nextTrack.videoSrc.mid;
            if (videoSrc) {
                preloadVideoElement.src = videoSrc;
                preloadVideoElement.load();
            }
        }
        
        if (nextTrack.imageSrc) {
            const img = new Image();
            img.src = nextTrack.imageSrc;
        }
    }

    function playBackgroundVideo() {
        if (bgVideoElement && currentMode === 'audio' && bgVideoElement.src) {
            const playPromise = bgVideoElement.play();
            if (playPromise !== undefined) {
                playPromise.catch(function() {});
            }
        }
    }

    function pauseBackgroundVideo() {
        if (bgVideoElement && !bgVideoElement.paused) {
            bgVideoElement.pause();
        }
    }

    function pauseAudioInternal() {
        if (audioElement && !audioElement.paused) {
            audioElement.pause();
        }
    }

    function pauseVideoInternal() {
        if (videoElement && !videoElement.paused) {
            videoElement.pause();
        }
    }

    function performPlaySync() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.src) {
            return false;
        }

        if (element.paused === false) {
            return true;
        }

        lastSyncTime = element.currentTime || 0;

        try {
            const playPromise = element.play();
            
            if (playPromise !== undefined) {
                playPromise.then(function() {
                    playbackState = PlaybackState.PLAYING;
                    isPlaying = true;
                    playbackAttempts = 0;
                    return true;
                }).catch(function(e) {
                    const errorName = e.name || 'UnknownError';
                    if (errorName === 'NotAllowedError') {
                        pendingPlayRequest = true;
                        isPlaying = false;
                        return false;
                    } else if (errorName === 'AbortError') {
                        return false;
                    } else if (errorName === 'NotSupportedError') {
                        playbackState = PlaybackState.ERROR;
                        isPlaying = false;
                        return false;
                    } else {
                        if (playbackAttempts < maxPlaybackAttempts) {
                            playbackAttempts++;
                            const delay = playbackRetryDelay * Math.pow(1.5, playbackAttempts - 1);
                            setTimeout(performPlaySync, delay);
                        } else {
                            playbackState = PlaybackState.ERROR;
                            isPlaying = false;
                        }
                        return false;
                    }
                });
            } else {
                playbackState = PlaybackState.PLAYING;
                isPlaying = true;
                playbackAttempts = 0;
                return true;
            }
        } catch (e) {
            if (playbackAttempts < maxPlaybackAttempts) {
                playbackAttempts++;
                const delay = playbackRetryDelay * Math.pow(1.5, playbackAttempts - 1);
                setTimeout(performPlaySync, delay);
            }
            return false;
        }

        return true;
    }

    function play() {
        if (!mediaElementsReady) {
            pendingPlayRequest = true;
            return Promise.resolve();
        }

        if (!userHasInteracted && isMobile) {
            pendingPlayRequest = true;
            return Promise.resolve();
        }
        
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.src) {
            return Promise.reject(new Error('No source'));
        }

        if (playbackState === PlaybackState.LOADING || element.readyState < 2) {
            pendingPlayRequest = true;
            return Promise.resolve();
        }
        
        return new Promise(function(resolve, reject) {
            try {
                if (element.paused === false) {
                    resolve();
                    return;
                }

                const playPromise = element.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(function() {
                        playbackState = PlaybackState.PLAYING;
                        isPlaying = true;
                        playbackAttempts = 0;
                        resolve();
                    }).catch(function(e) {
                        const errorName = e.name || 'UnknownError';
                        if (errorName === 'NotAllowedError') {
                            pendingPlayRequest = true;
                            isPlaying = false;
                            resolve();
                        } else if (errorName === 'AbortError') {
                            resolve();
                        } else {
                            if (playbackAttempts < maxPlaybackAttempts) {
                                playbackAttempts++;
                                const delay = playbackRetryDelay * Math.pow(1.5, playbackAttempts - 1);
                                setTimeout(function() {
                                    play().then(resolve).catch(reject);
                                }, delay);
                            } else {
                                playbackState = PlaybackState.ERROR;
                                isPlaying = false;
                                reject(e);
                            }
                        }
                    });
                } else {
                    playbackState = PlaybackState.PLAYING;
                    isPlaying = true;
                    playbackAttempts = 0;
                    resolve();
                }
            } catch (e) {
                if (playbackAttempts < maxPlaybackAttempts) {
                    playbackAttempts++;
                    const delay = playbackRetryDelay * Math.pow(1.5, playbackAttempts - 1);
                    setTimeout(function() {
                        play().then(resolve).catch(reject);
                    }, delay);
                } else {
                    reject(e);
                }
            }
        });
    }

    function pause() {
        pendingPlayRequest = false;
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (element && !element.paused) {
            element.pause();
        }
        playbackState = PlaybackState.PAUSED;
        isPlaying = false;
    }

    function togglePlayPause() {
        if (isPlaying) {
            pause();
            return Promise.resolve();
        } else {
            return play();
        }
    }

    function stop() {
        pause();
        seek(0);
        pauseBackgroundVideo();
        isPlaying = false;
        playbackState = PlaybackState.STOPPED;
    }

    function seek(time) {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.duration || !isFinite(element.duration)) return;
        
        const clampedTime = Math.max(0, Math.min(time, element.duration - 0.1));
        
        try {
            element.currentTime = clampedTime;
            lastSyncTime = clampedTime;
        } catch (e) {}
    }

    function seekPercent(percent) {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.duration || isNaN(element.duration)) return;
        
        const time = (percent / 100) * element.duration;
        seek(time);
    }

    function seekRelative(seconds) {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element) return;
        
        const newTime = (element.currentTime || 0) + seconds;
        seek(newTime);
    }

    function setVolume(value) {
        volume = Math.max(0, Math.min(1, value));
        
        if (audioElement) audioElement.volume = volume;
        if (videoElement) videoElement.volume = volume;

        if (volume > 0) {
            lastVolume = volume;
            isMutedState = false;
            if (audioElement) audioElement.muted = false;
            if (videoElement) videoElement.muted = false;
        }
        
        saveVolumeToStorage();
    }

    function getVolume() {
        return volume;
    }

    function mute() {
        isMutedState = true;
        if (audioElement) audioElement.muted = true;
        if (videoElement) videoElement.muted = true;
        saveVolumeToStorage();
    }

    function unmute() {
        isMutedState = false;
        if (audioElement) audioElement.muted = false;
        if (videoElement) videoElement.muted = false;
        saveVolumeToStorage();
    }

    function toggleMute() {
        if (isMutedState) {
            unmute();
            if (volume === 0) {
                setVolume(lastVolume > 0 ? lastVolume : 0.5);
            }
        } else {
            mute();
        }
        return isMutedState;
    }

    function isMuted() {
        return isMutedState;
    }

    function switchMode(newMode, preservePosition) {
        if (newMode === currentMode) return Promise.resolve();
        if (newMode !== 'audio' && newMode !== 'video') return Promise.reject(new Error('Invalid mode'));
        
        preservePosition = preservePosition !== false;
        
        const wasPlaying = isPlaying;
        const sourceElement = currentMode === 'audio' ? audioElement : videoElement;
        const currentTime = sourceElement ? sourceElement.currentTime : 0;
        
        playbackState = PlaybackState.LOADING;
        isLoadingMedia = true;
        pendingPlayRequest = false;
        stallRetryCount = 0;
        
        if (sourceElement && !sourceElement.paused) {
            sourceElement.pause();
        }
        
        const previousMode = currentMode;
        currentMode = newMode;

        if (callbacks.onModeChange) {
            callbacks.onModeChange({ previousMode: previousMode, currentMode: newMode, track: currentTrack });
        }

        if (!currentTrack) {
            playbackState = PlaybackState.READY;
            isLoadingMedia = false;
            return Promise.resolve();
        }

        return new Promise(function(resolve, reject) {
            const targetElement = currentMode === 'audio' ? audioElement : videoElement;
            
            if (currentMode === 'audio') {
                loadAudioTrack(currentTrack, preservePosition ? currentTime : 0);
            } else {
                loadVideoTrack(currentTrack, preservePosition ? currentTime : 0);
            }

            const onReady = function() {
                targetElement.removeEventListener('canplaythrough', onReady);
                targetElement.removeEventListener('error', onError);
                clearTimeout(timeoutId);
                
                playbackState = PlaybackState.READY;
                isLoadingMedia = false;
                
                if (preservePosition && currentTime > 0) {
                    try {
                        if (targetElement.duration && isFinite(targetElement.duration)) {
                            targetElement.currentTime = Math.min(currentTime, targetElement.duration - 0.1);
                        }
                    } catch (e) {}
                }
                
                if (wasPlaying) {
                    performPlaySync();
                    resolve();
                } else {
                    resolve();
                }
            };
            
            const onError = function(e) {
                targetElement.removeEventListener('canplaythrough', onReady);
                targetElement.removeEventListener('error', onError);
                clearTimeout(timeoutId);
                playbackState = PlaybackState.ERROR;
                isLoadingMedia = false;
                reject(e);
            };

            const timeoutId = setTimeout(function() {
                targetElement.removeEventListener('canplaythrough', onReady);
                targetElement.removeEventListener('error', onError);
                
                if (playbackState === PlaybackState.LOADING && targetElement.readyState >= 3) {
                    playbackState = PlaybackState.READY;
                    isLoadingMedia = false;
                    
                    if (preservePosition && currentTime > 0) {
                        try {
                            if (targetElement.duration && isFinite(targetElement.duration)) {
                                targetElement.currentTime = Math.min(currentTime, targetElement.duration - 0.1);
                            }
                        } catch (e) {}
                    }
                    
                    if (wasPlaying) {
                        performPlaySync();
                    }
                    resolve();
                } else {
                    playbackState = PlaybackState.ERROR;
                    isLoadingMedia = false;
                    reject(new Error('Mode switch timeout'));
                }
            }, 15000);

            if (targetElement.readyState >= 4) {
                onReady();
            } else {
                targetElement.addEventListener('canplaythrough', onReady, { once: true });
                targetElement.addEventListener('error', onError, { once: true });
            }
        });
    }

    function setQuality(quality) {
        if (!['low', 'mid', 'high'].includes(quality)) return false;
        if (quality === currentQuality) return true;

        const wasPlaying = isPlaying;
        const currentTime = videoElement ? videoElement.currentTime : 0;
        
        currentQuality = quality;
        saveQualityToStorage();

        if (currentMode === 'video' && currentTrack && currentTrack.videoSrc) {
            playbackState = PlaybackState.LOADING;
            isLoadingMedia = true;
            stallRetryCount = 0;
            
            if (!videoElement.paused) {
                videoElement.pause();
            }
            
            loadVideoTrack(currentTrack, currentTime);
            
            const onCanPlayHandler = function() {
                videoElement.removeEventListener('canplaythrough', onCanPlayHandler);
                playbackState = PlaybackState.READY;
                isLoadingMedia = false;
                
                if (wasPlaying) {
                    performPlaySync();
                }
            };
            
            videoElement.addEventListener('canplaythrough', onCanPlayHandler, { once: true });
        }
        
        return true;
    }

    function getQuality() {
        return currentQuality;
    }

    function getCurrentTime() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        return element ? (element.currentTime || 0) : 0;
    }

    function getDuration() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        return element ? (element.duration || 0) : 0;
    }

    function getProgress() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.duration) return 0;
        return (element.currentTime / element.duration) * 100;
    }

    function getRemainingTime() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        if (!element || !element.duration) return 0;
        return element.duration - element.currentTime;
    }

    function getIsPlaying() {
        return isPlaying;
    }

    function getCurrentMode() {
        return currentMode;
    }

    function getCurrentTrack() {
        return currentTrack;
    }

    function getAudioElement() {
        return audioElement;
    }

    function getVideoElement() {
        return videoElement;
    }

    function getPlaybackRate() {
        const element = currentMode === 'audio' ? audioElement : videoElement;
        return element ? (element.playbackRate || 1) : 1;
    }

    function setPlaybackRate(rate) {
        const r = Math.max(0.25, Math.min(4, rate));
        if (audioElement) audioElement.playbackRate = r;
        if (videoElement) videoElement.playbackRate = r;
    }

    function formatTime(seconds) {
        if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
        seconds = Math.max(0, Math.floor(seconds));
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return mins + ':' + (secs < 10 ? '0' : '') + secs;
    }

    function on(event, callback) {
        const key = 'on' + event.charAt(0).toUpperCase() + event.slice(1);
        if (callbacks.hasOwnProperty(key)) {
            callbacks[key] = callback;
        }
    }

    function off(event) {
        const key = 'on' + event.charAt(0).toUpperCase() + event.slice(1);
        if (callbacks.hasOwnProperty(key)) {
            callbacks[key] = null;
        }
    }

    function saveVolumeToStorage() {
        try {
            localStorage.setItem('deusExCT_volume', volume.toString());
            localStorage.setItem('deusExCT_muted', isMutedState.toString());
        } catch (e) {}
    }

    function loadVolumeFromStorage() {
        try {
            const savedVolume = localStorage.getItem('deusExCT_volume');
            const savedMuted = localStorage.getItem('deusExCT_muted');
            
            if (savedVolume !== null) {
                volume = parseFloat(savedVolume);
                if (isNaN(volume)) volume = 1.0;
                volume = Math.max(0, Math.min(1, volume));
                lastVolume = volume > 0 ? volume : 0.5;
            }
            
            if (savedMuted !== null) {
                isMutedState = savedMuted === 'true';
            }
        } catch (e) {}
    }

    function saveQualityToStorage() {
        try {
            localStorage.setItem('deusExCT_quality', currentQuality);
        } catch (e) {}
    }

    function loadQualityFromStorage() {
        try {
            const savedQuality = localStorage.getItem('deusExCT_quality');
            if (savedQuality && ['low', 'mid', 'high'].includes(savedQuality)) {
                currentQuality = savedQuality;
            }
        } catch (e) {}
    }

    function saveStateToStorage() {
        try {
            const state = {
                trackId: currentTrack ? currentTrack.id : null,
                mode: currentMode,
                quality: currentQuality,
                position: getCurrentTime(),
                volume: volume,
                muted: isMutedState
            };
            localStorage.setItem('deusExCT_playerState', JSON.stringify(state));
        } catch (e) {}
    }

    function loadStateFromStorage() {
        try {
            const saved = localStorage.getItem('deusExCT_playerState');
            return saved ? JSON.parse(saved) : null;
        } catch (e) {
            return null;
        }
    }

    function enterFullscreen() {
        const container = videoWrapper || videoElement;
        if (!container) return Promise.reject(new Error('No video element'));
        
        if (container.requestFullscreen) {
            return container.requestFullscreen();
        }
        if (container.webkitRequestFullscreen) {
            return Promise.resolve(container.webkitRequestFullscreen());
        }
        if (container.mozRequestFullScreen) {
            return Promise.resolve(container.mozRequestFullScreen());
        }
        if (container.msRequestFullscreen) {
            return Promise.resolve(container.msRequestFullscreen());
        }
        if (videoElement && videoElement.webkitEnterFullscreen) {
            return Promise.resolve(videoElement.webkitEnterFullscreen());
        }
        
        return Promise.reject(new Error('Fullscreen not supported'));
    }

    function exitFullscreen() {
        if (document.exitFullscreen) {
            return document.exitFullscreen();
        }
        if (document.webkitExitFullscreen) {
            return Promise.resolve(document.webkitExitFullscreen());
        }
        if (document.mozCancelFullScreen) {
            return Promise.resolve(document.mozCancelFullScreen());
        }
        if (document.msExitFullscreen) {
            return Promise.resolve(document.msExitFullscreen());
        }
        if (videoElement && videoElement.webkitExitFullscreen) {
            return Promise.resolve(videoElement.webkitExitFullscreen());
        }
        
        return Promise.reject(new Error('Exit fullscreen not supported'));
    }

    function toggleFullscreen() {
        return isFullscreen() ? exitFullscreen() : enterFullscreen();
    }

    function isFullscreen() {
        return !!(
            document.fullscreenElement ||
            document.webkitFullscreenElement ||
            document.mozFullScreenElement ||
            document.msFullscreenElement ||
            (videoElement && videoElement.webkitDisplayingFullscreen)
        );
    }

    function preloadTrack(track) {
        if (!track) return;
        
        if (track.audioSrc) {
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = track.audioSrc;
            link.as = 'audio';
            document.head.appendChild(link);
        }
        
        if (track.imageSrc) {
            const img = new Image();
            img.src = track.imageSrc;
        }
    }

    function startSeek() {
        isSeeking = true;
        playbackState = PlaybackState.SEEKING;
    }

    function endSeek(time) {
        isSeeking = false;
        if (typeof time === 'number') {
            seek(time);
        }
    }

    function isCurrentlySeeking() {
        return isSeeking;
    }

    function getUserHasInteracted() {
        return userHasInteracted;
    }

    function getIsMobile() {
        return isMobile;
    }

    function getIsIOS() {
        return isIOS;
    }

    function getPlaybackState() {
        return playbackState;
    }

    function isMediaReady() {
        return mediaElementsReady;
    }

    function destroy() {
        saveStateToStorage();
        stopTimeUpdateLoop();
        
        pause();
        pauseBackgroundVideo();
        
        if (audioElement) {
            audioElement.src = '';
            audioElement.load();
        }
        if (videoElement) {
            videoElement.src = '';
            videoElement.load();
        }
        if (bgVideoElement) {
            bgVideoElement.src = '';
            bgVideoElement.load();
        }
        if (preloadAudioElement) {
            preloadAudioElement.src = '';
        }
        if (preloadVideoElement) {
            preloadVideoElement.src = '';
        }
        
        currentTrack = null;
        preloadedNextTrack = null;
        isPlaying = false;
        playbackState = PlaybackState.STOPPED;
        isInitialized = false;
        mediaElementsReady = false;
        
        Object.keys(callbacks).forEach(function(key) {
            callbacks[key] = null;
        });
    }

    return {
        init: init,
        loadTrack: loadTrack,
        play: play,
        pause: pause,
        togglePlayPause: togglePlayPause,
        stop: stop,
        seek: seek,
        seekPercent: seekPercent,
        seekRelative: seekRelative,
        setVolume: setVolume,
        getVolume: getVolume,
        mute: mute,
        unmute: unmute,
        toggleMute: toggleMute,
        isMuted: isMuted,
        switchMode: switchMode,
        setQuality: setQuality,
        getQuality: getQuality,
        getCurrentTime: getCurrentTime,
        getDuration: getDuration,
        getProgress: getProgress,
        getRemainingTime: getRemainingTime,
        getIsPlaying: getIsPlaying,
        getCurrentMode: getCurrentMode,
        getCurrentTrack: getCurrentTrack,
        getAudioElement: getAudioElement,
        getVideoElement: getVideoElement,
        formatTime: formatTime,
        on: on,
        off: off,
        saveStateToStorage: saveStateToStorage,
        loadStateFromStorage: loadStateFromStorage,
        enterFullscreen: enterFullscreen,
        exitFullscreen: exitFullscreen,
        toggleFullscreen: toggleFullscreen,
        isFullscreen: isFullscreen,
        preloadTrack: preloadTrack,
        destroy: destroy,
        startSeek: startSeek,
        endSeek: endSeek,
        isCurrentlySeeking: isCurrentlySeeking,
        setPlaybackRate: setPlaybackRate,
        getPlaybackRate: getPlaybackRate,
        getUserHasInteracted: getUserHasInteracted,
        getIsMobile: getIsMobile,
        getIsIOS: getIsIOS,
        getPlaybackState: getPlaybackState,
        isMediaReady: isMediaReady
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = PlayerEngine;
}
```

 
--- 

/js\playlist.js:

```js
const PlaylistManager = (function() {
    const tracks = [
        {
            id: 1,
            number: '01',
            title: 'Oberarzt Dr. med. Placzek',
            artist: 'Deus ex CT',
            duration: '02:12',
            durationSeconds: 132,
            audioSrc: 'assets/audio/01-Oberarzt_Dr_med_Placzek.mp3',
            imageSrc: 'assets/images/01-Oberarzt_Dr_med_Placzek.png',
            lyricsSrc: 'assets/lyrics/01-Oberarzt_Dr_med_Placzek.lrc',
            backgroundSrc: 'assets/video/background/01-Oberarzt_Dr_med_Placzek.mp4',
            videoSrc: {
                low: 'assets/video/low/01-Oberarzt_Dr_med_Placzek_Lyrics_low.mp4',
                mid: 'assets/video/mid/01-Oberarzt_Dr_med_Placzek_Lyrics_mid.mp4',
                high: 'assets/video/high/01-Oberarzt_Dr_med_Placzek_Lyrics_hq.mp4'
            },
            slug: 'oberarzt-dr-med-placzek'
        },
        {
            id: 2,
            number: '02',
            title: 'Oberarzt der Herzen',
            artist: 'Deus ex CT',
            duration: '03:32',
            durationSeconds: 212,
            audioSrc: 'assets/audio/02-Oberarzt_der_Herzen.mp3',
            imageSrc: 'assets/images/02-Oberarzt_der_Herzen.png',
            lyricsSrc: 'assets/lyrics/02-Oberarzt_der_Herzen.lrc',
            backgroundSrc: 'assets/video/background/02-Oberarzt_der_Herzen.mp4',
            videoSrc: {
                low: 'assets/video/low/02-Oberarzt_der_Herzen_Lyrics_low.mp4',
                mid: 'assets/video/mid/02-Oberarzt_der_Herzen_Lyrics_mid.mp4',
                high: 'assets/video/high/02-Oberarzt_der_Herzen_Lyrics_hq.mp4'
            },
            slug: 'oberarzt-der-herzen'
        },
        {
            id: 3,
            number: '03',
            title: 'Vier-Eins-Neun-Zwei',
            artist: 'Deus ex CT',
            duration: '04:14',
            durationSeconds: 254,
            audioSrc: 'assets/audio/03-Vier-Eins-Neun-Zwei.mp3',
            imageSrc: 'assets/images/03-Vier-Eins-Neun-Zwei.png',
            lyricsSrc: 'assets/lyrics/03-Vier-Eins-Neun-Zwei.lrc',
            backgroundSrc: 'assets/video/background/03-Vier-Eins-Neun-Zwei.mp4',
            videoSrc: {
                low: 'assets/video/low/03-Vier-Eins-Neun-Zwei_Lyrics_low.mp4',
                mid: 'assets/video/mid/03-Vier-Eins-Neun-Zwei_Lyrics_mid.mp4',
                high: 'assets/video/high/03-Vier-Eins-Neun-Zwei_Lyrics_hq.mp4'
            },
            slug: 'vier-eins-neun-zwei'
        },
        {
            id: 4,
            number: '04',
            title: 'Pilot im Pixelmeer',
            artist: 'Deus ex CT',
            duration: '03:59',
            durationSeconds: 239,
            audioSrc: 'assets/audio/04-Pilot_im_Pixelmeer.mp3',
            imageSrc: 'assets/images/04-Pilot_im_Pixelmeer.png',
            lyricsSrc: 'assets/lyrics/04-Pilot_im_Pixelmeer.lrc',
            backgroundSrc: 'assets/video/background/04-Pilot_im_Pixelmeer.mp4',
            videoSrc: {
                low: 'assets/video/low/04-Pilot_im_Pixelmeer_Lyrics_low.mp4',
                mid: 'assets/video/mid/04-Pilot_im_Pixelmeer_Lyrics_mid.mp4',
                high: 'assets/video/high/04-Pilot_im_Pixelmeer_Lyrics_hq.mp4'
            },
            slug: 'pilot-im-pixelmeer'
        },
        {
            id: 5,
            number: '05',
            title: 'Drei Gebote',
            artist: 'Deus ex CT',
            duration: '03:54',
            durationSeconds: 234,
            audioSrc: 'assets/audio/05-Drei_Gebote.mp3',
            imageSrc: 'assets/images/05-Drei_Gebote.png',
            lyricsSrc: 'assets/lyrics/05-Drei_Gebote.lrc',
            backgroundSrc: 'assets/video/background/05-Drei_Gebote.mp4',
            videoSrc: {
                low: 'assets/video/low/05-Drei_Gebote_Lyrics_low.mp4',
                mid: 'assets/video/mid/05-Drei_Gebote_Lyrics_mid.mp4',
                high: 'assets/video/high/05-Drei_Gebote_Lyrics_hq.mp4'
            },
            slug: 'drei-gebote'
        },
        {
            id: 6,
            number: '06',
            title: 'Kunst der Diagnostik',
            artist: 'Deus ex CT',
            duration: '03:26',
            durationSeconds: 206,
            audioSrc: 'assets/audio/06-Kunst_der_Diagnostik.mp3',
            imageSrc: 'assets/images/06-Kunst_der_Diagnostik.png',
            lyricsSrc: 'assets/lyrics/06-Kunst_der_Diagnostik.lrc',
            backgroundSrc: 'assets/video/background/06-Kunst_der_Diagnostik.mp4',
            videoSrc: {
                low: 'assets/video/low/06-Kunst_der_Diagnostik_Lyrics_low.mp4',
                mid: 'assets/video/mid/06-Kunst_der_Diagnostik_Lyrics_mid.mp4',
                high: 'assets/video/high/06-Kunst_der_Diagnostik_Lyrics_hq.mp4'
            },
            slug: 'kunst-der-diagnostik'
        },
        {
            id: 7,
            number: '07',
            title: 'Mit harter Hand und Charme',
            artist: 'Deus ex CT',
            duration: '03:46',
            durationSeconds: 226,
            audioSrc: 'assets/audio/07-Mit_harter_Hand_und_Charme.mp3',
            imageSrc: 'assets/images/07-Mit_harter_Hand_und_Charme.png',
            lyricsSrc: 'assets/lyrics/07-Mit_harter_Hand_und_Charme.lrc',
            backgroundSrc: 'assets/video/background/07-Mit_harter_Hand_und_Charme.mp4',
            videoSrc: {
                low: 'assets/video/low/07-Mit_harter_Hand_und_Charme_Lyrics_low.mp4',
                mid: 'assets/video/mid/07-Mit_harter_Hand_und_Charme_Lyrics_mid.mp4',
                high: 'assets/video/high/07-Mit_harter_Hand_und_Charme_Lyrics_hq.mp4'
            },
            slug: 'mit-harter-hand-und-charme'
        },
        {
            id: 8,
            number: '08',
            title: 'Durch Feuer und Eis',
            artist: 'Deus ex CT',
            duration: '03:09',
            durationSeconds: 189,
            audioSrc: 'assets/audio/08-Durch_Feuer_und_Eis.mp3',
            imageSrc: 'assets/images/08-Durch_Feuer_und_Eis.png',
            lyricsSrc: 'assets/lyrics/08-Durch_Feuer_und_Eis.lrc',
            backgroundSrc: 'assets/video/background/08-Durch_Feuer_und_Eis.mp4',
            videoSrc: {
                low: 'assets/video/low/08-Durch_Feuer_und_Eis_Lyrics_low.mp4',
                mid: 'assets/video/mid/08-Durch_Feuer_und_Eis_Lyrics_mid.mp4',
                high: 'assets/video/high/08-Durch_Feuer_und_Eis_Lyrics_hq.mp4'
            },
            slug: 'durch-feuer-und-eis'
        },
        {
            id: 9,
            number: '09',
            title: 'Held und Idol',
            artist: 'Deus ex CT',
            duration: '04:02',
            durationSeconds: 242,
            audioSrc: 'assets/audio/09-Held_und_Idol.mp3',
            imageSrc: 'assets/images/09-Held_und_Idol.png',
            lyricsSrc: 'assets/lyrics/09-Held_und_Idol.lrc',
            backgroundSrc: 'assets/video/background/09-Held_und_Idol.mp4',
            videoSrc: {
                low: 'assets/video/low/09-Held_und_Idol_Lyrics_low.mp4',
                mid: 'assets/video/mid/09-Held_und_Idol_Lyrics_mid.mp4',
                high: 'assets/video/high/09-Held_und_Idol_Lyrics_hq.mp4'
            },
            slug: 'held-und-idol'
        },
        {
            id: 10,
            number: '10',
            title: 'Messerscharf und LegendÃ¤r',
            artist: 'Deus ex CT',
            duration: '03:19',
            durationSeconds: 199,
            audioSrc: 'assets/audio/10-Messerscharf_und_Legendaer.mp3',
            imageSrc: 'assets/images/10-Messerscharf_und_Legendaer.png',
            lyricsSrc: 'assets/lyrics/10-Messerscharf_und_Legendaer.lrc',
            backgroundSrc: 'assets/video/background/10-Messerscharf_und_Legendaer.mp4',
            videoSrc: {
                low: 'assets/video/low/10-Messerscharf_und_Legendaer_Lyrics_low.mp4',
                mid: 'assets/video/mid/10-Messerscharf_und_Legendaer_Lyrics_mid.mp4',
                high: 'assets/video/high/10-Messerscharf_und_Legendaer_Lyrics_hq.mp4'
            },
            slug: 'messerscharf-und-legendaer'
        },
        {
            id: 11,
            number: '11',
            title: 'OberÃ¤rztlicher Glanz',
            artist: 'Deus ex CT',
            duration: '03:14',
            durationSeconds: 194,
            audioSrc: 'assets/audio/11-Oberaerztlicher_Glanz.mp3',
            imageSrc: 'assets/images/11-Oberaerztlicher_Glanz.png',
            lyricsSrc: 'assets/lyrics/11-Oberaerztlicher_Glanz.lrc',
            backgroundSrc: 'assets/video/background/11-Oberaerztlicher_Glanz.mp4',
            videoSrc: {
                low: 'assets/video/low/11-Oberaerztlicher_Glanz_Lyrics_low.mp4',
                mid: 'assets/video/mid/11-Oberaerztlicher_Glanz_Lyrics_mid.mp4',
                high: 'assets/video/high/11-Oberaerztlicher_Glanz_Lyrics_hq.mp4'
            },
            slug: 'oberaerztlicher-glanz'
        },
        {
            id: 12,
            number: '12',
            title: 'GÃ¶tterdÃ¤mmerung',
            artist: 'Deus ex CT',
            duration: '05:03',
            durationSeconds: 303,
            audioSrc: 'assets/audio/12-Goetterdaemmerung.mp3',
            imageSrc: 'assets/images/12-Goetterdaemmerung.png',
            lyricsSrc: 'assets/lyrics/12-Goetterdaemmerung.lrc',
            backgroundSrc: 'assets/video/background/12-Goetterdaemmerung.mp4',
            videoSrc: {
                low: 'assets/video/low/12-Goetterdaemmerung_Lyrics_low.mp4',
                mid: 'assets/video/mid/12-Goetterdaemmerung_Lyrics_mid.mp4',
                high: 'assets/video/high/12-Goetterdaemmerung_Lyrics_hq.mp4'
            },
            slug: 'goetterdaemmerung'
        }
    ];

    const albumInfo = {
        title: 'Deus ex CT',
        artist: 'Oberarzt Dr. med. Placzek',
        coverSrc: 'assets/images/00-Albumcover.png',
        totalTracks: 12,
        totalDuration: '40:50',
        totalDurationSeconds: 2450,
        downloadSrc: 'assets/downloads/Deus_ex_CT_Complete.zip',
        allVideosZipSrc: 'assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip'
    };

    let currentIndex = 0;

    function getTracks() {
        return [...tracks];
    }

    function getTrackById(id) {
        return tracks.find(function(track) {
            return track.id === id;
        }) || null;
    }

    function getTrackByIndex(index) {
        if (index >= 0 && index < tracks.length) {
            return tracks[index];
        }
        return null;
    }

    function getTrackBySlug(slug) {
        return tracks.find(function(track) {
            return track.slug === slug;
        }) || null;
    }

    function getTrackIndex(trackId) {
        return tracks.findIndex(function(track) {
            return track.id === trackId;
        });
    }

    function getCurrentTrack() {
        return tracks[currentIndex];
    }

    function getCurrentIndex() {
        return currentIndex;
    }

    function setCurrentIndex(index) {
        if (index >= 0 && index < tracks.length) {
            currentIndex = index;
            return true;
        }
        return false;
    }

    function getAlbumInfo() {
        return { ...albumInfo };
    }

    function getNextTrack() {
        const nextIndex = currentIndex + 1;
        if (nextIndex >= tracks.length) {
            return null;
        }
        return tracks[nextIndex];
    }

    function getPreviousTrack() {
        const prevIndex = currentIndex - 1;
        if (prevIndex < 0) {
            return tracks[0];
        }
        return tracks[prevIndex];
    }

    function moveToNext() {
        const nextIndex = currentIndex + 1;
        if (nextIndex >= tracks.length) {
            return null;
        }
        currentIndex = nextIndex;
        return tracks[currentIndex];
    }

    function moveToPrevious() {
        let prevIndex = currentIndex - 1;
        if (prevIndex < 0) {
            prevIndex = 0;
        }
        currentIndex = prevIndex;
        return tracks[currentIndex];
    }

    function playTrackById(id) {
        const index = getTrackIndex(id);
        if (index !== -1) {
            currentIndex = index;
            return tracks[index];
        }
        return null;
    }

    function playTrackBySlug(slug) {
        const track = getTrackBySlug(slug);
        if (track) {
            return playTrackById(track.id);
        }
        return null;
    }

    function hasNextTrack() {
        return currentIndex < tracks.length - 1;
    }

    function hasPreviousTrack() {
        return currentIndex > 0;
    }

    function getPlaylistForDisplay() {
        return tracks.map(function(track, index) {
            return {
                ...track,
                displayIndex: index,
                isCurrentTrack: index === currentIndex
            };
        });
    }

    function getTotalDuration() {
        return tracks.reduce(function(total, track) {
            return total + track.durationSeconds;
        }, 0);
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return mins + ':' + (secs < 10 ? '0' : '') + secs;
    }

    function formatTotalDuration() {
        const totalSeconds = getTotalDuration();
        const hours = Math.floor(totalSeconds / 3600);
        const mins = Math.floor((totalSeconds % 3600) / 60);
        if (hours > 0) {
            return hours + ' Std. ' + mins + ' Min.';
        }
        return mins + ' Min.';
    }

    function reset() {
        currentIndex = 0;
    }

    function getState() {
        return {
            currentIndex: currentIndex,
            currentTrack: getCurrentTrack()
        };
    }

    function setState(state) {
        if (state.currentIndex !== undefined) {
            setCurrentIndex(state.currentIndex);
        }
    }

    function saveToStorage() {
        try {
            const state = {
                currentIndex: currentIndex
            };
            localStorage.setItem('deusExCT_playlistState', JSON.stringify(state));
        } catch (e) {
        }
    }

    function loadFromStorage() {
        try {
            const saved = localStorage.getItem('deusExCT_playlistState');
            if (saved) {
                const state = JSON.parse(saved);
                setState(state);
                return true;
            }
        } catch (e) {
        }
        return false;
    }

    return {
        getTracks: getTracks,
        getTrackById: getTrackById,
        getTrackByIndex: getTrackByIndex,
        getTrackBySlug: getTrackBySlug,
        getTrackIndex: getTrackIndex,
        getCurrentTrack: getCurrentTrack,
        getCurrentIndex: getCurrentIndex,
        setCurrentIndex: setCurrentIndex,
        getAlbumInfo: getAlbumInfo,
        getNextTrack: getNextTrack,
        getPreviousTrack: getPreviousTrack,
        moveToNext: moveToNext,
        moveToPrevious: moveToPrevious,
        playTrackById: playTrackById,
        playTrackBySlug: playTrackBySlug,
        hasNextTrack: hasNextTrack,
        hasPreviousTrack: hasPreviousTrack,
        getPlaylistForDisplay: getPlaylistForDisplay,
        getTotalDuration: getTotalDuration,
        formatTime: formatTime,
        formatTotalDuration: formatTotalDuration,
        reset: reset,
        getState: getState,
        setState: setState,
        saveToStorage: saveToStorage,
        loadFromStorage: loadFromStorage
    };
})();

if (typeof module !== 'undefined' && module.exports) {
    module.exports = PlaylistManager;
}
```

