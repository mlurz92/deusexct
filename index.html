<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deus ex CT">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="assets/images/00-Albumcover.png">
    <meta name="description" content="Deus ex CT - Das Album von Oberarzt Dr. med. Placzek. Streame alle Songs mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta name="keywords" content="Deus ex CT, Oberarzt Dr. med. Placzek, Album, Musik, Lyrics, Video">
    <meta name="author" content="Deus ex CT">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta id="appVersionMeta" name="app-version" content="">
    <meta id="appBuildTimeMeta" name="app-build-time" content="">
    <meta property="og:title" content="Deus ex CT - Das Album">
    <meta property="og:description" content="Streame das komplette Album mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta property="og:image" content="assets/images/00-Albumcover.png">
    <meta property="og:type" content="music.album">
    <meta property="og:url" content="https://deus-ex-ct.markuslurz.de">
    <meta property="og:site_name" content="Deus ex CT">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Deus ex CT - Das Album">
    <meta name="twitter:description" content="Streame das komplette Album mit Lyrics-Videos und synchronisierten Songtexten.">
    <meta name="twitter:image" content="assets/images/00-Albumcover.png">
    <title>Deus ex CT - Das Album</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/00-Albumcover.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/00-Albumcover.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/00-Albumcover.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="assets/images/00-Albumcover.png" as="image" type="image/png">
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="css/styles.css">
    <script>
        (function() {
            var CACHE_KEY = 'deusExCT_buildVersion';
            var CACHE_TIMESTAMP_KEY = 'deusExCT_buildTimestamp';
            var BUILD_TIMESTAMP = Math.floor(Date.now() / 1000);
            var BUILD_VERSION = '11.0';
            var ASSET_VERSION = BUILD_VERSION + '.' + BUILD_TIMESTAMP;

            function updateVersionMeta() {
                try {
                    var versionMeta = document.getElementById('appVersionMeta');
                    var timeMeta = document.getElementById('appBuildTimeMeta');
                    if (versionMeta) versionMeta.setAttribute('content', BUILD_VERSION);
                    if (timeMeta) timeMeta.setAttribute('content', new Date(BUILD_TIMESTAMP * 1000).toISOString());
                } catch (e) {}
            }

            function updateScriptVersions() {
                try {
                    var scripts = document.querySelectorAll('script[src]');
                    for (var i = 0; i < scripts.length; i++) {
                        var src = scripts[i].getAttribute('src');
                        if (src && src.indexOf('js/') === 0) {
                            if (src.indexOf('?v=') === -1) {
                                scripts[i].setAttribute('src', src + '?v=' + ASSET_VERSION);
                            }
                        }
                    }
                    var links = document.querySelectorAll('link[href*="css/"]');
                    for (var i = 0; i < links.length; i++) {
                        var href = links[i].getAttribute('href');
                        if (href && href.indexOf('?v=') === -1) {
                            links[i].setAttribute('href', href + '?v=' + ASSET_VERSION);
                        }
                    }
                } catch (e) {}
            }

            function clearIndexedDB() {
                return new Promise(function(resolve) {
                    if (!window.indexedDB) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        if (window.indexedDB.databases && typeof window.indexedDB.databases === 'function') {
                            window.indexedDB.databases().then(function(dbs) {
                                clearTimeout(timeout);
                                if (dbs && dbs.length > 0) {
                                    var deletePromises = [];
                                    for (var i = 0; i < dbs.length; i++) {
                                        try {
                                            deletePromises.push(
                                                new Promise(function(resolveDelete) {
                                                    try {
                                                        window.indexedDB.deleteDatabase(dbs[i].name);
                                                        setTimeout(resolveDelete, 100);
                                                    } catch (e) {
                                                        resolveDelete();
                                                    }
                                                })
                                            );
                                        } catch (e) {}
                                    }
                                    Promise.all(deletePromises).then(resolve).catch(resolve);
                                } else {
                                    resolve();
                                }
                            }).catch(function() {
                                clearTimeout(timeout);
                                resolve();
                            });
                        } else {
                            clearTimeout(timeout);
                            resolve();
                        }
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function clearAllStorage() {
                try {
                    var keysToRemove = [];
                    for (var i = 0; i < localStorage.length; i++) {
                        var key = localStorage.key(i);
                        if (key) {
                            keysToRemove.push(key);
                        }
                    }
                    for (var i = 0; i < keysToRemove.length; i++) {
                        try {
                            localStorage.removeItem(keysToRemove[i]);
                        } catch (e) {}
                    }
                } catch (e) {}

                try {
                    sessionStorage.clear();
                } catch (e) {}
            }

            function clearBrowserCaches() {
                return new Promise(function(resolve) {
                    if (!window.caches) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        caches.keys().then(function(names) {
                            clearTimeout(timeout);
                            if (names && names.length > 0) {
                                var deletePromises = [];
                                for (var i = 0; i < names.length; i++) {
                                    try {
                                        deletePromises.push(
                                            new Promise(function(resolveDelete) {
                                                caches.delete(names[i]).then(resolveDelete).catch(resolveDelete);
                                            })
                                        );
                                    } catch (e) {}
                                }
                                Promise.all(deletePromises).then(resolve).catch(resolve);
                            } else {
                                resolve();
                            }
                        }).catch(function() {
                            clearTimeout(timeout);
                            resolve();
                        });
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function unregisterServiceWorkers() {
                return new Promise(function(resolve) {
                    if (!navigator.serviceWorker) {
                        resolve();
                        return;
                    }

                    var timeout = setTimeout(function() {
                        resolve();
                    }, 2000);

                    try {
                        navigator.serviceWorker.getRegistrations().then(function(registrations) {
                            clearTimeout(timeout);
                            if (registrations && registrations.length > 0) {
                                var unregisterPromises = [];
                                for (var i = 0; i < registrations.length; i++) {
                                    try {
                                        unregisterPromises.push(
                                            new Promise(function(resolveUnregister) {
                                                registrations[i].unregister().then(resolveUnregister).catch(resolveUnregister);
                                            })
                                        );
                                    } catch (e) {}
                                }
                                Promise.all(unregisterPromises).then(resolve).catch(resolve);
                            } else {
                                resolve();
                            }
                        }).catch(function() {
                            clearTimeout(timeout);
                            resolve();
                        });
                    } catch (e) {
                        clearTimeout(timeout);
                        resolve();
                    }
                });
            }

            function shouldPerformCleanup() {
                try {
                    var storedVersion = localStorage.getItem(CACHE_KEY);
                    var storedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);

                    if (storedVersion !== BUILD_VERSION) {
                        return true;
                    }

                    if (!storedTimestamp) {
                        return true;
                    }

                    var lastTimestamp = parseInt(storedTimestamp, 10);
                    if (isNaN(lastTimestamp)) {
                        return true;
                    }

                    if (BUILD_TIMESTAMP > lastTimestamp) {
                        return true;
                    }

                    return false;
                } catch (e) {
                    return true;
                }
            }

            function recordCleanupCompletion() {
                try {
                    localStorage.setItem(CACHE_KEY, BUILD_VERSION);
                    localStorage.setItem(CACHE_TIMESTAMP_KEY, BUILD_TIMESTAMP.toString());
                } catch (e) {}
            }

            function performAsyncCleanup() {
                clearAllStorage();

                Promise.all([
                    clearIndexedDB(),
                    clearBrowserCaches(),
                    unregisterServiceWorkers()
                ]).then(function() {
                    recordCleanupCompletion();
                }).catch(function() {
                    recordCleanupCompletion();
                });
            }

            function initializeApp() {
                updateVersionMeta();
                updateScriptVersions();

                if (shouldPerformCleanup()) {
                    clearAllStorage();
                    recordCleanupCompletion();
                    performAsyncCleanup();
                } else {
                    performAsyncCleanup();
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                initializeApp();
            }

            window.addEventListener('load', function() {
                try {
                    if (navigator.serviceWorker && navigator.serviceWorker.getRegistrations) {
                        navigator.serviceWorker.getRegistrations().then(function(registrations) {
                            for (var i = 0; i < registrations.length; i++) {
                                try {
                                    registrations[i].unregister();
                                } catch (e) {}
                            }
                        }).catch(function() {});
                    }
                } catch (e) {}
            });

            window.APP_VERSION = BUILD_VERSION;
            window.ASSET_VERSION = ASSET_VERSION;
        })();
    </script>
</head>
<body>
    <div id="app">
        <div class="bg-video-container" id="bgVideoContainer">
            <video id="bgVideo" class="bg-video" loop muted playsinline webkit-playsinline x5-playsinline x5-video-player-type="h5" x5-video-player-fullscreen="false" disablePictureInPicture disableRemotePlayback preload="none"></video>
            <div class="bg-video-overlay"></div>
        </div>

        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <button class="header-btn hidden" id="backBtn" aria-label="Zurück zur Übersicht" type="button">
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="header-center hidden" id="headerTrackInfo">
                    <div class="header-text-group">
                        <div class="header-scroller">
                            <span class="header-track-title" id="headerTitleText"></span>
                        </div>
                        <span class="header-separator" aria-hidden="true">•</span>
                        <span class="header-track-artist">Deus ex CT</span>
                    </div>
                    <div class="header-mode-switch" id="headerModeSwitch" role="tablist" aria-label="Wiedergabemodus">
                        <button class="mode-switch-btn active" id="audioModeBtn" aria-label="Audio-Modus" aria-selected="true" role="tab" type="button">
                            <i class="fas fa-music" aria-hidden="true"></i>
                        </button>
                        <button class="mode-switch-btn" id="videoModeBtn" aria-label="Video-Modus" aria-selected="false" role="tab" type="button">
                            <i class="fas fa-film" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>

                <div class="header-right">
                    <button class="header-btn hidden" id="headerInstallBtn" aria-label="App installieren" type="button">
                        <i class="fas fa-download" aria-hidden="true"></i>
                    </button>
                    <button class="header-btn" id="headerDownloadBtn" aria-label="Downloads anzeigen" type="button">
                        <i class="fas fa-cloud-arrow-down" aria-hidden="true"></i>
                    </button>
                    <button class="header-btn" id="menuBtn" aria-label="Menü öffnen" type="button">
                        <i class="fas fa-ellipsis-v" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content" id="mainContent" role="main">
            <section class="view-section album-view" id="albumView" aria-label="Album-Übersicht">
                <div class="album-layout-grid">
                    <div class="album-hero">
                        <div class="album-artwork-container">
                            <img src="assets/images/00-Albumcover.png" alt="Deus ex CT Album Cover" class="album-artwork" id="albumArtwork" width="512" height="512" fetchpriority="high" decoding="async">
                            <div class="artwork-reflection" aria-hidden="true"></div>
                        </div>
                        <div class="album-info">
                            <h1 class="album-title">Deus ex CT</h1>
                            <p class="album-artist">Oberarzt Dr. med. Placzek</p>
                            <p class="album-meta">12 Songs • 40 Min.</p>
                        </div>
                        <div class="album-actions">
                            <button class="action-btn primary-btn" id="playAllBtn" type="button">
                                <i class="fas fa-play" aria-hidden="true"></i>
                                <span>Abspielen</span>
                            </button>
                            <button class="action-btn secondary-btn" id="downloadAllVideosBtn" type="button">
                                <i class="fas fa-film" aria-hidden="true"></i>
                                <span>Alle Videos (HQ)</span>
                            </button>
                            <button class="action-btn secondary-btn hidden" id="installAppHeroBtn" type="button">
                                <i class="fas fa-mobile-screen-button" aria-hidden="true"></i>
                                <span>Installieren</span>
                            </button>
                            <button class="action-btn download-btn" id="downloadAlbumBtn" type="button">
                                <i class="fas fa-file-zipper" aria-hidden="true"></i>
                                <span>Album MP3s</span>
                            </button>
                        </div>
                    </div>
                    <div class="playlist-container">
                        <ul class="playlist" id="playlist" role="list" aria-label="Tracklist"></ul>
                    </div>
                </div>
            </section>

            <section class="view-section player-view hidden" id="playerView" aria-label="Player">
                <div class="player-audio-layout" id="playerAudioLayout">
                    <div class="audio-stage-top">
                        <div class="artwork-wrapper active" id="artworkWrapper">
                            <img src="assets/images/00-Albumcover.png" alt="Aktuelles Track Cover" class="player-artwork-large" id="playerArtwork" width="512" height="512" decoding="async">
                        </div>
                    </div>
                    <div class="audio-stage-bottom">
                        <div class="player-lyrics-area" aria-live="polite" aria-atomic="false">
                            <p class="player-prev-lyric" id="prevLyric" aria-hidden="true"></p>
                            <p class="player-current-lyric" id="currentLyric" aria-label="Aktueller Songtext"></p>
                            <p class="player-next-lyric" id="nextLyric" aria-hidden="true"></p>
                        </div>
                    </div>
                </div>

                <div class="player-video-layout hidden" id="playerVideoLayout">
                    <div class="video-flex-container">
                        <div class="video-wrapper" id="videoWrapper">
                            <video id="videoPlayer" playsinline webkit-playsinline x5-playsinline x5-video-player-type="h5" x5-video-player-fullscreen="false" disablePictureInPicture preload="auto"></video>
                            <div class="video-overlay-controls" id="videoOverlay">
                                <button class="video-big-play-btn" id="videoPlayBtn" aria-label="Wiedergabe starten" type="button">
                                    <i class="fas fa-play" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <div class="video-external-controls">
                            <div class="video-quality-group" role="group" aria-label="Videoqualität">
                                <span class="video-ctrl-label" id="qualityLabel">Qualität:</span>
                                <button class="quality-tag" data-quality="low" aria-describedby="qualityLabel" type="button">LOW</button>
                                <button class="quality-tag active" data-quality="mid" aria-describedby="qualityLabel" aria-pressed="true" type="button">MID</button>
                                <button class="quality-tag" data-quality="high" aria-describedby="qualityLabel" type="button">HQ</button>
                            </div>
                            <button class="fullscreen-btn-ext" id="fullscreenBtn" aria-label="Vollbild umschalten" type="button">
                                <i class="fas fa-expand" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <div class="player-bottom-bar hidden" id="playerBottomBar" role="region" aria-label="Player-Steuerung">
            <div class="bar-progress-container">
                <div class="bar-progress-fill" id="progressBarFill" aria-hidden="true"></div>
                <div class="time-tooltip" id="timeTooltip" aria-hidden="true">0:00</div>
                <input type="range" class="bar-progress-input" id="progressBar" min="0" max="100" value="0" step="0.1" aria-label="Wiedergabefortschritt" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            </div>

            <div class="bar-content-grid">
                <div class="bar-section info-section">
                    <div class="bar-text-wrapper">
                        <span class="bar-track-title" id="trackTitle">Titel</span>
                        <span class="bar-track-artist" id="trackArtist">Deus ex CT</span>
                    </div>
                </div>

                <div class="bar-section controls-section" role="group" aria-label="Wiedergabesteuerung">
                    <button class="subtle-btn medium" id="prevBtn" aria-label="Vorheriger Track" type="button">
                        <i class="fas fa-backward-step" aria-hidden="true"></i>
                    </button>
                    <button class="subtle-btn large play-pause-btn" id="playPauseBtn" aria-label="Wiedergabe/Pause" type="button">
                        <i class="fas fa-play" id="playPauseIcon" aria-hidden="true"></i>
                    </button>
                    <button class="subtle-btn medium" id="nextBtn" aria-label="Nächster Track" type="button">
                        <i class="fas fa-forward-step" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="bar-section actions-section" role="group" aria-label="Lautstärke">
                    <button class="subtle-action-btn volume-btn-toggle" id="volumeMuteBtn" aria-label="Stumm schalten" type="button">
                        <i class="fas fa-volume-high" id="volumeIcon" aria-hidden="true"></i>
                    </button>
                    <div class="bar-volume-slider-container">
                        <input type="range" class="volume-range" id="volumeBar" min="0" max="100" value="100" aria-label="Lautstärke" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100">
                    </div>
                </div>
            </div>
        </div>

        <div class="mini-player hidden" id="miniPlayer" role="region" aria-label="Mini-Player">
            <div class="mini-player-progress" id="miniPlayerProgress" aria-hidden="true"></div>
            <div class="mini-player-content">
                <img src="assets/images/00-Albumcover.png" alt="Cover" class="mini-artwork" id="miniArtwork" width="40" height="40" loading="lazy" decoding="async">
                <div class="mini-info">
                    <p class="mini-title" id="miniTitle">Kein Song</p>
                    <p class="mini-lyric" id="miniLyric" aria-live="off"></p>
                </div>
                <div class="mini-controls" role="group" aria-label="Mini-Player Steuerung">
                    <button class="mini-btn" id="miniPrevBtn" aria-label="Vorheriger Track" type="button">
                        <i class="fas fa-backward-step" aria-hidden="true"></i>
                    </button>
                    <button class="mini-btn" id="miniPlayPauseBtn" aria-label="Wiedergabe/Pause" type="button">
                        <i class="fas fa-play" id="miniPlayPauseIcon" aria-hidden="true"></i>
                    </button>
                    <button class="mini-btn" id="miniNextBtn" aria-label="Nächster Track" type="button">
                        <i class="fas fa-forward-step" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="playlistModal" role="dialog" aria-modal="true" aria-labelledby="playlistModalTitle">
            <div class="modal-backdrop" id="modalBackdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="playlistModalTitle">Wiedergabeliste</h2>
                    <button class="modal-close" id="closePlaylistModal" aria-label="Schließen" type="button">
                        <i class="fas fa-xmark" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <ul class="modal-playlist" id="modalPlaylist" role="list"></ul>
                </div>
            </div>
        </div>

        <div class="modal hidden" id="downloadModal" role="dialog" aria-modal="true" aria-labelledby="downloadModalTitle">
            <div class="modal-backdrop" id="downloadModalBackdrop"></div>
            <div class="modal-content download-modal-content">
                <div class="modal-header">
                    <h2 id="downloadModalTitle">Download Optionen</h2>
                    <button class="modal-close" id="closeDownloadModal" aria-label="Schließen" type="button">
                        <i class="fas fa-xmark" aria-hidden="true"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="download-options" role="list">
                        <a href="#" class="download-option hidden" id="downloadSingleVideoOption" download role="listitem">
                            <i class="fas fa-film" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Aktuelles Video (HQ)</span>
                                <span class="dl-meta">Nur diesen Song</span>
                            </div>
                        </a>
                        <a href="assets/downloads/Deus_ex_CT_Complete.zip" class="download-option" id="downloadAlbumOption" download="Deus_ex_CT_Complete.zip" role="listitem">
                            <i class="fas fa-music" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Album (MP3)</span>
                                <span class="dl-meta">Alle 12 Songs als ZIP</span>
                            </div>
                        </a>
                        <a href="assets/downloads/Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip" class="download-option" id="downloadAllVideosOption" download="Oberarzt_Dr_med_Placzek_Deus-Ex-CT_Lyrics-Videos_(HQ).zip" role="listitem">
                            <i class="fas fa-file-zipper" aria-hidden="true"></i>
                            <div class="dl-text">
                                <span class="dl-title">Alle Videos (HQ)</span>
                                <span class="dl-meta">Komplett als ZIP</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast" id="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>
    </div>

    <audio id="audioPlayer" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></audio>

    <script src="js/playlist.js"></script>
    <script src="js/lyrics.js"></script>
    <script src="js/player.js"></script>
    <script src="js/mediasession.js"></script>
    <script src="js/download.js"></script>
    <script src="js/app.js"></script>
</body>
</html>