<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="theme-color" content="#050712">
  <meta name="color-scheme" content="dark light">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Deus ex CT">
  <meta name="application-name" content="Deus ex CT">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="description" content="Deus ex CT – Album WebApp. Startseite mit Albumcover, Track-Übersicht, Deep-Links, Player (Audio/Video), Downloads.">
  <title>Deus ex CT</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./Cover/00-Albumcover.jpg">
  <link rel="apple-touch-icon" href="./Cover/00-Albumcover.jpg">
  <link rel="preload" as="style" href="./app.css">
  <link rel="stylesheet" href="./app.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body data-page="home">
  <div class="app">
    <header class="topbar">
      <div>
        <div class="brand">
          <span class="brandCover"><img id="hdrCover" src="./Cover/00-Albumcover.jpg" alt="Deus ex CT" decoding="async"></span>
          <div class="brandMeta">
            <div class="brandTitle" id="hdrTitle">Deus ex CT</div>
            <div class="brandSub" id="hdrSub">Start · Audio/Video · Downloads</div>
          </div>
        </div>

        <div class="topActions">
          <a class="pillBtn" id="goAudio" href="./player.html?track=01&mode=audio" aria-label="Audio Player öffnen"><i class="fa-solid fa-headphones"></i><span class="lbl">Audio</span></a>
          <a class="pillBtn" id="goVideo" href="./player.html?track=01&mode=video" aria-label="Video Player öffnen"><i class="fa-solid fa-film"></i><span class="lbl">Video</span></a>
          <a class="pillBtn" id="goTrack" href="./player.html?track=01&mode=audio" aria-label="Direkt zu Track 01"><i class="fa-solid fa-music"></i><span class="lbl">Track</span></a>
          <a class="pillBtn" id="goAlbum" href="./player.html?track=01&mode=audio&album=1" aria-label="Album MP3 laden"><i class="fa-solid fa-download"></i><span class="lbl">Album</span></a>
        </div>
      </div>
    </header>

    <main class="homeMain">
      <section class="homeHero" aria-label="Album">
        <div class="homeHeroBg" aria-hidden="true"></div>
        <div class="homeHeroInner">
          <div class="homeCover">
            <img id="heroCover" src="./Cover/00-Albumcover.jpg" alt="Deus ex CT Albumcover" decoding="async">
          </div>

          <div class="homeMeta">
            <h1 class="homeTitle" id="heroTitle">Deus ex CT</h1>
            <p class="homeLead" id="heroLead">Wähle, was du tun möchtest: Audio hören, Lyrics-Videos ansehen oder per Deep-Link direkt auf einen Track verweisen. Alle Songs liegen als Playlist im Player.</p>

            <div class="homeCtas" aria-label="Aktionen">
              <a class="homePrimary" id="ctaAudio" href="./player.html?track=01&mode=audio" aria-label="Audio Player"><i class="fa-solid fa-headphones"></i><span>Audio Player</span></a>
              <a class="homePrimary" id="ctaVideo" href="./player.html?track=01&mode=video" aria-label="Lyrics-Video Player"><i class="fa-solid fa-film"></i><span>Lyrics-Video Player</span></a>
              <a class="homeGhost" id="ctaAlbum" href="./player.html?track=01&mode=audio&album=1" aria-label="Album MP3 laden"><i class="fa-solid fa-download"></i><span>Album-MP3 laden</span></a>
              <a class="homeGhost" id="ctaPlayer" href="./player.html?track=01&mode=audio" aria-label="Player öffnen"><i class="fa-solid fa-play"></i><span>Player öffnen</span></a>
            </div>

            <p class="homeHint" id="heroHint">Deep-Link Beispiel: <span class="badge">player.html?track=03&amp;mode=video</span></p>
          </div>
        </div>
      </section>

      <section class="homeGrid" aria-label="Übersicht">
        <div class="homeCard" aria-label="Tracks">
          <div class="homeCardHead">
            <div>
              <div class="homeCardTitle" id="tracksTitle">Tracks</div>
              <div class="homeCardSub" id="tracksSub">Direkt-Links pro Track · Audio oder Video</div>
            </div>
            <span class="badge" id="tracksCount">12</span>
          </div>
          <div class="trackGrid" id="trackGrid"></div>
        </div>

        <div class="homeCard" aria-label="Downloads & Hinweise">
          <div class="homeCardHead">
            <div>
              <div class="homeCardTitle">Downloads</div>
              <div class="homeCardSub">Album-MP3 oder einzelne Dateien im Player</div>
            </div>
            <span class="badge">Tip</span>
          </div>
          <div style="padding:14px;display:flex;flex-direction:column;gap:10px">
            <div class="setRow">
              <div>
                <div class="setKey">Album-MP3</div>
                <div class="setVal">Startet den Album-Download im Player (zusammengefügte MP3 aus allen Tracks).</div>
              </div>
              <a class="tBtn" href="./player.html?track=01&mode=audio&album=1" aria-label="Album MP3 laden"><i class="fa-solid fa-download"></i><span>Start</span></a>
            </div>

            <div class="setRow">
              <div>
                <div class="setKey">Einzel-Downloads</div>
                <div class="setVal">MP3 / MP4 / LRC findest du pro Track direkt in der Player-Playlist (Download-Icons rechts).</div>
              </div>
              <a class="tBtn" href="./player.html?track=01&mode=audio" aria-label="Player öffnen"><i class="fa-solid fa-list"></i><span>Player</span></a>
            </div>

            <div class="setRow">
              <div>
                <div class="setKey">Lyrics-Anzeige</div>
                <div class="setVal">Im Player wird immer nur die aktuelle Zeile angezeigt (Karaoke-Einzeiler). Umschaltbar.</div>
              </div>
              <a class="tBtn" href="./player.html?track=01&mode=video" aria-label="Video Player öffnen"><i class="fa-solid fa-music"></i><span>Go</span></a>
            </div>

            <div class="setRow">
              <div>
                <div class="setKey">Deep-Links</div>
                <div class="setVal">Du kannst jeden Track direkt verlinken: <span class="badge">track=01..12</span> und <span class="badge">mode=audio|video</span>.</div>
              </div>
              <a class="tBtn" href="./player.html?track=03&mode=video" aria-label="Beispiel Link"><i class="fa-solid fa-link"></i><span>Demo</span></a>
            </div>
          </div>
        </div>

        <div class="homeCard" aria-label="Info">
          <div class="homeCardHead">
            <div>
              <div class="homeCardTitle">Kurz-Guide</div>
              <div class="homeCardSub">Schnellstart für Mobile & Desktop</div>
            </div>
            <span class="badge">UX</span>
          </div>
          <div style="padding:14px;display:flex;flex-direction:column;gap:10px">
            <div class="setRow">
              <div>
                <div class="setKey">Playlist</div>
                <div class="setVal">Im Player über <span class="badge">Liste</span> öffnen. Track antippen zum Abspielen.</div>
              </div>
              <a class="tBtn" href="./player.html?track=01&mode=audio" aria-label="Player öffnen"><i class="fa-solid fa-play"></i><span>Open</span></a>
            </div>

            <div class="setRow">
              <div>
                <div class="setKey">Audio/Video</div>
                <div class="setVal">Im Player oben per Modus-Button umschalten. Position wird übernommen.</div>
              </div>
              <a class="tBtn" href="./player.html?track=01&mode=video" aria-label="Video öffnen"><i class="fa-solid fa-film"></i><span>Video</span></a>
            </div>

            <div class="setRow">
              <div>
                <div class="setKey">Mobile Bedienung</div>
                <div class="setVal">Buttons oben sind horizontal scrollbar, damit nichts überläuft. Layout bleibt stabil.</div>
              </div>
              <a class="tBtn" href="#tracks" aria-label="Zu den Tracks"><i class="fa-solid fa-chevron-down"></i><span>Tracks</span></a>
            </div>
          </div>
        </div>
      </section>

      <footer class="homeFooter" aria-label="Footer">
        <div>© <span id="y"></span> Deus ex CT</div>
        <div><a href="./player.html?track=01&mode=audio">Player</a></div>
      </footer>
    </main>
  </div>

  <script>
    (() => {
      const FALLBACK_COVER = "./Cover/00-Albumcover.jpg";
      const $ = (s, r = document) => r.querySelector(s);
      const esc = (s) => String(s ?? "");
      const pad2 = (n) => String(n).padStart(2, "0");
      const safe = (s) => String(s ?? "").normalize("NFKD").replace(/[\u0000-\u001f<>:"/\\|?*\u007f]+/g, " ").replace(/\s+/g, " ").trim();
      const setImgFallback = (img) => { if (!img) return; img.onerror = () => { img.onerror = null; img.src = FALLBACK_COVER; }; };

      $("#y").textContent = String(new Date().getFullYear());

      const applyCatalog = (data) => {
        const album = data && data.album ? data.album : {};
        const tracks = Array.isArray(data && data.tracks) ? data.tracks : [];
        const title = safe(album.title || "Deus ex CT") || "Deus ex CT";
        const cover = esc(album.cover || FALLBACK_COVER);

        $("#hdrTitle").textContent = title;
        $("#heroTitle").textContent = title;
        $("#tracksCount").textContent = String(tracks.length || album.tracks || 12);

        const hdrCover = $("#hdrCover");
        hdrCover.src = cover;
        setImgFallback(hdrCover);

        const heroCover = $("#heroCover");
        heroCover.src = cover;
        setImgFallback(heroCover);

        const first = tracks[0] && tracks[0].id ? String(tracks[0].id) : "01";
        const firstId = /^\d{2}$/.test(first) ? first : pad2(parseInt(first, 10) || 1);

        const setHref = (id, mode) => `./player.html?track=${encodeURIComponent(id)}&mode=${encodeURIComponent(mode)}`;
        $("#goAudio").href = setHref(firstId, "audio");
        $("#goVideo").href = setHref(firstId, "video");
        $("#goTrack").href = setHref(firstId, "audio");
        $("#ctaAudio").href = setHref(firstId, "audio");
        $("#ctaVideo").href = setHref(firstId, "video");
        $("#ctaPlayer").href = setHref(firstId, "audio");
        $("#ctaAlbum").href = `./player.html?track=${encodeURIComponent(firstId)}&mode=audio&album=1`;
        $("#goAlbum").href = `./player.html?track=${encodeURIComponent(firstId)}&mode=audio&album=1`;

        const grid = $("#trackGrid");
        grid.id = "tracks";
        grid.textContent = "";
        const frag = document.createDocumentFragment();

        for (let i = 0; i < tracks.length; i++) {
          const t = tracks[i] || {};
          const id = /^\d{2}$/.test(String(t.id)) ? String(t.id) : pad2(i + 1);
          const name = safe(t.title || `Track ${id}`) || `Track ${id}`;
          const c = esc(t.cover || cover || FALLBACK_COVER);

          const card = document.createElement("div");
          card.className = "tCard";

          const imgWrap = document.createElement("div");
          imgWrap.className = "tImg";
          const img = document.createElement("img");
          img.decoding = "async";
          img.loading = "lazy";
          img.alt = name;
          img.src = c;
          setImgFallback(img);
          imgWrap.appendChild(img);

          const meta = document.createElement("div");
          meta.className = "tMeta";

          const titleEl = document.createElement("div");
          titleEl.className = "tTitle";
          titleEl.textContent = `${id} · ${name}`;

          const btns = document.createElement("div");
          btns.className = "tBtns";

          const a1 = document.createElement("a");
          a1.className = "tBtn";
          a1.href = setHref(id, "audio");
          a1.setAttribute("aria-label", `${id} Audio`);
          a1.innerHTML = `<i class="fa-solid fa-headphones"></i><span>Audio</span>`;

          const a2 = document.createElement("a");
          a2.className = "tBtn";
          a2.href = setHref(id, "video");
          a2.setAttribute("aria-label", `${id} Video`);
          a2.innerHTML = `<i class="fa-solid fa-film"></i><span>Video</span>`;

          btns.append(a1, a2);
          meta.append(titleEl, btns);
          card.append(imgWrap, meta);
          frag.appendChild(card);
        }

        grid.appendChild(frag);
      };

      fetch("./catalog.json", { cache: "no-store" })
        .then((r) => (r.ok ? r.json() : Promise.reject()))
        .then(applyCatalog)
        .catch(() => {
          applyCatalog({
            album: { title: "Deus ex CT", cover: FALLBACK_COVER, tracks: 12 },
            tracks: Array.from({ length: 12 }, (_, i) => ({ id: pad2(i + 1), title: `Track ${pad2(i + 1)}`, cover: FALLBACK_COVER }))
          });
        });
    })();
  </script>
</body>
</html>
